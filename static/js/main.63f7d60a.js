/*! For license information please see main.63f7d60a.js.LICENSE.txt */
!function(){var e={6532:function(e,t){"use strict";var n,i=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.server_context"),c=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),C=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),A=Symbol.for("react.offscreen");function p(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case a:case s:case o:case I:case C:return e;default:switch(e=e&&e.$$typeof){case u:case l:case c:case h:case d:case g:return e;default:return t}}case r:return t}}}n=Symbol.for("react.module.reference")},8457:function(e,t,n){"use strict";n(6532)},5345:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,g=e[s],l=s+1,u=e[l];if(0>a(g,n))l<r&&0>a(u,g)?(e[i]=u,e[l]=n,i=l):(e[i]=g,e[s]=n,i=s);else{if(!(l<r&&0>a(u,n)))break e;e[i]=u,e[l]=n,i=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,g=s.now();t.unstable_now=function(){return s.now()-g}}var l=[],u=[],c=1,I=null,C=3,d=!1,h=!1,A=!1,p="function"===typeof setTimeout?setTimeout:null,m="function"===typeof clearTimeout?clearTimeout:null,f="undefined"!==typeof setImmediate?setImmediate:null;function v(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(l,t)}t=i(u)}}function b(e){if(A=!1,v(e),!h)if(null!==i(l))h=!0,X(y);else{var t=i(u);null!==t&&Y(b,t.startTime-e)}}function y(e,n){h=!1,A&&(A=!1,m(w),w=-1),d=!0;var a=C;try{for(v(n),I=i(l);null!==I&&(!(I.expirationTime>n)||e&&!x());){var o=I.callback;if("function"===typeof o){I.callback=null,C=I.priorityLevel;var s=o(I.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?I.callback=s:I===i(l)&&r(l),v(n)}else r(l);I=i(l)}if(null!==I)var g=!0;else{var c=i(u);null!==c&&Y(b,c.startTime-n),g=!1}return g}finally{I=null,C=a,d=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var G,B=!1,Z=null,w=-1,S=5,W=-1;function x(){return!(t.unstable_now()-W<S)}function R(){if(null!==Z){var e=t.unstable_now();W=e;var n=!0;try{n=Z(!0,e)}finally{n?G():(B=!1,Z=null)}}else B=!1}if("function"===typeof f)G=function(){f(R)};else if("undefined"!==typeof MessageChannel){var V=new MessageChannel,k=V.port2;V.port1.onmessage=R,G=function(){k.postMessage(null)}}else G=function(){p(R,0)};function X(e){Z=e,B||(B=!0,G())}function Y(e,n){w=p((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){h||d||(h=!0,X(y))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return C},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(C){case 1:case 2:case 3:var t=3;break;default:t=C}var n=C;C=t;try{return e()}finally{C=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=C;C=e;try{return t()}finally{C=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:c++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(u,e),null===i(l)&&e===i(u)&&(A?(m(w),w=-1):A=!0,Y(b,a-o))):(e.sortIndex=s,n(l,e),h||d||(h=!0,X(y))),e},t.unstable_shouldYield=x,t.unstable_wrapCallback=function(e){var t=C;return function(){var n=C;C=t;try{return e.apply(this,arguments)}finally{C=n}}}},4545:function(e,t,n){"use strict";e.exports=n(5345)},7494:function(e){function t(e,t,n){var i,r,a,o,s;function g(){var l=Date.now()-o;l<t&&l>=0?i=setTimeout(g,t-l):(i=null,n||(s=e.apply(a,r),a=r=null))}null==t&&(t=100);var l=function(){a=this,r=arguments,o=Date.now();var l=n&&!i;return i||(i=setTimeout(g,t)),l&&(s=e.apply(a,r),a=r=null),s};return l.clear=function(){i&&(clearTimeout(i),i=null)},l.flush=function(){i&&(s=e.apply(a,r),a=r=null,clearTimeout(i),i=null)},l}t.debounce=t,e.exports=t},2110:function(e,t,n){"use strict";var i=n(8309),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function g(e){return i.isMemo(e)?o:s[e.$$typeof]||r}s[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[i.Memo]=o;var l=Object.defineProperty,u=Object.getOwnPropertyNames,c=Object.getOwnPropertySymbols,I=Object.getOwnPropertyDescriptor,C=Object.getPrototypeOf,d=Object.prototype;e.exports=function e(t,n,i){if("string"!==typeof n){if(d){var r=C(n);r&&r!==d&&e(t,r,i)}var o=u(n);c&&(o=o.concat(c(n)));for(var s=g(t),h=g(n),A=0;A<o.length;++A){var p=o[A];if(!a[p]&&(!i||!i[p])&&(!h||!h[p])&&(!s||!s[p])){var m=I(n,p);try{l(t,p,m)}catch(f){}}}}return t}},746:function(e,t){"use strict";var n="function"===typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,g=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,c=n?Symbol.for("react.concurrent_mode"):60111,I=n?Symbol.for("react.forward_ref"):60112,C=n?Symbol.for("react.suspense"):60113,d=n?Symbol.for("react.suspense_list"):60120,h=n?Symbol.for("react.memo"):60115,A=n?Symbol.for("react.lazy"):60116,p=n?Symbol.for("react.block"):60121,m=n?Symbol.for("react.fundamental"):60117,f=n?Symbol.for("react.responder"):60118,v=n?Symbol.for("react.scope"):60119;function b(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case u:case c:case a:case s:case o:case C:return e;default:switch(e=e&&e.$$typeof){case l:case I:case A:case h:case g:return e;default:return t}}case r:return t}}}function y(e){return b(e)===c}t.AsyncMode=u,t.ConcurrentMode=c,t.ContextConsumer=l,t.ContextProvider=g,t.Element=i,t.ForwardRef=I,t.Fragment=a,t.Lazy=A,t.Memo=h,t.Portal=r,t.Profiler=s,t.StrictMode=o,t.Suspense=C,t.isAsyncMode=function(e){return y(e)||b(e)===u},t.isConcurrentMode=y,t.isContextConsumer=function(e){return b(e)===l},t.isContextProvider=function(e){return b(e)===g},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return b(e)===I},t.isFragment=function(e){return b(e)===a},t.isLazy=function(e){return b(e)===A},t.isMemo=function(e){return b(e)===h},t.isPortal=function(e){return b(e)===r},t.isProfiler=function(e){return b(e)===s},t.isStrictMode=function(e){return b(e)===o},t.isSuspense=function(e){return b(e)===C},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===a||e===c||e===s||e===o||e===C||e===d||"object"===typeof e&&null!==e&&(e.$$typeof===A||e.$$typeof===h||e.$$typeof===g||e.$$typeof===l||e.$$typeof===I||e.$$typeof===m||e.$$typeof===f||e.$$typeof===v||e.$$typeof===p)},t.typeOf=b},8309:function(e,t,n){"use strict";e.exports=n(746)},908:function(e,t,n){var i=n(8136)(n(7009),"DataView");e.exports=i},9676:function(e,t,n){var i=n(5403),r=n(2747),a=n(6037),o=n(4154),s=n(7728);function g(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}g.prototype.clear=i,g.prototype.delete=r,g.prototype.get=a,g.prototype.has=o,g.prototype.set=s,e.exports=g},8384:function(e,t,n){var i=n(3894),r=n(8699),a=n(4957),o=n(7184),s=n(7109);function g(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}g.prototype.clear=i,g.prototype.delete=r,g.prototype.get=a,g.prototype.has=o,g.prototype.set=s,e.exports=g},5797:function(e,t,n){var i=n(8136)(n(7009),"Map");e.exports=i},8059:function(e,t,n){var i=n(4086),r=n(9255),a=n(9186),o=n(3423),s=n(3739);function g(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}g.prototype.clear=i,g.prototype.delete=r,g.prototype.get=a,g.prototype.has=o,g.prototype.set=s,e.exports=g},8319:function(e,t,n){var i=n(8136)(n(7009),"Promise");e.exports=i},3924:function(e,t,n){var i=n(8136)(n(7009),"Set");e.exports=i},692:function(e,t,n){var i=n(8059),r=n(5774),a=n(1596);function o(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new i;++t<n;)this.add(e[t])}o.prototype.add=o.prototype.push=r,o.prototype.has=a,e.exports=o},2854:function(e,t,n){var i=n(8384),r=n(511),a=n(835),o=n(707),s=n(8832),g=n(5077);function l(e){var t=this.__data__=new i(e);this.size=t.size}l.prototype.clear=r,l.prototype.delete=a,l.prototype.get=o,l.prototype.has=s,l.prototype.set=g,e.exports=l},7197:function(e,t,n){var i=n(7009).Symbol;e.exports=i},6219:function(e,t,n){var i=n(7009).Uint8Array;e.exports=i},7091:function(e,t,n){var i=n(8136)(n(7009),"WeakMap");e.exports=i},4903:function(e){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,a=[];++n<i;){var o=e[n];t(o,n,e)&&(a[r++]=o)}return a}},7538:function(e,t,n){var i=n(6478),r=n(4963),a=n(3629),o=n(5174),s=n(6800),g=n(9102),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=a(e),u=!n&&r(e),c=!n&&!u&&o(e),I=!n&&!u&&!c&&g(e),C=n||u||c||I,d=C?i(e.length,String):[],h=d.length;for(var A in e)!t&&!l.call(e,A)||C&&("length"==A||c&&("offset"==A||"parent"==A)||I&&("buffer"==A||"byteLength"==A||"byteOffset"==A)||s(A,h))||d.push(A);return d}},8950:function(e){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}},1705:function(e){e.exports=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}},2095:function(e){e.exports=function(e,t,n,i){var r=-1,a=null==e?0:e.length;for(i&&a&&(n=e[++r]);++r<a;)n=t(n,e[r],r,e);return n}},7897:function(e){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}},4622:function(e){e.exports=function(e){return e.split("")}},240:function(e){var t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=function(e){return e.match(t)||[]}},7112:function(e,t,n){var i=n(9231);e.exports=function(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}},2526:function(e,t,n){var i=n(8528);e.exports=function(e,t,n){"__proto__"==t&&i?i(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},5099:function(e,t,n){var i=n(372)();e.exports=i},5358:function(e,t,n){var i=n(5099),r=n(2742);e.exports=function(e,t){return e&&i(e,t,r)}},8667:function(e,t,n){var i=n(3082),r=n(9793);e.exports=function(e,t){for(var n=0,a=(t=i(t,e)).length;null!=e&&n<a;)e=e[r(t[n++])];return n&&n==a?e:void 0}},1986:function(e,t,n){var i=n(1705),r=n(3629);e.exports=function(e,t,n){var a=t(e);return r(e)?a:i(a,n(e))}},9066:function(e,t,n){var i=n(7197),r=n(1587),a=n(3581),o=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?r(e):a(e)}},7852:function(e){var t=Object.prototype.hasOwnProperty;e.exports=function(e,n){return null!=e&&t.call(e,n)}},529:function(e){e.exports=function(e,t){return null!=e&&t in Object(e)}},4906:function(e,t,n){var i=n(9066),r=n(3141);e.exports=function(e){return r(e)&&"[object Arguments]"==i(e)}},1848:function(e,t,n){var i=n(3355),r=n(3141);e.exports=function e(t,n,a,o,s){return t===n||(null==t||null==n||!r(t)&&!r(n)?t!==t&&n!==n:i(t,n,a,o,e,s))}},3355:function(e,t,n){var i=n(2854),r=n(5305),a=n(2206),o=n(8078),s=n(8383),g=n(3629),l=n(5174),u=n(9102),c="[object Arguments]",I="[object Array]",C="[object Object]",d=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,h,A,p){var m=g(e),f=g(t),v=m?I:s(e),b=f?I:s(t),y=(v=v==c?C:v)==C,G=(b=b==c?C:b)==C,B=v==b;if(B&&l(e)){if(!l(t))return!1;m=!0,y=!1}if(B&&!y)return p||(p=new i),m||u(e)?r(e,t,n,h,A,p):a(e,t,v,n,h,A,p);if(!(1&n)){var Z=y&&d.call(e,"__wrapped__"),w=G&&d.call(t,"__wrapped__");if(Z||w){var S=Z?e.value():e,W=w?t.value():t;return p||(p=new i),A(S,W,n,h,p)}}return!!B&&(p||(p=new i),o(e,t,n,h,A,p))}},8856:function(e,t,n){var i=n(2854),r=n(1848);e.exports=function(e,t,n,a){var o=n.length,s=o,g=!a;if(null==e)return!s;for(e=Object(e);o--;){var l=n[o];if(g&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++o<s;){var u=(l=n[o])[0],c=e[u],I=l[1];if(g&&l[2]){if(void 0===c&&!(u in e))return!1}else{var C=new i;if(a)var d=a(c,I,u,e,t,C);if(!(void 0===d?r(I,c,3,a,C):d))return!1}}return!0}},6703:function(e,t,n){var i=n(4786),r=n(257),a=n(8092),o=n(7907),s=/^\[object .+?Constructor\]$/,g=Function.prototype,l=Object.prototype,u=g.toString,c=l.hasOwnProperty,I=RegExp("^"+u.call(c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!a(e)||r(e))&&(i(e)?I:s).test(o(e))}},8150:function(e,t,n){var i=n(9066),r=n(4635),a=n(3141),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return a(e)&&r(e.length)&&!!o[i(e)]}},6025:function(e,t,n){var i=n(7080),r=n(4322),a=n(2100),o=n(3629),s=n(38);e.exports=function(e){return"function"==typeof e?e:null==e?a:"object"==typeof e?o(e)?r(e[0],e[1]):i(e):s(e)}},3654:function(e,t,n){var i=n(2936),r=n(8836),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t=[];for(var n in Object(e))a.call(e,n)&&"constructor"!=n&&t.push(n);return t}},7080:function(e,t,n){var i=n(8856),r=n(9091),a=n(284);e.exports=function(e){var t=r(e);return 1==t.length&&t[0][2]?a(t[0][0],t[0][1]):function(n){return n===e||i(n,e,t)}}},4322:function(e,t,n){var i=n(1848),r=n(6181),a=n(5658),o=n(5823),s=n(5072),g=n(284),l=n(9793);e.exports=function(e,t){return o(e)&&s(t)?g(l(e),t):function(n){var o=r(n,e);return void 0===o&&o===t?a(n,e):i(t,o,3)}}},9586:function(e){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},4084:function(e,t,n){var i=n(8667);e.exports=function(e){return function(t){return i(t,e)}}},4632:function(e){e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},2646:function(e){e.exports=function(e,t,n){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(n=n>r?r:n)<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(r);++i<r;)a[i]=e[i+t];return a}},6478:function(e){e.exports=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}},2446:function(e,t,n){var i=n(7197),r=n(8950),a=n(3629),o=n(152),s=i?i.prototype:void 0,g=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(a(t))return r(t,e)+"";if(o(t))return g?g.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n}},6194:function(e){e.exports=function(e){return function(t){return e(t)}}},75:function(e){e.exports=function(e,t){return e.has(t)}},3082:function(e,t,n){var i=n(3629),r=n(5823),a=n(170),o=n(3518);e.exports=function(e,t){return i(e)?e:r(e,t)?[e]:a(o(e))}},9813:function(e,t,n){var i=n(2646);e.exports=function(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:i(e,t,n)}},5525:function(e,t,n){var i=n(7009)["__core-js_shared__"];e.exports=i},372:function(e){e.exports=function(e){return function(t,n,i){for(var r=-1,a=Object(t),o=i(t),s=o.length;s--;){var g=o[e?s:++r];if(!1===n(a[g],g,a))break}return t}}},322:function(e,t,n){var i=n(9813),r=n(7302),a=n(7580),o=n(3518);e.exports=function(e){return function(t){t=o(t);var n=r(t)?a(t):void 0,s=n?n[0]:t.charAt(0),g=n?i(n,1).join(""):t.slice(1);return s[e]()+g}}},7810:function(e,t,n){var i=n(2095),r=n(4857),a=n(5660),o=RegExp("['\u2019]","g");e.exports=function(e){return function(t){return i(a(r(t).replace(o,"")),e,"")}}},5868:function(e,t,n){var i=n(4632)({"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"});e.exports=i},8528:function(e,t,n){var i=n(8136),r=function(){try{var e=i(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();e.exports=r},5305:function(e,t,n){var i=n(692),r=n(7897),a=n(75);e.exports=function(e,t,n,o,s,g){var l=1&n,u=e.length,c=t.length;if(u!=c&&!(l&&c>u))return!1;var I=g.get(e),C=g.get(t);if(I&&C)return I==t&&C==e;var d=-1,h=!0,A=2&n?new i:void 0;for(g.set(e,t),g.set(t,e);++d<u;){var p=e[d],m=t[d];if(o)var f=l?o(m,p,d,t,e,g):o(p,m,d,e,t,g);if(void 0!==f){if(f)continue;h=!1;break}if(A){if(!r(t,(function(e,t){if(!a(A,t)&&(p===e||s(p,e,n,o,g)))return A.push(t)}))){h=!1;break}}else if(p!==m&&!s(p,m,n,o,g)){h=!1;break}}return g.delete(e),g.delete(t),h}},2206:function(e,t,n){var i=n(7197),r=n(6219),a=n(9231),o=n(5305),s=n(234),g=n(2230),l=i?i.prototype:void 0,u=l?l.valueOf:void 0;e.exports=function(e,t,n,i,l,c,I){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!c(new r(e),new r(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return a(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var C=s;case"[object Set]":var d=1&i;if(C||(C=g),e.size!=t.size&&!d)return!1;var h=I.get(e);if(h)return h==t;i|=2,I.set(e,t);var A=o(C(e),C(t),i,l,c,I);return I.delete(e),A;case"[object Symbol]":if(u)return u.call(e)==u.call(t)}return!1}},8078:function(e,t,n){var i=n(8248),r=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,a,o,s){var g=1&n,l=i(e),u=l.length;if(u!=i(t).length&&!g)return!1;for(var c=u;c--;){var I=l[c];if(!(g?I in t:r.call(t,I)))return!1}var C=s.get(e),d=s.get(t);if(C&&d)return C==t&&d==e;var h=!0;s.set(e,t),s.set(t,e);for(var A=g;++c<u;){var p=e[I=l[c]],m=t[I];if(a)var f=g?a(m,p,I,t,e,s):a(p,m,I,e,t,s);if(!(void 0===f?p===m||o(p,m,n,a,s):f)){h=!1;break}A||(A="constructor"==I)}if(h&&!A){var v=e.constructor,b=t.constructor;v==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b||(h=!1)}return s.delete(e),s.delete(t),h}},1032:function(e,t,n){var i="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g;e.exports=i},8248:function(e,t,n){var i=n(1986),r=n(5918),a=n(2742);e.exports=function(e){return i(e,a,r)}},2799:function(e,t,n){var i=n(5964);e.exports=function(e,t){var n=e.__data__;return i(t)?n["string"==typeof t?"string":"hash"]:n.map}},9091:function(e,t,n){var i=n(5072),r=n(2742);e.exports=function(e){for(var t=r(e),n=t.length;n--;){var a=t[n],o=e[a];t[n]=[a,o,i(o)]}return t}},8136:function(e,t,n){var i=n(6703),r=n(40);e.exports=function(e,t){var n=r(e,t);return i(n)?n:void 0}},1587:function(e,t,n){var i=n(7197),r=Object.prototype,a=r.hasOwnProperty,o=r.toString,s=i?i.toStringTag:void 0;e.exports=function(e){var t=a.call(e,s),n=e[s];try{e[s]=void 0;var i=!0}catch(g){}var r=o.call(e);return i&&(t?e[s]=n:delete e[s]),r}},5918:function(e,t,n){var i=n(4903),r=n(8174),a=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,s=o?function(e){return null==e?[]:(e=Object(e),i(o(e),(function(t){return a.call(e,t)})))}:r;e.exports=s},8383:function(e,t,n){var i=n(908),r=n(5797),a=n(8319),o=n(3924),s=n(7091),g=n(9066),l=n(7907),u="[object Map]",c="[object Promise]",I="[object Set]",C="[object WeakMap]",d="[object DataView]",h=l(i),A=l(r),p=l(a),m=l(o),f=l(s),v=g;(i&&v(new i(new ArrayBuffer(1)))!=d||r&&v(new r)!=u||a&&v(a.resolve())!=c||o&&v(new o)!=I||s&&v(new s)!=C)&&(v=function(e){var t=g(e),n="[object Object]"==t?e.constructor:void 0,i=n?l(n):"";if(i)switch(i){case h:return d;case A:return u;case p:return c;case m:return I;case f:return C}return t}),e.exports=v},40:function(e){e.exports=function(e,t){return null==e?void 0:e[t]}},6417:function(e,t,n){var i=n(3082),r=n(4963),a=n(3629),o=n(6800),s=n(4635),g=n(9793);e.exports=function(e,t,n){for(var l=-1,u=(t=i(t,e)).length,c=!1;++l<u;){var I=g(t[l]);if(!(c=null!=e&&n(e,I)))break;e=e[I]}return c||++l!=u?c:!!(u=null==e?0:e.length)&&s(u)&&o(I,u)&&(a(e)||r(e))}},7302:function(e){var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},7137:function(e){var t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;e.exports=function(e){return t.test(e)}},5403:function(e,t,n){var i=n(9620);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},2747:function(e){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},6037:function(e,t,n){var i=n(9620),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return r.call(t,e)?t[e]:void 0}},4154:function(e,t,n){var i=n(9620),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:r.call(t,e)}},7728:function(e,t,n){var i=n(9620);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},6800:function(e){var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,n){var i=typeof e;return!!(n=null==n?9007199254740991:n)&&("number"==i||"symbol"!=i&&t.test(e))&&e>-1&&e%1==0&&e<n}},5823:function(e,t,n){var i=n(3629),r=n(152),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;e.exports=function(e,t){if(i(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!r(e))||(o.test(e)||!a.test(e)||null!=t&&e in Object(t))}},5964:function(e){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},257:function(e,t,n){var i=n(5525),r=function(){var e=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=function(e){return!!r&&r in e}},2936:function(e){var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},5072:function(e,t,n){var i=n(8092);e.exports=function(e){return e===e&&!i(e)}},3894:function(e){e.exports=function(){this.__data__=[],this.size=0}},8699:function(e,t,n){var i=n(7112),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=i(t,e);return!(n<0)&&(n==t.length-1?t.pop():r.call(t,n,1),--this.size,!0)}},4957:function(e,t,n){var i=n(7112);e.exports=function(e){var t=this.__data__,n=i(t,e);return n<0?void 0:t[n][1]}},7184:function(e,t,n){var i=n(7112);e.exports=function(e){return i(this.__data__,e)>-1}},7109:function(e,t,n){var i=n(7112);e.exports=function(e,t){var n=this.__data__,r=i(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},4086:function(e,t,n){var i=n(9676),r=n(8384),a=n(5797);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(a||r),string:new i}}},9255:function(e,t,n){var i=n(2799);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},9186:function(e,t,n){var i=n(2799);e.exports=function(e){return i(this,e).get(e)}},3423:function(e,t,n){var i=n(2799);e.exports=function(e){return i(this,e).has(e)}},3739:function(e,t,n){var i=n(2799);e.exports=function(e,t){var n=i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},234:function(e){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}},284:function(e){e.exports=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}},4634:function(e,t,n){var i=n(9151);e.exports=function(e){var t=i(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},9620:function(e,t,n){var i=n(8136)(Object,"create");e.exports=i},8836:function(e,t,n){var i=n(2709)(Object.keys,Object);e.exports=i},9494:function(e,t,n){e=n.nmd(e);var i=n(1032),r=t&&!t.nodeType&&t,a=r&&e&&!e.nodeType&&e,o=a&&a.exports===r&&i.process,s=function(){try{var e=a&&a.require&&a.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(t){}}();e.exports=s},3581:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},2709:function(e){e.exports=function(e,t){return function(n){return e(t(n))}}},7009:function(e,t,n){var i=n(1032),r="object"==typeof self&&self&&self.Object===Object&&self,a=i||r||Function("return this")();e.exports=a},5774:function(e){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},1596:function(e){e.exports=function(e){return this.__data__.has(e)}},2230:function(e){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},511:function(e,t,n){var i=n(8384);e.exports=function(){this.__data__=new i,this.size=0}},835:function(e){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},707:function(e){e.exports=function(e){return this.__data__.get(e)}},8832:function(e){e.exports=function(e){return this.__data__.has(e)}},5077:function(e,t,n){var i=n(8384),r=n(5797),a=n(8059);e.exports=function(e,t){var n=this.__data__;if(n instanceof i){var o=n.__data__;if(!r||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new a(o)}return n.set(e,t),this.size=n.size,this}},7580:function(e,t,n){var i=n(4622),r=n(7302),a=n(2129);e.exports=function(e){return r(e)?a(e):i(e)}},170:function(e,t,n){var i=n(4634),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,o=i((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(r,(function(e,n,i,r){t.push(i?r.replace(a,"$1"):n||e)})),t}));e.exports=o},9793:function(e,t,n){var i=n(152);e.exports=function(e){if("string"==typeof e||i(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}},7907:function(e){var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(n){}try{return e+""}catch(n){}}return""}},2129:function(e){var t="[\\ud800-\\udfff]",n="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",r="[^\\ud800-\\udfff]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",o="[\\ud800-\\udbff][\\udc00-\\udfff]",s="(?:"+n+"|"+i+")"+"?",g="[\\ufe0e\\ufe0f]?",l=g+s+("(?:\\u200d(?:"+[r,a,o].join("|")+")"+g+s+")*"),u="(?:"+[r+n+"?",n,a,o,t].join("|")+")",c=RegExp(i+"(?="+i+")|"+u+l,"g");e.exports=function(e){return e.match(c)||[]}},1029:function(e){var t="\\u2700-\\u27bf",n="a-z\\xdf-\\xf6\\xf8-\\xff",i="A-Z\\xc0-\\xd6\\xd8-\\xde",r="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",a="["+r+"]",o="\\d+",s="[\\u2700-\\u27bf]",g="["+n+"]",l="[^\\ud800-\\udfff"+r+o+t+n+i+"]",u="(?:\\ud83c[\\udde6-\\uddff]){2}",c="[\\ud800-\\udbff][\\udc00-\\udfff]",I="["+i+"]",C="(?:"+g+"|"+l+")",d="(?:"+I+"|"+l+")",h="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",A="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",p="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",m="[\\ufe0e\\ufe0f]?",f=m+p+("(?:\\u200d(?:"+["[^\\ud800-\\udfff]",u,c].join("|")+")"+m+p+")*"),v="(?:"+[s,u,c].join("|")+")"+f,b=RegExp([I+"?"+g+"+"+h+"(?="+[a,I,"$"].join("|")+")",d+"+"+A+"(?="+[a,I+C,"$"].join("|")+")",I+"?"+C+"+"+h,I+"+"+A,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",o,v].join("|"),"g");e.exports=function(e){return e.match(b)||[]}},567:function(e,t,n){var i=n(3131),r=n(7810)((function(e,t,n){return t=t.toLowerCase(),e+(n?i(t):t)}));e.exports=r},3131:function(e,t,n){var i=n(3518),r=n(2085);e.exports=function(e){return r(i(e).toLowerCase())}},4857:function(e,t,n){var i=n(5868),r=n(3518),a=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,o=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");e.exports=function(e){return(e=r(e))&&e.replace(a,i).replace(o,"")}},9231:function(e){e.exports=function(e,t){return e===t||e!==e&&t!==t}},6181:function(e,t,n){var i=n(8667);e.exports=function(e,t,n){var r=null==e?void 0:i(e,t);return void 0===r?n:r}},7805:function(e,t,n){var i=n(7852),r=n(6417);e.exports=function(e,t){return null!=e&&r(e,t,i)}},5658:function(e,t,n){var i=n(529),r=n(6417);e.exports=function(e,t){return null!=e&&r(e,t,i)}},2100:function(e){e.exports=function(e){return e}},4963:function(e,t,n){var i=n(4906),r=n(3141),a=Object.prototype,o=a.hasOwnProperty,s=a.propertyIsEnumerable,g=i(function(){return arguments}())?i:function(e){return r(e)&&o.call(e,"callee")&&!s.call(e,"callee")};e.exports=g},3629:function(e){var t=Array.isArray;e.exports=t},1473:function(e,t,n){var i=n(4786),r=n(4635);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},5174:function(e,t,n){e=n.nmd(e);var i=n(7009),r=n(9488),a=t&&!t.nodeType&&t,o=a&&e&&!e.nodeType&&e,s=o&&o.exports===a?i.Buffer:void 0,g=(s?s.isBuffer:void 0)||r;e.exports=g},4786:function(e,t,n){var i=n(9066),r=n(8092);e.exports=function(e){if(!r(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},4635:function(e){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},8092:function(e){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},3141:function(e){e.exports=function(e){return null!=e&&"object"==typeof e}},152:function(e,t,n){var i=n(9066),r=n(3141);e.exports=function(e){return"symbol"==typeof e||r(e)&&"[object Symbol]"==i(e)}},9102:function(e,t,n){var i=n(8150),r=n(6194),a=n(9494),o=a&&a.isTypedArray,s=o?r(o):i;e.exports=s},2742:function(e,t,n){var i=n(7538),r=n(3654),a=n(1473);e.exports=function(e){return a(e)?i(e):r(e)}},9029:function(e,t,n){var i=n(2526),r=n(5358),a=n(6025);e.exports=function(e,t){var n={};return t=a(t,3),r(e,(function(e,r,a){i(n,t(e,r,a),e)})),n}},7702:function(e,t,n){var i=n(2526),r=n(5358),a=n(6025);e.exports=function(e,t){var n={};return t=a(t,3),r(e,(function(e,r,a){i(n,r,t(e,r,a))})),n}},9151:function(e,t,n){var i=n(8059);function r(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var i=arguments,r=t?t.apply(this,i):i[0],a=n.cache;if(a.has(r))return a.get(r);var o=e.apply(this,i);return n.cache=a.set(r,o)||a,o};return n.cache=new(r.Cache||i),n}r.Cache=i,e.exports=r},38:function(e,t,n){var i=n(9586),r=n(4084),a=n(5823),o=n(9793);e.exports=function(e){return a(e)?i(o(e)):r(e)}},7499:function(e,t,n){var i=n(7810)((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));e.exports=i},8174:function(e){e.exports=function(){return[]}},9488:function(e){e.exports=function(){return!1}},3518:function(e,t,n){var i=n(2446);e.exports=function(e){return null==e?"":i(e)}},2085:function(e,t,n){var i=n(322)("toUpperCase");e.exports=i},5660:function(e,t,n){var i=n(240),r=n(7137),a=n(3518),o=n(1029);e.exports=function(e,t,n){return e=a(e),void 0===(t=n?void 0:t)?r(e)?o(e):i(e):e.match(t)||[]}},2758:function(e){"use strict";function t(e){this._maxSize=e,this.clear()}t.prototype.clear=function(){this._size=0,this._values=Object.create(null)},t.prototype.get=function(e){return this._values[e]},t.prototype.set=function(e,t){return this._size>=this._maxSize&&this.clear(),e in this._values||this._size++,this._values[e]=t};var n=/[^.^\]^[]+|(?=\[\]|\.\.)/g,i=/^\d+$/,r=/^\d/,a=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,o=/^\s*(['"]?)(.*?)(\1)\s*$/,s=new t(512),g=new t(512),l=new t(512);function u(e){return s.get(e)||s.set(e,c(e).map((function(e){return e.replace(o,"$2")})))}function c(e){return e.match(n)||[""]}function I(e){return"string"===typeof e&&e&&-1!==["'",'"'].indexOf(e.charAt(0))}function C(e){return!I(e)&&(function(e){return e.match(r)&&!e.match(i)}(e)||function(e){return a.test(e)}(e))}e.exports={Cache:t,split:c,normalizePath:u,setter:function(e){var t=u(e);return g.get(e)||g.set(e,(function(e,n){for(var i=0,r=t.length,a=e;i<r-1;){var o=t[i];if("__proto__"===o||"constructor"===o||"prototype"===o)return e;a=a[t[i++]]}a[t[i]]=n}))},getter:function(e,t){var n=u(e);return l.get(e)||l.set(e,(function(e){for(var i=0,r=n.length;i<r;){if(null==e&&t)return;e=e[n[i++]]}return e}))},join:function(e){return e.reduce((function(e,t){return e+(I(t)||i.test(t)?"["+t+"]":(e?".":"")+t)}),"")},forEach:function(e,t,n){!function(e,t,n){var i,r,a,o,s=e.length;for(r=0;r<s;r++)(i=e[r])&&(C(i)&&(i='"'+i+'"'),a=!(o=I(i))&&/^\d+$/.test(i),t.call(n,i,o,a,r,e))}(Array.isArray(e)?e:c(e),t,n)}}},4463:function(e,t,n){"use strict";var i=n(2791),r=n(5296);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function g(e,t){l(e,t),l(e+"Capture",t)}function l(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),c=Object.prototype.hasOwnProperty,I=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},d={};function h(e,t,n,i,r,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var A={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){A[e]=new h(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];A[t]=new h(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){A[e]=new h(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){A[e]=new h(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){A[e]=new h(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){A[e]=new h(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){A[e]=new h(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){A[e]=new h(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){A[e]=new h(e,5,!1,e.toLowerCase(),null,!1,!1)}));var p=/[\-:]([a-z])/g;function m(e){return e[1].toUpperCase()}function f(e,t,n,i){var r=A.hasOwnProperty(t)?A[t]:null;(null!==r?0!==r.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,i)&&(n=null),i||null===r?function(e){return!!c.call(d,e)||!c.call(C,e)&&(I.test(e)?d[e]=!0:(C[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,i=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(p,m);A[t]=new h(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(p,m);A[t]=new h(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(p,m);A[t]=new h(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){A[e]=new h(e,1,!1,e.toLowerCase(),null,!1,!1)})),A.xlinkHref=new h("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){A[e]=new h(e,1,!1,e.toLowerCase(),null,!0,!0)}));var v=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),y=Symbol.for("react.portal"),G=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),Z=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),S=Symbol.for("react.context"),W=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),R=Symbol.for("react.suspense_list"),V=Symbol.for("react.memo"),k=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var X=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var Y=Symbol.iterator;function H(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=Y&&e[Y]||e["@@iterator"])?e:null}var F,M=Object.assign;function K(e){if(void 0===F)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var N=!1;function z(e,t){if(!e||N)return"";N=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var g="\n"+r[o].replace(" at new "," at ");return e.displayName&&g.includes("<anonymous>")&&(g=g.replace("<anonymous>",e.displayName)),g}}while(1<=o&&0<=s);break}}}finally{N=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?K(e):""}function L(e){switch(e.tag){case 5:return K(e.type);case 16:return K("Lazy");case 13:return K("Suspense");case 19:return K("SuspenseList");case 0:case 2:case 15:return e=z(e.type,!1);case 11:return e=z(e.type.render,!1);case 1:return e=z(e.type,!0);default:return""}}function _(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case G:return"Fragment";case y:return"Portal";case Z:return"Profiler";case B:return"StrictMode";case x:return"Suspense";case R:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case S:return(e.displayName||"Context")+".Consumer";case w:return(e._context.displayName||"Context")+".Provider";case W:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case V:return null!==(t=e.displayName||null)?t:_(e.type)||"Memo";case k:t=e._payload,e=e._init;try{return _(e(t))}catch(n){}}return null}function T(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _(t);case 8:return t===B?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function E(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function J(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function D(e){e._valueTracker||(e._valueTracker=function(e){var t=J(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){i=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function U(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=J(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function P(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function O(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=E(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function j(e,t){null!=(t=t.checked)&&f(e,"checked",t,!1)}function q(e,t){j(e,t);var n=E(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,E(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&P(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&i&&(e[n].defaultSelected=!0)}else{for(n=""+E(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(i&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:E(n)}}function ae(e,t){var n=E(t.value),i=E(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ge(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var le,ue,ce=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((le=le||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=le.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function Ie(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var Ce={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},de=["Webkit","ms","Moz","O"];function he(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||Ce.hasOwnProperty(e)&&Ce[e]?(""+t).trim():t+"px"}function Ae(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),r=he(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,r):e[n]=r}}Object.keys(Ce).forEach((function(e){de.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ce[t]=Ce[e]}))}));var pe=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function me(e,t){if(t){if(pe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function fe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var ye=null,Ge=null,Be=null;function Ze(e){if(e=fr(e)){if("function"!==typeof ye)throw Error(a(280));var t=e.stateNode;t&&(t=br(t),ye(e.stateNode,e.type,t))}}function we(e){Ge?Be?Be.push(e):Be=[e]:Ge=e}function Se(){if(Ge){var e=Ge,t=Be;if(Be=Ge=null,Ze(e),t)for(e=0;e<t.length;e++)Ze(t[e])}}function We(e,t){return e(t)}function xe(){}var Re=!1;function Ve(e,t,n){if(Re)return e(t,n);Re=!0;try{return We(e,t,n)}finally{Re=!1,(null!==Ge||null!==Be)&&(xe(),Se())}}function ke(e,t){var n=e.stateNode;if(null===n)return null;var i=br(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var Xe=!1;if(u)try{var Ye={};Object.defineProperty(Ye,"passive",{get:function(){Xe=!0}}),window.addEventListener("test",Ye,Ye),window.removeEventListener("test",Ye,Ye)}catch(ue){Xe=!1}function He(e,t,n,i,r,a,o,s,g){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(u){this.onError(u)}}var Fe=!1,Me=null,Ke=!1,Ne=null,ze={onError:function(e){Fe=!0,Me=e}};function Le(e,t,n,i,r,a,o,s,g){Fe=!1,Me=null,He.apply(ze,arguments)}function _e(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Te(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ee(e){if(_e(e)!==e)throw Error(a(188))}function Je(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=_e(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var o=r.alternate;if(null===o){if(null!==(i=r.return)){n=i;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Ee(r),e;if(o===i)return Ee(r),t;o=o.sibling}throw Error(a(188))}if(n.return!==i.return)n=r,i=o;else{for(var s=!1,g=r.child;g;){if(g===n){s=!0,n=r,i=o;break}if(g===i){s=!0,i=r,n=o;break}g=g.sibling}if(!s){for(g=o.child;g;){if(g===n){s=!0,n=o,i=r;break}if(g===i){s=!0,i=o,n=r;break}g=g.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?De(e):null}function De(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=De(e);if(null!==t)return t;e=e.sibling}return null}var Ue=r.unstable_scheduleCallback,Pe=r.unstable_cancelCallback,Qe=r.unstable_shouldYield,Oe=r.unstable_requestPaint,je=r.unstable_now,qe=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,it=r.unstable_IdlePriority,rt=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(st(e)/gt|0)|0},st=Math.log,gt=Math.LN2;var lt=64,ut=4194304;function ct(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function It(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=ct(s):0!==(a&=o)&&(i=ct(a))}else 0!==(o=n&~r)?i=ct(o):0!==a&&(i=ct(a));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-ot(t)),i|=e[n],t&=~r;return i}function Ct(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function dt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ht(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function At(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function pt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function mt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ot(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var ft=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,yt,Gt,Bt,Zt,wt=!1,St=[],Wt=null,xt=null,Rt=null,Vt=new Map,kt=new Map,Xt=[],Yt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ht(e,t){switch(e){case"focusin":case"focusout":Wt=null;break;case"dragenter":case"dragleave":xt=null;break;case"mouseover":case"mouseout":Rt=null;break;case"pointerover":case"pointerout":Vt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":kt.delete(t.pointerId)}}function Ft(e,t,n,i,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=fr(t))&&yt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Mt(e){var t=mr(e.target);if(null!==t){var n=_e(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Te(n)))return e.blockedOn=t,void Zt(e.priority,(function(){Gt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Kt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=fr(n))&&yt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);ve=i,n.target.dispatchEvent(i),ve=null,t.shift()}return!0}function Nt(e,t,n){Kt(e)&&n.delete(t)}function zt(){wt=!1,null!==Wt&&Kt(Wt)&&(Wt=null),null!==xt&&Kt(xt)&&(xt=null),null!==Rt&&Kt(Rt)&&(Rt=null),Vt.forEach(Nt),kt.forEach(Nt)}function Lt(e,t){e.blockedOn===t&&(e.blockedOn=null,wt||(wt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,zt)))}function _t(e){function t(t){return Lt(t,e)}if(0<St.length){Lt(St[0],e);for(var n=1;n<St.length;n++){var i=St[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==Wt&&Lt(Wt,e),null!==xt&&Lt(xt,e),null!==Rt&&Lt(Rt,e),Vt.forEach(t),kt.forEach(t),n=0;n<Xt.length;n++)(i=Xt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Xt.length&&null===(n=Xt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Xt.shift()}var Tt=v.ReactCurrentBatchConfig,Et=!0;function Jt(e,t,n,i){var r=ft,a=Tt.transition;Tt.transition=null;try{ft=1,Ut(e,t,n,i)}finally{ft=r,Tt.transition=a}}function Dt(e,t,n,i){var r=ft,a=Tt.transition;Tt.transition=null;try{ft=4,Ut(e,t,n,i)}finally{ft=r,Tt.transition=a}}function Ut(e,t,n,i){if(Et){var r=Qt(e,t,n,i);if(null===r)Ei(e,t,i,Pt,n),Ht(e,i);else if(function(e,t,n,i,r){switch(t){case"focusin":return Wt=Ft(Wt,e,t,n,i,r),!0;case"dragenter":return xt=Ft(xt,e,t,n,i,r),!0;case"mouseover":return Rt=Ft(Rt,e,t,n,i,r),!0;case"pointerover":var a=r.pointerId;return Vt.set(a,Ft(Vt.get(a)||null,e,t,n,i,r)),!0;case"gotpointercapture":return a=r.pointerId,kt.set(a,Ft(kt.get(a)||null,e,t,n,i,r)),!0}return!1}(r,e,t,n,i))i.stopPropagation();else if(Ht(e,i),4&t&&-1<Yt.indexOf(e)){for(;null!==r;){var a=fr(r);if(null!==a&&bt(a),null===(a=Qt(e,t,n,i))&&Ei(e,t,i,Pt,n),a===r)break;r=a}null!==r&&i.stopPropagation()}else Ei(e,t,i,null,n)}}var Pt=null;function Qt(e,t,n,i){if(Pt=null,null!==(e=mr(e=be(i))))if(null===(t=_e(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Te(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Pt=e,null}function Ot(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var jt=null,qt=null,$t=null;function en(){if($t)return $t;var e,t,n=qt,i=n.length,r="value"in jt?jt.value:jt.textContent,a=r.length;for(e=0;e<i&&n[e]===r[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===r[a-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,i,r,a){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(r):r[o]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,gn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=an(ln),cn=M({},ln,{view:0,detail:0}),In=an(cn),Cn=M({},cn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==gn&&(gn&&"mousemove"===e.type?(on=e.screenX-gn.screenX,sn=e.screenY-gn.screenY):sn=on=0,gn=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),dn=an(Cn),hn=an(M({},Cn,{dataTransfer:0})),An=an(M({},cn,{relatedTarget:0})),pn=an(M({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),mn=M({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),fn=an(mn),vn=an(M({},ln,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Gn[e])&&!!t[e]}function Zn(){return Bn}var wn=M({},cn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?yn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Sn=an(wn),Wn=an(M({},Cn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),xn=an(M({},cn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zn})),Rn=an(M({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Vn=M({},Cn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),kn=an(Vn),Xn=[9,13,27,32],Yn=u&&"CompositionEvent"in window,Hn=null;u&&"documentMode"in document&&(Hn=document.documentMode);var Fn=u&&"TextEvent"in window&&!Hn,Mn=u&&(!Yn||Hn&&8<Hn&&11>=Hn),Kn=String.fromCharCode(32),Nn=!1;function zn(e,t){switch(e){case"keyup":return-1!==Xn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ln(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var _n=!1;var Tn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function En(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Tn[e.type]:"textarea"===t}function Jn(e,t,n,i){we(i),0<(t=Di(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Dn=null,Un=null;function Pn(e){Ki(e,0)}function Qn(e){if(U(vr(e)))return e}function On(e,t){if("change"===e)return t}var jn=!1;if(u){var qn;if(u){var $n="oninput"in document;if(!$n){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),$n="function"===typeof ei.oninput}qn=$n}else qn=!1;jn=qn&&(!document.documentMode||9<document.documentMode)}function ti(){Dn&&(Dn.detachEvent("onpropertychange",ni),Un=Dn=null)}function ni(e){if("value"===e.propertyName&&Qn(Un)){var t=[];Jn(t,Un,e,be(e)),Ve(Pn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Un=n,(Dn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function ri(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Un)}function ai(e,t){if("click"===e)return Qn(t)}function oi(e,t){if("input"===e||"change"===e)return Qn(t)}var si="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function gi(e,t){if(si(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!c.call(t,r)||!si(e[r],t[r]))return!1}return!0}function li(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=li(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=li(i)}}function ci(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?ci(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Ii(){for(var e=window,t=P();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=P((e=t.contentWindow).document)}return t}function Ci(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function di(e){var t=Ii(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&ci(n.ownerDocument.documentElement,n)){if(null!==i&&Ci(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,a=Math.min(i.start,r);i=void 0===i.end?a:Math.min(i.end,r),!e.extend&&a>i&&(r=i,i=a,a=r),r=ui(n,a);var o=ui(n,i);r&&o&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hi=u&&"documentMode"in document&&11>=document.documentMode,Ai=null,pi=null,mi=null,fi=!1;function vi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;fi||null==Ai||Ai!==P(i)||("selectionStart"in(i=Ai)&&Ci(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},mi&&gi(mi,i)||(mi=i,0<(i=Di(pi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=Ai)))}function bi(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var yi={animationend:bi("Animation","AnimationEnd"),animationiteration:bi("Animation","AnimationIteration"),animationstart:bi("Animation","AnimationStart"),transitionend:bi("Transition","TransitionEnd")},Gi={},Bi={};function Zi(e){if(Gi[e])return Gi[e];if(!yi[e])return e;var t,n=yi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Bi)return Gi[e]=n[t];return e}u&&(Bi=document.createElement("div").style,"AnimationEvent"in window||(delete yi.animationend.animation,delete yi.animationiteration.animation,delete yi.animationstart.animation),"TransitionEvent"in window||delete yi.transitionend.transition);var wi=Zi("animationend"),Si=Zi("animationiteration"),Wi=Zi("animationstart"),xi=Zi("transitionend"),Ri=new Map,Vi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ki(e,t){Ri.set(e,t),g(t,[e])}for(var Xi=0;Xi<Vi.length;Xi++){var Yi=Vi[Xi];ki(Yi.toLowerCase(),"on"+(Yi[0].toUpperCase()+Yi.slice(1)))}ki(wi,"onAnimationEnd"),ki(Si,"onAnimationIteration"),ki(Wi,"onAnimationStart"),ki("dblclick","onDoubleClick"),ki("focusin","onFocus"),ki("focusout","onBlur"),ki(xi,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),g("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),g("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),g("onBeforeInput",["compositionend","keypress","textInput","paste"]),g("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),g("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),g("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hi));function Mi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,r,o,s,g,l){if(Le.apply(this,arguments),Fe){if(!Fe)throw Error(a(198));var u=Me;Fe=!1,Me=null,Ke||(Ke=!0,Ne=u)}}(i,t,void 0,e),e.currentTarget=null}function Ki(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],r=i.event;i=i.listeners;e:{var a=void 0;if(t)for(var o=i.length-1;0<=o;o--){var s=i[o],g=s.instance,l=s.currentTarget;if(s=s.listener,g!==a&&r.isPropagationStopped())break e;Mi(r,s,l),a=g}else for(o=0;o<i.length;o++){if(g=(s=i[o]).instance,l=s.currentTarget,s=s.listener,g!==a&&r.isPropagationStopped())break e;Mi(r,s,l),a=g}}}if(Ke)throw e=Ne,Ke=!1,Ne=null,e}function Ni(e,t){var n=t[hr];void 0===n&&(n=t[hr]=new Set);var i=e+"__bubble";n.has(i)||(Ti(t,e,2,!1),n.add(i))}function zi(e,t,n){var i=0;t&&(i|=4),Ti(n,e,i,t)}var Li="_reactListening"+Math.random().toString(36).slice(2);function _i(e){if(!e[Li]){e[Li]=!0,o.forEach((function(t){"selectionchange"!==t&&(Fi.has(t)||zi(t,!1,e),zi(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Li]||(t[Li]=!0,zi("selectionchange",!1,t))}}function Ti(e,t,n,i){switch(Ot(t)){case 1:var r=Jt;break;case 4:r=Dt;break;default:r=Ut}n=r.bind(null,t,n,e),r=void 0,!Xe||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),i?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Ei(e,t,n,i,r){var a=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var s=i.stateNode.containerInfo;if(s===r||8===s.nodeType&&s.parentNode===r)break;if(4===o)for(o=i.return;null!==o;){var g=o.tag;if((3===g||4===g)&&((g=o.stateNode.containerInfo)===r||8===g.nodeType&&g.parentNode===r))return;o=o.return}for(;null!==s;){if(null===(o=mr(s)))return;if(5===(g=o.tag)||6===g){i=a=o;continue e}s=s.parentNode}}i=i.return}Ve((function(){var i=a,r=be(n),o=[];e:{var s=Ri.get(e);if(void 0!==s){var g=un,l=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":g=Sn;break;case"focusin":l="focus",g=An;break;case"focusout":l="blur",g=An;break;case"beforeblur":case"afterblur":g=An;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=dn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=hn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=xn;break;case wi:case Si:case Wi:g=pn;break;case xi:g=Rn;break;case"scroll":g=In;break;case"wheel":g=kn;break;case"copy":case"cut":case"paste":g=fn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=Wn}var u=0!==(4&t),c=!u&&"scroll"===e,I=u?null!==s?s+"Capture":null:s;u=[];for(var C,d=i;null!==d;){var h=(C=d).stateNode;if(5===C.tag&&null!==h&&(C=h,null!==I&&(null!=(h=ke(d,I))&&u.push(Ji(d,h,C)))),c)break;d=d.return}0<u.length&&(s=new g(s,l,null,n,r),o.push({event:s,listeners:u}))}}if(0===(7&t)){if(g="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===ve||!(l=n.relatedTarget||n.fromElement)||!mr(l)&&!l[dr])&&(g||s)&&(s=r.window===r?r:(s=r.ownerDocument)?s.defaultView||s.parentWindow:window,g?(g=i,null!==(l=(l=n.relatedTarget||n.toElement)?mr(l):null)&&(l!==(c=_e(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(g=null,l=i),g!==l)){if(u=dn,h="onMouseLeave",I="onMouseEnter",d="mouse","pointerout"!==e&&"pointerover"!==e||(u=Wn,h="onPointerLeave",I="onPointerEnter",d="pointer"),c=null==g?s:vr(g),C=null==l?s:vr(l),(s=new u(h,d+"leave",g,n,r)).target=c,s.relatedTarget=C,h=null,mr(r)===i&&((u=new u(I,d+"enter",l,n,r)).target=C,u.relatedTarget=c,h=u),c=h,g&&l)e:{for(I=l,d=0,C=u=g;C;C=Ui(C))d++;for(C=0,h=I;h;h=Ui(h))C++;for(;0<d-C;)u=Ui(u),d--;for(;0<C-d;)I=Ui(I),C--;for(;d--;){if(u===I||null!==I&&u===I.alternate)break e;u=Ui(u),I=Ui(I)}u=null}else u=null;null!==g&&Pi(o,s,g,u,!1),null!==l&&null!==c&&Pi(o,c,l,u,!0)}if("select"===(g=(s=i?vr(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===g&&"file"===s.type)var A=On;else if(En(s))if(jn)A=oi;else{A=ri;var p=ii}else(g=s.nodeName)&&"input"===g.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(A=ai);switch(A&&(A=A(e,i))?Jn(o,A,n,r):(p&&p(e,s,i),"focusout"===e&&(p=s._wrapperState)&&p.controlled&&"number"===s.type&&ee(s,"number",s.value)),p=i?vr(i):window,e){case"focusin":(En(p)||"true"===p.contentEditable)&&(Ai=p,pi=i,mi=null);break;case"focusout":mi=pi=Ai=null;break;case"mousedown":fi=!0;break;case"contextmenu":case"mouseup":case"dragend":fi=!1,vi(o,n,r);break;case"selectionchange":if(hi)break;case"keydown":case"keyup":vi(o,n,r)}var m;if(Yn)e:{switch(e){case"compositionstart":var f="onCompositionStart";break e;case"compositionend":f="onCompositionEnd";break e;case"compositionupdate":f="onCompositionUpdate";break e}f=void 0}else _n?zn(e,n)&&(f="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(f="onCompositionStart");f&&(Mn&&"ko"!==n.locale&&(_n||"onCompositionStart"!==f?"onCompositionEnd"===f&&_n&&(m=en()):(qt="value"in(jt=r)?jt.value:jt.textContent,_n=!0)),0<(p=Di(i,f)).length&&(f=new vn(f,e,null,n,r),o.push({event:f,listeners:p}),m?f.data=m:null!==(m=Ln(n))&&(f.data=m))),(m=Fn?function(e,t){switch(e){case"compositionend":return Ln(t);case"keypress":return 32!==t.which?null:(Nn=!0,Kn);case"textInput":return(e=t.data)===Kn&&Nn?null:e;default:return null}}(e,n):function(e,t){if(_n)return"compositionend"===e||!Yn&&zn(e,t)?(e=en(),$t=qt=jt=null,_n=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Di(i,"onBeforeInput")).length&&(r=new vn("onBeforeInput","beforeinput",null,n,r),o.push({event:r,listeners:i}),r.data=m))}Ki(o,t)}))}function Ji(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Di(e,t){for(var n=t+"Capture",i=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=ke(e,n))&&i.unshift(Ji(e,a,r)),null!=(a=ke(e,t))&&i.push(Ji(e,a,r))),e=e.return}return i}function Ui(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Pi(e,t,n,i,r){for(var a=t._reactName,o=[];null!==n&&n!==i;){var s=n,g=s.alternate,l=s.stateNode;if(null!==g&&g===i)break;5===s.tag&&null!==l&&(s=l,r?null!=(g=ke(n,a))&&o.unshift(Ji(n,g,s)):r||null!=(g=ke(n,a))&&o.push(Ji(n,g,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Qi=/\r\n?/g,Oi=/\u0000|\uFFFD/g;function ji(e){return("string"===typeof e?e:""+e).replace(Qi,"\n").replace(Oi,"")}function qi(e,t,n){if(t=ji(t),ji(e)!==t&&n)throw Error(a(425))}function $i(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ir="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ar="function"===typeof Promise?Promise:void 0,or="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ar?function(e){return ar.resolve(null).then(e).catch(sr)}:ir;function sr(e){setTimeout((function(){throw e}))}function gr(e,t){var n=t,i=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===i)return e.removeChild(r),void _t(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=r}while(n);_t(t)}function lr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ur(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var cr=Math.random().toString(36).slice(2),Ir="__reactFiber$"+cr,Cr="__reactProps$"+cr,dr="__reactContainer$"+cr,hr="__reactEvents$"+cr,Ar="__reactListeners$"+cr,pr="__reactHandles$"+cr;function mr(e){var t=e[Ir];if(t)return t;for(var n=e.parentNode;n;){if(t=n[dr]||n[Ir]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ur(e);null!==e;){if(n=e[Ir])return n;e=ur(e)}return t}n=(e=n).parentNode}return null}function fr(e){return!(e=e[Ir]||e[dr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function vr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function br(e){return e[Cr]||null}var yr=[],Gr=-1;function Br(e){return{current:e}}function Zr(e){0>Gr||(e.current=yr[Gr],yr[Gr]=null,Gr--)}function wr(e,t){Gr++,yr[Gr]=e.current,e.current=t}var Sr={},Wr=Br(Sr),xr=Br(!1),Rr=Sr;function Vr(e,t){var n=e.type.contextTypes;if(!n)return Sr;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function kr(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Xr(){Zr(xr),Zr(Wr)}function Yr(e,t,n){if(Wr.current!==Sr)throw Error(a(168));wr(Wr,t),wr(xr,n)}function Hr(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(a(108,T(e)||"Unknown",r));return M({},n,i)}function Fr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Sr,Rr=Wr.current,wr(Wr,e),wr(xr,xr.current),!0}function Mr(e,t,n){var i=e.stateNode;if(!i)throw Error(a(169));n?(e=Hr(e,t,Rr),i.__reactInternalMemoizedMergedChildContext=e,Zr(xr),Zr(Wr),wr(Wr,e)):Zr(xr),wr(xr,n)}var Kr=null,Nr=!1,zr=!1;function Lr(e){null===Kr?Kr=[e]:Kr.push(e)}function _r(){if(!zr&&null!==Kr){zr=!0;var e=0,t=ft;try{var n=Kr;for(ft=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Kr=null,Nr=!1}catch(r){throw null!==Kr&&(Kr=Kr.slice(e+1)),Ue($e,_r),r}finally{ft=t,zr=!1}}return null}var Tr=[],Er=0,Jr=null,Dr=0,Ur=[],Pr=0,Qr=null,Or=1,jr="";function qr(e,t){Tr[Er++]=Dr,Tr[Er++]=Jr,Jr=e,Dr=t}function $r(e,t,n){Ur[Pr++]=Or,Ur[Pr++]=jr,Ur[Pr++]=Qr,Qr=e;var i=Or;e=jr;var r=32-ot(i)-1;i&=~(1<<r),n+=1;var a=32-ot(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Or=1<<32-ot(t)+r|n<<r|i,jr=a+e}else Or=1<<a|n<<r|i,jr=e}function ea(e){null!==e.return&&(qr(e,1),$r(e,1,0))}function ta(e){for(;e===Jr;)Jr=Tr[--Er],Tr[Er]=null,Dr=Tr[--Er],Tr[Er]=null;for(;e===Qr;)Qr=Ur[--Pr],Ur[Pr]=null,jr=Ur[--Pr],Ur[Pr]=null,Or=Ur[--Pr],Ur[Pr]=null}var na=null,ia=null,ra=!1,aa=null;function oa(e,t){var n=Vl(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function sa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,ia=lr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,ia=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qr?{id:Or,overflow:jr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Vl(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,ia=null,!0);default:return!1}}function ga(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function la(e){if(ra){var t=ia;if(t){var n=t;if(!sa(e,t)){if(ga(e))throw Error(a(418));t=lr(n.nextSibling);var i=na;t&&sa(e,t)?oa(i,n):(e.flags=-4097&e.flags|2,ra=!1,na=e)}}else{if(ga(e))throw Error(a(418));e.flags=-4097&e.flags|2,ra=!1,na=e}}}function ua(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function ca(e){if(e!==na)return!1;if(!ra)return ua(e),ra=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=ia)){if(ga(e))throw Ia(),Error(a(418));for(;t;)oa(e,t),t=lr(t.nextSibling)}if(ua(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ia=lr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ia=null}}else ia=na?lr(e.stateNode.nextSibling):null;return!0}function Ia(){for(var e=ia;e;)e=lr(e.nextSibling)}function Ca(){ia=na=null,ra=!1}function da(e){null===aa?aa=[e]:aa.push(e)}var ha=v.ReactCurrentBatchConfig;function Aa(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var pa=Br(null),ma=null,fa=null,va=null;function ba(){va=fa=ma=null}function ya(e){var t=pa.current;Zr(pa),e._currentValue=t}function Ga(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Ba(e,t){ma=e,va=fa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(vs=!0),e.firstContext=null)}function Za(e){var t=e._currentValue;if(va!==e)if(e={context:e,memoizedValue:t,next:null},null===fa){if(null===ma)throw Error(a(308));fa=e,ma.dependencies={lanes:0,firstContext:e}}else fa=fa.next=e;return t}var wa=null;function Sa(e){null===wa?wa=[e]:wa.push(e)}function Wa(e,t,n,i){var r=t.interleaved;return null===r?(n.next=n,Sa(t)):(n.next=r.next,r.next=n),t.interleaved=n,xa(e,i)}function xa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ra=!1;function Va(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ka(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Xa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ya(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Wg)){var r=i.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),i.pending=t,xa(e,n)}return null===(r=i.interleaved)?(t.next=t,Sa(i)):(t.next=r.next,r.next=t),i.interleaved=t,xa(e,n)}function Ha(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,mt(e,n)}}function Fa(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ma(e,t,n,i){var r=e.updateQueue;Ra=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,s=r.shared.pending;if(null!==s){r.shared.pending=null;var g=s,l=g.next;g.next=null,null===o?a=l:o.next=l,o=g;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===s?u.firstBaseUpdate=l:s.next=l,u.lastBaseUpdate=g))}if(null!==a){var c=r.baseState;for(o=0,u=l=g=null,s=a;;){var I=s.lane,C=s.eventTime;if((i&I)===I){null!==u&&(u=u.next={eventTime:C,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var d=e,h=s;switch(I=t,C=n,h.tag){case 1:if("function"===typeof(d=h.payload)){c=d.call(C,c,I);break e}c=d;break e;case 3:d.flags=-65537&d.flags|128;case 0:if(null===(I="function"===typeof(d=h.payload)?d.call(C,c,I):d)||void 0===I)break e;c=M({},c,I);break e;case 2:Ra=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(I=r.effects)?r.effects=[s]:I.push(s))}else C={eventTime:C,lane:I,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(l=u=C,g=c):u=u.next=C,o|=I;if(null===(s=s.next)){if(null===(s=r.shared.pending))break;s=(I=s).next,I.next=null,r.lastBaseUpdate=I,r.shared.pending=null}}if(null===u&&(g=c),r.baseState=g,r.firstBaseUpdate=l,r.lastBaseUpdate=u,null!==(t=r.shared.interleaved)){r=t;do{o|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);Fg|=o,e.lanes=o,e.memoizedState=c}}function Ka(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(a(191,r));r.call(i)}}}var Na=(new i.Component).refs;function za(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var La={isMounted:function(e){return!!(e=e._reactInternals)&&_e(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=el(),r=tl(e),a=Xa(i,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ya(e,a,r))&&(nl(t,e,r,i),Ha(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=el(),r=tl(e),a=Xa(i,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ya(e,a,r))&&(nl(t,e,r,i),Ha(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=el(),i=tl(e),r=Xa(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Ya(e,r,i))&&(nl(t,e,i,n),Ha(t,e,i))}};function _a(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!gi(n,i)||!gi(r,a))}function Ta(e,t,n){var i=!1,r=Sr,a=t.contextType;return"object"===typeof a&&null!==a?a=Za(a):(r=kr(t)?Rr:Wr.current,a=(i=null!==(i=t.contextTypes)&&void 0!==i)?Vr(e,r):Sr),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=La,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function Ea(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&La.enqueueReplaceState(t,t.state,null)}function Ja(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Na,Va(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=Za(a):(a=kr(t)?Rr:Wr.current,r.context=Vr(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(za(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&La.enqueueReplaceState(r,r.state,null),Ma(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function Da(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,e));var r=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=r.refs;t===Na&&(t=r.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Ua(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Pa(e){return(0,e._init)(e._payload)}function Qa(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Xl(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function g(e,t,n,i){return null===t||6!==t.tag?((t=Ml(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function l(e,t,n,i){var a=n.type;return a===G?c(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===k&&Pa(a)===t.type)?((i=r(t,n.props)).ref=Da(e,t,n),i.return=e,i):((i=Yl(n.type,n.key,n.props,null,e.mode,i)).ref=Da(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Kl(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function c(e,t,n,i,a){return null===t||7!==t.tag?((t=Hl(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function I(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Ml(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(n=Yl(t.type,t.key,t.props,null,e.mode,n)).ref=Da(e,null,t),n.return=e,n;case y:return(t=Kl(t,e.mode,n)).return=e,t;case k:return I(e,(0,t._init)(t._payload),n)}if(te(t)||H(t))return(t=Hl(t,e.mode,n,null)).return=e,t;Ua(e,t)}return null}function C(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:g(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case b:return n.key===r?l(e,t,n,i):null;case y:return n.key===r?u(e,t,n,i):null;case k:return C(e,t,(r=n._init)(n._payload),i)}if(te(n)||H(n))return null!==r?null:c(e,t,n,i,null);Ua(e,n)}return null}function d(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return g(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return l(t,e=e.get(null===i.key?n:i.key)||null,i,r);case y:return u(t,e=e.get(null===i.key?n:i.key)||null,i,r);case k:return d(e,t,n,(0,i._init)(i._payload),r)}if(te(i)||H(i))return c(t,e=e.get(n)||null,i,r,null);Ua(t,i)}return null}function h(r,a,s,g){for(var l=null,u=null,c=a,h=a=0,A=null;null!==c&&h<s.length;h++){c.index>h?(A=c,c=null):A=c.sibling;var p=C(r,c,s[h],g);if(null===p){null===c&&(c=A);break}e&&c&&null===p.alternate&&t(r,c),a=o(p,a,h),null===u?l=p:u.sibling=p,u=p,c=A}if(h===s.length)return n(r,c),ra&&qr(r,h),l;if(null===c){for(;h<s.length;h++)null!==(c=I(r,s[h],g))&&(a=o(c,a,h),null===u?l=c:u.sibling=c,u=c);return ra&&qr(r,h),l}for(c=i(r,c);h<s.length;h++)null!==(A=d(c,r,h,s[h],g))&&(e&&null!==A.alternate&&c.delete(null===A.key?h:A.key),a=o(A,a,h),null===u?l=A:u.sibling=A,u=A);return e&&c.forEach((function(e){return t(r,e)})),ra&&qr(r,h),l}function A(r,s,g,l){var u=H(g);if("function"!==typeof u)throw Error(a(150));if(null==(g=u.call(g)))throw Error(a(151));for(var c=u=null,h=s,A=s=0,p=null,m=g.next();null!==h&&!m.done;A++,m=g.next()){h.index>A?(p=h,h=null):p=h.sibling;var f=C(r,h,m.value,l);if(null===f){null===h&&(h=p);break}e&&h&&null===f.alternate&&t(r,h),s=o(f,s,A),null===c?u=f:c.sibling=f,c=f,h=p}if(m.done)return n(r,h),ra&&qr(r,A),u;if(null===h){for(;!m.done;A++,m=g.next())null!==(m=I(r,m.value,l))&&(s=o(m,s,A),null===c?u=m:c.sibling=m,c=m);return ra&&qr(r,A),u}for(h=i(r,h);!m.done;A++,m=g.next())null!==(m=d(h,r,A,m.value,l))&&(e&&null!==m.alternate&&h.delete(null===m.key?A:m.key),s=o(m,s,A),null===c?u=m:c.sibling=m,c=m);return e&&h.forEach((function(e){return t(r,e)})),ra&&qr(r,A),u}return function e(i,a,o,g){if("object"===typeof o&&null!==o&&o.type===G&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:e:{for(var l=o.key,u=a;null!==u;){if(u.key===l){if((l=o.type)===G){if(7===u.tag){n(i,u.sibling),(a=r(u,o.props.children)).return=i,i=a;break e}}else if(u.elementType===l||"object"===typeof l&&null!==l&&l.$$typeof===k&&Pa(l)===u.type){n(i,u.sibling),(a=r(u,o.props)).ref=Da(i,u,o),a.return=i,i=a;break e}n(i,u);break}t(i,u),u=u.sibling}o.type===G?((a=Hl(o.props.children,i.mode,g,o.key)).return=i,i=a):((g=Yl(o.type,o.key,o.props,null,i.mode,g)).ref=Da(i,a,o),g.return=i,i=g)}return s(i);case y:e:{for(u=o.key;null!==a;){if(a.key===u){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break e}n(i,a);break}t(i,a),a=a.sibling}(a=Kl(o,i.mode,g)).return=i,i=a}return s(i);case k:return e(i,a,(u=o._init)(o._payload),g)}if(te(o))return h(i,a,o,g);if(H(o))return A(i,a,o,g);Ua(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=Ml(o,i.mode,g)).return=i,i=a),s(i)):n(i,a)}}var Oa=Qa(!0),ja=Qa(!1),qa={},$a=Br(qa),eo=Br(qa),to=Br(qa);function no(e){if(e===qa)throw Error(a(174));return e}function io(e,t){switch(wr(to,t),wr(eo,e),wr($a,qa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ge(null,"");break;default:t=ge(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Zr($a),wr($a,t)}function ro(){Zr($a),Zr(eo),Zr(to)}function ao(e){no(to.current);var t=no($a.current),n=ge(t,e.type);t!==n&&(wr(eo,e),wr($a,n))}function oo(e){eo.current===e&&(Zr($a),Zr(eo))}var so=Br(0);function go(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var lo=[];function uo(){for(var e=0;e<lo.length;e++)lo[e]._workInProgressVersionPrimary=null;lo.length=0}var co=v.ReactCurrentDispatcher,Io=v.ReactCurrentBatchConfig,Co=0,ho=null,Ao=null,po=null,mo=!1,fo=!1,vo=0,bo=0;function yo(){throw Error(a(321))}function Go(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!si(e[n],t[n]))return!1;return!0}function Bo(e,t,n,i,r,o){if(Co=o,ho=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,co.current=null===e||null===e.memoizedState?ss:gs,e=n(i,r),fo){o=0;do{if(fo=!1,vo=0,25<=o)throw Error(a(301));o+=1,po=Ao=null,t.updateQueue=null,co.current=ls,e=n(i,r)}while(fo)}if(co.current=os,t=null!==Ao&&null!==Ao.next,Co=0,po=Ao=ho=null,mo=!1,t)throw Error(a(300));return e}function Zo(){var e=0!==vo;return vo=0,e}function wo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===po?ho.memoizedState=po=e:po=po.next=e,po}function So(){if(null===Ao){var e=ho.alternate;e=null!==e?e.memoizedState:null}else e=Ao.next;var t=null===po?ho.memoizedState:po.next;if(null!==t)po=t,Ao=e;else{if(null===e)throw Error(a(310));e={memoizedState:(Ao=e).memoizedState,baseState:Ao.baseState,baseQueue:Ao.baseQueue,queue:Ao.queue,next:null},null===po?ho.memoizedState=po=e:po=po.next=e}return po}function Wo(e,t){return"function"===typeof t?t(e):t}function xo(e){var t=So(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=Ao,r=i.baseQueue,o=n.pending;if(null!==o){if(null!==r){var s=r.next;r.next=o.next,o.next=s}i.baseQueue=r=o,n.pending=null}if(null!==r){o=r.next,i=i.baseState;var g=s=null,l=null,u=o;do{var c=u.lane;if((Co&c)===c)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var I={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(g=l=I,s=i):l=l.next=I,ho.lanes|=c,Fg|=c}u=u.next}while(null!==u&&u!==o);null===l?s=i:l.next=g,si(i,t.memoizedState)||(vs=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{o=r.lane,ho.lanes|=o,Fg|=o,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ro(e){var t=So(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,o=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{o=e(o,s.action),s=s.next}while(s!==r);si(o,t.memoizedState)||(vs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function Vo(){}function ko(e,t){var n=ho,i=So(),r=t(),o=!si(i.memoizedState,r);if(o&&(i.memoizedState=r,vs=!0),i=i.queue,Eo(Ho.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==po&&1&po.memoizedState.tag){if(n.flags|=2048,No(9,Yo.bind(null,n,i,r,t),void 0,null),null===xg)throw Error(a(349));0!==(30&Co)||Xo(n,t,r)}return r}function Xo(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ho.updateQueue)?(t={lastEffect:null,stores:null},ho.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Yo(e,t,n,i){t.value=n,t.getSnapshot=i,Fo(t)&&Mo(e)}function Ho(e,t,n){return n((function(){Fo(t)&&Mo(e)}))}function Fo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!si(e,n)}catch(i){return!0}}function Mo(e){var t=xa(e,1);null!==t&&nl(t,e,1,-1)}function Ko(e){var t=wo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wo,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,ho,e),[t.memoizedState,e]}function No(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ho.updateQueue)?(t={lastEffect:null,stores:null},ho.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function zo(){return So().memoizedState}function Lo(e,t,n,i){var r=wo();ho.flags|=e,r.memoizedState=No(1|t,n,void 0,void 0===i?null:i)}function _o(e,t,n,i){var r=So();i=void 0===i?null:i;var a=void 0;if(null!==Ao){var o=Ao.memoizedState;if(a=o.destroy,null!==i&&Go(i,o.deps))return void(r.memoizedState=No(t,n,a,i))}ho.flags|=e,r.memoizedState=No(1|t,n,a,i)}function To(e,t){return Lo(8390656,8,e,t)}function Eo(e,t){return _o(2048,8,e,t)}function Jo(e,t){return _o(4,2,e,t)}function Do(e,t){return _o(4,4,e,t)}function Uo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Po(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,_o(4,4,Uo.bind(null,t,e),n)}function Qo(){}function Oo(e,t){var n=So();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Go(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function jo(e,t){var n=So();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Go(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function qo(e,t,n){return 0===(21&Co)?(e.baseState&&(e.baseState=!1,vs=!0),e.memoizedState=n):(si(n,t)||(n=ht(),ho.lanes|=n,Fg|=n,e.baseState=!0),t)}function $o(e,t){var n=ft;ft=0!==n&&4>n?n:4,e(!0);var i=Io.transition;Io.transition={};try{e(!1),t()}finally{ft=n,Io.transition=i}}function es(){return So().memoizedState}function ts(e,t,n){var i=tl(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},is(e))rs(t,n);else if(null!==(n=Wa(e,t,n,i))){nl(n,e,i,el()),as(n,t,i)}}function ns(e,t,n){var i=tl(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(is(e))rs(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,si(s,o)){var g=t.interleaved;return null===g?(r.next=r,Sa(t)):(r.next=g.next,g.next=r),void(t.interleaved=r)}}catch(l){}null!==(n=Wa(e,t,r,i))&&(nl(n,e,i,r=el()),as(n,t,i))}}function is(e){var t=e.alternate;return e===ho||null!==t&&t===ho}function rs(e,t){fo=mo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function as(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,mt(e,n)}}var os={readContext:Za,useCallback:yo,useContext:yo,useEffect:yo,useImperativeHandle:yo,useInsertionEffect:yo,useLayoutEffect:yo,useMemo:yo,useReducer:yo,useRef:yo,useState:yo,useDebugValue:yo,useDeferredValue:yo,useTransition:yo,useMutableSource:yo,useSyncExternalStore:yo,useId:yo,unstable_isNewReconciler:!1},ss={readContext:Za,useCallback:function(e,t){return wo().memoizedState=[e,void 0===t?null:t],e},useContext:Za,useEffect:To,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Lo(4194308,4,Uo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Lo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Lo(4,2,e,t)},useMemo:function(e,t){var n=wo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=wo();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=ts.bind(null,ho,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},wo().memoizedState=e},useState:Ko,useDebugValue:Qo,useDeferredValue:function(e){return wo().memoizedState=e},useTransition:function(){var e=Ko(!1),t=e[0];return e=$o.bind(null,e[1]),wo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=ho,r=wo();if(ra){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===xg)throw Error(a(349));0!==(30&Co)||Xo(i,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,To(Ho.bind(null,i,o,e),[e]),i.flags|=2048,No(9,Yo.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=wo(),t=xg.identifierPrefix;if(ra){var n=jr;t=":"+t+"R"+(n=(Or&~(1<<32-ot(Or)-1)).toString(32)+n),0<(n=vo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=bo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},gs={readContext:Za,useCallback:Oo,useContext:Za,useEffect:Eo,useImperativeHandle:Po,useInsertionEffect:Jo,useLayoutEffect:Do,useMemo:jo,useReducer:xo,useRef:zo,useState:function(){return xo(Wo)},useDebugValue:Qo,useDeferredValue:function(e){return qo(So(),Ao.memoizedState,e)},useTransition:function(){return[xo(Wo)[0],So().memoizedState]},useMutableSource:Vo,useSyncExternalStore:ko,useId:es,unstable_isNewReconciler:!1},ls={readContext:Za,useCallback:Oo,useContext:Za,useEffect:Eo,useImperativeHandle:Po,useInsertionEffect:Jo,useLayoutEffect:Do,useMemo:jo,useReducer:Ro,useRef:zo,useState:function(){return Ro(Wo)},useDebugValue:Qo,useDeferredValue:function(e){var t=So();return null===Ao?t.memoizedState=e:qo(t,Ao.memoizedState,e)},useTransition:function(){return[Ro(Wo)[0],So().memoizedState]},useMutableSource:Vo,useSyncExternalStore:ko,useId:es,unstable_isNewReconciler:!1};function us(e,t){try{var n="",i=t;do{n+=L(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function cs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function Is(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var Cs="function"===typeof WeakMap?WeakMap:Map;function ds(e,t,n){(n=Xa(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Eg||(Eg=!0,Jg=i),Is(0,t)},n}function hs(e,t,n){(n=Xa(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){Is(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){Is(0,t),"function"!==typeof i&&(null===Dg?Dg=new Set([this]):Dg.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function As(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new Cs;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Zl.bind(null,e,t,n),t.then(e,e))}function ps(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ms(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Xa(-1,1)).tag=2,Ya(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var fs=v.ReactCurrentOwner,vs=!1;function bs(e,t,n,i){t.child=null===e?ja(t,null,n,i):Oa(t,e.child,n,i)}function ys(e,t,n,i,r){n=n.render;var a=t.ref;return Ba(t,r),i=Bo(e,t,n,i,a,r),n=Zo(),null===e||vs?(ra&&n&&ea(t),t.flags|=1,bs(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Es(e,t,r))}function Gs(e,t,n,i,r){if(null===e){var a=n.type;return"function"!==typeof a||kl(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Yl(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Bs(e,t,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:gi)(o,i)&&e.ref===t.ref)return Es(e,t,r)}return t.flags|=1,(e=Xl(a,i)).ref=t.ref,e.return=t,t.child=e}function Bs(e,t,n,i,r){if(null!==e){var a=e.memoizedProps;if(gi(a,i)&&e.ref===t.ref){if(vs=!1,t.pendingProps=i=a,0===(e.lanes&r))return t.lanes=e.lanes,Es(e,t,r);0!==(131072&e.flags)&&(vs=!0)}}return Ss(e,t,n,i,r)}function Zs(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},wr(Xg,kg),kg|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,wr(Xg,kg),kg|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==a?a.baseLanes:n,wr(Xg,kg),kg|=i}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,wr(Xg,kg),kg|=i;return bs(e,t,r,n),t.child}function ws(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ss(e,t,n,i,r){var a=kr(n)?Rr:Wr.current;return a=Vr(t,a),Ba(t,r),n=Bo(e,t,n,i,a,r),i=Zo(),null===e||vs?(ra&&i&&ea(t),t.flags|=1,bs(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Es(e,t,r))}function Ws(e,t,n,i,r){if(kr(n)){var a=!0;Fr(t)}else a=!1;if(Ba(t,r),null===t.stateNode)Ts(e,t),Ta(t,n,i),Ja(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var g=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=Za(l):l=Vr(t,l=kr(n)?Rr:Wr.current);var u=n.getDerivedStateFromProps,c="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;c||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||g!==l)&&Ea(t,o,i,l),Ra=!1;var I=t.memoizedState;o.state=I,Ma(t,i,o,r),g=t.memoizedState,s!==i||I!==g||xr.current||Ra?("function"===typeof u&&(za(t,n,u,i),g=t.memoizedState),(s=Ra||_a(t,n,s,i,I,g,l))?(c||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=g),o.props=i,o.state=g,o.context=l,i=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,ka(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:Aa(t.type,s),o.props=l,c=t.pendingProps,I=o.context,"object"===typeof(g=n.contextType)&&null!==g?g=Za(g):g=Vr(t,g=kr(n)?Rr:Wr.current);var C=n.getDerivedStateFromProps;(u="function"===typeof C||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==c||I!==g)&&Ea(t,o,i,g),Ra=!1,I=t.memoizedState,o.state=I,Ma(t,i,o,r);var d=t.memoizedState;s!==c||I!==d||xr.current||Ra?("function"===typeof C&&(za(t,n,C,i),d=t.memoizedState),(l=Ra||_a(t,n,l,i,I,d,g)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,d,g),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,d,g)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=d),o.props=i,o.state=d,o.context=g,i=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),i=!1)}return xs(e,t,n,i,a,r)}function xs(e,t,n,i,r,a){ws(e,t);var o=0!==(128&t.flags);if(!i&&!o)return r&&Mr(t,n,!1),Es(e,t,a);i=t.stateNode,fs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Oa(t,e.child,null,a),t.child=Oa(t,null,s,a)):bs(e,t,s,a),t.memoizedState=i.state,r&&Mr(t,n,!0),t.child}function Rs(e){var t=e.stateNode;t.pendingContext?Yr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Yr(0,t.context,!1),io(e,t.containerInfo)}function Vs(e,t,n,i,r){return Ca(),da(r),t.flags|=256,bs(e,t,n,i),t.child}var ks,Xs,Ys,Hs={dehydrated:null,treeContext:null,retryLane:0};function Fs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ms(e,t,n){var i,r=t.pendingProps,o=so.current,s=!1,g=0!==(128&t.flags);if((i=g)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),wr(so,1&o),null===e)return la(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(g=r.children,e=r.fallback,s?(r=t.mode,s=t.child,g={mode:"hidden",children:g},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=g):s=Fl(g,r,0,null),e=Hl(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Fs(n),t.memoizedState=Hs,e):Ks(t,g));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,r,o,s){if(n)return 256&t.flags?(t.flags&=-257,Ns(e,t,s,i=cs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,r=t.mode,i=Fl({mode:"visible",children:i.children},r,0,null),(o=Hl(o,r,s,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&Oa(t,e.child,null,s),t.child.memoizedState=Fs(s),t.memoizedState=Hs,o);if(0===(1&t.mode))return Ns(e,t,s,null);if("$!"===r.data){if(i=r.nextSibling&&r.nextSibling.dataset)var g=i.dgst;return i=g,Ns(e,t,s,i=cs(o=Error(a(419)),i,void 0))}if(g=0!==(s&e.childLanes),vs||g){if(null!==(i=xg)){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(i.suspendedLanes|s))?0:r)&&r!==o.retryLane&&(o.retryLane=r,xa(e,r),nl(i,e,r,-1))}return hl(),Ns(e,t,s,i=cs(Error(a(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Sl.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,ia=lr(r.nextSibling),na=t,ra=!0,aa=null,null!==e&&(Ur[Pr++]=Or,Ur[Pr++]=jr,Ur[Pr++]=Qr,Or=e.id,jr=e.overflow,Qr=t),(t=Ks(t,i.children)).flags|=4096,t)}(e,t,g,r,i,o,n);if(s){s=r.fallback,g=t.mode,i=(o=e.child).sibling;var l={mode:"hidden",children:r.children};return 0===(1&g)&&t.child!==o?((r=t.child).childLanes=0,r.pendingProps=l,t.deletions=null):(r=Xl(o,l)).subtreeFlags=14680064&o.subtreeFlags,null!==i?s=Xl(i,s):(s=Hl(s,g,n,null)).flags|=2,s.return=t,r.return=t,r.sibling=s,t.child=r,r=s,s=t.child,g=null===(g=e.child.memoizedState)?Fs(n):{baseLanes:g.baseLanes|n,cachePool:null,transitions:g.transitions},s.memoizedState=g,s.childLanes=e.childLanes&~n,t.memoizedState=Hs,r}return e=(s=e.child).sibling,r=Xl(s,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Ks(e,t){return(t=Fl({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ns(e,t,n,i){return null!==i&&da(i),Oa(t,e.child,null,n),(e=Ks(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zs(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Ga(e.return,t,n)}function Ls(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function _s(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(bs(e,t,i.children,n),0!==(2&(i=so.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zs(e,n,t);else if(19===e.tag)zs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(wr(so,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===go(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ls(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===go(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ls(t,!0,n,null,a);break;case"together":Ls(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ts(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Es(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fg|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Xl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Xl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Js(e,t){if(!ra)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ds(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Us(e,t,n){var i=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ds(t),null;case 1:case 17:return kr(t.type)&&Xr(),Ds(t),null;case 3:return i=t.stateNode,ro(),Zr(xr),Zr(Wr),uo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(ca(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(ol(aa),aa=null))),Ds(t),null;case 5:oo(t);var r=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Xs(e,t,n,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(a(166));return Ds(t),null}if(e=no($a.current),ca(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[Ir]=t,i[Cr]=o,e=0!==(1&t.mode),n){case"dialog":Ni("cancel",i),Ni("close",i);break;case"iframe":case"object":case"embed":Ni("load",i);break;case"video":case"audio":for(r=0;r<Hi.length;r++)Ni(Hi[r],i);break;case"source":Ni("error",i);break;case"img":case"image":case"link":Ni("error",i),Ni("load",i);break;case"details":Ni("toggle",i);break;case"input":O(i,o),Ni("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Ni("invalid",i);break;case"textarea":re(i,o),Ni("invalid",i)}for(var g in me(n,o),r=null,o)if(o.hasOwnProperty(g)){var l=o[g];"children"===g?"string"===typeof l?i.textContent!==l&&(!0!==o.suppressHydrationWarning&&qi(i.textContent,l,e),r=["children",l]):"number"===typeof l&&i.textContent!==""+l&&(!0!==o.suppressHydrationWarning&&qi(i.textContent,l,e),r=["children",""+l]):s.hasOwnProperty(g)&&null!=l&&"onScroll"===g&&Ni("scroll",i)}switch(n){case"input":D(i),$(i,o,!0);break;case"textarea":D(i),oe(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=$i)}i=r,t.updateQueue=i,null!==i&&(t.flags|=4)}else{g=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=g.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=g.createElement(n,{is:i.is}):(e=g.createElement(n),"select"===n&&(g=e,i.multiple?g.multiple=!0:i.size&&(g.size=i.size))):e=g.createElementNS(e,n),e[Ir]=t,e[Cr]=i,ks(e,t),t.stateNode=e;e:{switch(g=fe(n,i),n){case"dialog":Ni("cancel",e),Ni("close",e),r=i;break;case"iframe":case"object":case"embed":Ni("load",e),r=i;break;case"video":case"audio":for(r=0;r<Hi.length;r++)Ni(Hi[r],e);r=i;break;case"source":Ni("error",e),r=i;break;case"img":case"image":case"link":Ni("error",e),Ni("load",e),r=i;break;case"details":Ni("toggle",e),r=i;break;case"input":O(e,i),r=Q(e,i),Ni("invalid",e);break;case"option":default:r=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=M({},i,{value:void 0}),Ni("invalid",e);break;case"textarea":re(e,i),r=ie(e,i),Ni("invalid",e)}for(o in me(n,r),l=r)if(l.hasOwnProperty(o)){var u=l[o];"style"===o?Ae(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&ce(e,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&Ie(e,u):"number"===typeof u&&Ie(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=u&&"onScroll"===o&&Ni("scroll",e):null!=u&&f(e,o,u,g))}switch(n){case"input":D(e),$(e,i,!1);break;case"textarea":D(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+E(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ne(e,!!i.multiple,o,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$i)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ds(t),null;case 6:if(e&&null!=t.stateNode)Ys(0,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));if(n=no(to.current),no($a.current),ca(t)){if(i=t.stateNode,n=t.memoizedProps,i[Ir]=t,(o=i.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:qi(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&qi(i.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[Ir]=t,t.stateNode=i}return Ds(t),null;case 13:if(Zr(so),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ra&&null!==ia&&0!==(1&t.mode)&&0===(128&t.flags))Ia(),Ca(),t.flags|=98560,o=!1;else if(o=ca(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[Ir]=t}else Ca(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ds(t),o=!1}else null!==aa&&(ol(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Yg&&(Yg=3):hl())),null!==t.updateQueue&&(t.flags|=4),Ds(t),null);case 4:return ro(),null===e&&_i(t.stateNode.containerInfo),Ds(t),null;case 10:return ya(t.type._context),Ds(t),null;case 19:if(Zr(so),null===(o=t.memoizedState))return Ds(t),null;if(i=0!==(128&t.flags),null===(g=o.rendering))if(i)Js(o,!1);else{if(0!==Yg||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(g=go(e))){for(t.flags|=128,Js(o,!1),null!==(i=g.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(g=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=g.childLanes,o.lanes=g.lanes,o.child=g.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=g.memoizedProps,o.memoizedState=g.memoizedState,o.updateQueue=g.updateQueue,o.type=g.type,e=g.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return wr(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&je()>_g&&(t.flags|=128,i=!0,Js(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=go(g))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Js(o,!0),null===o.tail&&"hidden"===o.tailMode&&!g.alternate&&!ra)return Ds(t),null}else 2*je()-o.renderingStartTime>_g&&1073741824!==n&&(t.flags|=128,i=!0,Js(o,!1),t.lanes=4194304);o.isBackwards?(g.sibling=t.child,t.child=g):(null!==(n=o.last)?n.sibling=g:t.child=g,o.last=g)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=je(),t.sibling=null,n=so.current,wr(so,i?1&n|2:1&n),t):(Ds(t),null);case 22:case 23:return cl(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&kg)&&(Ds(t),6&t.subtreeFlags&&(t.flags|=8192)):Ds(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Ps(e,t){switch(ta(t),t.tag){case 1:return kr(t.type)&&Xr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ro(),Zr(xr),Zr(Wr),uo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Zr(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));Ca()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Zr(so),null;case 4:return ro(),null;case 10:return ya(t.type._context),null;case 22:case 23:return cl(),null;default:return null}}ks=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Xs=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,no($a.current);var a,o=null;switch(n){case"input":r=Q(e,r),i=Q(e,i),o=[];break;case"select":r=M({},r,{value:void 0}),i=M({},i,{value:void 0}),o=[];break;case"textarea":r=ie(e,r),i=ie(e,i),o=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=$i)}for(u in me(n,i),n=null,r)if(!i.hasOwnProperty(u)&&r.hasOwnProperty(u)&&null!=r[u])if("style"===u){var g=r[u];for(a in g)g.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var l=i[u];if(g=null!=r?r[u]:void 0,i.hasOwnProperty(u)&&l!==g&&(null!=l||null!=g))if("style"===u)if(g){for(a in g)!g.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&g[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(o||(o=[]),o.push(u,n)),n=l;else"dangerouslySetInnerHTML"===u?(l=l?l.__html:void 0,g=g?g.__html:void 0,null!=l&&g!==l&&(o=o||[]).push(u,l)):"children"===u?"string"!==typeof l&&"number"!==typeof l||(o=o||[]).push(u,""+l):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=l&&"onScroll"===u&&Ni("scroll",e),o||g===l||(o=[])):(o=o||[]).push(u,l))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},Ys=function(e,t,n,i){n!==i&&(t.flags|=4)};var Qs=!1,Os=!1,js="function"===typeof WeakSet?WeakSet:Set,qs=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Bl(e,t,i)}else n.current=null}function eg(e,t,n){try{n()}catch(i){Bl(e,t,i)}}var tg=!1;function ng(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&eg(t,n,a)}r=r.next}while(r!==i)}}function ig(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function rg(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ag(e){var t=e.alternate;null!==t&&(e.alternate=null,ag(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[Ir],delete t[Cr],delete t[hr],delete t[Ar],delete t[pr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function og(e){return 5===e.tag||3===e.tag||4===e.tag}function sg(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||og(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function gg(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$i));else if(4!==i&&null!==(e=e.child))for(gg(e,t,n),e=e.sibling;null!==e;)gg(e,t,n),e=e.sibling}function lg(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(lg(e,t,n),e=e.sibling;null!==e;)lg(e,t,n),e=e.sibling}var ug=null,cg=!1;function Ig(e,t,n){for(n=n.child;null!==n;)Cg(e,t,n),n=n.sibling}function Cg(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(rt,n)}catch(s){}switch(n.tag){case 5:Os||$s(n,t);case 6:var i=ug,r=cg;ug=null,Ig(e,t,n),cg=r,null!==(ug=i)&&(cg?(e=ug,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ug.removeChild(n.stateNode));break;case 18:null!==ug&&(cg?(e=ug,n=n.stateNode,8===e.nodeType?gr(e.parentNode,n):1===e.nodeType&&gr(e,n),_t(e)):gr(ug,n.stateNode));break;case 4:i=ug,r=cg,ug=n.stateNode.containerInfo,cg=!0,Ig(e,t,n),ug=i,cg=r;break;case 0:case 11:case 14:case 15:if(!Os&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){r=i=i.next;do{var a=r,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&eg(n,t,o),r=r.next}while(r!==i)}Ig(e,t,n);break;case 1:if(!Os&&($s(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(s){Bl(n,t,s)}Ig(e,t,n);break;case 21:Ig(e,t,n);break;case 22:1&n.mode?(Os=(i=Os)||null!==n.memoizedState,Ig(e,t,n),Os=i):Ig(e,t,n);break;default:Ig(e,t,n)}}function dg(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new js),t.forEach((function(t){var i=Wl.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function hg(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var o=e,s=t,g=s;e:for(;null!==g;){switch(g.tag){case 5:ug=g.stateNode,cg=!1;break e;case 3:case 4:ug=g.stateNode.containerInfo,cg=!0;break e}g=g.return}if(null===ug)throw Error(a(160));Cg(o,s,r),ug=null,cg=!1;var l=r.alternate;null!==l&&(l.return=null),r.return=null}catch(u){Bl(r,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)Ag(t,e),t=t.sibling}function Ag(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(hg(t,e),pg(e),4&i){try{ng(3,e,e.return),ig(3,e)}catch(A){Bl(e,e.return,A)}try{ng(5,e,e.return)}catch(A){Bl(e,e.return,A)}}break;case 1:hg(t,e),pg(e),512&i&&null!==n&&$s(n,n.return);break;case 5:if(hg(t,e),pg(e),512&i&&null!==n&&$s(n,n.return),32&e.flags){var r=e.stateNode;try{Ie(r,"")}catch(A){Bl(e,e.return,A)}}if(4&i&&null!=(r=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,g=e.type,l=e.updateQueue;if(e.updateQueue=null,null!==l)try{"input"===g&&"radio"===o.type&&null!=o.name&&j(r,o),fe(g,s);var u=fe(g,o);for(s=0;s<l.length;s+=2){var c=l[s],I=l[s+1];"style"===c?Ae(r,I):"dangerouslySetInnerHTML"===c?ce(r,I):"children"===c?Ie(r,I):f(r,c,I,u)}switch(g){case"input":q(r,o);break;case"textarea":ae(r,o);break;case"select":var C=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var d=o.value;null!=d?ne(r,!!o.multiple,d,!1):C!==!!o.multiple&&(null!=o.defaultValue?ne(r,!!o.multiple,o.defaultValue,!0):ne(r,!!o.multiple,o.multiple?[]:"",!1))}r[Cr]=o}catch(A){Bl(e,e.return,A)}}break;case 6:if(hg(t,e),pg(e),4&i){if(null===e.stateNode)throw Error(a(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(A){Bl(e,e.return,A)}}break;case 3:if(hg(t,e),pg(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{_t(t.containerInfo)}catch(A){Bl(e,e.return,A)}break;case 4:default:hg(t,e),pg(e);break;case 13:hg(t,e),pg(e),8192&(r=e.child).flags&&(o=null!==r.memoizedState,r.stateNode.isHidden=o,!o||null!==r.alternate&&null!==r.alternate.memoizedState||(Lg=je())),4&i&&dg(e);break;case 22:if(c=null!==n&&null!==n.memoizedState,1&e.mode?(Os=(u=Os)||c,hg(t,e),Os=u):hg(t,e),pg(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!c&&0!==(1&e.mode))for(qs=e,c=e.child;null!==c;){for(I=qs=c;null!==qs;){switch(d=(C=qs).child,C.tag){case 0:case 11:case 14:case 15:ng(4,C,C.return);break;case 1:$s(C,C.return);var h=C.stateNode;if("function"===typeof h.componentWillUnmount){i=C,n=C.return;try{t=i,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(A){Bl(i,n,A)}}break;case 5:$s(C,C.return);break;case 22:if(null!==C.memoizedState){bg(I);continue}}null!==d?(d.return=C,qs=d):bg(I)}c=c.sibling}e:for(c=null,I=e;;){if(5===I.tag){if(null===c){c=I;try{r=I.stateNode,u?"function"===typeof(o=r.style).setProperty?o.setProperty("display","none","important"):o.display="none":(g=I.stateNode,s=void 0!==(l=I.memoizedProps.style)&&null!==l&&l.hasOwnProperty("display")?l.display:null,g.style.display=he("display",s))}catch(A){Bl(e,e.return,A)}}}else if(6===I.tag){if(null===c)try{I.stateNode.nodeValue=u?"":I.memoizedProps}catch(A){Bl(e,e.return,A)}}else if((22!==I.tag&&23!==I.tag||null===I.memoizedState||I===e)&&null!==I.child){I.child.return=I,I=I.child;continue}if(I===e)break e;for(;null===I.sibling;){if(null===I.return||I.return===e)break e;c===I&&(c=null),I=I.return}c===I&&(c=null),I.sibling.return=I.return,I=I.sibling}}break;case 19:hg(t,e),pg(e),4&i&&dg(e);case 21:}}function pg(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(og(n)){var i=n;break e}n=n.return}throw Error(a(160))}switch(i.tag){case 5:var r=i.stateNode;32&i.flags&&(Ie(r,""),i.flags&=-33),lg(e,sg(e),r);break;case 3:case 4:var o=i.stateNode.containerInfo;gg(e,sg(e),o);break;default:throw Error(a(161))}}catch(s){Bl(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function mg(e,t,n){qs=e,fg(e,t,n)}function fg(e,t,n){for(var i=0!==(1&e.mode);null!==qs;){var r=qs,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||Qs;if(!o){var s=r.alternate,g=null!==s&&null!==s.memoizedState||Os;s=Qs;var l=Os;if(Qs=o,(Os=g)&&!l)for(qs=r;null!==qs;)g=(o=qs).child,22===o.tag&&null!==o.memoizedState?yg(r):null!==g?(g.return=o,qs=g):yg(r);for(;null!==a;)qs=a,fg(a,t,n),a=a.sibling;qs=r,Qs=s,Os=l}vg(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,qs=a):vg(e)}}function vg(e){for(;null!==qs;){var t=qs;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Os||ig(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!Os)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:Aa(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Ka(t,o,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ka(t,s,n)}break;case 5:var g=t.stateNode;if(null===n&&4&t.flags){n=g;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var c=u.memoizedState;if(null!==c){var I=c.dehydrated;null!==I&&_t(I)}}}break;default:throw Error(a(163))}Os||512&t.flags&&rg(t)}catch(C){Bl(t,t.return,C)}}if(t===e){qs=null;break}if(null!==(n=t.sibling)){n.return=t.return,qs=n;break}qs=t.return}}function bg(e){for(;null!==qs;){var t=qs;if(t===e){qs=null;break}var n=t.sibling;if(null!==n){n.return=t.return,qs=n;break}qs=t.return}}function yg(e){for(;null!==qs;){var t=qs;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ig(4,t)}catch(g){Bl(t,n,g)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(g){Bl(t,r,g)}}var a=t.return;try{rg(t)}catch(g){Bl(t,a,g)}break;case 5:var o=t.return;try{rg(t)}catch(g){Bl(t,o,g)}}}catch(g){Bl(t,t.return,g)}if(t===e){qs=null;break}var s=t.sibling;if(null!==s){s.return=t.return,qs=s;break}qs=t.return}}var Gg,Bg=Math.ceil,Zg=v.ReactCurrentDispatcher,wg=v.ReactCurrentOwner,Sg=v.ReactCurrentBatchConfig,Wg=0,xg=null,Rg=null,Vg=0,kg=0,Xg=Br(0),Yg=0,Hg=null,Fg=0,Mg=0,Kg=0,Ng=null,zg=null,Lg=0,_g=1/0,Tg=null,Eg=!1,Jg=null,Dg=null,Ug=!1,Pg=null,Qg=0,Og=0,jg=null,qg=-1,$g=0;function el(){return 0!==(6&Wg)?je():-1!==qg?qg:qg=je()}function tl(e){return 0===(1&e.mode)?1:0!==(2&Wg)&&0!==Vg?Vg&-Vg:null!==ha.transition?(0===$g&&($g=ht()),$g):0!==(e=ft)?e:e=void 0===(e=window.event)?16:Ot(e.type)}function nl(e,t,n,i){if(50<Og)throw Og=0,jg=null,Error(a(185));pt(e,n,i),0!==(2&Wg)&&e===xg||(e===xg&&(0===(2&Wg)&&(Mg|=n),4===Yg&&sl(e,Vg)),il(e,i),1===n&&0===Wg&&0===(1&t.mode)&&(_g=je()+500,Nr&&_r()))}function il(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,g=r[o];-1===g?0!==(s&n)&&0===(s&i)||(r[o]=Ct(s,t)):g<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var i=It(e,e===xg?Vg:0);if(0===i)null!==n&&Pe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Pe(n),1===t)0===e.tag?function(e){Nr=!0,Lr(e)}(gl.bind(null,e)):Lr(gl.bind(null,e)),or((function(){0===(6&Wg)&&_r()})),n=null;else{switch(vt(i)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=xl(n,rl.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rl(e,t){if(qg=-1,$g=0,0!==(6&Wg))throw Error(a(327));var n=e.callbackNode;if(yl()&&e.callbackNode!==n)return null;var i=It(e,e===xg?Vg:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=Al(e,i);else{t=i;var r=Wg;Wg|=2;var o=dl();for(xg===e&&Vg===t||(Tg=null,_g=je()+500,Il(e,t));;)try{ml();break}catch(g){Cl(e,g)}ba(),Zg.current=o,Wg=r,null!==Rg?t=0:(xg=null,Vg=0,t=Yg)}if(0!==t){if(2===t&&(0!==(r=dt(e))&&(i=r,t=al(e,r))),1===t)throw n=Hg,Il(e,0),sl(e,i),il(e,je()),n;if(6===t)sl(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!si(a(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=Al(e,i))&&(0!==(o=dt(e))&&(i=o,t=al(e,o))),1===t))throw n=Hg,Il(e,0),sl(e,i),il(e,je()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(a(345));case 2:case 5:bl(e,zg,Tg);break;case 3:if(sl(e,i),(130023424&i)===i&&10<(t=Lg+500-je())){if(0!==It(e,0))break;if(((r=e.suspendedLanes)&i)!==i){el(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=ir(bl.bind(null,e,zg,Tg),t);break}bl(e,zg,Tg);break;case 4:if(sl(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-ot(i);o=1<<s,(s=t[s])>r&&(r=s),i&=~o}if(i=r,10<(i=(120>(i=je()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Bg(i/1960))-i)){e.timeoutHandle=ir(bl.bind(null,e,zg,Tg),i);break}bl(e,zg,Tg);break;default:throw Error(a(329))}}}return il(e,je()),e.callbackNode===n?rl.bind(null,e):null}function al(e,t){var n=Ng;return e.current.memoizedState.isDehydrated&&(Il(e,t).flags|=256),2!==(e=Al(e,t))&&(t=zg,zg=n,null!==t&&ol(t)),e}function ol(e){null===zg?zg=e:zg.push.apply(zg,e)}function sl(e,t){for(t&=~Kg,t&=~Mg,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),i=1<<n;e[n]=-1,t&=~i}}function gl(e){if(0!==(6&Wg))throw Error(a(327));yl();var t=It(e,0);if(0===(1&t))return il(e,je()),null;var n=Al(e,t);if(0!==e.tag&&2===n){var i=dt(e);0!==i&&(t=i,n=al(e,i))}if(1===n)throw n=Hg,Il(e,0),sl(e,t),il(e,je()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bl(e,zg,Tg),il(e,je()),null}function ll(e,t){var n=Wg;Wg|=1;try{return e(t)}finally{0===(Wg=n)&&(_g=je()+500,Nr&&_r())}}function ul(e){null!==Pg&&0===Pg.tag&&0===(6&Wg)&&yl();var t=Wg;Wg|=1;var n=Sg.transition,i=ft;try{if(Sg.transition=null,ft=1,e)return e()}finally{ft=i,Sg.transition=n,0===(6&(Wg=t))&&_r()}}function cl(){kg=Xg.current,Zr(Xg)}function Il(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Rg)for(n=Rg.return;null!==n;){var i=n;switch(ta(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Xr();break;case 3:ro(),Zr(xr),Zr(Wr),uo();break;case 5:oo(i);break;case 4:ro();break;case 13:case 19:Zr(so);break;case 10:ya(i.type._context);break;case 22:case 23:cl()}n=n.return}if(xg=e,Rg=e=Xl(e.current,null),Vg=kg=t,Yg=0,Hg=null,Kg=Mg=Fg=0,zg=Ng=null,null!==wa){for(t=0;t<wa.length;t++)if(null!==(i=(n=wa[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}wa=null}return e}function Cl(e,t){for(;;){var n=Rg;try{if(ba(),co.current=os,mo){for(var i=ho.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}mo=!1}if(Co=0,po=Ao=ho=null,fo=!1,vo=0,wg.current=null,null===n||null===n.return){Yg=1,Hg=t,Rg=null;break}e:{var o=e,s=n.return,g=n,l=t;if(t=Vg,g.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,c=g,I=c.tag;if(0===(1&c.mode)&&(0===I||11===I||15===I)){var C=c.alternate;C?(c.updateQueue=C.updateQueue,c.memoizedState=C.memoizedState,c.lanes=C.lanes):(c.updateQueue=null,c.memoizedState=null)}var d=ps(s);if(null!==d){d.flags&=-257,ms(d,s,g,0,t),1&d.mode&&As(o,u,t),l=u;var h=(t=d).updateQueue;if(null===h){var A=new Set;A.add(l),t.updateQueue=A}else h.add(l);break e}if(0===(1&t)){As(o,u,t),hl();break e}l=Error(a(426))}else if(ra&&1&g.mode){var p=ps(s);if(null!==p){0===(65536&p.flags)&&(p.flags|=256),ms(p,s,g,0,t),da(us(l,g));break e}}o=l=us(l,g),4!==Yg&&(Yg=2),null===Ng?Ng=[o]:Ng.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Fa(o,ds(0,l,t));break e;case 1:g=l;var m=o.type,f=o.stateNode;if(0===(128&o.flags)&&("function"===typeof m.getDerivedStateFromError||null!==f&&"function"===typeof f.componentDidCatch&&(null===Dg||!Dg.has(f)))){o.flags|=65536,t&=-t,o.lanes|=t,Fa(o,hs(o,g,t));break e}}o=o.return}while(null!==o)}vl(n)}catch(v){t=v,Rg===n&&null!==n&&(Rg=n=n.return);continue}break}}function dl(){var e=Zg.current;return Zg.current=os,null===e?os:e}function hl(){0!==Yg&&3!==Yg&&2!==Yg||(Yg=4),null===xg||0===(268435455&Fg)&&0===(268435455&Mg)||sl(xg,Vg)}function Al(e,t){var n=Wg;Wg|=2;var i=dl();for(xg===e&&Vg===t||(Tg=null,Il(e,t));;)try{pl();break}catch(r){Cl(e,r)}if(ba(),Wg=n,Zg.current=i,null!==Rg)throw Error(a(261));return xg=null,Vg=0,Yg}function pl(){for(;null!==Rg;)fl(Rg)}function ml(){for(;null!==Rg&&!Qe();)fl(Rg)}function fl(e){var t=Gg(e.alternate,e,kg);e.memoizedProps=e.pendingProps,null===t?vl(e):Rg=t,wg.current=null}function vl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Us(n,t,kg)))return void(Rg=n)}else{if(null!==(n=Ps(n,t)))return n.flags&=32767,void(Rg=n);if(null===e)return Yg=6,void(Rg=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Rg=t);Rg=t=e}while(null!==t);0===Yg&&(Yg=5)}function bl(e,t,n){var i=ft,r=Sg.transition;try{Sg.transition=null,ft=1,function(e,t,n,i){do{yl()}while(null!==Pg);if(0!==(6&Wg))throw Error(a(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-ot(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,o),e===xg&&(Rg=xg=null,Vg=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Ug||(Ug=!0,xl(tt,(function(){return yl(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Sg.transition,Sg.transition=null;var s=ft;ft=1;var g=Wg;Wg|=4,wg.current=null,function(e,t){if(er=Et,Ci(e=Ii())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var r=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(b){n=null;break e}var s=0,g=-1,l=-1,u=0,c=0,I=e,C=null;t:for(;;){for(var d;I!==n||0!==r&&3!==I.nodeType||(g=s+r),I!==o||0!==i&&3!==I.nodeType||(l=s+i),3===I.nodeType&&(s+=I.nodeValue.length),null!==(d=I.firstChild);)C=I,I=d;for(;;){if(I===e)break t;if(C===n&&++u===r&&(g=s),C===o&&++c===i&&(l=s),null!==(d=I.nextSibling))break;C=(I=C).parentNode}I=d}n=-1===g||-1===l?null:{start:g,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},Et=!1,qs=t;null!==qs;)if(e=(t=qs).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,qs=e;else for(;null!==qs;){t=qs;try{var h=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==h){var A=h.memoizedProps,p=h.memoizedState,m=t.stateNode,f=m.getSnapshotBeforeUpdate(t.elementType===t.type?A:Aa(t.type,A),p);m.__reactInternalSnapshotBeforeUpdate=f}break;case 3:var v=t.stateNode.containerInfo;1===v.nodeType?v.textContent="":9===v.nodeType&&v.documentElement&&v.removeChild(v.documentElement);break;default:throw Error(a(163))}}catch(b){Bl(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,qs=e;break}qs=t.return}h=tg,tg=!1}(e,n),Ag(n,e),di(tr),Et=!!er,tr=er=null,e.current=n,mg(n,e,r),Oe(),Wg=g,ft=s,Sg.transition=o}else e.current=n;if(Ug&&(Ug=!1,Pg=e,Qg=r),0===(o=e.pendingLanes)&&(Dg=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),il(e,je()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)i((r=t[n]).value,{componentStack:r.stack,digest:r.digest});if(Eg)throw Eg=!1,e=Jg,Jg=null,e;0!==(1&Qg)&&0!==e.tag&&yl(),0!==(1&(o=e.pendingLanes))?e===jg?Og++:(Og=0,jg=e):Og=0,_r()}(e,t,n,i)}finally{Sg.transition=r,ft=i}return null}function yl(){if(null!==Pg){var e=vt(Qg),t=Sg.transition,n=ft;try{if(Sg.transition=null,ft=16>e?16:e,null===Pg)var i=!1;else{if(e=Pg,Pg=null,Qg=0,0!==(6&Wg))throw Error(a(331));var r=Wg;for(Wg|=4,qs=e.current;null!==qs;){var o=qs,s=o.child;if(0!==(16&qs.flags)){var g=o.deletions;if(null!==g){for(var l=0;l<g.length;l++){var u=g[l];for(qs=u;null!==qs;){var c=qs;switch(c.tag){case 0:case 11:case 15:ng(8,c,o)}var I=c.child;if(null!==I)I.return=c,qs=I;else for(;null!==qs;){var C=(c=qs).sibling,d=c.return;if(ag(c),c===u){qs=null;break}if(null!==C){C.return=d,qs=C;break}qs=d}}}var h=o.alternate;if(null!==h){var A=h.child;if(null!==A){h.child=null;do{var p=A.sibling;A.sibling=null,A=p}while(null!==A)}}qs=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,qs=s;else e:for(;null!==qs;){if(0!==(2048&(o=qs).flags))switch(o.tag){case 0:case 11:case 15:ng(9,o,o.return)}var m=o.sibling;if(null!==m){m.return=o.return,qs=m;break e}qs=o.return}}var f=e.current;for(qs=f;null!==qs;){var v=(s=qs).child;if(0!==(2064&s.subtreeFlags)&&null!==v)v.return=s,qs=v;else e:for(s=f;null!==qs;){if(0!==(2048&(g=qs).flags))try{switch(g.tag){case 0:case 11:case 15:ig(9,g)}}catch(y){Bl(g,g.return,y)}if(g===s){qs=null;break e}var b=g.sibling;if(null!==b){b.return=g.return,qs=b;break e}qs=g.return}}if(Wg=r,_r(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(rt,e)}catch(y){}i=!0}return i}finally{ft=n,Sg.transition=t}}return!1}function Gl(e,t,n){e=Ya(e,t=ds(0,t=us(n,t),1),1),t=el(),null!==e&&(pt(e,1,t),il(e,t))}function Bl(e,t,n){if(3===e.tag)Gl(e,e,n);else for(;null!==t;){if(3===t.tag){Gl(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Dg||!Dg.has(i))){t=Ya(t,e=hs(t,e=us(n,e),1),1),e=el(),null!==t&&(pt(t,1,e),il(t,e));break}}t=t.return}}function Zl(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=el(),e.pingedLanes|=e.suspendedLanes&n,xg===e&&(Vg&n)===n&&(4===Yg||3===Yg&&(130023424&Vg)===Vg&&500>je()-Lg?Il(e,0):Kg|=n),il(e,t)}function wl(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=el();null!==(e=xa(e,t))&&(pt(e,t,n),il(e,n))}function Sl(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),wl(e,n)}function Wl(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(a(314))}null!==i&&i.delete(t),wl(e,n)}function xl(e,t){return Ue(e,t)}function Rl(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Vl(e,t,n,i){return new Rl(e,t,n,i)}function kl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Xl(e,t){var n=e.alternate;return null===n?((n=Vl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Yl(e,t,n,i,r,o){var s=2;if(i=e,"function"===typeof e)kl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case G:return Hl(n.children,r,o,t);case B:s=8,r|=8;break;case Z:return(e=Vl(12,n,t,2|r)).elementType=Z,e.lanes=o,e;case x:return(e=Vl(13,n,t,r)).elementType=x,e.lanes=o,e;case R:return(e=Vl(19,n,t,r)).elementType=R,e.lanes=o,e;case X:return Fl(n,r,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case w:s=10;break e;case S:s=9;break e;case W:s=11;break e;case V:s=14;break e;case k:s=16,i=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Vl(s,n,t,r)).elementType=e,t.type=i,t.lanes=o,t}function Hl(e,t,n,i){return(e=Vl(7,e,i,t)).lanes=n,e}function Fl(e,t,n,i){return(e=Vl(22,e,i,t)).elementType=X,e.lanes=n,e.stateNode={isHidden:!1},e}function Ml(e,t,n){return(e=Vl(6,e,null,t)).lanes=n,e}function Kl(e,t,n){return(t=Vl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Nl(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=At(0),this.expirationTimes=At(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=At(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function zl(e,t,n,i,r,a,o,s,g){return e=new Nl(e,t,n,s,g),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Vl(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Va(a),e}function Ll(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:y,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}function _l(e){if(!e)return Sr;e:{if(_e(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(kr(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(kr(n))return Hr(e,n,t)}return t}function Tl(e,t,n,i,r,a,o,s,g){return(e=zl(n,i,!0,e,0,a,0,s,g)).context=_l(null),n=e.current,(a=Xa(i=el(),r=tl(n))).callback=void 0!==t&&null!==t?t:null,Ya(n,a,r),e.current.lanes=r,pt(e,r,i),il(e,i),e}function El(e,t,n,i){var r=t.current,a=el(),o=tl(r);return n=_l(n),null===t.context?t.context=n:t.pendingContext=n,(t=Xa(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Ya(r,t,o))&&(nl(e,r,o,a),Ha(e,r,o)),o}function Jl(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Dl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Ul(e,t){Dl(e,t),(e=e.alternate)&&Dl(e,t)}Gg=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||xr.current)vs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return vs=!1,function(e,t,n){switch(t.tag){case 3:Rs(t),Ca();break;case 5:ao(t);break;case 1:kr(t.type)&&Fr(t);break;case 4:io(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,r=t.memoizedProps.value;wr(pa,i._currentValue),i._currentValue=r;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(wr(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ms(e,t,n):(wr(so,1&so.current),null!==(e=Es(e,t,n))?e.sibling:null);wr(so,1&so.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return _s(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),wr(so,so.current),i)break;return null;case 22:case 23:return t.lanes=0,Zs(e,t,n)}return Es(e,t,n)}(e,t,n);vs=0!==(131072&e.flags)}else vs=!1,ra&&0!==(1048576&t.flags)&&$r(t,Dr,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ts(e,t),e=t.pendingProps;var r=Vr(t,Wr.current);Ba(t,n),r=Bo(null,t,i,e,r,n);var o=Zo();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,kr(i)?(o=!0,Fr(t)):o=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Va(t),r.updater=La,t.stateNode=r,r._reactInternals=t,Ja(t,i,e,n),t=xs(null,t,i,!0,o,n)):(t.tag=0,ra&&o&&ea(t),bs(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ts(e,t),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return kl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===W)return 11;if(e===V)return 14}return 2}(i),e=Aa(i,e),r){case 0:t=Ss(null,t,i,e,n);break e;case 1:t=Ws(null,t,i,e,n);break e;case 11:t=ys(null,t,i,e,n);break e;case 14:t=Gs(null,t,i,Aa(i.type,e),n);break e}throw Error(a(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Ss(e,t,i,r=t.elementType===i?r:Aa(i,r),n);case 1:return i=t.type,r=t.pendingProps,Ws(e,t,i,r=t.elementType===i?r:Aa(i,r),n);case 3:e:{if(Rs(t),null===e)throw Error(a(387));i=t.pendingProps,r=(o=t.memoizedState).element,ka(e,t),Ma(t,i,null,n);var s=t.memoizedState;if(i=s.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Vs(e,t,i,n,r=us(Error(a(423)),t));break e}if(i!==r){t=Vs(e,t,i,n,r=us(Error(a(424)),t));break e}for(ia=lr(t.stateNode.containerInfo.firstChild),na=t,ra=!0,aa=null,n=ja(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Ca(),i===r){t=Es(e,t,n);break e}bs(e,t,i,n)}t=t.child}return t;case 5:return ao(t),null===e&&la(t),i=t.type,r=t.pendingProps,o=null!==e?e.memoizedProps:null,s=r.children,nr(i,r)?s=null:null!==o&&nr(i,o)&&(t.flags|=32),ws(e,t),bs(e,t,s,n),t.child;case 6:return null===e&&la(t),null;case 13:return Ms(e,t,n);case 4:return io(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Oa(t,null,i,n):bs(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,ys(e,t,i,r=t.elementType===i?r:Aa(i,r),n);case 7:return bs(e,t,t.pendingProps,n),t.child;case 8:case 12:return bs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,o=t.memoizedProps,s=r.value,wr(pa,i._currentValue),i._currentValue=s,null!==o)if(si(o.value,s)){if(o.children===r.children&&!xr.current){t=Es(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var g=o.dependencies;if(null!==g){s=o.child;for(var l=g.firstContext;null!==l;){if(l.context===i){if(1===o.tag){(l=Xa(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var c=(u=u.shared).pending;null===c?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Ga(o.return,n,t),g.lanes|=n;break}l=l.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=n,null!==(g=s.alternate)&&(g.lanes|=n),Ga(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}bs(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,Ba(t,n),i=i(r=Za(r)),t.flags|=1,bs(e,t,i,n),t.child;case 14:return r=Aa(i=t.type,t.pendingProps),Gs(e,t,i,r=Aa(i.type,r),n);case 15:return Bs(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:Aa(i,r),Ts(e,t),t.tag=1,kr(i)?(e=!0,Fr(t)):e=!1,Ba(t,n),Ta(t,i,r),Ja(t,i,r,n),xs(null,t,i,!0,e,n);case 19:return _s(e,t,n);case 22:return Zs(e,t,n)}throw Error(a(156,t.tag))};var Pl="function"===typeof reportError?reportError:function(e){console.error(e)};function Ql(e){this._internalRoot=e}function Ol(e){this._internalRoot=e}function jl(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function ql(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $l(){}function eu(e,t,n,i,r){var a=n._reactRootContainer;if(a){var o=a;if("function"===typeof r){var s=r;r=function(){var e=Jl(o);s.call(e)}}El(t,o,e,r)}else o=function(e,t,n,i,r){if(r){if("function"===typeof i){var a=i;i=function(){var e=Jl(o);a.call(e)}}var o=Tl(t,i,e,0,null,!1,0,"",$l);return e._reactRootContainer=o,e[dr]=o.current,_i(8===e.nodeType?e.parentNode:e),ul(),o}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof i){var s=i;i=function(){var e=Jl(g);s.call(e)}}var g=zl(e,0,!1,null,0,!1,0,"",$l);return e._reactRootContainer=g,e[dr]=g.current,_i(8===e.nodeType?e.parentNode:e),ul((function(){El(t,g,n,i)})),g}(n,t,e,r,i);return Jl(o)}Ol.prototype.render=Ql.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));El(e,t,null,null)},Ol.prototype.unmount=Ql.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;ul((function(){El(null,e,null,null)})),t[dr]=null}},Ol.prototype.unstable_scheduleHydration=function(e){if(e){var t=Bt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Xt.length&&0!==t&&t<Xt[n].priority;n++);Xt.splice(n,0,e),0===n&&Mt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ct(t.pendingLanes);0!==n&&(mt(t,1|n),il(t,je()),0===(6&Wg)&&(_g=je()+500,_r()))}break;case 13:ul((function(){var t=xa(e,1);if(null!==t){var n=el();nl(t,e,1,n)}})),Ul(e,1)}},yt=function(e){if(13===e.tag){var t=xa(e,134217728);if(null!==t)nl(t,e,134217728,el());Ul(e,134217728)}},Gt=function(e){if(13===e.tag){var t=tl(e),n=xa(e,t);if(null!==n)nl(n,e,t,el());Ul(e,t)}},Bt=function(){return ft},Zt=function(e,t){var n=ft;try{return ft=e,t()}finally{ft=n}},ye=function(e,t,n){switch(t){case"input":if(q(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var r=br(i);if(!r)throw Error(a(90));U(i),q(i,r)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},We=ll,xe=ul;var tu={usingClientEntryPoint:!1,Events:[fr,vr,br,we,Se,ll]},nu={findFiberByHostInstance:mr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},iu={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:v.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Je(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{rt=ru.inject(iu),at=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!jl(t))throw Error(a(200));return Ll(e,t,null,n)},t.createRoot=function(e,t){if(!jl(e))throw Error(a(299));var n=!1,i="",r=Pl;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=zl(e,1,!1,null,0,n,0,i,r),e[dr]=t.current,_i(8===e.nodeType?e.parentNode:e),new Ql(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=Je(t))?null:e.stateNode},t.flushSync=function(e){return ul(e)},t.hydrate=function(e,t,n){if(!ql(t))throw Error(a(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!jl(e))throw Error(a(405));var i=null!=n&&n.hydratedSources||null,r=!1,o="",s=Pl;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Tl(t,null,e,1,null!=n?n:null,r,0,o,s),e[dr]=t.current,_i(e),i)for(e=0;e<i.length;e++)r=(r=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Ol(t)},t.render=function(e,t,n){if(!ql(t))throw Error(a(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!ql(e))throw Error(a(40));return!!e._reactRootContainer&&(ul((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[dr]=null}))})),!0)},t.unstable_batchedUpdates=ll,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!ql(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return eu(e,t,n,!1,i)},t.version="18.2.0-next-9e3b772b8-20220608"},1250:function(e,t,n){"use strict";var i=n(4164);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},4164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},77:function(e){"use strict";var t=Array.isArray,n=Object.keys,i=Object.prototype.hasOwnProperty,r="undefined"!==typeof Element;function a(e,o){if(e===o)return!0;if(e&&o&&"object"==typeof e&&"object"==typeof o){var s,g,l,u=t(e),c=t(o);if(u&&c){if((g=e.length)!=o.length)return!1;for(s=g;0!==s--;)if(!a(e[s],o[s]))return!1;return!0}if(u!=c)return!1;var I=e instanceof Date,C=o instanceof Date;if(I!=C)return!1;if(I&&C)return e.getTime()==o.getTime();var d=e instanceof RegExp,h=o instanceof RegExp;if(d!=h)return!1;if(d&&h)return e.toString()==o.toString();var A=n(e);if((g=A.length)!==n(o).length)return!1;for(s=g;0!==s--;)if(!i.call(o,A[s]))return!1;if(r&&e instanceof Element&&o instanceof Element)return e===o;for(s=g;0!==s--;)if(("_owner"!==(l=A[s])||!e.$$typeof)&&!a(e[l],o[l]))return!1;return!0}return e!==e&&o!==o}e.exports=function(e,t){try{return a(e,t)}catch(n){if(n.message&&n.message.match(/stack|recursion/i)||-2146828260===n.number)return console.warn("Warning: react-fast-compare does not handle circular references.",n.name,n.message),!1;throw n}}},4976:function(e,t){"use strict";t.ConcurrentRoot=1,t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},3721:function(e,t,n){e.exports=function(e){var t={},i=n(2791),r=n(3100),a=Object.assign;function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,g=Symbol.for("react.element"),l=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),d=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),p=Symbol.for("react.suspense_list"),m=Symbol.for("react.memo"),f=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var v=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var b=Symbol.iterator;function y(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=b&&e[b]||e["@@iterator"])?e:null}function G(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case u:return"Fragment";case l:return"Portal";case I:return"Profiler";case c:return"StrictMode";case A:return"Suspense";case p:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case d:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case h:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case m:return null!==(t=e.displayName||null)?t:G(e.type)||"Memo";case f:t=e._payload,e=e._init;try{return G(e(t))}catch(n){}}return null}function B(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return G(t);case 8:return t===c?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function Z(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function w(e){if(Z(e)!==e)throw Error(o(188))}function S(e){var t=e.alternate;if(!t){if(null===(t=Z(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,i=t;;){var r=n.return;if(null===r)break;var a=r.alternate;if(null===a){if(null!==(i=r.return)){n=i;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===n)return w(r),e;if(a===i)return w(r),t;a=a.sibling}throw Error(o(188))}if(n.return!==i.return)n=r,i=a;else{for(var s=!1,g=r.child;g;){if(g===n){s=!0,n=r,i=a;break}if(g===i){s=!0,i=r,n=a;break}g=g.sibling}if(!s){for(g=a.child;g;){if(g===n){s=!0,n=a,i=r;break}if(g===i){s=!0,i=a,n=r;break}g=g.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==i)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}function W(e){return null!==(e=S(e))?x(e):null}function x(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=x(e);if(null!==t)return t;e=e.sibling}return null}function R(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=R(e);if(null!==t)return t}e=e.sibling}return null}var V,k=Array.isArray,X=e.getPublicInstance,Y=e.getRootHostContext,H=e.getChildHostContext,F=e.prepareForCommit,M=e.resetAfterCommit,K=e.createInstance,N=e.appendInitialChild,z=e.finalizeInitialChildren,L=e.prepareUpdate,_=e.shouldSetTextContent,T=e.createTextInstance,E=e.scheduleTimeout,J=e.cancelTimeout,D=e.noTimeout,U=e.isPrimaryRenderer,P=e.supportsMutation,Q=e.supportsPersistence,O=e.supportsHydration,j=e.getInstanceFromNode,q=e.preparePortalMount,$=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,ie=e.supportsTestSelectors,re=e.findFiberRoot,ae=e.getBoundingRect,oe=e.getTextContent,se=e.isHiddenSubtree,ge=e.matchAccessibilityRole,le=e.setFocusIfFocusable,ue=e.setupIntersectionObserver,ce=e.appendChild,Ie=e.appendChildToContainer,Ce=e.commitTextUpdate,de=e.commitMount,he=e.commitUpdate,Ae=e.insertBefore,pe=e.insertInContainerBefore,me=e.removeChild,fe=e.removeChildFromContainer,ve=e.resetTextContent,be=e.hideInstance,ye=e.hideTextInstance,Ge=e.unhideInstance,Be=e.unhideTextInstance,Ze=e.clearContainer,we=e.cloneInstance,Se=e.createContainerChildSet,We=e.appendChildToContainerChildSet,xe=e.finalizeContainerChildren,Re=e.replaceContainerChildren,Ve=e.cloneHiddenInstance,ke=e.cloneHiddenTextInstance,Xe=e.canHydrateInstance,Ye=e.canHydrateTextInstance,He=e.canHydrateSuspenseInstance,Fe=e.isSuspenseInstancePending,Me=e.isSuspenseInstanceFallback,Ke=e.registerSuspenseInstanceRetry,Ne=e.getNextHydratableSibling,ze=e.getFirstHydratableChild,Le=e.getFirstHydratableChildWithinContainer,_e=e.getFirstHydratableChildWithinSuspenseInstance,Te=e.hydrateInstance,Ee=e.hydrateTextInstance,Je=e.hydrateSuspenseInstance,De=e.getNextHydratableInstanceAfterSuspenseInstance,Ue=e.commitHydratedContainer,Pe=e.commitHydratedSuspenseInstance,Qe=e.clearSuspenseBoundary,Oe=e.clearSuspenseBoundaryFromContainer,je=e.shouldDeleteUnhydratedTailInstances,qe=e.didNotMatchHydratedContainerTextInstance,$e=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===V)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);V=t&&t[1]||""}return"\n"+V+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var i=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){i=l}e.call(t.prototype)}else{try{throw Error()}catch(l){i=l}e()}}catch(l){if(l&&i&&"string"===typeof l.stack){for(var r=l.stack.split("\n"),a=i.stack.split("\n"),o=r.length-1,s=a.length-1;1<=o&&0<=s&&r[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(r[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||r[o]!==a[s]){var g="\n"+r[o].replace(" at new "," at ");return e.displayName&&g.includes("<anonymous>")&&(g=g.replace("<anonymous>",e.displayName)),g}}while(1<=o&&0<=s);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var it=Object.prototype.hasOwnProperty,rt=[],at=-1;function ot(e){return{current:e}}function st(e){0>at||(e.current=rt[at],rt[at]=null,at--)}function gt(e,t){at++,rt[at]=e.current,e.current=t}var lt={},ut=ot(lt),ct=ot(!1),It=lt;function Ct(e,t){var n=e.type.contextTypes;if(!n)return lt;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function dt(e){return null!==(e=e.childContextTypes)&&void 0!==e}function ht(){st(ct),st(ut)}function At(e,t,n){if(ut.current!==lt)throw Error(o(168));gt(ut,t),gt(ct,n)}function pt(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in t))throw Error(o(108,B(e)||"Unknown",r));return a({},n,i)}function mt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||lt,It=ut.current,gt(ut,e),gt(ct,ct.current),!0}function ft(e,t,n){var i=e.stateNode;if(!i)throw Error(o(169));n?(e=pt(e,t,It),i.__reactInternalMemoizedMergedChildContext=e,st(ct),st(ut),gt(ut,e)):st(ct),gt(ct,n)}var vt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(bt(e)/yt|0)|0},bt=Math.log,yt=Math.LN2;var Gt=64,Bt=4194304;function Zt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function wt(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,r=e.suspendedLanes,a=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~r;0!==s?i=Zt(s):0!==(a&=o)&&(i=Zt(a))}else 0!==(o=n&~r)?i=Zt(o):0!==a&&(i=Zt(a));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&r)&&((r=i&-i)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)r=1<<(n=31-vt(t)),i|=e[n],t&=~r;return i}function St(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Wt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function xt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Rt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-vt(t)]=n}function Vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-vt(n),r=1<<i;r&t|e[i]&t&&(e[i]|=t),n&=~r}}var kt=0;function Xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Yt=r.unstable_scheduleCallback,Ht=r.unstable_cancelCallback,Ft=r.unstable_shouldYield,Mt=r.unstable_requestPaint,Kt=r.unstable_now,Nt=r.unstable_ImmediatePriority,zt=r.unstable_UserBlockingPriority,Lt=r.unstable_NormalPriority,_t=r.unstable_IdlePriority,Tt=null,Et=null;var Jt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Dt=null,Ut=!1,Pt=!1;function Qt(e){null===Dt?Dt=[e]:Dt.push(e)}function Ot(){if(!Pt&&null!==Dt){Pt=!0;var e=0,t=kt;try{var n=Dt;for(kt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Dt=null,Ut=!1}catch(r){throw null!==Dt&&(Dt=Dt.slice(e+1)),Yt(Nt,Ot),r}finally{kt=t,Pt=!1}}return null}var jt=s.ReactCurrentBatchConfig;function qt(e,t){if(Jt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!it.call(t,r)||!Jt(e[r],t[r]))return!1}return!0}function $t(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=a({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=ot(null),nn=null,rn=null,an=null;function on(){an=rn=nn=null}function sn(e,t,n){U?(gt(tn,t._currentValue),t._currentValue=n):(gt(tn,t._currentValue2),t._currentValue2=n)}function gn(e){var t=tn.current;st(tn),U?e._currentValue=t:e._currentValue2=t}function ln(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function un(e,t){nn=e,an=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Fr=!0),e.firstContext=null)}function cn(e){var t=U?e._currentValue:e._currentValue2;if(an!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(o(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var In=null,Cn=!1;function dn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function An(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function pn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==Pa&&0!==(1&e.mode)&&0===(2&Ua)?(null===(e=n.interleaved)?(t.next=t,null===In?In=[n]:In.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function mn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Vt(e,n)}}function fn(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function vn(e,t,n,i){var r=e.updateQueue;Cn=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,g=r.shared.pending;if(null!==g){r.shared.pending=null;var l=g,u=l.next;l.next=null,null===s?o=u:s.next=u,s=l;var c=e.alternate;null!==c&&((g=(c=c.updateQueue).lastBaseUpdate)!==s&&(null===g?c.firstBaseUpdate=u:g.next=u,c.lastBaseUpdate=l))}if(null!==o){var I=r.baseState;for(s=0,c=u=l=null,g=o;;){var C=g.lane,d=g.eventTime;if((i&C)===C){null!==c&&(c=c.next={eventTime:d,lane:0,tag:g.tag,payload:g.payload,callback:g.callback,next:null});e:{var h=e,A=g;switch(C=t,d=n,A.tag){case 1:if("function"===typeof(h=A.payload)){I=h.call(d,I,C);break e}I=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null===(C="function"===typeof(h=A.payload)?h.call(d,I,C):h)||void 0===C)break e;I=a({},I,C);break e;case 2:Cn=!0}}null!==g.callback&&0!==g.lane&&(e.flags|=64,null===(C=r.effects)?r.effects=[g]:C.push(g))}else d={eventTime:d,lane:C,tag:g.tag,payload:g.payload,callback:g.callback,next:null},null===c?(u=c=d,l=I):c=c.next=d,s|=C;if(null===(g=g.next)){if(null===(g=r.shared.pending))break;g=(C=g).next,C.next=null,r.lastBaseUpdate=C,r.shared.pending=null}}if(null===c&&(l=I),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=c,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===o&&(r.shared.lanes=0);to|=s,e.lanes=s,e.memoizedState=I}}function bn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],r=i.callback;if(null!==r){if(i.callback=null,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var yn=(new i.Component).refs;function Gn(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:a({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Bn={isMounted:function(e){return!!(e=e._reactInternals)&&Z(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=bo(),r=yo(e),a=An(i,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),pn(e,a),null!==(t=Go(e,r,i))&&mn(t,e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=bo(),r=yo(e),a=An(i,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),pn(e,a),null!==(t=Go(e,r,i))&&mn(t,e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=bo(),i=yo(e),r=An(n,i);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),pn(e,r),null!==(t=Go(e,i,n))&&mn(t,e,i)}};function Zn(e,t,n,i,r,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!qt(n,i)||!qt(r,a))}function wn(e,t,n){var i=!1,r=lt,a=t.contextType;return"object"===typeof a&&null!==a?a=cn(a):(r=dt(t)?It:ut.current,a=(i=null!==(i=t.contextTypes)&&void 0!==i)?Ct(e,r):lt),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Bn,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function Sn(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&Bn.enqueueReplaceState(t,t.state,null)}function Wn(e,t,n,i){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=yn,dn(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=cn(a):(a=dt(t)?It:ut.current,r.context=Ct(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(Gn(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Bn.enqueueReplaceState(r,r.state,null),vn(e,n,r,i),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}var xn=[],Rn=0,Vn=null,kn=0,Xn=[],Yn=0,Hn=null,Fn=1,Mn="";function Kn(e,t){xn[Rn++]=kn,xn[Rn++]=Vn,Vn=e,kn=t}function Nn(e,t,n){Xn[Yn++]=Fn,Xn[Yn++]=Mn,Xn[Yn++]=Hn,Hn=e;var i=Fn;e=Mn;var r=32-vt(i)-1;i&=~(1<<r),n+=1;var a=32-vt(t)+r;if(30<a){var o=r-r%5;a=(i&(1<<o)-1).toString(32),i>>=o,r-=o,Fn=1<<32-vt(t)+r|n<<r|i,Mn=a+e}else Fn=1<<a|n<<r|i,Mn=e}function zn(e){null!==e.return&&(Kn(e,1),Nn(e,1,0))}function Ln(e){for(;e===Vn;)Vn=xn[--Rn],xn[Rn]=null,kn=xn[--Rn],xn[Rn]=null;for(;e===Hn;)Hn=Xn[--Yn],Xn[Yn]=null,Mn=Xn[--Yn],Xn[Yn]=null,Fn=Xn[--Yn],Xn[Yn]=null}var _n=null,Tn=null,En=!1,Jn=!1,Dn=null;function Un(e,t){var n=qo(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Pn(e,t){switch(e.tag){case 5:return null!==(t=Xe(t,e.type,e.pendingProps))&&(e.stateNode=t,_n=e,Tn=ze(t),!0);case 6:return null!==(t=Ye(t,e.pendingProps))&&(e.stateNode=t,_n=e,Tn=null,!0);case 13:if(null!==(t=He(t))){var n=null!==Hn?{id:Fn,overflow:Mn}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=qo(18,null,null,0)).stateNode=t,n.return=e,e.child=n,_n=e,Tn=null,!0}return!1;default:return!1}}function Qn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function On(e){if(En){var t=Tn;if(t){var n=t;if(!Pn(e,t)){if(Qn(e))throw Error(o(418));t=Ne(n);var i=_n;t&&Pn(e,t)?Un(i,n):(e.flags=-4097&e.flags|2,En=!1,_n=e)}}else{if(Qn(e))throw Error(o(418));e.flags=-4097&e.flags|2,En=!1,_n=e}}}function jn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;_n=e}function qn(e){if(!O||e!==_n)return!1;if(!En)return jn(e),En=!0,!1;if(3!==e.tag&&(5!==e.tag||je(e.type)&&!_(e.type,e.memoizedProps))){var t=Tn;if(t){if(Qn(e)){for(e=Tn;e;)e=Ne(e);throw Error(o(418))}for(;t;)Un(e,t),t=Ne(t)}}if(jn(e),13===e.tag){if(!O)throw Error(o(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));Tn=De(e)}else Tn=_n?Ne(e.stateNode):null;return!0}function $n(){O&&(Tn=_n=null,Jn=En=!1)}function ei(e){null===Dn?Dn=[e]:Dn.push(e)}function ti(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var i=n.stateNode}if(!i)throw Error(o(147,e));var r=i,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=r.refs;t===yn&&(t=r.refs={}),null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function ni(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ii(e){return(0,e._init)(e._payload)}function ri(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=es(e,t)).index=0,e.sibling=null,e}function a(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,i){return null===t||6!==t.tag?((t=rs(n,e.mode,i)).return=e,t):((t=r(t,n)).return=e,t)}function I(e,t,n,i){var a=n.type;return a===u?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===f&&ii(a)===t.type)?((i=r(t,n.props)).ref=ti(e,t,n),i.return=e,i):((i=ts(n.type,n.key,n.props,null,e.mode,i)).ref=ti(e,t,n),i.return=e,i)}function C(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=as(n,e.mode,i)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function d(e,t,n,i,a){return null===t||7!==t.tag?((t=ns(n,e.mode,i,a)).return=e,t):((t=r(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=rs(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case g:return(n=ts(t.type,t.key,t.props,null,e.mode,n)).ref=ti(e,null,t),n.return=e,n;case l:return(t=as(t,e.mode,n)).return=e,t;case f:return h(e,(0,t._init)(t._payload),n)}if(k(t)||y(t))return(t=ns(t,e.mode,n,null)).return=e,t;ni(e,t)}return null}function A(e,t,n,i){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:c(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case g:return n.key===r?I(e,t,n,i):null;case l:return n.key===r?C(e,t,n,i):null;case f:return A(e,t,(r=n._init)(n._payload),i)}if(k(n)||y(n))return null!==r?null:d(e,t,n,i,null);ni(e,n)}return null}function p(e,t,n,i,r){if("string"===typeof i&&""!==i||"number"===typeof i)return c(t,e=e.get(n)||null,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case g:return I(t,e=e.get(null===i.key?n:i.key)||null,i,r);case l:return C(t,e=e.get(null===i.key?n:i.key)||null,i,r);case f:return p(e,t,n,(0,i._init)(i._payload),r)}if(k(i)||y(i))return d(t,e=e.get(n)||null,i,r,null);ni(t,i)}return null}function m(r,o,s,g){for(var l=null,u=null,c=o,I=o=0,C=null;null!==c&&I<s.length;I++){c.index>I?(C=c,c=null):C=c.sibling;var d=A(r,c,s[I],g);if(null===d){null===c&&(c=C);break}e&&c&&null===d.alternate&&t(r,c),o=a(d,o,I),null===u?l=d:u.sibling=d,u=d,c=C}if(I===s.length)return n(r,c),En&&Kn(r,I),l;if(null===c){for(;I<s.length;I++)null!==(c=h(r,s[I],g))&&(o=a(c,o,I),null===u?l=c:u.sibling=c,u=c);return En&&Kn(r,I),l}for(c=i(r,c);I<s.length;I++)null!==(C=p(c,r,I,s[I],g))&&(e&&null!==C.alternate&&c.delete(null===C.key?I:C.key),o=a(C,o,I),null===u?l=C:u.sibling=C,u=C);return e&&c.forEach((function(e){return t(r,e)})),En&&Kn(r,I),l}function v(r,s,g,l){var u=y(g);if("function"!==typeof u)throw Error(o(150));if(null==(g=u.call(g)))throw Error(o(151));for(var c=u=null,I=s,C=s=0,d=null,m=g.next();null!==I&&!m.done;C++,m=g.next()){I.index>C?(d=I,I=null):d=I.sibling;var f=A(r,I,m.value,l);if(null===f){null===I&&(I=d);break}e&&I&&null===f.alternate&&t(r,I),s=a(f,s,C),null===c?u=f:c.sibling=f,c=f,I=d}if(m.done)return n(r,I),En&&Kn(r,C),u;if(null===I){for(;!m.done;C++,m=g.next())null!==(m=h(r,m.value,l))&&(s=a(m,s,C),null===c?u=m:c.sibling=m,c=m);return En&&Kn(r,C),u}for(I=i(r,I);!m.done;C++,m=g.next())null!==(m=p(I,r,C,m.value,l))&&(e&&null!==m.alternate&&I.delete(null===m.key?C:m.key),s=a(m,s,C),null===c?u=m:c.sibling=m,c=m);return e&&I.forEach((function(e){return t(r,e)})),En&&Kn(r,C),u}return function e(i,a,o,c){if("object"===typeof o&&null!==o&&o.type===u&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case g:e:{for(var I=o.key,C=a;null!==C;){if(C.key===I){if((I=o.type)===u){if(7===C.tag){n(i,C.sibling),(a=r(C,o.props.children)).return=i,i=a;break e}}else if(C.elementType===I||"object"===typeof I&&null!==I&&I.$$typeof===f&&ii(I)===C.type){n(i,C.sibling),(a=r(C,o.props)).ref=ti(i,C,o),a.return=i,i=a;break e}n(i,C);break}t(i,C),C=C.sibling}o.type===u?((a=ns(o.props.children,i.mode,c,o.key)).return=i,i=a):((c=ts(o.type,o.key,o.props,null,i.mode,c)).ref=ti(i,a,o),c.return=i,i=c)}return s(i);case l:e:{for(C=o.key;null!==a;){if(a.key===C){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){n(i,a.sibling),(a=r(a,o.children||[])).return=i,i=a;break e}n(i,a);break}t(i,a),a=a.sibling}(a=as(o,i.mode,c)).return=i,i=a}return s(i);case f:return e(i,a,(C=o._init)(o._payload),c)}if(k(o))return m(i,a,o,c);if(y(o))return v(i,a,o,c);ni(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(n(i,a.sibling),(a=r(a,o)).return=i,i=a):(n(i,a),(a=rs(o,i.mode,c)).return=i,i=a),s(i)):n(i,a)}}var ai=ri(!0),oi=ri(!1),si={},gi=ot(si),li=ot(si),ui=ot(si);function ci(e){if(e===si)throw Error(o(174));return e}function Ii(e,t){gt(ui,t),gt(li,e),gt(gi,si),e=Y(t),st(gi),gt(gi,e)}function Ci(){st(gi),st(li),st(ui)}function di(e){var t=ci(ui.current),n=ci(gi.current);n!==(t=H(n,e.type,t))&&(gt(li,e),gt(gi,t))}function hi(e){li.current===e&&(st(gi),st(li))}var Ai=ot(0);function pi(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Fe(n)||Me(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var mi=[];function fi(){for(var e=0;e<mi.length;e++){var t=mi[e];U?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}mi.length=0}var vi=s.ReactCurrentDispatcher,bi=s.ReactCurrentBatchConfig,yi=0,Gi=null,Bi=null,Zi=null,wi=!1,Si=!1,Wi=0,xi=0;function Ri(){throw Error(o(321))}function Vi(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Jt(e[n],t[n]))return!1;return!0}function ki(e,t,n,i,r,a){if(yi=a,Gi=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,vi.current=null===e||null===e.memoizedState?dr:hr,e=n(i,r),Si){a=0;do{if(Si=!1,Wi=0,25<=a)throw Error(o(301));a+=1,Zi=Bi=null,t.updateQueue=null,vi.current=Ar,e=n(i,r)}while(Si)}if(vi.current=Cr,t=null!==Bi&&null!==Bi.next,yi=0,Zi=Bi=Gi=null,wi=!1,t)throw Error(o(300));return e}function Xi(){var e=0!==Wi;return Wi=0,e}function Yi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Zi?Gi.memoizedState=Zi=e:Zi=Zi.next=e,Zi}function Hi(){if(null===Bi){var e=Gi.alternate;e=null!==e?e.memoizedState:null}else e=Bi.next;var t=null===Zi?Gi.memoizedState:Zi.next;if(null!==t)Zi=t,Bi=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Bi=e).memoizedState,baseState:Bi.baseState,baseQueue:Bi.baseQueue,queue:Bi.queue,next:null},null===Zi?Gi.memoizedState=Zi=e:Zi=Zi.next=e}return Zi}function Fi(e,t){return"function"===typeof t?t(e):t}function Mi(e){var t=Hi(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=Bi,r=i.baseQueue,a=n.pending;if(null!==a){if(null!==r){var s=r.next;r.next=a.next,a.next=s}i.baseQueue=r=a,n.pending=null}if(null!==r){a=r.next,i=i.baseState;var g=s=null,l=null,u=a;do{var c=u.lane;if((yi&c)===c)null!==l&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var I={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===l?(g=l=I,s=i):l=l.next=I,Gi.lanes|=c,to|=c}u=u.next}while(null!==u&&u!==a);null===l?s=i:l.next=g,Jt(i,t.memoizedState)||(Fr=!0),t.memoizedState=i,t.baseState=s,t.baseQueue=l,n.lastRenderedState=i}if(null!==(e=n.interleaved)){r=e;do{a=r.lane,Gi.lanes|=a,to|=a,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ki(e){var t=Hi(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var i=n.dispatch,r=n.pending,a=t.memoizedState;if(null!==r){n.pending=null;var s=r=r.next;do{a=e(a,s.action),s=s.next}while(s!==r);Jt(a,t.memoizedState)||(Fr=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,i]}function Ni(){}function zi(e,t){var n=Gi,i=Hi(),r=t(),a=!Jt(i.memoizedState,r);if(a&&(i.memoizedState=r,Fr=!0),i=i.queue,ji(Ti.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==Zi&&1&Zi.memoizedState.tag){if(n.flags|=2048,Di(9,_i.bind(null,n,i,r,t),void 0,null),null===Pa)throw Error(o(349));0!==(30&yi)||Li(n,t,r)}return r}function Li(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Gi.updateQueue)?(t={lastEffect:null,stores:null},Gi.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function _i(e,t,n,i){t.value=n,t.getSnapshot=i,Ei(t)&&Go(e,1,-1)}function Ti(e,t,n){return n((function(){Ei(t)&&Go(e,1,-1)}))}function Ei(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Jt(e,n)}catch(i){return!0}}function Ji(e){var t=Yi();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fi,lastRenderedState:e},t.queue=e,e=e.dispatch=gr.bind(null,Gi,e),[t.memoizedState,e]}function Di(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=Gi.updateQueue)?(t={lastEffect:null,stores:null},Gi.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Ui(){return Hi().memoizedState}function Pi(e,t,n,i){var r=Yi();Gi.flags|=e,r.memoizedState=Di(1|t,n,void 0,void 0===i?null:i)}function Qi(e,t,n,i){var r=Hi();i=void 0===i?null:i;var a=void 0;if(null!==Bi){var o=Bi.memoizedState;if(a=o.destroy,null!==i&&Vi(i,o.deps))return void(r.memoizedState=Di(t,n,a,i))}Gi.flags|=e,r.memoizedState=Di(1|t,n,a,i)}function Oi(e,t){return Pi(8390656,8,e,t)}function ji(e,t){return Qi(2048,8,e,t)}function qi(e,t){return Qi(4,2,e,t)}function $i(e,t){return Qi(4,4,e,t)}function er(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function tr(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Qi(4,4,er.bind(null,t,e),n)}function nr(){}function ir(e,t){var n=Hi();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Vi(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function rr(e,t){var n=Hi();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Vi(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function ar(e,t){var n=kt;kt=0!==n&&4>n?n:4,e(!0);var i=bi.transition;bi.transition={};try{e(!1),t()}finally{kt=n,bi.transition=i}}function or(){return Hi().memoizedState}function sr(e,t,n){var i=yo(e);n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},lr(e)?ur(t,n):(cr(e,t,n),null!==(e=Go(e,i,n=bo()))&&Ir(e,t,i))}function gr(e,t,n){var i=yo(e),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(lr(e))ur(t,r);else{cr(e,t,r);var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(r.hasEagerState=!0,r.eagerState=s,Jt(s,o))return}catch(g){}null!==(e=Go(e,i,n=bo()))&&Ir(e,t,i)}}function lr(e){var t=e.alternate;return e===Gi||null!==t&&t===Gi}function ur(e,t){Si=wi=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function cr(e,t,n){null!==Pa&&0!==(1&e.mode)&&0===(2&Ua)?(null===(e=t.interleaved)?(n.next=n,null===In?In=[t]:In.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function Ir(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,Vt(e,n)}}var Cr={readContext:cn,useCallback:Ri,useContext:Ri,useEffect:Ri,useImperativeHandle:Ri,useInsertionEffect:Ri,useLayoutEffect:Ri,useMemo:Ri,useReducer:Ri,useRef:Ri,useState:Ri,useDebugValue:Ri,useDeferredValue:Ri,useTransition:Ri,useMutableSource:Ri,useSyncExternalStore:Ri,useId:Ri,unstable_isNewReconciler:!1},dr={readContext:cn,useCallback:function(e,t){return Yi().memoizedState=[e,void 0===t?null:t],e},useContext:cn,useEffect:Oi,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pi(4194308,4,er.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pi(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pi(4,2,e,t)},useMemo:function(e,t){var n=Yi();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Yi();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=sr.bind(null,Gi,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Yi().memoizedState=e},useState:Ji,useDebugValue:nr,useDeferredValue:function(e){var t=Ji(e),n=t[0],i=t[1];return Oi((function(){var t=bi.transition;bi.transition={};try{i(e)}finally{bi.transition=t}}),[e]),n},useTransition:function(){var e=Ji(!1),t=e[0];return e=ar.bind(null,e[1]),Yi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=Gi,r=Yi();if(En){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Pa)throw Error(o(349));0!==(30&yi)||Li(i,t,n)}r.memoizedState=n;var a={value:n,getSnapshot:t};return r.queue=a,Oi(Ti.bind(null,i,a,e),[e]),i.flags|=2048,Di(9,_i.bind(null,i,a,n,t),void 0,null),n},useId:function(){var e=Yi(),t=Pa.identifierPrefix;if(En){var n=Mn;t=":"+t+"R"+(n=(Fn&~(1<<32-vt(Fn)-1)).toString(32)+n),0<(n=Wi++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=xi++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},hr={readContext:cn,useCallback:ir,useContext:cn,useEffect:ji,useImperativeHandle:tr,useInsertionEffect:qi,useLayoutEffect:$i,useMemo:rr,useReducer:Mi,useRef:Ui,useState:function(){return Mi(Fi)},useDebugValue:nr,useDeferredValue:function(e){var t=Mi(Fi),n=t[0],i=t[1];return ji((function(){var t=bi.transition;bi.transition={};try{i(e)}finally{bi.transition=t}}),[e]),n},useTransition:function(){return[Mi(Fi)[0],Hi().memoizedState]},useMutableSource:Ni,useSyncExternalStore:zi,useId:or,unstable_isNewReconciler:!1},Ar={readContext:cn,useCallback:ir,useContext:cn,useEffect:ji,useImperativeHandle:tr,useInsertionEffect:qi,useLayoutEffect:$i,useMemo:rr,useReducer:Ki,useRef:Ui,useState:function(){return Ki(Fi)},useDebugValue:nr,useDeferredValue:function(e){var t=Ki(Fi),n=t[0],i=t[1];return ji((function(){var t=bi.transition;bi.transition={};try{i(e)}finally{bi.transition=t}}),[e]),n},useTransition:function(){return[Ki(Fi)[0],Hi().memoizedState]},useMutableSource:Ni,useSyncExternalStore:zi,useId:or,unstable_isNewReconciler:!1};function pr(e,t){try{var n="",i=t;do{n+=$t(i),i=i.return}while(i);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r}}function mr(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fr,vr,br,yr,Gr="function"===typeof WeakMap?WeakMap:Map;function Br(e,t,n){(n=An(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){uo||(uo=!0,co=i),mr(0,t)},n}function Zr(e,t,n){(n=An(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var r=t.value;n.payload=function(){return i(r)},n.callback=function(){mr(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){mr(0,t),"function"!==typeof i&&(null===Io?Io=new Set([this]):Io.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function wr(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new Gr;var r=new Set;i.set(t,r)}else void 0===(r=i.get(t))&&(r=new Set,i.set(t,r));r.has(n)||(r.add(n),e=Do.bind(null,e,t,n),t.then(e,e))}function Sr(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Wr(e,t,n,i,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=An(-1,1)).tag=2,pn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}function xr(e){e.flags|=4}function Rr(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(P)fr=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)N(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},vr=function(){},br=function(e,t,n,i,r){if((e=e.memoizedProps)!==i){var a=t.stateNode,o=ci(gi.current);n=L(a,n,e,i,r,o),(t.updateQueue=n)&&xr(t)}},yr=function(e,t,n,i){n!==i&&xr(t)};else if(Q){fr=function(e,t,n,i){for(var r=t.child;null!==r;){if(5===r.tag){var a=r.stateNode;n&&i&&(a=Ve(a,r.type,r.memoizedProps,r)),N(e,a)}else if(6===r.tag)a=r.stateNode,n&&i&&(a=ke(a,r.memoizedProps,r)),N(e,a);else if(4!==r.tag)if(22===r.tag&&null!==r.memoizedState)null!==(a=r.child)&&(a.return=r),fr(e,r,!0,!0);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};var Vr=function e(t,n,i,r){for(var a=n.child;null!==a;){if(5===a.tag){var o=a.stateNode;i&&r&&(o=Ve(o,a.type,a.memoizedProps,a)),We(t,o)}else if(6===a.tag)o=a.stateNode,i&&r&&(o=ke(o,a.memoizedProps,a)),We(t,o);else if(4!==a.tag)if(22===a.tag&&null!==a.memoizedState)null!==(o=a.child)&&(o.return=a),e(t,a,!0,!0);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===n)break;for(;null===a.sibling;){if(null===a.return||a.return===n)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};vr=function(e,t){var n=t.stateNode;if(!Rr(e,t)){e=n.containerInfo;var i=Se(e);Vr(i,t,!1,!1),n.pendingChildren=i,xr(t),xe(e,i)}},br=function(e,t,n,i,r){var a=e.stateNode,o=e.memoizedProps;if((e=Rr(e,t))&&o===i)t.stateNode=a;else{var s=t.stateNode,g=ci(gi.current),l=null;o!==i&&(l=L(s,n,o,i,r,g)),e&&null===l?t.stateNode=a:(a=we(a,l,n,o,i,t,e,s),z(a,n,i,r,g)&&xr(t),t.stateNode=a,e?xr(t):fr(a,t,!1,!1))}},yr=function(e,t,n,i){n!==i?(e=ci(ui.current),n=ci(gi.current),t.stateNode=T(i,e,n,t),xr(t)):t.stateNode=e.stateNode}}else vr=function(){},br=function(){},yr=function(){};function kr(e,t){if(!En)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Xr(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=14680064&r.subtreeFlags,i|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Yr(e,t,n){var i=t.pendingProps;switch(Ln(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xr(t),null;case 1:case 17:return dt(t.type)&&ht(),Xr(t),null;case 3:return i=t.stateNode,Ci(),st(ct),st(ut),fi(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(qn(t)?xr(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Dn&&(Wo(Dn),Dn=null))),vr(e,t),Xr(t),null;case 5:hi(t),n=ci(ui.current);var r=t.type;if(null!==e&&null!=t.stateNode)br(e,t,r,i,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(o(166));return Xr(t),null}if(e=ci(gi.current),qn(t)){if(!O)throw Error(o(175));e=Te(t.stateNode,t.type,t.memoizedProps,n,e,t,!Jn),t.updateQueue=e,null!==e&&xr(t)}else{var a=K(r,i,n,e,t);fr(a,t,!1,!1),t.stateNode=a,z(a,r,i,n,e)&&xr(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Xr(t),null;case 6:if(e&&null!=t.stateNode)yr(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(o(166));if(e=ci(ui.current),n=ci(gi.current),qn(t)){if(!O)throw Error(o(176));if(e=t.stateNode,i=t.memoizedProps,(n=Ee(e,i,t,!Jn))&&null!==(r=_n))switch(a=0!==(1&r.mode),r.tag){case 3:qe(r.stateNode.containerInfo,e,i,a);break;case 5:$e(r.type,r.memoizedProps,r.stateNode,e,i,a)}n&&xr(t)}else t.stateNode=T(i,e,n,t)}return Xr(t),null;case 13:if(st(Ai),i=t.memoizedState,En&&null!==Tn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Tn;e;)e=Ne(e);return $n(),t.flags|=98560,t}if(null!==i&&null!==i.dehydrated){if(i=qn(t),null===e){if(!i)throw Error(o(318));if(!O)throw Error(o(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(o(317));Je(e,t)}else $n(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return Xr(t),null}return null!==Dn&&(Wo(Dn),Dn=null),0!==(128&t.flags)?(t.lanes=n,t):(i=null!==i,n=!1,null===e?qn(t):n=null!==e.memoizedState,i&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Ai.current)?0===$a&&($a=3):Fo())),null!==t.updateQueue&&(t.flags|=4),Xr(t),null);case 4:return Ci(),vr(e,t),null===e&&q(t.stateNode.containerInfo),Xr(t),null;case 10:return gn(t.type._context),Xr(t),null;case 19:if(st(Ai),null===(r=t.memoizedState))return Xr(t),null;if(i=0!==(128&t.flags),null===(a=r.rendering))if(i)kr(r,!1);else{if(0!==$a||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(a=pi(e))){for(t.flags|=128,kr(r,!1),null!==(e=a.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,i=t.child;null!==i;)r=e,(n=i).flags&=14680066,null===(a=n.alternate)?(n.childLanes=0,n.lanes=r,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=a.childLanes,n.lanes=a.lanes,n.child=a.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=a.memoizedProps,n.memoizedState=a.memoizedState,n.updateQueue=a.updateQueue,n.type=a.type,r=a.dependencies,n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext}),i=i.sibling;return gt(Ai,1&Ai.current|2),t.child}e=e.sibling}null!==r.tail&&Kt()>so&&(t.flags|=128,i=!0,kr(r,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=pi(a))){if(t.flags|=128,i=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),kr(r,!0),null===r.tail&&"hidden"===r.tailMode&&!a.alternate&&!En)return Xr(t),null}else 2*Kt()-r.renderingStartTime>so&&1073741824!==n&&(t.flags|=128,i=!0,kr(r,!1),t.lanes=4194304);r.isBackwards?(a.sibling=t.child,t.child=a):(null!==(e=r.last)?e.sibling=a:t.child=a,r.last=a)}return null!==r.tail?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=Kt(),t.sibling=null,e=Ai.current,gt(Ai,i?1&e|2:1&e),t):(Xr(t),null);case 22:case 23:return ko(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&ja)&&(Xr(t),P&&6&t.subtreeFlags&&(t.flags|=8192)):Xr(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}var Hr=s.ReactCurrentOwner,Fr=!1;function Mr(e,t,n,i){t.child=null===e?oi(t,null,n,i):ai(t,e.child,n,i)}function Kr(e,t,n,i,r){n=n.render;var a=t.ref;return un(t,r),i=ki(e,t,n,i,a,r),n=Xi(),null===e||Fr?(En&&n&&zn(t),t.flags|=1,Mr(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ra(e,t,r))}function Nr(e,t,n,i,r){if(null===e){var a=n.type;return"function"!==typeof a||$o(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ts(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,zr(e,t,a,i,r))}if(a=e.child,0===(e.lanes&r)){var o=a.memoizedProps;if((n=null!==(n=n.compare)?n:qt)(o,i)&&e.ref===t.ref)return ra(e,t,r)}return t.flags|=1,(e=es(a,i)).ref=t.ref,e.return=t,t.child=e}function zr(e,t,n,i,r){if(null!==e&&qt(e.memoizedProps,i)&&e.ref===t.ref){if(Fr=!1,0===(e.lanes&r))return t.lanes=e.lanes,ra(e,t,r);0!==(131072&e.flags)&&(Fr=!0)}return Tr(e,t,n,i,r)}function Lr(e,t,n){var i=t.pendingProps,r=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},gt(qa,ja),ja|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,gt(qa,ja),ja|=e,null;t.memoizedState={baseLanes:0,cachePool:null},i=null!==a?a.baseLanes:n,gt(qa,ja),ja|=i}else null!==a?(i=a.baseLanes|n,t.memoizedState=null):i=n,gt(qa,ja),ja|=i;return Mr(e,t,r,n),t.child}function _r(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Tr(e,t,n,i,r){var a=dt(n)?It:ut.current;return a=Ct(t,a),un(t,r),n=ki(e,t,n,i,a,r),i=Xi(),null===e||Fr?(En&&i&&zn(t),t.flags|=1,Mr(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,ra(e,t,r))}function Er(e,t,n,i,r){if(dt(n)){var a=!0;mt(t)}else a=!1;if(un(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),wn(t,n,i),Wn(t,n,i,r),i=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var g=o.context,l=n.contextType;"object"===typeof l&&null!==l?l=cn(l):l=Ct(t,l=dt(n)?It:ut.current);var u=n.getDerivedStateFromProps,c="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;c||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==i||g!==l)&&Sn(t,o,i,l),Cn=!1;var I=t.memoizedState;o.state=I,vn(t,i,o,r),g=t.memoizedState,s!==i||I!==g||ct.current||Cn?("function"===typeof u&&(Gn(t,n,u,i),g=t.memoizedState),(s=Cn||Zn(t,n,s,i,I,g,l))?(c||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=g),o.props=i,o.state=g,o.context=l,i=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,hn(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:en(t.type,s),o.props=l,c=t.pendingProps,I=o.context,"object"===typeof(g=n.contextType)&&null!==g?g=cn(g):g=Ct(t,g=dt(n)?It:ut.current);var C=n.getDerivedStateFromProps;(u="function"===typeof C||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==c||I!==g)&&Sn(t,o,i,g),Cn=!1,I=t.memoizedState,o.state=I,vn(t,i,o,r);var d=t.memoizedState;s!==c||I!==d||ct.current||Cn?("function"===typeof C&&(Gn(t,n,C,i),d=t.memoizedState),(l=Cn||Zn(t,n,l,i,I,d,g)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,d,g),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,d,g)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=d),o.props=i,o.state=d,o.context=g,i=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),i=!1)}return Jr(e,t,n,i,a,r)}function Jr(e,t,n,i,r,a){_r(e,t);var o=0!==(128&t.flags);if(!i&&!o)return r&&ft(t,n,!1),ra(e,t,a);i=t.stateNode,Hr.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=ai(t,e.child,null,a),t.child=ai(t,null,s,a)):Mr(e,t,s,a),t.memoizedState=i.state,r&&ft(t,n,!0),t.child}function Dr(e){var t=e.stateNode;t.pendingContext?At(0,t.pendingContext,t.pendingContext!==t.context):t.context&&At(0,t.context,!1),Ii(e,t.containerInfo)}function Ur(e,t,n,i,r){return $n(),ei(r),t.flags|=256,Mr(e,t,n,i),t.child}var Pr={dehydrated:null,treeContext:null,retryLane:0};function Qr(e){return{baseLanes:e,cachePool:null}}function Or(e,t,n){var i,r=t.pendingProps,a=Ai.current,s=!1,g=0!==(128&t.flags);if((i=g)||(i=(null===e||null!==e.memoizedState)&&0!==(2&a)),i?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),gt(Ai,1&a),null===e)return On(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:Me(e)?t.lanes=8:t.lanes=1073741824,null):(a=r.children,e=r.fallback,s?(r=t.mode,s=t.child,a={mode:"hidden",children:a},0===(1&r)&&null!==s?(s.childLanes=0,s.pendingProps=a):s=is(a,r,0,null),e=ns(e,r,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Qr(n),t.memoizedState=Pr,e):jr(t,a));if(null!==(a=e.memoizedState)){if(null!==(i=a.dehydrated)){if(g)return 256&t.flags?(t.flags&=-257,ea(e,t,n,Error(o(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,a=t.mode,r=is({mode:"visible",children:r.children},a,0,null),(s=ns(s,a,n,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&ai(t,e.child,null,n),t.child.memoizedState=Qr(n),t.memoizedState=Pr,s);if(0===(1&t.mode))t=ea(e,t,n,null);else if(Me(i))t=ea(e,t,n,Error(o(419)));else if(r=0!==(n&e.childLanes),Fr||r){if(null!==(r=Pa)){switch(n&-n){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(r=0!==(s&(r.suspendedLanes|n))?0:s)&&r!==a.retryLane&&(a.retryLane=r,Go(e,r,-1))}Fo(),t=ea(e,t,n,Error(o(421)))}else Fe(i)?(t.flags|=128,t.child=e.child,t=Po.bind(null,e),Ke(i,t),t=null):(n=a.treeContext,O&&(Tn=_e(i),_n=t,En=!0,Dn=null,Jn=!1,null!==n&&(Xn[Yn++]=Fn,Xn[Yn++]=Mn,Xn[Yn++]=Hn,Fn=n.id,Mn=n.overflow,Hn=t)),(t=jr(t,t.pendingProps.children)).flags|=4096);return t}return s?(r=$r(e,t,r.children,r.fallback,n),s=t.child,a=e.child.memoizedState,s.memoizedState=null===a?Qr(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=Pr,r):(n=qr(e,t,r.children,n),t.memoizedState=null,n)}return s?(r=$r(e,t,r.children,r.fallback,n),s=t.child,a=e.child.memoizedState,s.memoizedState=null===a?Qr(n):{baseLanes:a.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=Pr,r):(n=qr(e,t,r.children,n),t.memoizedState=null,n)}function jr(e,t){return(t=is({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function qr(e,t,n,i){var r=e.child;return e=r.sibling,n=es(r,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n}function $r(e,t,n,i,r){var a=t.mode,o=(e=e.child).sibling,s={mode:"hidden",children:n};return 0===(1&a)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=s,t.deletions=null):(n=es(e,s)).subtreeFlags=14680064&e.subtreeFlags,null!==o?i=es(o,i):(i=ns(i,a,r,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}function ea(e,t,n,i){return null!==i&&ei(i),ai(t,e.child,null,n),(e=jr(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ta(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),ln(e.return,t,n)}function na(e,t,n,i,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=r)}function ia(e,t,n){var i=t.pendingProps,r=i.revealOrder,a=i.tail;if(Mr(e,t,i.children,n),0!==(2&(i=Ai.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ta(e,n,t);else if(19===e.tag)ta(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(gt(Ai,i),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===pi(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),na(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===pi(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}na(t,!0,n,null,a);break;case"together":na(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ra(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),to|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=es(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=es(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function aa(e,t){switch(Ln(t),t.tag){case 1:return dt(t.type)&&ht(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ci(),st(ct),st(ut),fi(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return hi(t),null;case 13:if(st(Ai),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));$n()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return st(Ai),null;case 4:return Ci(),null;case 10:return gn(t.type._context),null;case 22:case 23:return ko(),null;default:return null}}var oa=!1,sa=!1,ga="function"===typeof WeakSet?WeakSet:Set,la=null;function ua(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Jo(e,t,i)}else n.current=null}function ca(e,t,n){try{n()}catch(i){Jo(e,t,i)}}var Ia=!1;function Ca(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var r=i=i.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&ca(t,n,a)}r=r.next}while(r!==i)}}function da(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function ha(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=X(n);else e=n;"function"===typeof t?t(e):t.current=e}}function Aa(e,t,n){if(Et&&"function"===typeof Et.onCommitFiberUnmount)try{Et.onCommitFiberUnmount(Tt,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e=e.next;do{var r=i,a=r.destroy;r=r.tag,void 0!==a&&(0!==(2&r)||0!==(4&r))&&ca(t,n,a),i=i.next}while(i!==e)}break;case 1:if(ua(t,n),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){Jo(t,n,o)}break;case 5:ua(t,n);break;case 4:P?Ba(e,t,n):Q&&Q&&(t=t.stateNode.containerInfo,n=Se(t),Re(t,n))}}function pa(e,t,n){for(var i=t;;)if(Aa(e,i,n),null===i.child||P&&4===i.tag){if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}else i.child.return=i,i=i.child}function ma(e){var t=e.alternate;null!==t&&(e.alternate=null,ma(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function fa(e){return 5===e.tag||3===e.tag||4===e.tag}function va(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||fa(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ba(e){if(P){e:{for(var t=e.return;null!==t;){if(fa(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(ve(t),n.flags&=-33),Ga(e,n=va(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,ya(e,n=va(e),t);break;default:throw Error(o(161))}}}function ya(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?pe(n,e,t):Ie(n,e);else if(4!==i&&null!==(e=e.child))for(ya(e,t,n),e=e.sibling;null!==e;)ya(e,t,n),e=e.sibling}function Ga(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?Ae(n,e,t):ce(n,e);else if(4!==i&&null!==(e=e.child))for(Ga(e,t,n),e=e.sibling;null!==e;)Ga(e,t,n),e=e.sibling}function Ba(e,t,n){for(var i,r,a=t,s=!1;;){if(!s){s=a.return;e:for(;;){if(null===s)throw Error(o(160));switch(i=s.stateNode,s.tag){case 5:r=!1;break e;case 3:case 4:i=i.containerInfo,r=!0;break e}s=s.return}s=!0}if(5===a.tag||6===a.tag)pa(e,a,n),r?fe(i,a.stateNode):me(i,a.stateNode);else if(18===a.tag)r?Oe(i,a.stateNode):Qe(i,a.stateNode);else if(4===a.tag){if(null!==a.child){i=a.stateNode.containerInfo,r=!0,a.child.return=a,a=a.child;continue}}else if(Aa(e,a,n),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(s=!1)}a.sibling.return=a.return,a=a.sibling}}function Za(e,t){if(P){switch(t.tag){case 0:case 11:case 14:case 15:return Ca(3,t,t.return),da(3,t),void Ca(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps;e=null!==e?e.memoizedProps:i;var r=t.type,a=t.updateQueue;t.updateQueue=null,null!==a&&he(n,a,r,e,i,t)}return;case 6:if(null===t.stateNode)throw Error(o(162));return n=t.memoizedProps,void Ce(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(O&&null!==e&&e.memoizedState.isDehydrated&&Ue(t.stateNode.containerInfo));case 13:case 19:return void wa(t)}throw Error(o(163))}switch(t.tag){case 0:case 11:case 14:case 15:return Ca(3,t,t.return),da(3,t),void Ca(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void wa(t);case 3:O&&null!==e&&e.memoizedState.isDehydrated&&Ue(t.stateNode.containerInfo)}e:if(Q){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Re(t.containerInfo,t.pendingChildren);break e}throw Error(o(163))}}function wa(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ga),t.forEach((function(t){var i=Qo.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function Sa(e,t,n){la=e,Wa(e,t,n)}function Wa(e,t,n){for(var i=0!==(1&e.mode);null!==la;){var r=la,a=r.child;if(22===r.tag&&i){var o=null!==r.memoizedState||oa;if(!o){var s=r.alternate,g=null!==s&&null!==s.memoizedState||sa;s=oa;var l=sa;if(oa=o,(sa=g)&&!l)for(la=r;null!==la;)g=(o=la).child,22===o.tag&&null!==o.memoizedState?Va(r):null!==g?(g.return=o,la=g):Va(r);for(;null!==a;)la=a,Wa(a,t,n),a=a.sibling;la=r,oa=s,sa=l}xa(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,la=a):xa(e)}}function xa(e){for(;null!==la;){var t=la;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:sa||da(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!sa)if(null===n)i.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&bn(t,a,i);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=X(t.child.stateNode);break;case 1:n=t.child.stateNode}bn(t,s,n)}break;case 5:var g=t.stateNode;null===n&&4&t.flags&&de(g,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(O&&null===t.memoizedState){var l=t.alternate;if(null!==l){var u=l.memoizedState;if(null!==u){var c=u.dehydrated;null!==c&&Pe(c)}}}break;default:throw Error(o(163))}sa||512&t.flags&&ha(t)}catch(I){Jo(t,t.return,I)}}if(t===e){la=null;break}if(null!==(n=t.sibling)){n.return=t.return,la=n;break}la=t.return}}function Ra(e){for(;null!==la;){var t=la;if(t===e){la=null;break}var n=t.sibling;if(null!==n){n.return=t.return,la=n;break}la=t.return}}function Va(e){for(;null!==la;){var t=la;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{da(4,t)}catch(g){Jo(t,n,g)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var r=t.return;try{i.componentDidMount()}catch(g){Jo(t,r,g)}}var a=t.return;try{ha(t)}catch(g){Jo(t,a,g)}break;case 5:var o=t.return;try{ha(t)}catch(g){Jo(t,o,g)}}}catch(g){Jo(t,t.return,g)}if(t===e){la=null;break}var s=t.sibling;if(null!==s){s.return=t.return,la=s;break}la=t.return}}var ka=0,Xa=1,Ya=2,Ha=3,Fa=4;if("function"===typeof Symbol&&Symbol.for){var Ma=Symbol.for;ka=Ma("selector.component"),Xa=Ma("selector.has_pseudo_class"),Ya=Ma("selector.role"),Ha=Ma("selector.test_id"),Fa=Ma("selector.text")}function Ka(e){var t=j(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(o(364));return t}if(null===(e=re(e)))throw Error(o(362));return e.stateNode.current}function Na(e,t){switch(t.$$typeof){case ka:if(e.type===t.value)return!0;break;case Xa:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var i=e[n++],r=e[n++],a=t[r];if(5!==i.tag||!se(i)){for(;null!=a&&Na(i,a);)a=t[++r];if(r===t.length){t=!0;break e}for(i=i.child;null!==i;)e.push(i,r),i=i.sibling}}t=!1}return t;case Ya:if(5===e.tag&&ge(e.stateNode,t.value))return!0;break;case Fa:if((5===e.tag||6===e.tag)&&(null!==(e=oe(e))&&0<=e.indexOf(t.value)))return!0;break;case Ha:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function za(e){switch(e.$$typeof){case ka:return"<"+(G(e.value)||"Unknown")+">";case Xa:return":has("+(za(e)||"")+")";case Ya:return'[role="'+e.value+'"]';case Fa:return'"'+e.value+'"';case Ha:return'[data-testname="'+e.value+'"]';default:throw Error(o(365))}}function La(e,t){var n=[];e=[e,0];for(var i=0;i<e.length;){var r=e[i++],a=e[i++],o=t[a];if(5!==r.tag||!se(r)){for(;null!=o&&Na(r,o);)o=t[++a];if(a===t.length)n.push(r);else for(r=r.child;null!==r;)e.push(r,a),r=r.sibling}}return n}function _a(e,t){if(!ie)throw Error(o(363));e=La(e=Ka(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var i=e[n++];if(5===i.tag)se(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}var Ta=Math.ceil,Ea=s.ReactCurrentDispatcher,Ja=s.ReactCurrentOwner,Da=s.ReactCurrentBatchConfig,Ua=0,Pa=null,Qa=null,Oa=0,ja=0,qa=ot(0),$a=0,eo=null,to=0,no=0,io=0,ro=null,ao=null,oo=0,so=1/0;function go(){so=Kt()+500}var lo,uo=!1,co=null,Io=null,Co=!1,ho=null,Ao=0,po=0,mo=null,fo=-1,vo=0;function bo(){return 0!==(6&Ua)?Kt():-1!==fo?fo:fo=Kt()}function yo(e){return 0===(1&e.mode)?1:0!==(2&Ua)&&0!==Oa?Oa&-Oa:null!==jt.transition?(0===vo&&(e=Gt,0===(4194240&(Gt<<=1))&&(Gt=64),vo=e),vo):0!==(e=kt)?e:$()}function Go(e,t,n){if(50<po)throw po=0,mo=null,Error(o(185));var i=Bo(e,t);return null===i?null:(Rt(i,t,n),0!==(2&Ua)&&i===Pa||(i===Pa&&(0===(2&Ua)&&(no|=t),4===$a&&xo(i,Oa)),Zo(i,n),1===t&&0===Ua&&0===(1&e.mode)&&(go(),Ut&&Ot())),i)}function Bo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Zo(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-vt(a),s=1<<o,g=r[o];-1===g?0!==(s&n)&&0===(s&i)||(r[o]=St(s,t)):g<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var i=wt(e,e===Pa?Oa:0);if(0===i)null!==n&&Ht(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ht(n),1===t)0===e.tag?function(e){Ut=!0,Qt(e)}(Ro.bind(null,e)):Qt(Ro.bind(null,e)),te?ne((function(){0===Ua&&Ot()})):Yt(Nt,Ot),n=null;else{switch(Xt(i)){case 1:n=Nt;break;case 4:n=zt;break;case 16:default:n=Lt;break;case 536870912:n=_t}n=Oo(n,wo.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function wo(e,t){if(fo=-1,vo=0,0!==(6&Ua))throw Error(o(327));var n=e.callbackNode;if(To()&&e.callbackNode!==n)return null;var i=wt(e,e===Pa?Oa:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=Mo(e,i);else{t=i;var r=Ua;Ua|=2;var a=Ho();for(Pa===e&&Oa===t||(go(),Xo(e,t));;)try{No();break}catch(g){Yo(e,g)}on(),Ea.current=a,Ua=r,null!==Qa?t=0:(Pa=null,Oa=0,t=$a)}if(0!==t){if(2===t&&(0!==(r=Wt(e))&&(i=r,t=So(e,r))),1===t)throw n=eo,Xo(e,0),xo(e,i),Zo(e,Kt()),n;if(6===t)xo(e,i);else{if(r=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var r=n[i],a=r.getSnapshot;r=r.value;try{if(!Jt(a(),r))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=Mo(e,i))&&(0!==(a=Wt(e))&&(i=a,t=So(e,a))),1===t))throw n=eo,Xo(e,0),xo(e,i),Zo(e,Kt()),n;switch(e.finishedWork=r,e.finishedLanes=i,t){case 0:case 1:throw Error(o(345));case 2:case 5:_o(e,ao);break;case 3:if(xo(e,i),(130023424&i)===i&&10<(t=oo+500-Kt())){if(0!==wt(e,0))break;if(((r=e.suspendedLanes)&i)!==i){bo(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=E(_o.bind(null,e,ao),t);break}_o(e,ao);break;case 4:if(xo(e,i),(4194240&i)===i)break;for(t=e.eventTimes,r=-1;0<i;){var s=31-vt(i);a=1<<s,(s=t[s])>r&&(r=s),i&=~a}if(i=r,10<(i=(120>(i=Kt()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ta(i/1960))-i)){e.timeoutHandle=E(_o.bind(null,e,ao),i);break}_o(e,ao);break;default:throw Error(o(329))}}}return Zo(e,Kt()),e.callbackNode===n?wo.bind(null,e):null}function So(e,t){var n=ro;return e.current.memoizedState.isDehydrated&&(Xo(e,t).flags|=256),2!==(e=Mo(e,t))&&(t=ao,ao=n,null!==t&&Wo(t)),e}function Wo(e){null===ao?ao=e:ao.push.apply(ao,e)}function xo(e,t){for(t&=~io,t&=~no,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-vt(t),i=1<<n;e[n]=-1,t&=~i}}function Ro(e){if(0!==(6&Ua))throw Error(o(327));To();var t=wt(e,0);if(0===(1&t))return Zo(e,Kt()),null;var n=Mo(e,t);if(0!==e.tag&&2===n){var i=Wt(e);0!==i&&(t=i,n=So(e,i))}if(1===n)throw n=eo,Xo(e,0),xo(e,t),Zo(e,Kt()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_o(e,ao),Zo(e,Kt()),null}function Vo(e){null!==ho&&0===ho.tag&&0===(6&Ua)&&To();var t=Ua;Ua|=1;var n=Da.transition,i=kt;try{if(Da.transition=null,kt=1,e)return e()}finally{kt=i,Da.transition=n,0===(6&(Ua=t))&&Ot()}}function ko(){ja=qa.current,st(qa)}function Xo(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==D&&(e.timeoutHandle=D,J(n)),null!==Qa)for(n=Qa.return;null!==n;){var i=n;switch(Ln(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&ht();break;case 3:Ci(),st(ct),st(ut),fi();break;case 5:hi(i);break;case 4:Ci();break;case 13:case 19:st(Ai);break;case 10:gn(i.type._context);break;case 22:case 23:ko()}n=n.return}if(Pa=e,Qa=e=es(e.current,null),Oa=ja=t,$a=0,eo=null,io=no=to=0,ao=ro=null,null!==In){for(t=0;t<In.length;t++)if(null!==(i=(n=In[t]).interleaved)){n.interleaved=null;var r=i.next,a=n.pending;if(null!==a){var o=a.next;a.next=r,i.next=o}n.pending=i}In=null}return e}function Yo(e,t){for(;;){var n=Qa;try{if(on(),vi.current=Cr,wi){for(var i=Gi.memoizedState;null!==i;){var r=i.queue;null!==r&&(r.pending=null),i=i.next}wi=!1}if(yi=0,Zi=Bi=Gi=null,Si=!1,Wi=0,Ja.current=null,null===n||null===n.return){$a=1,eo=t,Qa=null;break}e:{var a=e,s=n.return,g=n,l=t;if(t=Oa,g.flags|=32768,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l,c=g,I=c.tag;if(0===(1&c.mode)&&(0===I||11===I||15===I)){var C=c.alternate;C?(c.updateQueue=C.updateQueue,c.memoizedState=C.memoizedState,c.lanes=C.lanes):(c.updateQueue=null,c.memoizedState=null)}var d=Sr(s);if(null!==d){d.flags&=-257,Wr(d,s,g,0,t),1&d.mode&&wr(a,u,t),l=u;var h=(t=d).updateQueue;if(null===h){var A=new Set;A.add(l),t.updateQueue=A}else h.add(l);break e}if(0===(1&t)){wr(a,u,t),Fo();break e}l=Error(o(426))}else if(En&&1&g.mode){var p=Sr(s);if(null!==p){0===(65536&p.flags)&&(p.flags|=256),Wr(p,s,g,0,t),ei(l);break e}}a=l,4!==$a&&($a=2),null===ro?ro=[a]:ro.push(a),l=pr(l,g),g=s;do{switch(g.tag){case 3:g.flags|=65536,t&=-t,g.lanes|=t,fn(g,Br(0,l,t));break e;case 1:a=l;var m=g.type,f=g.stateNode;if(0===(128&g.flags)&&("function"===typeof m.getDerivedStateFromError||null!==f&&"function"===typeof f.componentDidCatch&&(null===Io||!Io.has(f)))){g.flags|=65536,t&=-t,g.lanes|=t,fn(g,Zr(g,a,t));break e}}g=g.return}while(null!==g)}Lo(n)}catch(v){t=v,Qa===n&&null!==n&&(Qa=n=n.return);continue}break}}function Ho(){var e=Ea.current;return Ea.current=Cr,null===e?Cr:e}function Fo(){0!==$a&&3!==$a&&2!==$a||($a=4),null===Pa||0===(268435455&to)&&0===(268435455&no)||xo(Pa,Oa)}function Mo(e,t){var n=Ua;Ua|=2;var i=Ho();for(Pa===e&&Oa===t||Xo(e,t);;)try{Ko();break}catch(r){Yo(e,r)}if(on(),Ua=n,Ea.current=i,null!==Qa)throw Error(o(261));return Pa=null,Oa=0,$a}function Ko(){for(;null!==Qa;)zo(Qa)}function No(){for(;null!==Qa&&!Ft();)zo(Qa)}function zo(e){var t=lo(e.alternate,e,ja);e.memoizedProps=e.pendingProps,null===t?Lo(e):Qa=t,Ja.current=null}function Lo(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Yr(n,t,ja)))return void(Qa=n)}else{if(null!==(n=aa(n,t)))return n.flags&=32767,void(Qa=n);if(null===e)return $a=6,void(Qa=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Qa=t);Qa=t=e}while(null!==t);0===$a&&($a=5)}function _o(e,t){var n=kt,i=Da.transition;try{Da.transition=null,kt=1,function(e,t,n){do{To()}while(null!==ho);if(0!==(6&Ua))throw Error(o(327));var i=e.finishedWork,r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=i.lanes|i.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-vt(n),a=1<<r;t[r]=0,i[r]=-1,e[r]=-1,n&=~a}}(e,a),e===Pa&&(Qa=Pa=null,Oa=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||Co||(Co=!0,Oo(Lt,(function(){return To(),null}))),a=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||a){a=Da.transition,Da.transition=null;var s=kt;kt=1;var g=Ua;Ua|=4,Ja.current=null,function(e,t){for(F(e.containerInfo),la=t;null!==la;)if(t=(e=la).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,la=t;else for(;null!==la;){e=la;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var i=n.memoizedProps,r=n.memoizedState,a=e.stateNode,s=a.getSnapshotBeforeUpdate(e.elementType===e.type?i:en(e.type,i),r);a.__reactInternalSnapshotBeforeUpdate=s}break;case 3:P&&Ze(e.stateNode.containerInfo);break;default:throw Error(o(163))}}catch(g){Jo(e,e.return,g)}if(null!==(t=e.sibling)){t.return=e.return,la=t;break}la=e.return}n=Ia,Ia=!1}(e,i),function(e,t){for(la=t;null!==la;){var n=(t=la).deletions;if(null!==n)for(var i=0;i<n.length;i++){var r=n[i];try{var a=e;P?Ba(a,r,t):pa(a,r,t);var o=r.alternate;null!==o&&(o.return=null),r.return=null}catch(b){Jo(r,t,b)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,la=n;else for(;null!==la;){t=la;try{var s=t.flags;if(32&s&&P&&ve(t.stateNode),512&s){var g=t.alternate;if(null!==g){var l=g.ref;null!==l&&("function"===typeof l?l(null):l.current=null)}}if(8192&s)switch(t.tag){case 13:if(null!==t.memoizedState){var u=t.alternate;null!==u&&null!==u.memoizedState||(oo=Kt())}break;case 22:var c=null!==t.memoizedState,I=t.alternate,C=null!==I&&null!==I.memoizedState;if(n=t,P)e:if(i=n,r=c,a=null,P)for(var d=i;;){if(5===d.tag){if(null===a){a=d;var h=d.stateNode;r?be(h):Ge(d.stateNode,d.memoizedProps)}}else if(6===d.tag){if(null===a){var A=d.stateNode;r?ye(A):Be(A,d.memoizedProps)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===i)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===i)break;for(;null===d.sibling;){if(null===d.return||d.return===i)break e;a===d&&(a=null),d=d.return}a===d&&(a=null),d.sibling.return=d.return,d=d.sibling}if(c&&!C&&0!==(1&n.mode)){la=n;for(var p=n.child;null!==p;){for(n=la=p;null!==la;){var m=(i=la).child;switch(i.tag){case 0:case 11:case 14:case 15:Ca(4,i,i.return);break;case 1:ua(i,i.return);var f=i.stateNode;if("function"===typeof f.componentWillUnmount){var v=i.return;try{f.props=i.memoizedProps,f.state=i.memoizedState,f.componentWillUnmount()}catch(b){Jo(i,v,b)}}break;case 5:ua(i,i.return);break;case 22:if(null!==i.memoizedState){Ra(n);continue}}null!==m?(m.return=i,la=m):Ra(n)}p=p.sibling}}}switch(4102&s){case 2:ba(t),t.flags&=-3;break;case 6:ba(t),t.flags&=-3,Za(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Za(t.alternate,t);break;case 4:Za(t.alternate,t)}}catch(b){Jo(t,t.return,b)}if(null!==(n=t.sibling)){n.return=t.return,la=n;break}la=t.return}}}(e,i),M(e.containerInfo),e.current=i,Sa(i,e,r),Mt(),Ua=g,kt=s,Da.transition=a}else e.current=i;if(Co&&(Co=!1,ho=e,Ao=r),0===(a=e.pendingLanes)&&(Io=null),function(e){if(Et&&"function"===typeof Et.onCommitFiberRoot)try{Et.onCommitFiberRoot(Tt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),Zo(e,Kt()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)n(t[i]);if(uo)throw uo=!1,e=co,co=null,e;0!==(1&Ao)&&0!==e.tag&&To(),0!==(1&(a=e.pendingLanes))?e===mo?po++:(po=0,mo=e):po=0,Ot()}(e,t,n)}finally{Da.transition=i,kt=n}return null}function To(){if(null!==ho){var e=Xt(Ao),t=Da.transition,n=kt;try{if(Da.transition=null,kt=16>e?16:e,null===ho)var i=!1;else{if(e=ho,ho=null,Ao=0,0!==(6&Ua))throw Error(o(331));var r=Ua;for(Ua|=4,la=e.current;null!==la;){var a=la,s=a.child;if(0!==(16&la.flags)){var g=a.deletions;if(null!==g){for(var l=0;l<g.length;l++){var u=g[l];for(la=u;null!==la;){var c=la;switch(c.tag){case 0:case 11:case 15:Ca(8,c,a)}var I=c.child;if(null!==I)I.return=c,la=I;else for(;null!==la;){var C=(c=la).sibling,d=c.return;if(ma(c),c===u){la=null;break}if(null!==C){C.return=d,la=C;break}la=d}}}var h=a.alternate;if(null!==h){var A=h.child;if(null!==A){h.child=null;do{var p=A.sibling;A.sibling=null,A=p}while(null!==A)}}la=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,la=s;else e:for(;null!==la;){if(0!==(2048&(a=la).flags))switch(a.tag){case 0:case 11:case 15:Ca(9,a,a.return)}var m=a.sibling;if(null!==m){m.return=a.return,la=m;break e}la=a.return}}var f=e.current;for(la=f;null!==la;){var v=(s=la).child;if(0!==(2064&s.subtreeFlags)&&null!==v)v.return=s,la=v;else e:for(s=f;null!==la;){if(0!==(2048&(g=la).flags))try{switch(g.tag){case 0:case 11:case 15:da(9,g)}}catch(y){Jo(g,g.return,y)}if(g===s){la=null;break e}var b=g.sibling;if(null!==b){b.return=g.return,la=b;break e}la=g.return}}if(Ua=r,Ot(),Et&&"function"===typeof Et.onPostCommitFiberRoot)try{Et.onPostCommitFiberRoot(Tt,e)}catch(y){}i=!0}return i}finally{kt=n,Da.transition=t}}return!1}function Eo(e,t,n){pn(e,t=Br(0,t=pr(n,t),1)),t=bo(),null!==(e=Bo(e,1))&&(Rt(e,1,t),Zo(e,t))}function Jo(e,t,n){if(3===e.tag)Eo(e,e,n);else for(;null!==t;){if(3===t.tag){Eo(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===Io||!Io.has(i))){pn(t,e=Zr(t,e=pr(n,e),1)),e=bo(),null!==(t=Bo(t,1))&&(Rt(t,1,e),Zo(t,e));break}}t=t.return}}function Do(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=bo(),e.pingedLanes|=e.suspendedLanes&n,Pa===e&&(Oa&n)===n&&(4===$a||3===$a&&(130023424&Oa)===Oa&&500>Kt()-oo?Xo(e,0):io|=n),Zo(e,t)}function Uo(e,t){0===t&&(0===(1&e.mode)?t=1:(t=Bt,0===(130023424&(Bt<<=1))&&(Bt=4194304)));var n=bo();null!==(e=Bo(e,t))&&(Rt(e,t,n),Zo(e,n))}function Po(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Uo(e,n)}function Qo(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(o(314))}null!==i&&i.delete(t),Uo(e,n)}function Oo(e,t){return Yt(e,t)}function jo(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qo(e,t,n,i){return new jo(e,t,n,i)}function $o(e){return!(!(e=e.prototype)||!e.isReactComponent)}function es(e,t){var n=e.alternate;return null===n?((n=qo(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ts(e,t,n,i,r,a){var s=2;if(i=e,"function"===typeof e)$o(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case u:return ns(n.children,r,a,t);case c:s=8,r|=8;break;case I:return(e=qo(12,n,t,2|r)).elementType=I,e.lanes=a,e;case A:return(e=qo(13,n,t,r)).elementType=A,e.lanes=a,e;case p:return(e=qo(19,n,t,r)).elementType=p,e.lanes=a,e;case v:return is(n,r,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:s=10;break e;case d:s=9;break e;case h:s=11;break e;case m:s=14;break e;case f:s=16,i=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=qo(s,n,t,r)).elementType=e,t.type=i,t.lanes=a,t}function ns(e,t,n,i){return(e=qo(7,e,i,t)).lanes=n,e}function is(e,t,n,i){return(e=qo(22,e,i,t)).elementType=v,e.lanes=n,e.stateNode={},e}function rs(e,t,n){return(e=qo(6,e,null,t)).lanes=n,e}function as(e,t,n){return(t=qo(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function os(e,t,n,i,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=D,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=xt(0),this.expirationTimes=xt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xt(0),this.identifierPrefix=i,this.onRecoverableError=r,O&&(this.mutableSourceEagerHydrationData=null)}function ss(e,t,n,i,r,a,o,s,g){return e=new os(e,t,n,s,g),1===t?(t=1,!0===a&&(t|=8)):t=0,a=qo(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null},dn(a),e}function gs(e){if(!e)return lt;e:{if(Z(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(dt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(dt(n))return pt(e,n,t)}return t}function ls(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return null===(e=W(t))?null:e.stateNode}function us(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function cs(e,t){us(e,t),(e=e.alternate)&&us(e,t)}function Is(e){return null===(e=W(e))?null:e.stateNode}function Cs(){return null}return lo=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ct.current)Fr=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Fr=!1,function(e,t,n){switch(t.tag){case 3:Dr(t),$n();break;case 5:di(t);break;case 1:dt(t.type)&&mt(t);break;case 4:Ii(t,t.stateNode.containerInfo);break;case 10:sn(0,t.type._context,t.memoizedProps.value);break;case 13:var i=t.memoizedState;if(null!==i)return null!==i.dehydrated?(gt(Ai,1&Ai.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Or(e,t,n):(gt(Ai,1&Ai.current),null!==(e=ra(e,t,n))?e.sibling:null);gt(Ai,1&Ai.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return ia(e,t,n);t.flags|=128}var r=t.memoizedState;if(null!==r&&(r.rendering=null,r.tail=null,r.lastEffect=null),gt(Ai,Ai.current),i)break;return null;case 22:case 23:return t.lanes=0,Lr(e,t,n)}return ra(e,t,n)}(e,t,n);Fr=0!==(131072&e.flags)}else Fr=!1,En&&0!==(1048576&t.flags)&&Nn(t,kn,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var r=Ct(t,ut.current);un(t,n),r=ki(null,t,i,e,r,n);var a=Xi();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,dt(i)?(a=!0,mt(t)):a=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,dn(t),r.updater=Bn,t.stateNode=r,r._reactInternals=t,Wn(t,i,e,n),t=Jr(null,t,i,!0,a,n)):(t.tag=0,En&&a&&zn(t),Mr(null,t,r,n),t=t.child),t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(r=i._init)(i._payload),t.type=i,r=t.tag=function(e){if("function"===typeof e)return $o(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===h)return 11;if(e===m)return 14}return 2}(i),e=en(i,e),r){case 0:t=Tr(null,t,i,e,n);break e;case 1:t=Er(null,t,i,e,n);break e;case 11:t=Kr(null,t,i,e,n);break e;case 14:t=Nr(null,t,i,en(i.type,e),n);break e}throw Error(o(306,i,""))}return t;case 0:return i=t.type,r=t.pendingProps,Tr(e,t,i,r=t.elementType===i?r:en(i,r),n);case 1:return i=t.type,r=t.pendingProps,Er(e,t,i,r=t.elementType===i?r:en(i,r),n);case 3:e:{if(Dr(t),null===e)throw Error(o(387));i=t.pendingProps,r=(a=t.memoizedState).element,hn(e,t),vn(t,i,null,n);var s=t.memoizedState;if(i=s.element,O&&a.isDehydrated){if(a={element:i,isDehydrated:!1,cache:s.cache,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ur(e,t,i,n,r=Error(o(423)));break e}if(i!==r){t=Ur(e,t,i,n,r=Error(o(424)));break e}for(O&&(Tn=Le(t.stateNode.containerInfo),_n=t,En=!0,Dn=null,Jn=!1),n=oi(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if($n(),i===r){t=ra(e,t,n);break e}Mr(e,t,i,n)}t=t.child}return t;case 5:return di(t),null===e&&On(t),i=t.type,r=t.pendingProps,a=null!==e?e.memoizedProps:null,s=r.children,_(i,r)?s=null:null!==a&&_(i,a)&&(t.flags|=32),_r(e,t),Mr(e,t,s,n),t.child;case 6:return null===e&&On(t),null;case 13:return Or(e,t,n);case 4:return Ii(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=ai(t,null,i,n):Mr(e,t,i,n),t.child;case 11:return i=t.type,r=t.pendingProps,Kr(e,t,i,r=t.elementType===i?r:en(i,r),n);case 7:return Mr(e,t,t.pendingProps,n),t.child;case 8:case 12:return Mr(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,r=t.pendingProps,a=t.memoizedProps,sn(0,i,s=r.value),null!==a)if(Jt(a.value,s)){if(a.children===r.children&&!ct.current){t=ra(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var g=a.dependencies;if(null!==g){s=a.child;for(var l=g.firstContext;null!==l;){if(l.context===i){if(1===a.tag){(l=An(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var c=(u=u.shared).pending;null===c?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),ln(a.return,n,t),g.lanes|=n;break}l=l.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=n,null!==(g=s.alternate)&&(g.lanes|=n),ln(s,n,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}Mr(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,i=t.pendingProps.children,un(t,n),i=i(r=cn(r)),t.flags|=1,Mr(e,t,i,n),t.child;case 14:return r=en(i=t.type,t.pendingProps),Nr(e,t,i,r=en(i.type,r),n);case 15:return zr(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,r=t.pendingProps,r=t.elementType===i?r:en(i,r),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,dt(i)?(e=!0,mt(t)):e=!1,un(t,n),wn(t,i,r),Wn(t,i,r,n),Jr(null,t,i,!0,e,n);case 19:return ia(e,t,n);case 22:return Lr(e,t,n)}throw Error(o(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(Go(e,134217728,bo()),cs(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=bo(),n=yo(e);Go(e,n,t),cs(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Zt(t.pendingLanes);0!==n&&(Vt(t,1|n),Zo(t,Kt()),0===(6&Ua)&&(go(),Ot()))}break;case 13:var i=bo();Vo((function(){return Go(e,1,i)})),cs(e,1)}},t.batchedUpdates=function(e,t){var n=Ua;Ua|=1;try{return e(t)}finally{0===(Ua=n)&&(go(),Ut&&Ot())}},t.createComponentSelector=function(e){return{$$typeof:ka,value:e}},t.createContainer=function(e,t,n,i,r,a,o){return ss(e,t,!1,null,0,i,0,a,o)},t.createHasPseudoClassSelector=function(e){return{$$typeof:Xa,value:e}},t.createHydrationContainer=function(e,t,n,i,r,a,o,s,g){return(e=ss(n,i,!0,e,0,a,0,s,g)).context=gs(null),n=e.current,(a=An(i=bo(),r=yo(n))).callback=void 0!==t&&null!==t?t:null,pn(n,a),e.current.lanes=r,Rt(e,r,i),Zo(e,i),e},t.createPortal=function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:l,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Ya,value:e}},t.createTestNameSelector=function(e){return{$$typeof:Ha,value:e}},t.createTextSelector=function(e){return{$$typeof:Fa,value:e}},t.deferredUpdates=function(e){var t=kt,n=Da.transition;try{return Da.transition=null,kt=16,e()}finally{kt=t,Da.transition=n}},t.discreteUpdates=function(e,t,n,i,r){var a=kt,o=Da.transition;try{return Da.transition=null,kt=1,e(t,n,i,r)}finally{kt=a,Da.transition=o,0===Ua&&go()}},t.findAllNodes=_a,t.findBoundingRects=function(e,t){if(!ie)throw Error(o(363));t=_a(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ae(t[n]));for(t=e.length-1;0<t;t--)for(var i=(n=e[t]).x,r=i+n.width,a=n.y,s=a+n.height,g=t-1;0<=g;g--)if(t!==g){var l=e[g],u=l.x,c=u+l.width,I=l.y,C=I+l.height;if(i>=u&&a>=I&&r<=c&&s<=C){e.splice(t,1);break}if(!(i!==u||n.width!==l.width||C<a||I>s)){I>a&&(l.height+=I-a,l.y=a),C<s&&(l.height=s-I),e.splice(t,1);break}if(!(a!==I||n.height!==l.height||c<i||u>r)){u>i&&(l.width+=u-i,l.x=i),c<r&&(l.width=r-u),e.splice(t,1);break}}return e},t.findHostInstance=ls,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=S(e))?R(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return ls(e)},t.flushControlled=function(e){var t=Ua;Ua|=1;var n=Da.transition,i=kt;try{Da.transition=null,kt=1,e()}finally{kt=i,Da.transition=n,0===(Ua=t)&&(go(),Ot())}},t.flushPassiveEffects=To,t.flushSync=Vo,t.focusWithin=function(e,t){if(!ie)throw Error(o(363));for(t=La(e=Ka(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!se(n)){if(5===n.tag&&le(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return kt},t.getFindAllNodesFailureDescription=function(e,t){if(!ie)throw Error(o(363));var n=0,i=[];e=[Ka(e),0];for(var r=0;r<e.length;){var a=e[r++],s=e[r++],g=t[s];if((5!==a.tag||!se(a))&&(Na(a,g)&&(i.push(za(g)),++s>n&&(n=s)),s<t.length))for(a=a.child;null!==a;)e.push(a,s),a=a.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(za(t[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?X(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:Is,findFiberByHostInstance:e.findFiberByHostInstance||Cs,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Tt=t.inject(e),Et=t}catch(n){}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,i){if(!ie)throw Error(o(363));e=_a(e,t);var r=ue(e,n,i).disconnect;return{disconnect:function(){r()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=kt;try{return kt=e,t()}finally{kt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,i){var r=t.current,a=bo(),o=yo(r);return n=gs(n),null===t.context?t.context=n:t.pendingContext=n,(t=An(a,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),pn(r,t),null!==(e=Go(r,o,a))&&mn(e,r,o),o},t}},4585:function(e,t,n){"use strict";e.exports=n(4976)},258:function(e,t,n){"use strict";e.exports=n(3721)},5783:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,g=e[s],l=s+1,u=e[l];if(0>a(g,n))l<r&&0>a(u,g)?(e[i]=u,e[l]=n,i=l):(e[i]=g,e[s]=n,i=s);else{if(!(l<r&&0>a(u,n)))break e;e[i]=u,e[l]=n,i=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,g=s.now();t.unstable_now=function(){return s.now()-g}}var l=[],u=[],c=1,I=null,C=3,d=!1,h=!1,A=!1,p="function"===typeof setTimeout?setTimeout:null,m="function"===typeof clearTimeout?clearTimeout:null,f="undefined"!==typeof setImmediate?setImmediate:null;function v(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(l,t)}t=i(u)}}function b(e){if(A=!1,v(e),!h)if(null!==i(l))h=!0,X(y);else{var t=i(u);null!==t&&Y(b,t.startTime-e)}}function y(e,n){h=!1,A&&(A=!1,m(w),w=-1),d=!0;var a=C;try{for(v(n),I=i(l);null!==I&&(!(I.expirationTime>n)||e&&!x());){var o=I.callback;if("function"===typeof o){I.callback=null,C=I.priorityLevel;var s=o(I.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?I.callback=s:I===i(l)&&r(l),v(n)}else r(l);I=i(l)}if(null!==I)var g=!0;else{var c=i(u);null!==c&&Y(b,c.startTime-n),g=!1}return g}finally{I=null,C=a,d=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var G,B=!1,Z=null,w=-1,S=5,W=-1;function x(){return!(t.unstable_now()-W<S)}function R(){if(null!==Z){var e=t.unstable_now();W=e;var n=!0;try{n=Z(!0,e)}finally{n?G():(B=!1,Z=null)}}else B=!1}if("function"===typeof f)G=function(){f(R)};else if("undefined"!==typeof MessageChannel){var V=new MessageChannel,k=V.port2;V.port1.onmessage=R,G=function(){k.postMessage(null)}}else G=function(){p(R,0)};function X(e){Z=e,B||(B=!0,G())}function Y(e,n){w=p((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){h||d||(h=!0,X(y))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return C},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(C){case 1:case 2:case 3:var t=3;break;default:t=C}var n=C;C=t;try{return e()}finally{C=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=C;C=e;try{return t()}finally{C=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:c++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(u,e),null===i(l)&&e===i(u)&&(A?(m(w),w=-1):A=!0,Y(b,a-o))):(e.sortIndex=s,n(l,e),h||d||(h=!0,X(y))),e},t.unstable_shouldYield=x,t.unstable_wrapCallback=function(e){var t=C;return function(){var n=C;C=t;try{return e.apply(this,arguments)}finally{C=n}}}},3100:function(e,t,n){"use strict";e.exports=n(5783)},6374:function(e,t,n){"use strict";var i=n(2791),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,g={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,a={},l=null,u=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!g.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===a[i]&&(a[i]=t[i]);return{$$typeof:r,type:e,key:l,ref:u,props:a,_owner:s.current}}t.Fragment=a,t.jsx=l,t.jsxs=l},9117:function(e,t){"use strict";var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),g=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),C=Symbol.iterator;var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,A={};function p(e,t,n){this.props=e,this.context=t,this.refs=A,this.updater=n||d}function m(){}function f(e,t,n){this.props=e,this.context=t,this.refs=A,this.updater=n||d}p.prototype.isReactComponent={},p.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},p.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=p.prototype;var v=f.prototype=new m;v.constructor=f,h(v,p.prototype),v.isPureReactComponent=!0;var b=Array.isArray,y=Object.prototype.hasOwnProperty,G={current:null},B={key:!0,ref:!0,__self:!0,__source:!0};function Z(e,t,i){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)y.call(t,r)&&!B.hasOwnProperty(r)&&(a[r]=t[r]);var g=arguments.length-2;if(1===g)a.children=i;else if(1<g){for(var l=Array(g),u=0;u<g;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(r in g=e.defaultProps)void 0===a[r]&&(a[r]=g[r]);return{$$typeof:n,type:e,key:o,ref:s,props:a,_owner:G.current}}function w(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var S=/\/+/g;function W(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function x(e,t,r,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var g=!1;if(null===e)g=!0;else switch(s){case"string":case"number":g=!0;break;case"object":switch(e.$$typeof){case n:case i:g=!0}}if(g)return o=o(g=e),e=""===a?"."+W(g,0):a,b(o)?(r="",null!=e&&(r=e.replace(S,"$&/")+"/"),x(o,t,r,"",(function(e){return e}))):null!=o&&(w(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,r+(!o.key||g&&g.key===o.key?"":(""+o.key).replace(S,"$&/")+"/")+e)),t.push(o)),1;if(g=0,a=""===a?".":a+":",b(e))for(var l=0;l<e.length;l++){var u=a+W(s=e[l],l);g+=x(s,t,r,u,o)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=C&&e[C]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),l=0;!(s=e.next()).done;)g+=x(s=s.value,t,r,u=a+W(s,l++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return g}function R(e,t,n){if(null==e)return e;var i=[],r=0;return x(e,i,"","",(function(e){return t.call(n,e,r++)})),i}function V(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var k={current:null},X={transition:null},Y={ReactCurrentDispatcher:k,ReactCurrentBatchConfig:X,ReactCurrentOwner:G};t.Children={map:R,forEach:function(e,t,n){R(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return R(e,(function(){t++})),t},toArray:function(e){return R(e,(function(e){return e}))||[]},only:function(e){if(!w(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=p,t.Fragment=r,t.Profiler=o,t.PureComponent=f,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Y,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=h({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=G.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var g=e.type.defaultProps;for(l in t)y.call(t,l)&&!B.hasOwnProperty(l)&&(r[l]=void 0===t[l]&&void 0!==g?g[l]:t[l])}var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){g=Array(l);for(var u=0;u<l;u++)g[u]=arguments[u+2];r.children=g}return{$$typeof:n,type:e.type,key:a,ref:o,props:r,_owner:s}},t.createContext=function(e){return(e={$$typeof:g,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=Z,t.createFactory=function(e){var t=Z.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=w,t.lazy=function(e){return{$$typeof:I,_payload:{_status:-1,_result:e},_init:V}},t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=X.transition;X.transition={};try{e()}finally{X.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return k.current.useCallback(e,t)},t.useContext=function(e){return k.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return k.current.useDeferredValue(e)},t.useEffect=function(e,t){return k.current.useEffect(e,t)},t.useId=function(){return k.current.useId()},t.useImperativeHandle=function(e,t,n){return k.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return k.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return k.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return k.current.useMemo(e,t)},t.useReducer=function(e,t,n){return k.current.useReducer(e,t,n)},t.useRef=function(e){return k.current.useRef(e)},t.useState=function(e){return k.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return k.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return k.current.useTransition()},t.version="18.2.0"},2791:function(e,t,n){"use strict";e.exports=n(9117)},184:function(e,t,n){"use strict";e.exports=n(6374)},6813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,r=e[i];if(!(0<a(r,t)))break e;e[i]=t,e[n]=r,n=i}}function i(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,r=e.length,o=r>>>1;i<o;){var s=2*(i+1)-1,g=e[s],l=s+1,u=e[l];if(0>a(g,n))l<r&&0>a(u,g)?(e[i]=u,e[l]=n,i=l):(e[i]=g,e[s]=n,i=s);else{if(!(l<r&&0>a(u,n)))break e;e[i]=u,e[l]=n,i=l}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,g=s.now();t.unstable_now=function(){return s.now()-g}}var l=[],u=[],c=1,I=null,C=3,d=!1,h=!1,A=!1,p="function"===typeof setTimeout?setTimeout:null,m="function"===typeof clearTimeout?clearTimeout:null,f="undefined"!==typeof setImmediate?setImmediate:null;function v(e){for(var t=i(u);null!==t;){if(null===t.callback)r(u);else{if(!(t.startTime<=e))break;r(u),t.sortIndex=t.expirationTime,n(l,t)}t=i(u)}}function b(e){if(A=!1,v(e),!h)if(null!==i(l))h=!0,X(y);else{var t=i(u);null!==t&&Y(b,t.startTime-e)}}function y(e,n){h=!1,A&&(A=!1,m(w),w=-1),d=!0;var a=C;try{for(v(n),I=i(l);null!==I&&(!(I.expirationTime>n)||e&&!x());){var o=I.callback;if("function"===typeof o){I.callback=null,C=I.priorityLevel;var s=o(I.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?I.callback=s:I===i(l)&&r(l),v(n)}else r(l);I=i(l)}if(null!==I)var g=!0;else{var c=i(u);null!==c&&Y(b,c.startTime-n),g=!1}return g}finally{I=null,C=a,d=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var G,B=!1,Z=null,w=-1,S=5,W=-1;function x(){return!(t.unstable_now()-W<S)}function R(){if(null!==Z){var e=t.unstable_now();W=e;var n=!0;try{n=Z(!0,e)}finally{n?G():(B=!1,Z=null)}}else B=!1}if("function"===typeof f)G=function(){f(R)};else if("undefined"!==typeof MessageChannel){var V=new MessageChannel,k=V.port2;V.port1.onmessage=R,G=function(){k.postMessage(null)}}else G=function(){p(R,0)};function X(e){Z=e,B||(B=!0,G())}function Y(e,n){w=p((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){h||d||(h=!0,X(y))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return C},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(e){switch(C){case 1:case 2:case 3:var t=3;break;default:t=C}var n=C;C=t;try{return e()}finally{C=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=C;C=e;try{return t()}finally{C=n}},t.unstable_scheduleCallback=function(e,r,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:c++,callback:r,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,n(u,e),null===i(l)&&e===i(u)&&(A?(m(w),w=-1):A=!0,Y(b,a-o))):(e.sortIndex=s,n(l,e),h||d||(h=!0,X(y))),e},t.unstable_shouldYield=x,t.unstable_wrapCallback=function(e){var t=C;return function(){var n=C;C=t;try{return e.apply(this,arguments)}finally{C=n}}}},5296:function(e,t,n){"use strict";e.exports=n(6813)},6514:function(e){function t(e,t){var n=e.length,i=new Array(n),r={},a=n,o=function(e){for(var t=new Map,n=0,i=e.length;n<i;n++){var r=e[n];t.has(r[0])||t.set(r[0],new Set),t.has(r[1])||t.set(r[1],new Set),t.get(r[0]).add(r[1])}return t}(t),s=function(e){for(var t=new Map,n=0,i=e.length;n<i;n++)t.set(e[n],n);return t}(e);for(t.forEach((function(e){if(!s.has(e[0])||!s.has(e[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")}));a--;)r[a]||g(e[a],a,new Set);return i;function g(e,t,a){if(a.has(e)){var l;try{l=", node was:"+JSON.stringify(e)}catch(I){l=""}throw new Error("Cyclic dependency"+l)}if(!s.has(e))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(e));if(!r[t]){r[t]=!0;var u=o.get(e)||new Set;if(t=(u=Array.from(u)).length){a.add(e);do{var c=u[--t];g(c,s.get(c),a)}while(t);a.delete(e)}i[--n]=e}}}e.exports=function(e){return t(function(e){for(var t=new Set,n=0,i=e.length;n<i;n++){var r=e[n];t.add(r[0]),t.add(r[1])}return Array.from(t)}(e),e)},e.exports.array=t}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={id:i,loaded:!1,exports:{}};return e[i](a,a.exports,n),a.loaded=!0,a.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var a=Object.create(null);n.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&r&&i;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){o[e]=function(){return i[e]}}));return o.default=function(){return i},n.d(a,o),a}}(),n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,i){return n.f[i](e,t),t}),[]))},n.u=function(e){return"static/js/"+e+".fa3c4679.chunk.js"},n.miniCssF=function(e){},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={},t="react-template:";n.l=function(i,r,a,o){if(e[i])e[i].push(r);else{var s,g;if(void 0!==a)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var c=l[u];if(c.getAttribute("src")==i||c.getAttribute("data-webpack")==t+a){s=c;break}}s||(g=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",t+a),s.src=i),e[i]=[r];var I=function(t,n){s.onerror=s.onload=null,clearTimeout(C);var r=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((function(e){return e(n)})),t)return t(n)},C=setTimeout(I.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=I.bind(null,s.onerror),s.onload=I.bind(null,s.onload),g&&document.head.appendChild(s)}}}(),n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="/",function(){var e={179:0};n.f.j=function(t,i){var r=n.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var a=new Promise((function(n,i){r=e[t]=[n,i]}));i.push(r[2]=a);var o=n.p+n.u(t),s=new Error;n.l(o,(function(i){if(n.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=i&&("load"===i.type?"missing":i.type),o=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,r[1](s)}}),"chunk-"+t,t)}};var t=function(t,i){var r,a,o=i[0],s=i[1],g=i[2],l=0;if(o.some((function(t){return 0!==e[t]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(g)g(n)}for(t&&t(i);l<o.length;l++)a=o[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0},i=self.webpackChunkreact_template=self.webpackChunkreact_template||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}(),function(){"use strict";var e={};n.r(e),n.d(e,{ACESFilmicToneMapping:function(){return Hy},AddEquation:function(){return ry},AddOperation:function(){return Ry},AdditiveAnimationBlendMode:function(){return sB},AdditiveBlending:function(){return ey},AlphaFormat:function(){return CG},AlwaysDepth:function(){return by},AlwaysStencilFunc:function(){return HB},AmbientLight:function(){return fY},AmbientLightProbe:function(){return HY},AnimationClip:function(){return TX},AnimationLoader:function(){return qX},AnimationMixer:function(){return IH},AnimationObjectGroup:function(){return lH},AnimationUtils:function(){return RX},ArcCurve:function(){return qV},ArrayCamera:function(){return RR},ArrowHelper:function(){return tF},Audio:function(){return UY},AudioAnalyser:function(){return $Y},AudioContext:function(){return kY},AudioListener:function(){return DY},AudioLoader:function(){return XY},AxesHelper:function(){return nF},BackSide:function(){return Pb},BasicDepthPacking:function(){return CB},BasicShadowMap:function(){return Tb},Bone:function(){return pV},BooleanKeyframeTrack:function(){return FX},Box2:function(){return yH},Box3:function(){return LZ},Box3Helper:function(){return qH},BoxBufferGeometry:function(){return LS},BoxGeometry:function(){return LS},BoxHelper:function(){return jH},BufferAttribute:function(){return iS},BufferGeometry:function(){return bS},BufferGeometryLoader:function(){return wY},ByteType:function(){return iG},Cache:function(){return DX},Camera:function(){return DS},CameraHelper:function(){return DH},CanvasTexture:function(){return QV},CapsuleBufferGeometry:function(){return fk},CapsuleGeometry:function(){return fk},CatmullRomCurve3:function(){return rk},CineonToneMapping:function(){return Yy},CircleBufferGeometry:function(){return vk},CircleGeometry:function(){return vk},ClampToEdgeWrapping:function(){return Ey},Clock:function(){return zY},Color:function(){return BZ},ColorKeyframeTrack:function(){return MX},ColorManagement:function(){return AZ},CompressedTexture:function(){return PV},CompressedTextureLoader:function(){return $X},ConeBufferGeometry:function(){return yk},ConeGeometry:function(){return yk},CubeCamera:function(){return QS},CubeReflectionMapping:function(){return Ky},CubeRefractionMapping:function(){return Ny},CubeTexture:function(){return OS},CubeTextureLoader:function(){return tY},CubeUVReflectionMapping:function(){return _y},CubicBezierCurve:function(){return gk},CubicBezierCurve3:function(){return lk},CubicInterpolant:function(){return kX},CullFaceBack:function(){return zb},CullFaceFront:function(){return Lb},CullFaceFrontBack:function(){return _b},CullFaceNone:function(){return Nb},Curve:function(){return OV},CurvePath:function(){return Ak},CustomBlending:function(){return iy},CustomToneMapping:function(){return Fy},CylinderBufferGeometry:function(){return bk},CylinderGeometry:function(){return bk},Cylindrical:function(){return vH},Data3DTexture:function(){return YZ},DataArrayTexture:function(){return kZ},DataTexture:function(){return mV},DataTexture2DArray:function(){return vF},DataTexture3D:function(){return bF},DataTextureLoader:function(){return nY},DataUtils:function(){return CF},DecrementStencilOp:function(){return BB},DecrementWrapStencilOp:function(){return wB},DefaultLoadingManager:function(){return PX},DepthFormat:function(){return mG},DepthStencilFormat:function(){return fG},DepthTexture:function(){return YR},DirectionalLight:function(){return mY},DirectionalLightHelper:function(){return TH},DiscreteInterpolant:function(){return YX},DodecahedronBufferGeometry:function(){return Bk},DodecahedronGeometry:function(){return Bk},DoubleSide:function(){return Qb},DstAlphaFactor:function(){return hy},DstColorFactor:function(){return py},DynamicCopyUsage:function(){return TB},DynamicDrawUsage:function(){return MB},DynamicReadUsage:function(){return zB},EdgesGeometry:function(){return xk},EllipseCurve:function(){return jV},EqualDepth:function(){return By},EqualStencilFunc:function(){return RB},EquirectangularReflectionMapping:function(){return zy},EquirectangularRefractionMapping:function(){return Ly},Euler:function(){return Zw},EventDispatcher:function(){return PB},ExtrudeBufferGeometry:function(){return oX},ExtrudeGeometry:function(){return oX},FileLoader:function(){return jX},FlatShading:function(){return Ob},Float16BufferAttribute:function(){return cS},Float32BufferAttribute:function(){return IS},Float64BufferAttribute:function(){return CS},FloatType:function(){return gG},Fog:function(){return _R},FogExp2:function(){return LR},Font:function(){return pF},FontLoader:function(){return AF},FramebufferTexture:function(){return UV},FrontSide:function(){return Ub},Frustum:function(){return rW},GLBufferAttribute:function(){return hH},GLSL1:function(){return JB},GLSL3:function(){return DB},GreaterDepth:function(){return wy},GreaterEqualDepth:function(){return Zy},GreaterEqualStencilFunc:function(){return YB},GreaterStencilFunc:function(){return kB},GridHelper:function(){return KH},Group:function(){return VR},HalfFloatType:function(){return lG},HemisphereLight:function(){return aY},HemisphereLightHelper:function(){return MH},HemisphereLightProbe:function(){return YY},IcosahedronBufferGeometry:function(){return gX},IcosahedronGeometry:function(){return gX},ImageBitmapLoader:function(){return VY},ImageLoader:function(){return eY},ImageUtils:function(){return ZZ},ImmediateRenderObject:function(){return mF},IncrementStencilOp:function(){return GB},IncrementWrapStencilOp:function(){return ZB},InstancedBufferAttribute:function(){return yV},InstancedBufferGeometry:function(){return ZY},InstancedInterleavedBuffer:function(){return dH},InstancedMesh:function(){return SV},Int16BufferAttribute:function(){return sS},Int32BufferAttribute:function(){return lS},Int8BufferAttribute:function(){return rS},IntType:function(){return oG},InterleavedBuffer:function(){return ER},InterleavedBufferAttribute:function(){return DR},Interpolant:function(){return VX},InterpolateDiscrete:function(){return eB},InterpolateLinear:function(){return tB},InterpolateSmooth:function(){return nB},InvertStencilOp:function(){return SB},KeepStencilOp:function(){return bB},KeyframeTrack:function(){return HX},LOD:function(){return uV},LatheBufferGeometry:function(){return mk},LatheGeometry:function(){return mk},Layers:function(){return ww},LessDepth:function(){return yy},LessEqualDepth:function(){return Gy},LessEqualStencilFunc:function(){return VB},LessStencilFunc:function(){return xB},Light:function(){return rY},LightProbe:function(){return yY},Line:function(){return YV},Line3:function(){return ZH},LineBasicMaterial:function(){return WV},LineCurve:function(){return uk},LineCurve3:function(){return ck},LineDashedMaterial:function(){return xX},LineLoop:function(){return KV},LineSegments:function(){return MV},LinearEncoding:function(){return cB},LinearFilter:function(){return jy},LinearInterpolant:function(){return XX},LinearMipMapLinearFilter:function(){return tG},LinearMipMapNearestFilter:function(){return $y},LinearMipmapLinearFilter:function(){return eG},LinearMipmapNearestFilter:function(){return qy},LinearSRGBColorSpace:function(){return fB},LinearToneMapping:function(){return ky},Loader:function(){return QX},LoaderUtils:function(){return BY},LoadingManager:function(){return UX},LoopOnce:function(){return jG},LoopPingPong:function(){return $G},LoopRepeat:function(){return qG},LuminanceAlphaFormat:function(){return pG},LuminanceFormat:function(){return AG},MOUSE:function(){return Mb},Material:function(){return $w},MaterialLoader:function(){return GY},MathUtils:function(){return oZ},Matrix3:function(){return gZ},Matrix4:function(){return hw},MaxEquation:function(){return gy},Mesh:function(){return NS},MeshBasicMaterial:function(){return eS},MeshDepthMaterial:function(){return BR},MeshDistanceMaterial:function(){return ZR},MeshLambertMaterial:function(){return SX},MeshMatcapMaterial:function(){return WX},MeshNormalMaterial:function(){return wX},MeshPhongMaterial:function(){return BX},MeshPhysicalMaterial:function(){return GX},MeshStandardMaterial:function(){return yX},MeshToonMaterial:function(){return ZX},MinEquation:function(){return sy},MirroredRepeatWrapping:function(){return Jy},MixOperation:function(){return xy},MultiplyBlending:function(){return ny},MultiplyOperation:function(){return Wy},NearestFilter:function(){return Dy},NearestMipMapLinearFilter:function(){return Oy},NearestMipMapNearestFilter:function(){return Py},NearestMipmapLinearFilter:function(){return Qy},NearestMipmapNearestFilter:function(){return Uy},NeverDepth:function(){return vy},NeverStencilFunc:function(){return WB},NoBlending:function(){return qb},NoColorSpace:function(){return pB},NoToneMapping:function(){return Vy},NormalAnimationBlendMode:function(){return oB},NormalBlending:function(){return $b},NotEqualDepth:function(){return Sy},NotEqualStencilFunc:function(){return XB},NumberKeyframeTrack:function(){return KX},Object3D:function(){return zw},ObjectLoader:function(){return SY},ObjectSpaceNormalMap:function(){return AB},OctahedronBufferGeometry:function(){return lX},OctahedronGeometry:function(){return lX},OneFactor:function(){return uy},OneMinusDstAlphaFactor:function(){return Ay},OneMinusDstColorFactor:function(){return my},OneMinusSrcAlphaFactor:function(){return dy},OneMinusSrcColorFactor:function(){return Iy},OrthographicCamera:function(){return pW},PCFShadowMap:function(){return Eb},PCFSoftShadowMap:function(){return Jb},PMREMGenerator:function(){return wW},ParametricGeometry:function(){return dF},Path:function(){return pk},PerspectiveCamera:function(){return US},Plane:function(){return tW},PlaneBufferGeometry:function(){return sW},PlaneGeometry:function(){return sW},PlaneHelper:function(){return $H},PointLight:function(){return AY},PointLightHelper:function(){return XH},Points:function(){return EV},PointsMaterial:function(){return NV},PolarGridHelper:function(){return NH},PolyhedronBufferGeometry:function(){return Gk},PolyhedronGeometry:function(){return Gk},PositionalAudio:function(){return qY},PropertyBinding:function(){return gH},PropertyMixer:function(){return eH},QuadraticBezierCurve:function(){return Ik},QuadraticBezierCurve3:function(){return Ck},Quaternion:function(){return MZ},QuaternionKeyframeTrack:function(){return zX},QuaternionLinearInterpolant:function(){return NX},REVISION:function(){return Fb},RGBADepthPacking:function(){return dB},RGBAFormat:function(){return hG},RGBAIntegerFormat:function(){return BG},RGBA_ASTC_10x10_Format:function(){return UG},RGBA_ASTC_10x5_Format:function(){return EG},RGBA_ASTC_10x6_Format:function(){return JG},RGBA_ASTC_10x8_Format:function(){return DG},RGBA_ASTC_12x10_Format:function(){return PG},RGBA_ASTC_12x12_Format:function(){return QG},RGBA_ASTC_4x4_Format:function(){return FG},RGBA_ASTC_5x4_Format:function(){return MG},RGBA_ASTC_5x5_Format:function(){return KG},RGBA_ASTC_6x5_Format:function(){return NG},RGBA_ASTC_6x6_Format:function(){return zG},RGBA_ASTC_8x5_Format:function(){return LG},RGBA_ASTC_8x6_Format:function(){return _G},RGBA_ASTC_8x8_Format:function(){return TG},RGBA_BPTC_Format:function(){return OG},RGBA_ETC2_EAC_Format:function(){return HG},RGBA_PVRTC_2BPPV1_Format:function(){return kG},RGBA_PVRTC_4BPPV1_Format:function(){return VG},RGBA_S3TC_DXT1_Format:function(){return wG},RGBA_S3TC_DXT3_Format:function(){return SG},RGBA_S3TC_DXT5_Format:function(){return WG},RGBFormat:function(){return dG},RGB_ETC1_Format:function(){return XG},RGB_ETC2_Format:function(){return YG},RGB_PVRTC_2BPPV1_Format:function(){return RG},RGB_PVRTC_4BPPV1_Format:function(){return xG},RGB_S3TC_DXT1_Format:function(){return ZG},RGFormat:function(){return yG},RGIntegerFormat:function(){return GG},RawShaderMaterial:function(){return bX},Ray:function(){return dw},Raycaster:function(){return AH},RectAreaLight:function(){return vY},RedFormat:function(){return vG},RedIntegerFormat:function(){return bG},ReinhardToneMapping:function(){return Xy},RepeatWrapping:function(){return Ty},ReplaceStencilOp:function(){return yB},ReverseSubtractEquation:function(){return oy},RingBufferGeometry:function(){return uX},RingGeometry:function(){return uX},SRGBColorSpace:function(){return mB},Scene:function(){return TR},ShaderChunk:function(){return gW},ShaderLib:function(){return uW},ShaderMaterial:function(){return JS},ShadowMaterial:function(){return vX},Shape:function(){return Rk},ShapeBufferGeometry:function(){return cX},ShapeGeometry:function(){return cX},ShapePath:function(){return iF},ShapeUtils:function(){return iX},ShortType:function(){return rG},Skeleton:function(){return bV},SkeletonHelper:function(){return VH},SkinnedMesh:function(){return AV},SmoothShading:function(){return jb},Source:function(){return wZ},Sphere:function(){return ow},SphereBufferGeometry:function(){return IX},SphereGeometry:function(){return IX},Spherical:function(){return fH},SphericalHarmonics3:function(){return bY},SplineCurve:function(){return dk},SpotLight:function(){return cY},SpotLightHelper:function(){return SH},Sprite:function(){return oV},SpriteMaterial:function(){return UR},SrcAlphaFactor:function(){return Cy},SrcAlphaSaturateFactor:function(){return fy},SrcColorFactor:function(){return cy},StaticCopyUsage:function(){return _B},StaticDrawUsage:function(){return FB},StaticReadUsage:function(){return NB},StereoCamera:function(){return NY},StreamCopyUsage:function(){return EB},StreamDrawUsage:function(){return KB},StreamReadUsage:function(){return LB},StringKeyframeTrack:function(){return LX},SubtractEquation:function(){return ay},SubtractiveBlending:function(){return ty},TOUCH:function(){return Kb},TangentSpaceNormalMap:function(){return hB},TetrahedronBufferGeometry:function(){return CX},TetrahedronGeometry:function(){return CX},TextGeometry:function(){return hF},Texture:function(){return xZ},TextureLoader:function(){return iY},TorusBufferGeometry:function(){return dX},TorusGeometry:function(){return dX},TorusKnotBufferGeometry:function(){return hX},TorusKnotGeometry:function(){return hX},Triangle:function(){return jw},TriangleFanDrawMode:function(){return uB},TriangleStripDrawMode:function(){return lB},TrianglesDrawMode:function(){return gB},TubeBufferGeometry:function(){return AX},TubeGeometry:function(){return AX},UVMapping:function(){return My},Uint16BufferAttribute:function(){return gS},Uint32BufferAttribute:function(){return uS},Uint8BufferAttribute:function(){return aS},Uint8ClampedBufferAttribute:function(){return oS},Uniform:function(){return CH},UniformsLib:function(){return lW},UniformsUtils:function(){return ES},UnsignedByteType:function(){return nG},UnsignedInt248Type:function(){return IG},UnsignedIntType:function(){return sG},UnsignedShort4444Type:function(){return uG},UnsignedShort5551Type:function(){return cG},UnsignedShortType:function(){return aG},VSMShadowMap:function(){return Db},Vector2:function(){return sZ},Vector3:function(){return KZ},Vector4:function(){return RZ},VectorKeyframeTrack:function(){return _X},VideoTexture:function(){return DV},WebGL1Renderer:function(){return NR},WebGL3DRenderTarget:function(){return HZ},WebGLArrayRenderTarget:function(){return XZ},WebGLCubeRenderTarget:function(){return jS},WebGLMultipleRenderTargets:function(){return FZ},WebGLMultisampleRenderTarget:function(){return fF},WebGLRenderTarget:function(){return VZ},WebGLRenderer:function(){return KR},WebGLUtils:function(){return xR},WireframeGeometry:function(){return pX},WrapAroundEnding:function(){return aB},ZeroCurvatureEnding:function(){return iB},ZeroFactor:function(){return ly},ZeroSlopeEnding:function(){return rB},ZeroStencilOp:function(){return vB},_SRGBAFormat:function(){return UB},sRGBEncoding:function(){return IB}});var t=n(2791),i=n.t(t,2),r=n(1250),a=n(77),o=n.n(a),s=function(e){return function(e){return!!e&&"object"===typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===g}(e)}(e)};var g="function"===typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function l(e,t){return!1!==t.clone&&t.isMergeableObject(e)?c((n=e,Array.isArray(n)?[]:{}),e,t):e;var n}function u(e,t,n){return e.concat(t).map((function(e){return l(e,n)}))}function c(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||u,n.isMergeableObject=n.isMergeableObject||s;var i=Array.isArray(t);return i===Array.isArray(e)?i?n.arrayMerge(e,t,n):function(e,t,n){var i={};return n.isMergeableObject(e)&&Object.keys(e).forEach((function(t){i[t]=l(e[t],n)})),Object.keys(t).forEach((function(r){n.isMergeableObject(t[r])&&e[r]?i[r]=c(e[r],t[r],n):i[r]=l(t[r],n)})),i}(e,t,n):l(t,n)}c.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return c(e,n,t)}),{})};var I=function(){this.__data__=[],this.size=0};var C=function(e,t){return e===t||e!==e&&t!==t};var d=function(e,t){for(var n=e.length;n--;)if(C(e[n][0],t))return n;return-1},h=Array.prototype.splice;var A=function(e){var t=this.__data__,n=d(t,e);return!(n<0)&&(n==t.length-1?t.pop():h.call(t,n,1),--this.size,!0)};var p=function(e){var t=this.__data__,n=d(t,e);return n<0?void 0:t[n][1]};var m=function(e){return d(this.__data__,e)>-1};var f=function(e,t){var n=this.__data__,i=d(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this};function v(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}v.prototype.clear=I,v.prototype.delete=A,v.prototype.get=p,v.prototype.has=m,v.prototype.set=f;var b=v;var y=function(){this.__data__=new b,this.size=0};var G=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};var B=function(e){return this.__data__.get(e)};var Z=function(e){return this.__data__.has(e)},w="object"==typeof global&&global&&global.Object===Object&&global,S="object"==typeof self&&self&&self.Object===Object&&self,W=w||S||Function("return this")(),x=W.Symbol,R=Object.prototype,V=R.hasOwnProperty,k=R.toString,X=x?x.toStringTag:void 0;var Y=function(e){var t=V.call(e,X),n=e[X];try{e[X]=void 0;var i=!0}catch(CL){}var r=k.call(e);return i&&(t?e[X]=n:delete e[X]),r},H=Object.prototype.toString;var F=function(e){return H.call(e)},M=x?x.toStringTag:void 0;var K=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":M&&M in Object(e)?Y(e):F(e)};var N=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var z=function(e){if(!N(e))return!1;var t=K(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},L=W["__core-js_shared__"],_=function(){var e=/[^.]+$/.exec(L&&L.keys&&L.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var T=function(e){return!!_&&_ in e},E=Function.prototype.toString;var J=function(e){if(null!=e){try{return E.call(e)}catch(CL){}try{return e+""}catch(CL){}}return""},D=/^\[object .+?Constructor\]$/,U=Function.prototype,P=Object.prototype,Q=U.toString,O=P.hasOwnProperty,j=RegExp("^"+Q.call(O).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var q=function(e){return!(!N(e)||T(e))&&(z(e)?j:D).test(J(e))};var $=function(e,t){return null==e?void 0:e[t]};var ee=function(e,t){var n=$(e,t);return q(n)?n:void 0},te=ee(W,"Map"),ne=ee(Object,"create");var ie=function(){this.__data__=ne?ne(null):{},this.size=0};var re=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ae=Object.prototype.hasOwnProperty;var oe=function(e){var t=this.__data__;if(ne){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return ae.call(t,e)?t[e]:void 0},se=Object.prototype.hasOwnProperty;var ge=function(e){var t=this.__data__;return ne?void 0!==t[e]:se.call(t,e)};var le=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ne&&void 0===t?"__lodash_hash_undefined__":t,this};function ue(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}ue.prototype.clear=ie,ue.prototype.delete=re,ue.prototype.get=oe,ue.prototype.has=ge,ue.prototype.set=le;var ce=ue;var Ie=function(){this.size=0,this.__data__={hash:new ce,map:new(te||b),string:new ce}};var Ce=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var de=function(e,t){var n=e.__data__;return Ce(t)?n["string"==typeof t?"string":"hash"]:n.map};var he=function(e){var t=de(this,e).delete(e);return this.size-=t?1:0,t};var Ae=function(e){return de(this,e).get(e)};var pe=function(e){return de(this,e).has(e)};var me=function(e,t){var n=de(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this};function fe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}fe.prototype.clear=Ie,fe.prototype.delete=he,fe.prototype.get=Ae,fe.prototype.has=pe,fe.prototype.set=me;var ve=fe;var be=function(e,t){var n=this.__data__;if(n instanceof b){var i=n.__data__;if(!te||i.length<199)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new ve(i)}return n.set(e,t),this.size=n.size,this};function ye(e){var t=this.__data__=new b(e);this.size=t.size}ye.prototype.clear=y,ye.prototype.delete=G,ye.prototype.get=B,ye.prototype.has=Z,ye.prototype.set=be;var Ge=ye;var Be=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e},Ze=function(){try{var e=ee(Object,"defineProperty");return e({},"",{}),e}catch(CL){}}();var we=function(e,t,n){"__proto__"==t&&Ze?Ze(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Se=Object.prototype.hasOwnProperty;var We=function(e,t,n){var i=e[t];Se.call(e,t)&&C(i,n)&&(void 0!==n||t in e)||we(e,t,n)};var xe=function(e,t,n,i){var r=!n;n||(n={});for(var a=-1,o=t.length;++a<o;){var s=t[a],g=i?i(n[s],e[s],s,n,e):void 0;void 0===g&&(g=e[s]),r?we(n,s,g):We(n,s,g)}return n};var Re=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i};var Ve=function(e){return null!=e&&"object"==typeof e};var ke=function(e){return Ve(e)&&"[object Arguments]"==K(e)},Xe=Object.prototype,Ye=Xe.hasOwnProperty,He=Xe.propertyIsEnumerable,Fe=ke(function(){return arguments}())?ke:function(e){return Ve(e)&&Ye.call(e,"callee")&&!He.call(e,"callee")},Me=Fe,Ke=Array.isArray;var Ne=function(){return!1},ze="object"==typeof exports&&exports&&!exports.nodeType&&exports,Le=ze&&"object"==typeof module&&module&&!module.nodeType&&module,_e=Le&&Le.exports===ze?W.Buffer:void 0,Te=(_e?_e.isBuffer:void 0)||Ne,Ee=/^(?:0|[1-9]\d*)$/;var Je=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Ee.test(e))&&e>-1&&e%1==0&&e<t};var De=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},Ue={};Ue["[object Float32Array]"]=Ue["[object Float64Array]"]=Ue["[object Int8Array]"]=Ue["[object Int16Array]"]=Ue["[object Int32Array]"]=Ue["[object Uint8Array]"]=Ue["[object Uint8ClampedArray]"]=Ue["[object Uint16Array]"]=Ue["[object Uint32Array]"]=!0,Ue["[object Arguments]"]=Ue["[object Array]"]=Ue["[object ArrayBuffer]"]=Ue["[object Boolean]"]=Ue["[object DataView]"]=Ue["[object Date]"]=Ue["[object Error]"]=Ue["[object Function]"]=Ue["[object Map]"]=Ue["[object Number]"]=Ue["[object Object]"]=Ue["[object RegExp]"]=Ue["[object Set]"]=Ue["[object String]"]=Ue["[object WeakMap]"]=!1;var Pe=function(e){return Ve(e)&&De(e.length)&&!!Ue[K(e)]};var Qe=function(e){return function(t){return e(t)}},Oe="object"==typeof exports&&exports&&!exports.nodeType&&exports,je=Oe&&"object"==typeof module&&module&&!module.nodeType&&module,qe=je&&je.exports===Oe&&w.process,$e=function(){try{var e=je&&je.require&&je.require("util").types;return e||qe&&qe.binding&&qe.binding("util")}catch(CL){}}(),et=$e&&$e.isTypedArray,tt=et?Qe(et):Pe,nt=Object.prototype.hasOwnProperty;var it=function(e,t){var n=Ke(e),i=!n&&Me(e),r=!n&&!i&&Te(e),a=!n&&!i&&!r&&tt(e),o=n||i||r||a,s=o?Re(e.length,String):[],g=s.length;for(var l in e)!t&&!nt.call(e,l)||o&&("length"==l||r&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Je(l,g))||s.push(l);return s},rt=Object.prototype;var at=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||rt)};var ot=function(e,t){return function(n){return e(t(n))}},st=ot(Object.keys,Object),gt=Object.prototype.hasOwnProperty;var lt=function(e){if(!at(e))return st(e);var t=[];for(var n in Object(e))gt.call(e,n)&&"constructor"!=n&&t.push(n);return t};var ut=function(e){return null!=e&&De(e.length)&&!z(e)};var ct=function(e){return ut(e)?it(e):lt(e)};var It=function(e,t){return e&&xe(t,ct(t),e)};var Ct=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t},dt=Object.prototype.hasOwnProperty;var ht=function(e){if(!N(e))return Ct(e);var t=at(e),n=[];for(var i in e)("constructor"!=i||!t&&dt.call(e,i))&&n.push(i);return n};var At=function(e){return ut(e)?it(e,!0):ht(e)};var pt=function(e,t){return e&&xe(t,At(t),e)},mt="object"==typeof exports&&exports&&!exports.nodeType&&exports,ft=mt&&"object"==typeof module&&module&&!module.nodeType&&module,vt=ft&&ft.exports===mt?W.Buffer:void 0,bt=vt?vt.allocUnsafe:void 0;var yt=function(e,t){if(t)return e.slice();var n=e.length,i=bt?bt(n):new e.constructor(n);return e.copy(i),i};var Gt=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t};var Bt=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,a=[];++n<i;){var o=e[n];t(o,n,e)&&(a[r++]=o)}return a};var Zt=function(){return[]},wt=Object.prototype.propertyIsEnumerable,St=Object.getOwnPropertySymbols,Wt=St?function(e){return null==e?[]:(e=Object(e),Bt(St(e),(function(t){return wt.call(e,t)})))}:Zt,xt=Wt;var Rt=function(e,t){return xe(e,xt(e),t)};var Vt=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e},kt=ot(Object.getPrototypeOf,Object),Xt=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Vt(t,xt(e)),e=kt(e);return t}:Zt,Yt=Xt;var Ht=function(e,t){return xe(e,Yt(e),t)};var Ft=function(e,t,n){var i=t(e);return Ke(e)?i:Vt(i,n(e))};var Mt=function(e){return Ft(e,ct,xt)};var Kt=function(e){return Ft(e,At,Yt)},Nt=ee(W,"DataView"),zt=ee(W,"Promise"),Lt=ee(W,"Set"),_t=ee(W,"WeakMap"),Tt="[object Map]",Et="[object Promise]",Jt="[object Set]",Dt="[object WeakMap]",Ut="[object DataView]",Pt=J(Nt),Qt=J(te),Ot=J(zt),jt=J(Lt),qt=J(_t),$t=K;(Nt&&$t(new Nt(new ArrayBuffer(1)))!=Ut||te&&$t(new te)!=Tt||zt&&$t(zt.resolve())!=Et||Lt&&$t(new Lt)!=Jt||_t&&$t(new _t)!=Dt)&&($t=function(e){var t=K(e),n="[object Object]"==t?e.constructor:void 0,i=n?J(n):"";if(i)switch(i){case Pt:return Ut;case Qt:return Tt;case Ot:return Et;case jt:return Jt;case qt:return Dt}return t});var en=$t,tn=Object.prototype.hasOwnProperty;var nn=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&tn.call(e,"index")&&(n.index=e.index,n.input=e.input),n},rn=W.Uint8Array;var an=function(e){var t=new e.constructor(e.byteLength);return new rn(t).set(new rn(e)),t};var on=function(e,t){var n=t?an(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)},sn=/\w*$/;var gn=function(e){var t=new e.constructor(e.source,sn.exec(e));return t.lastIndex=e.lastIndex,t},ln=x?x.prototype:void 0,un=ln?ln.valueOf:void 0;var cn=function(e){return un?Object(un.call(e)):{}};var In=function(e,t){var n=t?an(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};var Cn=function(e,t,n){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return an(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return on(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return In(e,n);case"[object Map]":case"[object Set]":return new i;case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return gn(e);case"[object Symbol]":return cn(e)}},dn=Object.create,hn=function(){function e(){}return function(t){if(!N(t))return{};if(dn)return dn(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}(),An=hn;var pn=function(e){return"function"!=typeof e.constructor||at(e)?{}:An(kt(e))};var mn=function(e){return Ve(e)&&"[object Map]"==en(e)},fn=$e&&$e.isMap,vn=fn?Qe(fn):mn;var bn=function(e){return Ve(e)&&"[object Set]"==en(e)},yn=$e&&$e.isSet,Gn=yn?Qe(yn):bn,Bn="[object Arguments]",Zn="[object Function]",wn="[object Object]",Sn={};Sn[Bn]=Sn["[object Array]"]=Sn["[object ArrayBuffer]"]=Sn["[object DataView]"]=Sn["[object Boolean]"]=Sn["[object Date]"]=Sn["[object Float32Array]"]=Sn["[object Float64Array]"]=Sn["[object Int8Array]"]=Sn["[object Int16Array]"]=Sn["[object Int32Array]"]=Sn["[object Map]"]=Sn["[object Number]"]=Sn["[object Object]"]=Sn["[object RegExp]"]=Sn["[object Set]"]=Sn["[object String]"]=Sn["[object Symbol]"]=Sn["[object Uint8Array]"]=Sn["[object Uint8ClampedArray]"]=Sn["[object Uint16Array]"]=Sn["[object Uint32Array]"]=!0,Sn["[object Error]"]=Sn[Zn]=Sn["[object WeakMap]"]=!1;var Wn=function e(t,n,i,r,a,o){var s,g=1&n,l=2&n,u=4&n;if(i&&(s=a?i(t,r,a,o):i(t)),void 0!==s)return s;if(!N(t))return t;var c=Ke(t);if(c){if(s=nn(t),!g)return Gt(t,s)}else{var I=en(t),C=I==Zn||"[object GeneratorFunction]"==I;if(Te(t))return yt(t,g);if(I==wn||I==Bn||C&&!a){if(s=l||C?{}:pn(t),!g)return l?Ht(t,pt(s,t)):Rt(t,It(s,t))}else{if(!Sn[I])return a?t:{};s=Cn(t,I,g)}}o||(o=new Ge);var d=o.get(t);if(d)return d;o.set(t,s),Gn(t)?t.forEach((function(r){s.add(e(r,n,i,r,t,o))})):vn(t)&&t.forEach((function(r,a){s.set(a,e(r,n,i,a,t,o))}));var h=c?void 0:(u?l?Kt:Mt:l?At:ct)(t);return Be(h||t,(function(r,a){h&&(r=t[a=r]),We(s,a,e(r,n,i,a,t,o))})),s};var xn=function(e){return Wn(e,4)};var Rn=function(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r};var Vn=function(e){return"symbol"==typeof e||Ve(e)&&"[object Symbol]"==K(e)};function kn(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var i=arguments,r=t?t.apply(this,i):i[0],a=n.cache;if(a.has(r))return a.get(r);var o=e.apply(this,i);return n.cache=a.set(r,o)||a,o};return n.cache=new(kn.Cache||ve),n}kn.Cache=ve;var Xn=kn;var Yn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Hn=/\\(\\)?/g,Fn=function(e){var t=Xn(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Yn,(function(e,n,i,r){t.push(i?r.replace(Hn,"$1"):n||e)})),t})),Mn=Fn;var Kn=function(e){if("string"==typeof e||Vn(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t},Nn=x?x.prototype:void 0,zn=Nn?Nn.toString:void 0;var Ln=function e(t){if("string"==typeof t)return t;if(Ke(t))return Rn(t,e)+"";if(Vn(t))return zn?zn.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n};var _n=function(e){return null==e?"":Ln(e)};var Tn=function(e){return Ke(e)?Rn(e,Kn):Vn(e)?[e]:Gt(Mn(_n(e)))};var En=function(e,t){};n(2110);var Jn=function(e){return Wn(e,5)};function Dn(){return Dn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Dn.apply(this,arguments)}function Un(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function Pn(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}function Qn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var On=function(e){return Array.isArray(e)&&0===e.length},jn=function(e){return"function"===typeof e},qn=function(e){return null!==e&&"object"===typeof e},$n=function(e){return String(Math.floor(Number(e)))===e},ei=function(e){return 0===t.Children.count(e)};function ti(e,t,n,i){void 0===i&&(i=0);for(var r=Tn(t);e&&i<r.length;)e=e[r[i++]];return void 0===e?n:e}function ni(e,t,n){for(var i=xn(e),r=i,a=0,o=Tn(t);a<o.length-1;a++){var s=o[a],g=ti(e,o.slice(0,a+1));if(g&&(qn(g)||Array.isArray(g)))r=r[s]=xn(g);else{var l=o[a+1];r=r[s]=$n(l)&&Number(l)>=0?[]:{}}}return(0===a?e:r)[o[a]]===n?e:(void 0===n?delete r[o[a]]:r[o[a]]=n,0===a&&void 0===n&&delete i[o[a]],i)}var ii=(0,t.createContext)(void 0);ii.displayName="FormikContext";ii.Provider,ii.Consumer;function ri(){var e=(0,t.useContext)(ii);return e||En(!1),e}"undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement?t.useLayoutEffect:t.useEffect;(0,t.forwardRef)((function(e,n){var i=e.action,r=Pn(e,["action"]),a=null!=i?i:"#",o=ri(),s=o.handleReset,g=o.handleSubmit;return(0,t.createElement)("form",Object.assign({onSubmit:g,ref:n,onReset:s,action:a},r))})).displayName="Form";var ai=function(e,t,n){var i=oi(e);return i.splice(t,0,n),i},oi=function(e){if(e){if(Array.isArray(e))return[].concat(e);var t=Object.keys(e).map((function(e){return parseInt(e)})).reduce((function(e,t){return t>e?t:e}),0);return Array.from(Dn({},e,{length:t+1}))}return[]},si=function(e){function n(t){var n;return(n=e.call(this,t)||this).updateArrayField=function(e,t,i){var r=n.props,a=r.name;(0,r.formik.setFormikState)((function(n){var r="function"===typeof i?i:e,o="function"===typeof t?t:e,s=ni(n.values,a,e(ti(n.values,a))),g=i?r(ti(n.errors,a)):void 0,l=t?o(ti(n.touched,a)):void 0;return On(g)&&(g=void 0),On(l)&&(l=void 0),Dn({},n,{values:s,errors:i?ni(n.errors,a,g):n.errors,touched:t?ni(n.touched,a,l):n.touched})}))},n.push=function(e){return n.updateArrayField((function(t){return[].concat(oi(t),[Jn(e)])}),!1,!1)},n.handlePush=function(e){return function(){return n.push(e)}},n.swap=function(e,t){return n.updateArrayField((function(n){return function(e,t,n){var i=oi(e),r=i[t];return i[t]=i[n],i[n]=r,i}(n,e,t)}),!0,!0)},n.handleSwap=function(e,t){return function(){return n.swap(e,t)}},n.move=function(e,t){return n.updateArrayField((function(n){return function(e,t,n){var i=oi(e),r=i[t];return i.splice(t,1),i.splice(n,0,r),i}(n,e,t)}),!0,!0)},n.handleMove=function(e,t){return function(){return n.move(e,t)}},n.insert=function(e,t){return n.updateArrayField((function(n){return ai(n,e,t)}),(function(t){return ai(t,e,null)}),(function(t){return ai(t,e,null)}))},n.handleInsert=function(e,t){return function(){return n.insert(e,t)}},n.replace=function(e,t){return n.updateArrayField((function(n){return function(e,t,n){var i=oi(e);return i[t]=n,i}(n,e,t)}),!1,!1)},n.handleReplace=function(e,t){return function(){return n.replace(e,t)}},n.unshift=function(e){var t=-1;return n.updateArrayField((function(n){var i=n?[e].concat(n):[e];return t<0&&(t=i.length),i}),(function(e){var n=e?[null].concat(e):[null];return t<0&&(t=n.length),n}),(function(e){var n=e?[null].concat(e):[null];return t<0&&(t=n.length),n})),t},n.handleUnshift=function(e){return function(){return n.unshift(e)}},n.handleRemove=function(e){return function(){return n.remove(e)}},n.handlePop=function(){return function(){return n.pop()}},n.remove=n.remove.bind(Qn(n)),n.pop=n.pop.bind(Qn(n)),n}Un(n,e);var i=n.prototype;return i.componentDidUpdate=function(e){this.props.validateOnChange&&this.props.formik.validateOnChange&&!o()(ti(e.formik.values,e.name),ti(this.props.formik.values,this.props.name))&&this.props.formik.validateForm(this.props.formik.values)},i.remove=function(e){var t;return this.updateArrayField((function(n){var i=n?oi(n):[];return t||(t=i[e]),jn(i.splice)&&i.splice(e,1),i}),!0,!0),t},i.pop=function(){var e;return this.updateArrayField((function(t){var n=t;return e||(e=n&&n.pop&&n.pop()),n}),!0,!0),e},i.render=function(){var e={push:this.push,pop:this.pop,swap:this.swap,move:this.move,insert:this.insert,replace:this.replace,unshift:this.unshift,remove:this.remove,handlePush:this.handlePush,handlePop:this.handlePop,handleSwap:this.handleSwap,handleMove:this.handleMove,handleInsert:this.handleInsert,handleReplace:this.handleReplace,handleUnshift:this.handleUnshift,handleRemove:this.handleRemove},n=this.props,i=n.component,r=n.render,a=n.children,o=n.name,s=Dn({},e,{form:Pn(n.formik,["validate","validationSchema"]),name:o});return i?(0,t.createElement)(i,s):r?r(s):a?"function"===typeof a?a(s):ei(a)?null:t.Children.only(a):null},n}(t.Component);si.defaultProps={validateOnChange:!0};var gi,li;t.Component,t.Component;function ui(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function ci(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Ii(e,t){if(e){if("string"===typeof e)return ui(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ui(e,t):void 0}}function Ci(e){return function(e){if(Array.isArray(e))return ui(e)}(e)||ci(e)||Ii(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function di(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function hi(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Ai(e,t,n){return t&&hi(e.prototype,t),n&&hi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}try{gi=Map}catch(mT){}try{li=Set}catch(mT){}function pi(e,t,n){if(!e||"object"!==typeof e||"function"===typeof e)return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);if(Array.isArray(e))return e.map(mi);if(gi&&e instanceof gi)return new Map(Array.from(e.entries()));if(li&&e instanceof li)return new Set(Array.from(e.values()));if(e instanceof Object){t.push(e);var i=Object.create(e);for(var r in n.push(i),e){var a=t.findIndex((function(t){return t===e[r]}));i[r]=a>-1?n[a]:pi(e[r],t,n)}return i}return e}function mi(e){return pi(e,[],[])}var fi=Object.prototype.toString,vi=Error.prototype.toString,bi=RegExp.prototype.toString,yi="undefined"!==typeof Symbol?Symbol.prototype.toString:function(){return""},Gi=/^Symbol\((.*)\)(.*)$/;function Bi(e){return e!=+e?"NaN":0===e&&1/e<0?"-0":""+e}function Zi(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==e||!0===e||!1===e)return""+e;var n=typeof e;if("number"===n)return Bi(e);if("string"===n)return t?'"'.concat(e,'"'):e;if("function"===n)return"[Function "+(e.name||"anonymous")+"]";if("symbol"===n)return yi.call(e).replace(Gi,"Symbol($1)");var i=fi.call(e).slice(8,-1);return"Date"===i?isNaN(e.getTime())?""+e:e.toISOString(e):"Error"===i||e instanceof Error?"["+vi.call(e)+"]":"RegExp"===i?bi.call(e):null}function wi(e,t){var n=Zi(e,t);return null!==n?n:JSON.stringify(e,(function(e,n){var i=Zi(this[e],t);return null!==i?i:n}),2)}var Si={default:"${path} is invalid",required:"${path} is a required field",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:function(e){var t=e.path,n=e.type,i=e.value,r=e.originalValue,a=null!=r&&r!==i,o="".concat(t," must be a `").concat(n,"` type, ")+"but the final value was: `".concat(wi(i,!0),"`")+(a?" (cast from the value `".concat(wi(r,!0),"`)."):".");return null===i&&(o+='\n If "null" is intended as an empty value be sure to mark the schema as `.nullable()`'),o},defined:"${path} must be defined"},Wi={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},xi={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},Ri={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},Vi={isValue:"${path} field must be ${value}"},ki={noUnknown:"${path} field has unspecified keys: ${unknown}"},Xi={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},Yi=(Object.assign(Object.create(null),{mixed:Si,string:Wi,number:xi,date:Ri,object:ki,array:Xi,boolean:Vi}),n(7805)),Hi=n.n(Yi),Fi=function(e){return e&&e.__isYupSchema__},Mi=function(){function e(t,n){if(di(this,e),this.fn=void 0,this.refs=t,this.refs=t,"function"!==typeof n){if(!Hi()(n,"is"))throw new TypeError("`is:` is required for `when()` conditions");if(!n.then&&!n.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");var i=n.is,r=n.then,a=n.otherwise,o="function"===typeof i?i:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every((function(e){return e===i}))};this.fn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.pop(),s=t.pop(),g=o.apply(void 0,t)?r:a;if(g)return"function"===typeof g?g(s):s.concat(g.resolve(i))}}else this.fn=n}return Ai(e,[{key:"resolve",value:function(e,t){var n=this.refs.map((function(e){return e.getValue(null==t?void 0:t.value,null==t?void 0:t.parent,null==t?void 0:t.context)})),i=this.fn.apply(e,n.concat(e,t));if(void 0===i||i===e)return e;if(!Fi(i))throw new TypeError("conditions must return a schema object");return i.resolve(t)}}]),e}(),Ki=Mi;function Ni(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zi(e,t){return zi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zi(e,t)}function Li(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zi(e,t)}function _i(e){return _i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_i(e)}function Ti(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(CL){return!1}}function Ei(e){return Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ei(e)}function Ji(e,t){if(t&&("object"===Ei(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ni(e)}function Di(e){var t=Ti();return function(){var n,i=_i(e);if(t){var r=_i(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Ji(this,n)}}function Ui(e,t,n){return Ui=Ti()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&zi(r,n.prototype),r},Ui.apply(null,arguments)}function Pi(e){var t="function"===typeof Map?new Map:void 0;return Pi=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return Ui(e,arguments,_i(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),zi(i,e)},Pi(e)}function Qi(e){return null==e?[]:[].concat(e)}function Oi(){return Oi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Oi.apply(this,arguments)}var ji=/\$\{\s*(\w+)\s*\}/g,qi=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a){var o;return di(this,n),(o=t.call(this)).value=void 0,o.path=void 0,o.type=void 0,o.errors=void 0,o.params=void 0,o.inner=void 0,o.name="ValidationError",o.value=i,o.path=r,o.type=a,o.errors=[],o.inner=[],Qi(e).forEach((function(e){var t;n.isError(e)?((t=o.errors).push.apply(t,Ci(e.errors)),o.inner=o.inner.concat(e.inner.length?e.inner:e)):o.errors.push(e)})),o.message=o.errors.length>1?"".concat(o.errors.length," errors occurred"):o.errors[0],Error.captureStackTrace&&Error.captureStackTrace(Ni(o),n),o}return Ai(n,null,[{key:"formatError",value:function(e,t){var n=t.label||t.path||"this";return n!==t.path&&(t=Oi({},t,{path:n})),"string"===typeof e?e.replace(ji,(function(e,n){return wi(t[n])})):"function"===typeof e?e(t):e}},{key:"isError",value:function(e){return e&&"ValidationError"===e.name}}]),n}(Pi(Error));function $i(e,t){var n=e.endEarly,i=e.tests,r=e.args,a=e.value,o=e.errors,s=e.sort,g=e.path,l=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(t),u=i.length,c=[];if(o=o||[],!u)return o.length?l(new qi(o,a,g)):l(null,a);for(var I=0;I<i.length;I++){(0,i[I])(r,(function(e){if(e){if(!qi.isError(e))return l(e,a);if(n)return e.value=a,l(e,a);c.push(e)}if(--u<=0){if(c.length&&(s&&c.sort(s),o.length&&c.push.apply(c,Ci(o)),o=c),o.length)return void l(new qi(o,a,g),a);l(null,a)}}))}}var er=n(7702),tr=n.n(er),nr=n(2758),ir="$",rr=".";var ar=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(di(this,e),this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,"string"!==typeof t)throw new TypeError("ref must be a string, got: "+t);if(this.key=t.trim(),""===t)throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===ir,this.isValue=this.key[0]===rr,this.isSibling=!this.isContext&&!this.isValue;var i=this.isContext?ir:this.isValue?rr:"";this.path=this.key.slice(i.length),this.getter=this.path&&(0,nr.getter)(this.path,!0),this.map=n.map}return Ai(e,[{key:"getValue",value:function(e,t,n){var i=this.isContext?n:this.isValue?e:t;return this.getter&&(i=this.getter(i||{})),this.map&&(i=this.map(i)),i}},{key:"cast",value:function(e,t){return this.getValue(e,null==t?void 0:t.parent,null==t?void 0:t.context)}},{key:"resolve",value:function(){return this}},{key:"describe",value:function(){return{type:"ref",key:this.key}}},{key:"toString",value:function(){return"Ref(".concat(this.key,")")}}],[{key:"isRef",value:function(e){return e&&e.__isYupRef}}]),e}();function or(){return or=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},or.apply(this,arguments)}function sr(e){function t(t,n){var i=t.value,r=t.path,a=void 0===r?"":r,o=t.label,s=t.options,g=t.originalValue,l=t.sync,u=function(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(t,["value","path","label","options","originalValue","sync"]),c=e.name,I=e.test,C=e.params,d=e.message,h=s.parent,A=s.context;function p(e){return ar.isRef(e)?e.getValue(i,h,A):e}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=tr()(or({value:i,originalValue:g,label:o,path:e.path||a},C,e.params),p),n=new qi(qi.formatError(e.message||d,t),i,t.path,e.type||c);return n.params=t,n}var f=or({path:a,parent:h,type:c,createError:m,resolve:p,options:s,originalValue:g},u);if(l){var v;try{var b;if("function"===typeof(null==(b=v=I.call(f,i,f))?void 0:b.then))throw new Error('Validation test of type: "'.concat(f.type,'" returned a Promise during a synchronous validate. ')+"This test will finish after the validate call has returned")}catch(y){return void n(y)}qi.isError(v)?n(v):v?n(null,v):n(m())}else try{Promise.resolve(I.call(f,i,f)).then((function(e){qi.isError(e)?n(e):e?n(null,e):n(m())})).catch(n)}catch(y){n(y)}}return t.OPTIONS=e,t}ar.prototype.__isYupRef=!0;var gr=function(e){return e.substr(0,e.length-1).substr(1)};function lr(e,t,n){var i,r,a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return t?((0,nr.forEach)(t,(function(s,g,l){var u=g?gr(s):s;if((e=e.resolve({context:o,parent:i,value:n})).innerType){var c=l?parseInt(u,10):0;if(n&&c>=n.length)throw new Error("Yup.reach cannot resolve an array item at index: ".concat(s,", in the path: ").concat(t,". ")+"because there is no value at that index. ");i=n,n=n&&n[c],e=e.innerType}if(!l){if(!e.fields||!e.fields[u])throw new Error("The schema does not contain the path: ".concat(t,". ")+"(failed at: ".concat(a,' which is a type: "').concat(e._type,'")'));i=n,n=n&&n[u],e=e.fields[u]}r=u,a=g?"["+s+"]":"."+s})),{schema:e,parent:i,parentPath:r}):{parent:i,parentPath:t,schema:e}}function ur(e){if(Array.isArray(e))return e}function cr(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ir(e,t){return ur(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(g){s=!0,r=g}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}}(e,t)||Ii(e,t)||cr()}function Cr(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Ii(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}var dr=function(){function e(){di(this,e),this.list=void 0,this.refs=void 0,this.list=new Set,this.refs=new Map}return Ai(e,[{key:"size",get:function(){return this.list.size+this.refs.size}},{key:"describe",value:function(){var e,t=[],n=Cr(this.list);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push(i)}}catch(s){n.e(s)}finally{n.f()}var r,a=Cr(this.refs);try{for(a.s();!(r=a.n()).done;){var o=Ir(r.value,2)[1];t.push(o.describe())}}catch(s){a.e(s)}finally{a.f()}return t}},{key:"toArray",value:function(){return Array.from(this.list).concat(Array.from(this.refs.values()))}},{key:"resolveAll",value:function(e){return this.toArray().reduce((function(t,n){return t.concat(ar.isRef(n)?e(n):n)}),[])}},{key:"add",value:function(e){ar.isRef(e)?this.refs.set(e.key,e):this.list.add(e)}},{key:"delete",value:function(e){ar.isRef(e)?this.refs.delete(e.key):this.list.delete(e)}},{key:"clone",value:function(){var t=new e;return t.list=new Set(this.list),t.refs=new Map(this.refs),t}},{key:"merge",value:function(e,t){var n=this.clone();return e.list.forEach((function(e){return n.add(e)})),e.refs.forEach((function(e){return n.add(e)})),t.list.forEach((function(e){return n.delete(e)})),t.refs.forEach((function(e){return n.delete(e)})),n}}]),e}();function hr(){return hr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},hr.apply(this,arguments)}var Ar=function(){function e(t){var n=this;di(this,e),this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this._typeError=void 0,this._whitelist=new dr,this._blacklist=new dr,this.exclusiveTests=Object.create(null),this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation((function(){n.typeError(Si.notType)})),this.type=(null==t?void 0:t.type)||"mixed",this.spec=hr({strip:!1,strict:!1,abortEarly:!0,recursive:!0,nullable:!1,presence:"optional"},null==t?void 0:t.spec)}return Ai(e,[{key:"_type",get:function(){return this.type}},{key:"_typeCheck",value:function(e){return!0}},{key:"clone",value:function(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;var t=Object.create(Object.getPrototypeOf(this));return t.type=this.type,t._typeError=this._typeError,t._whitelistError=this._whitelistError,t._blacklistError=this._blacklistError,t._whitelist=this._whitelist.clone(),t._blacklist=this._blacklist.clone(),t.exclusiveTests=hr({},this.exclusiveTests),t.deps=Ci(this.deps),t.conditions=Ci(this.conditions),t.tests=Ci(this.tests),t.transforms=Ci(this.transforms),t.spec=mi(hr({},this.spec,e)),t}},{key:"label",value:function(e){var t=this.clone();return t.spec.label=e,t}},{key:"meta",value:function(){if(0===arguments.length)return this.spec.meta;var e=this.clone();return e.spec.meta=Object.assign(e.spec.meta||{},arguments.length<=0?void 0:arguments[0]),e}},{key:"withMutation",value:function(e){var t=this._mutate;this._mutate=!0;var n=e(this);return this._mutate=t,n}},{key:"concat",value:function(e){if(!e||e===this)return this;if(e.type!==this.type&&"mixed"!==this.type)throw new TypeError("You cannot `concat()` schema's of different types: ".concat(this.type," and ").concat(e.type));var t=this,n=e.clone(),i=hr({},t.spec,n.spec);return n.spec=i,n._typeError||(n._typeError=t._typeError),n._whitelistError||(n._whitelistError=t._whitelistError),n._blacklistError||(n._blacklistError=t._blacklistError),n._whitelist=t._whitelist.merge(e._whitelist,e._blacklist),n._blacklist=t._blacklist.merge(e._blacklist,e._whitelist),n.tests=t.tests,n.exclusiveTests=t.exclusiveTests,n.withMutation((function(t){e.tests.forEach((function(e){t.test(e.OPTIONS)}))})),n.transforms=[].concat(Ci(t.transforms),Ci(n.transforms)),n}},{key:"isType",value:function(e){return!(!this.spec.nullable||null!==e)||this._typeCheck(e)}},{key:"resolve",value:function(e){var t=this;if(t.conditions.length){var n=t.conditions;(t=t.clone()).conditions=[],t=(t=n.reduce((function(t,n){return n.resolve(t,e)}),t)).resolve(e)}return t}},{key:"cast",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.resolve(hr({value:e},t)),i=n._cast(e,t);if(void 0!==e&&!1!==t.assert&&!0!==n.isType(i)){var r=wi(e),a=wi(i);throw new TypeError("The value of ".concat(t.path||"field"," could not be cast to a value ")+'that satisfies the schema type: "'.concat(n._type,'". \n\n')+"attempted value: ".concat(r," \n")+(a!==r?"result of cast: ".concat(a):""))}return i}},{key:"_cast",value:function(e,t){var n=this,i=void 0===e?e:this.transforms.reduce((function(t,i){return i.call(n,t,e,n)}),e);return void 0===i&&(i=this.getDefault()),i}},{key:"_validate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=n.sync,a=n.path,o=n.from,s=void 0===o?[]:o,g=n.originalValue,l=void 0===g?e:g,u=n.strict,c=void 0===u?this.spec.strict:u,I=n.abortEarly,C=void 0===I?this.spec.abortEarly:I,d=e;c||(d=this._cast(d,hr({assert:!1},n)));var h={value:d,path:a,options:n,originalValue:l,schema:this,label:this.spec.label,sync:r,from:s},A=[];this._typeError&&A.push(this._typeError);var p=[];this._whitelistError&&p.push(this._whitelistError),this._blacklistError&&p.push(this._blacklistError),$i({args:h,value:d,path:a,sync:r,tests:A,endEarly:C},(function(e){e?i(e,d):$i({tests:t.tests.concat(p),args:h,path:a,sync:r,value:d,endEarly:C},i)}))}},{key:"validate",value:function(e,t,n){var i=this.resolve(hr({},t,{value:e}));return"function"===typeof n?i._validate(e,t,n):new Promise((function(n,r){return i._validate(e,t,(function(e,t){e?r(e):n(t)}))}))}},{key:"validateSync",value:function(e,t){var n;return this.resolve(hr({},t,{value:e}))._validate(e,hr({},t,{sync:!0}),(function(e,t){if(e)throw e;n=t})),n}},{key:"isValid",value:function(e,t){return this.validate(e,t).then((function(){return!0}),(function(e){if(qi.isError(e))return!1;throw e}))}},{key:"isValidSync",value:function(e,t){try{return this.validateSync(e,t),!0}catch(n){if(qi.isError(n))return!1;throw n}}},{key:"_getDefault",value:function(){var e=this.spec.default;return null==e?e:"function"===typeof e?e.call(this):mi(e)}},{key:"getDefault",value:function(e){return this.resolve(e||{})._getDefault()}},{key:"default",value:function(e){if(0===arguments.length)return this._getDefault();var t=this.clone({default:e});return t}},{key:"strict",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.clone();return t.spec.strict=e,t}},{key:"_isPresent",value:function(e){return null!=e}},{key:"defined",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Si.defined;return this.test({message:e,name:"defined",exclusive:!0,test:function(e){return void 0!==e}})}},{key:"required",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Si.required;return this.clone({presence:"required"}).withMutation((function(t){return t.test({message:e,name:"required",exclusive:!0,test:function(e){return this.schema._isPresent(e)}})}))}},{key:"notRequired",value:function(){var e=this.clone({presence:"optional"});return e.tests=e.tests.filter((function(e){return"required"!==e.OPTIONS.name})),e}},{key:"nullable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.clone({nullable:!1!==e});return t}},{key:"transform",value:function(e){var t=this.clone();return t.transforms.push(e),t}},{key:"test",value:function(){var e;if(void 0===(e=1===arguments.length?"function"===typeof(arguments.length<=0?void 0:arguments[0])?{test:arguments.length<=0?void 0:arguments[0]}:arguments.length<=0?void 0:arguments[0]:2===arguments.length?{name:arguments.length<=0?void 0:arguments[0],test:arguments.length<=1?void 0:arguments[1]}:{name:arguments.length<=0?void 0:arguments[0],message:arguments.length<=1?void 0:arguments[1],test:arguments.length<=2?void 0:arguments[2]}).message&&(e.message=Si.default),"function"!==typeof e.test)throw new TypeError("`test` is a required parameters");var t=this.clone(),n=sr(e),i=e.exclusive||e.name&&!0===t.exclusiveTests[e.name];if(e.exclusive&&!e.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return e.name&&(t.exclusiveTests[e.name]=!!e.exclusive),t.tests=t.tests.filter((function(t){if(t.OPTIONS.name===e.name){if(i)return!1;if(t.OPTIONS.test===n.OPTIONS.test)return!1}return!0})),t.tests.push(n),t}},{key:"when",value:function(e,t){Array.isArray(e)||"string"===typeof e||(t=e,e=".");var n=this.clone(),i=Qi(e).map((function(e){return new ar(e)}));return i.forEach((function(e){e.isSibling&&n.deps.push(e.key)})),n.conditions.push(new Ki(i,t)),n}},{key:"typeError",value:function(e){var t=this.clone();return t._typeError=sr({message:e,name:"typeError",test:function(e){return!(void 0!==e&&!this.schema.isType(e))||this.createError({params:{type:this.schema._type}})}}),t}},{key:"oneOf",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Si.oneOf,n=this.clone();return e.forEach((function(e){n._whitelist.add(e),n._blacklist.delete(e)})),n._whitelistError=sr({message:t,name:"oneOf",test:function(e){if(void 0===e)return!0;var t=this.schema._whitelist,n=t.resolveAll(this.resolve);return!!n.includes(e)||this.createError({params:{values:t.toArray().join(", "),resolved:n}})}}),n}},{key:"notOneOf",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Si.notOneOf,n=this.clone();return e.forEach((function(e){n._blacklist.add(e),n._whitelist.delete(e)})),n._blacklistError=sr({message:t,name:"notOneOf",test:function(e){var t=this.schema._blacklist,n=t.resolveAll(this.resolve);return!n.includes(e)||this.createError({params:{values:t.toArray().join(", "),resolved:n}})}}),n}},{key:"strip",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.clone();return t.spec.strip=e,t}},{key:"describe",value:function(){var e=this.clone(),t=e.spec,n=t.label,i={meta:t.meta,label:n,type:e.type,oneOf:e._whitelist.describe(),notOneOf:e._blacklist.describe(),tests:e.tests.map((function(e){return{name:e.OPTIONS.name,params:e.OPTIONS.params}})).filter((function(e,t,n){return n.findIndex((function(t){return t.name===e.name}))===t}))};return i}}]),e}();Ar.prototype.__isYupSchema__=!0;for(var pr=function(){var e=fr[mr];Ar.prototype["".concat(e,"At")]=function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=lr(this,t,n,i.context),a=r.parent,o=r.parentPath,s=r.schema;return s[e](a&&a[o],hr({},i,{parent:a,path:t}))}},mr=0,fr=["validate","validateSync"];mr<fr.length;mr++)pr();for(var vr=0,br=["equals","is"];vr<br.length;vr++){var yr=br[vr];Ar.prototype[yr]=Ar.prototype.oneOf}for(var Gr=0,Br=["not","nope"];Gr<Br.length;Gr++){var Zr=Br[Gr];Ar.prototype[Zr]=Ar.prototype.notOneOf}Ar.prototype.optional=Ar.prototype.notRequired;var wr=Ar;wr.prototype;var Sr=function(e){return null==e};var Wr=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this,{type:"boolean"})).withMutation((function(){e.transform((function(e){if(!this.isType(e)){if(/^(true|1)$/i.test(String(e)))return!0;if(/^(false|0)$/i.test(String(e)))return!1}return e}))})),e}return Ai(n,[{key:"_typeCheck",value:function(e){return e instanceof Boolean&&(e=e.valueOf()),"boolean"===typeof e}},{key:"isTrue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vi.isValue;return this.test({message:e,name:"is-value",exclusive:!0,params:{value:"true"},test:function(e){return Sr(e)||!0===e}})}},{key:"isFalse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vi.isValue;return this.test({message:e,name:"is-value",exclusive:!0,params:{value:"false"},test:function(e){return Sr(e)||!1===e}})}}]),n}(Ar);function xr(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_i(e)););return e}function Rr(){return Rr="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=xr(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},Rr.apply(this,arguments)}Wr.prototype;var Vr=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,kr=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,Xr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Yr=function(e){return Sr(e)||e===e.trim()},Hr={}.toString();var Fr=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this,{type:"string"})).withMutation((function(){e.transform((function(e){if(this.isType(e))return e;if(Array.isArray(e))return e;var t=null!=e&&e.toString?e.toString():e;return t===Hr?e:t}))})),e}return Ai(n,[{key:"_typeCheck",value:function(e){return e instanceof String&&(e=e.valueOf()),"string"===typeof e}},{key:"_isPresent",value:function(e){return Rr(_i(n.prototype),"_isPresent",this).call(this,e)&&!!e.length}},{key:"length",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wi.length;return this.test({message:t,name:"length",exclusive:!0,params:{length:e},test:function(t){return Sr(t)||t.length===this.resolve(e)}})}},{key:"min",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wi.min;return this.test({message:t,name:"min",exclusive:!0,params:{min:e},test:function(t){return Sr(t)||t.length>=this.resolve(e)}})}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wi.max;return this.test({name:"max",exclusive:!0,message:t,params:{max:e},test:function(t){return Sr(t)||t.length<=this.resolve(e)}})}},{key:"matches",value:function(e,t){var n,i,r=!1;if(t)if("object"===typeof t){var a=t.excludeEmptyString;r=void 0!==a&&a,n=t.message,i=t.name}else n=t;return this.test({name:i||"matches",message:n||Wi.matches,params:{regex:e},test:function(t){return Sr(t)||""===t&&r||-1!==t.search(e)}})}},{key:"email",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wi.email;return this.matches(Vr,{name:"email",message:e,excludeEmptyString:!0})}},{key:"url",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wi.url;return this.matches(kr,{name:"url",message:e,excludeEmptyString:!0})}},{key:"uuid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wi.uuid;return this.matches(Xr,{name:"uuid",message:e,excludeEmptyString:!1})}},{key:"ensure",value:function(){return this.default("").transform((function(e){return null===e?"":e}))}},{key:"trim",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wi.trim;return this.transform((function(e){return null!=e?e.trim():e})).test({message:e,name:"trim",test:Yr})}},{key:"lowercase",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wi.lowercase;return this.transform((function(e){return Sr(e)?e:e.toLowerCase()})).test({message:e,name:"string_case",exclusive:!0,test:function(e){return Sr(e)||e===e.toLowerCase()}})}},{key:"uppercase",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wi.uppercase;return this.transform((function(e){return Sr(e)?e:e.toUpperCase()})).test({message:e,name:"string_case",exclusive:!0,test:function(e){return Sr(e)||e===e.toUpperCase()}})}}]),n}(Ar);Fr.prototype;var Mr=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this,{type:"number"})).withMutation((function(){e.transform((function(e){var t=e;if("string"===typeof t){if(""===(t=t.replace(/\s/g,"")))return NaN;t=+t}return this.isType(t)?t:parseFloat(t)}))})),e}return Ai(n,[{key:"_typeCheck",value:function(e){return e instanceof Number&&(e=e.valueOf()),"number"===typeof e&&!function(e){return e!=+e}(e)}},{key:"min",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xi.min;return this.test({message:t,name:"min",exclusive:!0,params:{min:e},test:function(t){return Sr(t)||t>=this.resolve(e)}})}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xi.max;return this.test({message:t,name:"max",exclusive:!0,params:{max:e},test:function(t){return Sr(t)||t<=this.resolve(e)}})}},{key:"lessThan",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xi.lessThan;return this.test({message:t,name:"max",exclusive:!0,params:{less:e},test:function(t){return Sr(t)||t<this.resolve(e)}})}},{key:"moreThan",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xi.moreThan;return this.test({message:t,name:"min",exclusive:!0,params:{more:e},test:function(t){return Sr(t)||t>this.resolve(e)}})}},{key:"positive",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xi.positive;return this.moreThan(0,e)}},{key:"negative",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xi.negative;return this.lessThan(0,e)}},{key:"integer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xi.integer;return this.test({name:"integer",message:e,test:function(e){return Sr(e)||Number.isInteger(e)}})}},{key:"truncate",value:function(){return this.transform((function(e){return Sr(e)?e:0|e}))}},{key:"round",value:function(e){var t,n=["ceil","floor","round","trunc"];if("trunc"===(e=(null==(t=e)?void 0:t.toLowerCase())||"round"))return this.truncate();if(-1===n.indexOf(e.toLowerCase()))throw new TypeError("Only valid options for round() are: "+n.join(", "));return this.transform((function(t){return Sr(t)?t:Math[e](t)}))}}]),n}(Ar);Mr.prototype;var Kr=/^(\d{4}|[+\-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,\.](\d{1,}))?)?(?:(Z)|([+\-])(\d{2})(?::?(\d{2}))?)?)?$/;var Nr=new Date("");function zr(){return new Lr}var Lr=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this,{type:"date"})).withMutation((function(){e.transform((function(e){return this.isType(e)?e:(e=function(e){var t,n,i=[1,4,5,6,7,10,11],r=0;if(n=Kr.exec(e)){for(var a,o=0;a=i[o];++o)n[a]=+n[a]||0;n[2]=(+n[2]||1)-1,n[3]=+n[3]||1,n[7]=n[7]?String(n[7]).substr(0,3):0,void 0!==n[8]&&""!==n[8]||void 0!==n[9]&&""!==n[9]?("Z"!==n[8]&&void 0!==n[9]&&(r=60*n[10]+n[11],"+"===n[9]&&(r=0-r)),t=Date.UTC(n[1],n[2],n[3],n[4],n[5]+r,n[6],n[7])):t=+new Date(n[1],n[2],n[3],n[4],n[5],n[6],n[7])}else t=Date.parse?Date.parse(e):NaN;return t}(e),isNaN(e)?Nr:new Date(e))}))})),e}return Ai(n,[{key:"_typeCheck",value:function(e){return t=e,"[object Date]"===Object.prototype.toString.call(t)&&!isNaN(e.getTime());var t}},{key:"prepareParam",value:function(e,t){var n;if(ar.isRef(e))n=e;else{var i=this.cast(e);if(!this._typeCheck(i))throw new TypeError("`".concat(t,"` must be a Date or a value that can be `cast()` to a Date"));n=i}return n}},{key:"min",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ri.min,n=this.prepareParam(e,"min");return this.test({message:t,name:"min",exclusive:!0,params:{min:e},test:function(e){return Sr(e)||e>=this.resolve(n)}})}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ri.max,n=this.prepareParam(e,"max");return this.test({message:t,name:"max",exclusive:!0,params:{max:e},test:function(e){return Sr(e)||e<=this.resolve(n)}})}}]),n}(Ar);Lr.INVALID_DATE=Nr,zr.prototype=Lr.prototype,zr.INVALID_DATE=Nr;var _r=n(7499),Tr=n.n(_r),Er=n(567),Jr=n.n(Er),Dr=n(9029),Ur=n.n(Dr),Pr=n(6514),Qr=n.n(Pr);function Or(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],i=new Set,r=new Set(t.map((function(e){var t=Ir(e,2),n=t[0],i=t[1];return"".concat(n,"-").concat(i)})));function a(e,t){var a=(0,nr.split)(e)[0];i.add(a),r.has("".concat(t,"-").concat(a))||n.push([t,a])}var o=function(t){if(Hi()(e,t)){var n=e[t];i.add(t),ar.isRef(n)&&n.isSibling?a(n.path,t):Fi(n)&&"deps"in n&&n.deps.forEach((function(e){return a(e,t)}))}};for(var s in e)o(s);return Qr().array(Array.from(i),n).reverse()}function jr(e,t){var n=1/0;return e.some((function(e,i){var r;if(-1!==(null==(r=t.path)?void 0:r.indexOf(e)))return n=i,!0})),n}function qr(e){return function(t,n){return jr(e,t)-jr(e,n)}}function $r(){return $r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},$r.apply(this,arguments)}var ea=function(e){return"[object Object]"===Object.prototype.toString.call(e)};function ta(e,t){var n=Object.keys(e.fields);return Object.keys(t).filter((function(e){return-1===n.indexOf(e)}))}var na=qr([]),ia=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,{type:"object"})).fields=Object.create(null),i._sortErrors=na,i._nodes=[],i._excludedEdges=[],i.withMutation((function(){i.transform((function(e){if("string"===typeof e)try{e=JSON.parse(e)}catch(t){e=null}return this.isType(e)?e:null})),e&&i.shape(e)})),i}return Ai(n,[{key:"_typeCheck",value:function(e){return ea(e)||"function"===typeof e}},{key:"_cast",value:function(e){var t,i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=Rr(_i(n.prototype),"_cast",this).call(this,e,r);if(void 0===a)return this.getDefault();if(!this._typeCheck(a))return a;var o,s=this.fields,g=null!=(t=r.stripUnknown)?t:this.spec.noUnknown,l=this._nodes.concat(Object.keys(a).filter((function(e){return-1===i._nodes.indexOf(e)}))),u={},c=$r({},r,{parent:u,__validating:r.__validating||!1}),I=!1,C=Cr(l);try{for(C.s();!(o=C.n()).done;){var d=o.value,h=s[d],A=Hi()(a,d);if(h){var p=void 0,m=a[d];c.path=(r.path?"".concat(r.path,"."):"")+d;var f="spec"in(h=h.resolve({value:m,context:r.context,parent:u}))?h.spec:void 0,v=null==f?void 0:f.strict;if(null==f?void 0:f.strip){I=I||d in a;continue}void 0!==(p=r.__validating&&v?a[d]:h.cast(a[d],c))&&(u[d]=p)}else A&&!g&&(u[d]=a[d]);u[d]!==a[d]&&(I=!0)}}catch(b){C.e(b)}finally{C.f()}return I?u:a}},{key:"_validate",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=[],o=i.sync,s=i.from,g=void 0===s?[]:s,l=i.originalValue,u=void 0===l?e:l,c=i.abortEarly,I=void 0===c?this.spec.abortEarly:c,C=i.recursive,d=void 0===C?this.spec.recursive:C;g=[{schema:this,value:u}].concat(Ci(g)),i.__validating=!0,i.originalValue=u,i.from=g,Rr(_i(n.prototype),"_validate",this).call(this,e,i,(function(e,n){if(e){if(!qi.isError(e)||I)return void r(e,n);a.push(e)}if(d&&ea(n)){u=u||n;var s=t._nodes.map((function(e){return function(r,a){var o=-1===e.indexOf(".")?(i.path?"".concat(i.path,"."):"")+e:"".concat(i.path||"",'["').concat(e,'"]'),s=t.fields[e];s&&"validate"in s?s.validate(n[e],$r({},i,{path:o,from:g,strict:!0,parent:n,originalValue:u[e]}),a):a(null)}}));$i({sync:o,tests:s,value:n,errors:a,endEarly:I,sort:t._sortErrors,path:i.path},r)}else r(a[0]||null,n)}))}},{key:"clone",value:function(e){var t=Rr(_i(n.prototype),"clone",this).call(this,e);return t.fields=$r({},this.fields),t._nodes=this._nodes,t._excludedEdges=this._excludedEdges,t._sortErrors=this._sortErrors,t}},{key:"concat",value:function(e){for(var t=this,i=Rr(_i(n.prototype),"concat",this).call(this,e),r=i.fields,a=0,o=Object.entries(this.fields);a<o.length;a++){var s=Ir(o[a],2),g=s[0],l=s[1],u=r[g];void 0===u?r[g]=l:u instanceof Ar&&l instanceof Ar&&(r[g]=l.concat(u))}return i.withMutation((function(){return i.shape(r,t._excludedEdges)}))}},{key:"getDefaultFromShape",value:function(){var e=this,t={};return this._nodes.forEach((function(n){var i=e.fields[n];t[n]="default"in i?i.getDefault():void 0})),t}},{key:"_getDefault",value:function(){return"default"in this.spec?Rr(_i(n.prototype),"_getDefault",this).call(this):this._nodes.length?this.getDefaultFromShape():void 0}},{key:"shape",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=this.clone(),i=Object.assign(n.fields,e);return n.fields=i,n._sortErrors=qr(Object.keys(i)),t.length&&(Array.isArray(t[0])||(t=[t]),n._excludedEdges=[].concat(Ci(n._excludedEdges),Ci(t))),n._nodes=Or(i,n._excludedEdges),n}},{key:"pick",value:function(e){var t,n={},i=Cr(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this.fields[r]&&(n[r]=this.fields[r])}}catch(a){i.e(a)}finally{i.f()}return this.clone().withMutation((function(e){return e.fields={},e.shape(n)}))}},{key:"omit",value:function(e){var t=this.clone(),n=t.fields;t.fields={};var i,r=Cr(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;delete n[a]}}catch(o){r.e(o)}finally{r.f()}return t.withMutation((function(){return t.shape(n)}))}},{key:"from",value:function(e,t,n){var i=(0,nr.getter)(e,!0);return this.transform((function(r){if(null==r)return r;var a=r;return Hi()(r,e)&&(a=$r({},r),n||delete a[e],a[t]=i(r)),a}))}},{key:"noUnknown",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ki.noUnknown;"string"===typeof e&&(t=e,e=!0);var n=this.test({name:"noUnknown",exclusive:!0,message:t,test:function(t){if(null==t)return!0;var n=ta(this.schema,t);return!e||0===n.length||this.createError({params:{unknown:n.join(", ")}})}});return n.spec.noUnknown=e,n}},{key:"unknown",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ki.noUnknown;return this.noUnknown(!e,t)}},{key:"transformKeys",value:function(e){return this.transform((function(t){return t&&Ur()(t,(function(t,n){return e(n)}))}))}},{key:"camelCase",value:function(){return this.transformKeys(Jr())}},{key:"snakeCase",value:function(){return this.transformKeys(Tr())}},{key:"constantCase",value:function(){return this.transformKeys((function(e){return Tr()(e).toUpperCase()}))}},{key:"describe",value:function(){var e=Rr(_i(n.prototype),"describe",this).call(this);return e.fields=tr()(this.fields,(function(e){return e.describe()})),e}}]),n}(Ar);function ra(){return ra=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},ra.apply(this,arguments)}ia.prototype;var aa=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,{type:"array"})).innerType=void 0,i.innerType=e,i.withMutation((function(){i.transform((function(e){if("string"===typeof e)try{e=JSON.parse(e)}catch(t){e=null}return this.isType(e)?e:null}))})),i}return Ai(n,[{key:"_typeCheck",value:function(e){return Array.isArray(e)}},{key:"_subType",get:function(){return this.innerType}},{key:"_cast",value:function(e,t){var i=this,r=Rr(_i(n.prototype),"_cast",this).call(this,e,t);if(!this._typeCheck(r)||!this.innerType)return r;var a=!1,o=r.map((function(e,n){var r=i.innerType.cast(e,ra({},t,{path:"".concat(t.path||"","[").concat(n,"]")}));return r!==e&&(a=!0),r}));return a?o:r}},{key:"_validate",value:function(e){var t,i,r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,s=[],g=a.sync,l=a.path,u=this.innerType,c=null!=(t=a.abortEarly)?t:this.spec.abortEarly,I=null!=(i=a.recursive)?i:this.spec.recursive,C=null!=a.originalValue?a.originalValue:e;Rr(_i(n.prototype),"_validate",this).call(this,e,a,(function(e,t){if(e){if(!qi.isError(e)||c)return void o(e,t);s.push(e)}if(I&&u&&r._typeCheck(t)){C=C||t;for(var n=new Array(t.length),i=function(e){var i=t[e],r="".concat(a.path||"","[").concat(e,"]"),o=ra({},a,{path:r,strict:!0,parent:t,index:e,originalValue:C[e]});n[e]=function(e,t){return u.validate(i,o,t)}},d=0;d<t.length;d++)i(d);$i({sync:g,path:l,value:t,errors:s,endEarly:c,tests:n},o)}else o(s[0]||null,t)}))}},{key:"clone",value:function(e){var t=Rr(_i(n.prototype),"clone",this).call(this,e);return t.innerType=this.innerType,t}},{key:"concat",value:function(e){var t=Rr(_i(n.prototype),"concat",this).call(this,e);return t.innerType=this.innerType,e.innerType&&(t.innerType=t.innerType?t.innerType.concat(e.innerType):e.innerType),t}},{key:"of",value:function(e){var t=this.clone();if(!Fi(e))throw new TypeError("`array.of()` sub-schema must be a valid yup schema not: "+wi(e));return t.innerType=e,t}},{key:"length",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xi.length;return this.test({message:t,name:"length",exclusive:!0,params:{length:e},test:function(t){return Sr(t)||t.length===this.resolve(e)}})}},{key:"min",value:function(e,t){return t=t||Xi.min,this.test({message:t,name:"min",exclusive:!0,params:{min:e},test:function(t){return Sr(t)||t.length>=this.resolve(e)}})}},{key:"max",value:function(e,t){return t=t||Xi.max,this.test({message:t,name:"max",exclusive:!0,params:{max:e},test:function(t){return Sr(t)||t.length<=this.resolve(e)}})}},{key:"ensure",value:function(){var e=this;return this.default((function(){return[]})).transform((function(t,n){return e._typeCheck(t)?t:null==n?[]:[].concat(n)}))}},{key:"compact",value:function(e){var t=e?function(t,n,i){return!e(t,n,i)}:function(e){return!!e};return this.transform((function(e){return null!=e?e.filter(t):e}))}},{key:"describe",value:function(){var e=Rr(_i(n.prototype),"describe",this).call(this);return this.innerType&&(e.innerType=this.innerType.describe()),e}},{key:"nullable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Rr(_i(n.prototype),"nullable",this).call(this,e)}},{key:"defined",value:function(){return Rr(_i(n.prototype),"defined",this).call(this)}},{key:"required",value:function(e){return Rr(_i(n.prototype),"required",this).call(this,e)}}]),n}(Ar);function oa(){return oa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},oa.apply(this,arguments)}function sa(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}aa.prototype;var ga=function(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}},la=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,ua=ga((function(e){return la.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91}));var ca=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(CL){0}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0},e}(),Ia=Math.abs,Ca=String.fromCharCode,da=Object.assign;function ha(e){return e.trim()}function Aa(e,t,n){return e.replace(t,n)}function pa(e,t){return e.indexOf(t)}function ma(e,t){return 0|e.charCodeAt(t)}function fa(e,t,n){return e.slice(t,n)}function va(e){return e.length}function ba(e){return e.length}function ya(e,t){return t.push(e),e}var Ga=1,Ba=1,Za=0,wa=0,Sa=0,Wa="";function xa(e,t,n,i,r,a,o){return{value:e,root:t,parent:n,type:i,props:r,children:a,line:Ga,column:Ba,length:o,return:""}}function Ra(e,t){return da(xa("",null,null,"",null,null,0),e,{length:-e.length},t)}function Va(){return Sa=wa>0?ma(Wa,--wa):0,Ba--,10===Sa&&(Ba=1,Ga--),Sa}function ka(){return Sa=wa<Za?ma(Wa,wa++):0,Ba++,10===Sa&&(Ba=1,Ga++),Sa}function Xa(){return ma(Wa,wa)}function Ya(){return wa}function Ha(e,t){return fa(Wa,e,t)}function Fa(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Ma(e){return Ga=Ba=1,Za=va(Wa=e),wa=0,[]}function Ka(e){return Wa="",e}function Na(e){return ha(Ha(wa-1,_a(91===e?e+2:40===e?e+1:e)))}function za(e){for(;(Sa=Xa())&&Sa<33;)ka();return Fa(e)>2||Fa(Sa)>3?"":" "}function La(e,t){for(;--t&&ka()&&!(Sa<48||Sa>102||Sa>57&&Sa<65||Sa>70&&Sa<97););return Ha(e,Ya()+(t<6&&32==Xa()&&32==ka()))}function _a(e){for(;ka();)switch(Sa){case e:return wa;case 34:case 39:34!==e&&39!==e&&_a(Sa);break;case 40:41===e&&_a(e);break;case 92:ka()}return wa}function Ta(e,t){for(;ka()&&e+Sa!==57&&(e+Sa!==84||47!==Xa()););return"/*"+Ha(t,wa-1)+"*"+Ca(47===e?e:ka())}function Ea(e){for(;!Fa(Xa());)ka();return Ha(e,wa)}var Ja="-ms-",Da="-moz-",Ua="-webkit-",Pa="comm",Qa="rule",Oa="decl",ja="@keyframes";function qa(e,t){for(var n="",i=ba(e),r=0;r<i;r++)n+=t(e[r],r,e,t)||"";return n}function $a(e,t,n,i){switch(e.type){case"@import":case Oa:return e.return=e.return||e.value;case Pa:return"";case ja:return e.return=e.value+"{"+qa(e.children,i)+"}";case Qa:e.value=e.props.join(",")}return va(n=qa(e.children,i))?e.return=e.value+"{"+n+"}":""}function eo(e,t){switch(function(e,t){return(((t<<2^ma(e,0))<<2^ma(e,1))<<2^ma(e,2))<<2^ma(e,3)}(e,t)){case 5103:return Ua+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ua+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Ua+e+Da+e+Ja+e+e;case 6828:case 4268:return Ua+e+Ja+e+e;case 6165:return Ua+e+Ja+"flex-"+e+e;case 5187:return Ua+e+Aa(e,/(\w+).+(:[^]+)/,"-webkit-box-$1$2-ms-flex-$1$2")+e;case 5443:return Ua+e+Ja+"flex-item-"+Aa(e,/flex-|-self/,"")+e;case 4675:return Ua+e+Ja+"flex-line-pack"+Aa(e,/align-content|flex-|-self/,"")+e;case 5548:return Ua+e+Ja+Aa(e,"shrink","negative")+e;case 5292:return Ua+e+Ja+Aa(e,"basis","preferred-size")+e;case 6060:return Ua+"box-"+Aa(e,"-grow","")+Ua+e+Ja+Aa(e,"grow","positive")+e;case 4554:return Ua+Aa(e,/([^-])(transform)/g,"$1-webkit-$2")+e;case 6187:return Aa(Aa(Aa(e,/(zoom-|grab)/,Ua+"$1"),/(image-set)/,Ua+"$1"),e,"")+e;case 5495:case 3959:return Aa(e,/(image-set\([^]*)/,Ua+"$1$`$1");case 4968:return Aa(Aa(e,/(.+:)(flex-)?(.*)/,"-webkit-box-pack:$3-ms-flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ua+e+e;case 4095:case 3583:case 4068:case 2532:return Aa(e,/(.+)-inline(.+)/,Ua+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(va(e)-1-t>6)switch(ma(e,t+1)){case 109:if(45!==ma(e,t+4))break;case 102:return Aa(e,/(.+:)(.+)-([^]+)/,"$1-webkit-$2-$3$1"+Da+(108==ma(e,t+3)?"$3":"$2-$3"))+e;case 115:return~pa(e,"stretch")?eo(Aa(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==ma(e,t+1))break;case 6444:switch(ma(e,va(e)-3-(~pa(e,"!important")&&10))){case 107:return Aa(e,":",":"+Ua)+e;case 101:return Aa(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Ua+(45===ma(e,14)?"inline-":"")+"box$3$1"+Ua+"$2$3$1"+Ja+"$2box$3")+e}break;case 5936:switch(ma(e,t+11)){case 114:return Ua+e+Ja+Aa(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Ua+e+Ja+Aa(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Ua+e+Ja+Aa(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return Ua+e+Ja+e+e}return e}function to(e){return Ka(no("",null,null,null,[""],e=Ma(e),0,[0],e))}function no(e,t,n,i,r,a,o,s,g){for(var l=0,u=0,c=o,I=0,C=0,d=0,h=1,A=1,p=1,m=0,f="",v=r,b=a,y=i,G=f;A;)switch(d=m,m=ka()){case 40:if(108!=d&&58==G.charCodeAt(c-1)){-1!=pa(G+=Aa(Na(m),"&","&\f"),"&\f")&&(p=-1);break}case 34:case 39:case 91:G+=Na(m);break;case 9:case 10:case 13:case 32:G+=za(d);break;case 92:G+=La(Ya()-1,7);continue;case 47:switch(Xa()){case 42:case 47:ya(ro(Ta(ka(),Ya()),t,n),g);break;default:G+="/"}break;case 123*h:s[l++]=va(G)*p;case 125*h:case 59:case 0:switch(m){case 0:case 125:A=0;case 59+u:C>0&&va(G)-c&&ya(C>32?ao(G+";",i,n,c-1):ao(Aa(G," ","")+";",i,n,c-2),g);break;case 59:G+=";";default:if(ya(y=io(G,t,n,l,u,r,s,f,v=[],b=[],c),a),123===m)if(0===u)no(G,t,y,y,v,a,c,s,b);else switch(I){case 100:case 109:case 115:no(e,y,y,i&&ya(io(e,y,y,0,0,r,s,f,r,v=[],c),b),r,b,c,s,i?v:b);break;default:no(G,y,y,y,[""],b,0,s,b)}}l=u=C=0,h=p=1,f=G="",c=o;break;case 58:c=1+va(G),C=d;default:if(h<1)if(123==m)--h;else if(125==m&&0==h++&&125==Va())continue;switch(G+=Ca(m),m*h){case 38:p=u>0?1:(G+="\f",-1);break;case 44:s[l++]=(va(G)-1)*p,p=1;break;case 64:45===Xa()&&(G+=Na(ka())),I=Xa(),u=c=va(f=G+=Ea(Ya())),m++;break;case 45:45===d&&2==va(G)&&(h=0)}}return a}function io(e,t,n,i,r,a,o,s,g,l,u){for(var c=r-1,I=0===r?a:[""],C=ba(I),d=0,h=0,A=0;d<i;++d)for(var p=0,m=fa(e,c+1,c=Ia(h=o[d])),f=e;p<C;++p)(f=ha(h>0?I[p]+" "+m:Aa(m,/&\f/g,I[p])))&&(g[A++]=f);return xa(e,t,n,0===r?Qa:s,g,l,u)}function ro(e,t,n){return xa(e,t,n,Pa,Ca(Sa),fa(e,2,-2),0)}function ao(e,t,n,i){return xa(e,t,n,Oa,fa(e,0,i),fa(e,i+1,-1),i)}var oo=function(e,t,n){for(var i=0,r=0;i=r,r=Xa(),38===i&&12===r&&(t[n]=1),!Fa(r);)ka();return Ha(e,wa)},so=function(e,t){return Ka(function(e,t){var n=-1,i=44;do{switch(Fa(i)){case 0:38===i&&12===Xa()&&(t[n]=1),e[n]+=oo(wa-1,t,n);break;case 2:e[n]+=Na(i);break;case 4:if(44===i){e[++n]=58===Xa()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=Ca(i)}}while(i=ka());return e}(Ma(e),t))},go=new WeakMap,lo=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,i=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||go.get(n))&&!i){go.set(e,!0);for(var r=[],a=so(t,r),o=n.props,s=0,g=0;s<a.length;s++)for(var l=0;l<o.length;l++,g++)e.props[g]=r[s]?a[s].replace(/&\f/g,o[l]):o[l]+" "+a[s]}}},uo=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},co=[function(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case Oa:e.return=eo(e.value,e.length);break;case ja:return qa([Ra(e,{value:Aa(e.value,"@","@"+Ua)})],i);case Qa:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return qa([Ra(e,{props:[Aa(t,/:(read-\w+)/,":-moz-$1")]})],i);case"::placeholder":return qa([Ra(e,{props:[Aa(t,/:(plac\w+)/,":-webkit-input-$1")]}),Ra(e,{props:[Aa(t,/:(plac\w+)/,":-moz-$1")]}),Ra(e,{props:[Aa(t,/:(plac\w+)/,Ja+"input-$1")]})],i)}return""}))}}],Io=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var i=e.stylisPlugins||co;var r,a,o={},s=[];r=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)o[t[n]]=!0;s.push(e)}));var g,l,u=[$a,(l=function(e){g.insert(e)},function(e){e.root||(e=e.return)&&l(e)})],c=function(e){var t=ba(e);return function(n,i,r,a){for(var o="",s=0;s<t;s++)o+=e[s](n,i,r,a)||"";return o}}([lo,uo].concat(i,u));a=function(e,t,n,i){g=n,function(e){qa(to(e),c)}(e?e+"{"+t.styles+"}":t.styles),i&&(I.inserted[t.name]=!0)};var I={key:t,sheet:new ca({key:t,container:r,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:o,registered:{},insert:a};return I.sheet.hydrate(s),I};var Co=function(e){for(var t,n=0,i=0,r=e.length;r>=4;++i,r-=4)t=1540483477*(65535&(t=255&e.charCodeAt(i)|(255&e.charCodeAt(++i))<<8|(255&e.charCodeAt(++i))<<16|(255&e.charCodeAt(++i))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(r){case 3:n^=(255&e.charCodeAt(i+2))<<16;case 2:n^=(255&e.charCodeAt(i+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(i)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)},ho={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Ao=/[A-Z]|^ms/g,po=/_EMO_([^_]+?)_([^]*?)_EMO_/g,mo=function(e){return 45===e.charCodeAt(1)},fo=function(e){return null!=e&&"boolean"!==typeof e},vo=ga((function(e){return mo(e)?e:e.replace(Ao,"-$&").toLowerCase()})),bo=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(po,(function(e,t,n){return Go={name:t,styles:n,next:Go},t}))}return 1===ho[e]||mo(e)||"number"!==typeof t||0===t?t:t+"px"};function yo(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return Go={name:n.name,styles:n.styles,next:Go},n.name;if(void 0!==n.styles){var i=n.next;if(void 0!==i)for(;void 0!==i;)Go={name:i.name,styles:i.styles,next:Go},i=i.next;return n.styles+";"}return function(e,t,n){var i="";if(Array.isArray(n))for(var r=0;r<n.length;r++)i+=yo(e,t,n[r])+";";else for(var a in n){var o=n[a];if("object"!==typeof o)null!=t&&void 0!==t[o]?i+=a+"{"+t[o]+"}":fo(o)&&(i+=vo(a)+":"+bo(a,o)+";");else if(!Array.isArray(o)||"string"!==typeof o[0]||null!=t&&void 0!==t[o[0]]){var s=yo(e,t,o);switch(a){case"animation":case"animationName":i+=vo(a)+":"+s+";";break;default:i+=a+"{"+s+"}"}}else for(var g=0;g<o.length;g++)fo(o[g])&&(i+=vo(a)+":"+bo(a,o[g])+";")}return i}(e,t,n);case"function":if(void 0!==e){var r=Go,a=n(e);return Go=r,yo(e,t,a)}}if(null==t)return n;var o=t[n];return void 0!==o?o:n}var Go,Bo=/label:\s*([^\s;\n{]+)\s*(;|$)/g;var Zo=function(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var i=!0,r="";Go=void 0;var a=e[0];null==a||void 0===a.raw?(i=!1,r+=yo(n,t,a)):r+=a[0];for(var o=1;o<e.length;o++)r+=yo(n,t,e[o]),i&&(r+=a[o]);Bo.lastIndex=0;for(var s,g="";null!==(s=Bo.exec(r));)g+="-"+s[1];return{name:Co(r)+g,styles:r,next:Go}},wo=(0,t.createContext)("undefined"!==typeof HTMLElement?Io({key:"css"}):null);wo.Provider;var So=function(e){return(0,t.forwardRef)((function(n,i){var r=(0,t.useContext)(wo);return e(n,r,i)}))},Wo=(0,t.createContext)({});i.useInsertionEffect&&i.useInsertionEffect;function xo(e,t,n){var i="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):i+=n+" "})),i}var Ro=function(e,t,n){var i=e.key+"-"+t.name;!1===n&&void 0===e.registered[i]&&(e.registered[i]=t.styles)},Vo=function(e,t,n){Ro(e,t,n);var i=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var r=t;do{e.insert(t===r?"."+i:"",r,e.sheet,!0);r=r.next}while(void 0!==r)}},ko=ua,Xo=function(e){return"theme"!==e},Yo=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?ko:Xo},Ho=function(e,t,n){var i;if(t){var r=t.shouldForwardProp;i=e.__emotion_forwardProp&&r?function(t){return e.__emotion_forwardProp(t)&&r(t)}:r}return"function"!==typeof i&&n&&(i=e.__emotion_forwardProp),i},Fo=i.useInsertionEffect?i.useInsertionEffect:function(e){e()};var Mo=function(e){var t=e.cache,n=e.serialized,i=e.isStringTag;Ro(t,n,i);!function(e){Fo(e)}((function(){return Vo(t,n,i)}));return null},Ko=function e(n,i){var r,a,o=n.__emotion_real===n,s=o&&n.__emotion_base||n;void 0!==i&&(r=i.label,a=i.target);var g=Ho(n,i,o),l=g||Yo(s),u=!l("as");return function(){var c=arguments,I=o&&void 0!==n.__emotion_styles?n.__emotion_styles.slice(0):[];if(void 0!==r&&I.push("label:"+r+";"),null==c[0]||void 0===c[0].raw)I.push.apply(I,c);else{0,I.push(c[0][0]);for(var C=c.length,d=1;d<C;d++)I.push(c[d],c[0][d])}var h=So((function(e,n,i){var r=u&&e.as||s,o="",c=[],C=e;if(null==e.theme){for(var d in C={},e)C[d]=e[d];C.theme=(0,t.useContext)(Wo)}"string"===typeof e.className?o=xo(n.registered,c,e.className):null!=e.className&&(o=e.className+" ");var h=Zo(I.concat(c),n.registered,C);o+=n.key+"-"+h.name,void 0!==a&&(o+=" "+a);var A=u&&void 0===g?Yo(r):l,p={};for(var m in e)u&&"as"===m||A(m)&&(p[m]=e[m]);return p.className=o,p.ref=i,(0,t.createElement)(t.Fragment,null,(0,t.createElement)(Mo,{cache:n,serialized:h,isStringTag:"string"===typeof r}),(0,t.createElement)(r,p))}));return h.displayName=void 0!==r?r:"Styled("+("string"===typeof s?s:s.displayName||s.name||"Component")+")",h.defaultProps=n.defaultProps,h.__emotion_real=h,h.__emotion_base=s,h.__emotion_styles=I,h.__emotion_forwardProp=g,Object.defineProperty(h,"toString",{value:function(){return"."+a}}),h.withComponent=function(t,n){return e(t,oa({},i,n,{shouldForwardProp:Ho(h,n,!0)})).apply(void 0,I)},h}},No=Ko.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){No[e]=No(e)}));var zo=No;function Lo(e,t){return zo(e,t)}function _o(e){return null!==e&&"object"===typeof e&&e.constructor===Object}function To(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0},i=n.clone?oa({},e):e;return _o(e)&&_o(t)&&Object.keys(t).forEach((function(r){"__proto__"!==r&&(_o(t[r])&&r in e&&_o(e[r])?i[r]=To(e[r],t[r],n):i[r]=t[r])})),i}function Eo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jo=["values","unit","step"];function Do(e){var t=e.values,n=void 0===t?{xs:0,sm:600,md:900,lg:1200,xl:1536}:t,i=e.unit,r=void 0===i?"px":i,a=e.step,o=void 0===a?5:a,s=sa(e,Jo),g=function(e){var t=Object.keys(e).map((function(t){return{key:t,val:e[t]}}))||[];return t.sort((function(e,t){return e.val-t.val})),t.reduce((function(e,t){return oa({},e,Eo({},t.key,t.val))}),{})}(n),l=Object.keys(g);function u(e){var t="number"===typeof n[e]?n[e]:e;return"@media (min-width:".concat(t).concat(r,")")}function c(e){var t="number"===typeof n[e]?n[e]:e;return"@media (max-width:".concat(t-o/100).concat(r,")")}function I(e,t){var i=l.indexOf(t);return"@media (min-width:".concat("number"===typeof n[e]?n[e]:e).concat(r,") and ")+"(max-width:".concat((-1!==i&&"number"===typeof n[l[i]]?n[l[i]]:t)-o/100).concat(r,")")}return oa({keys:l,values:g,up:u,down:c,between:I,only:function(e){return l.indexOf(e)+1<l.length?I(e,l[l.indexOf(e)+1]):u(e)},not:function(e){var t=l.indexOf(e);return 0===t?u(l[1]):t===l.length-1?c(l[t]):I(e,l[l.indexOf(e)+1]).replace("@media","@media not all and")},unit:r},s)}var Uo={borderRadius:4},Po={xs:0,sm:600,md:900,lg:1200,xl:1536},Qo={keys:["xs","sm","md","lg","xl"],up:function(e){return"@media (min-width:".concat(Po[e],"px)")}};function Oo(e,t,n){var i=e.theme||{};if(Array.isArray(t)){var r=i.breakpoints||Qo;return t.reduce((function(e,i,a){return e[r.up(r.keys[a])]=n(t[a]),e}),{})}if("object"===typeof t){var a=i.breakpoints||Qo;return Object.keys(t).reduce((function(e,i){if(-1!==Object.keys(a.values||Po).indexOf(i)){e[a.up(i)]=n(t[i],i)}else{var r=i;e[r]=t[r]}return e}),{})}return n(t)}function jo(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=null==(e=t.keys)?void 0:e.reduce((function(e,n){return e[t.up(n)]={},e}),{});return n||{}}function qo(e,t){return e.reduce((function(e,t){var n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function $o(e){for(var t="https://mui.com/production-error/?code="+e,n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}function es(e){if("string"!==typeof e)throw new Error($o(7));return e.charAt(0).toUpperCase()+e.slice(1)}function ts(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){var i="vars.".concat(t).split(".").reduce((function(e,t){return e&&e[t]?e[t]:null}),e);if(null!=i)return i}return t.split(".").reduce((function(e,t){return e&&null!=e[t]?e[t]:null}),e)}function ns(e,t,n){var i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return i="function"===typeof e?e(n):Array.isArray(e)?e[n]||r:ts(e,n)||r,t&&(i=t(i)),i}var is=function(e){var t=e.prop,n=e.cssProperty,i=void 0===n?e.prop:n,r=e.themeKey,a=e.transform,o=function(e){if(null==e[t])return null;var n=e[t],o=ts(e.theme,r)||{};return Oo(e,n,(function(e){var n=ns(o,a,e);return e===n&&"string"===typeof e&&(n=ns(o,a,"".concat(t).concat("default"===e?"":es(e)),e)),!1===i?n:Eo({},i,n)}))};return o.propTypes={},o.filterProps=[t],o};var rs=function(e,t){return t?To(e,t,{clone:!1}):e};var as={m:"margin",p:"padding"},os={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},ss={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},gs=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){if(e.length>2){if(!ss[e])return[e];e=ss[e]}var t=Ir(e.split(""),2),n=t[0],i=t[1],r=as[n],a=os[i]||"";return Array.isArray(a)?a.map((function(e){return r+e})):[r+a]})),ls=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],us=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],cs=[].concat(ls,us);function Is(e,t,n,i){var r,a=null!=(r=ts(e,t,!1))?r:n;return"number"===typeof a?function(e){return"string"===typeof e?e:a*e}:Array.isArray(a)?function(e){return"string"===typeof e?e:a[e]}:"function"===typeof a?a:function(){}}function Cs(e){return Is(e,"spacing",8)}function ds(e,t){if("string"===typeof t||null==t)return t;var n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:"-".concat(n)}function hs(e,t,n,i){if(-1===t.indexOf(n))return null;var r=function(e,t){return function(n){return e.reduce((function(e,i){return e[i]=ds(t,n),e}),{})}}(gs(n),i);return Oo(e,e[n],r)}function As(e,t){var n=Cs(e.theme);return Object.keys(e).map((function(i){return hs(e,t,i,n)})).reduce(rs,{})}function ps(e){return As(e,ls)}function ms(e){return As(e,us)}function fs(e){return As(e,cs)}ps.propTypes={},ps.filterProps=ls,ms.propTypes={},ms.filterProps=us,fs.propTypes={},fs.filterProps=cs;var vs=fs;function bs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;var t=Cs({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=0===n.length?[1]:n;return r.map((function(e){var n=t(e);return"number"===typeof n?"".concat(n,"px"):n})).join(" ")};return n.mui=!0,n}var ys=["breakpoints","palette","spacing","shape"];var Gs=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.breakpoints,n=void 0===t?{}:t,i=e.palette,r=void 0===i?{}:i,a=e.spacing,o=e.shape,s=void 0===o?{}:o,g=sa(e,ys),l=Do(n),u=bs(a),c=To({breakpoints:l,direction:"ltr",components:{},palette:oa({mode:"light"},r),spacing:u,shape:oa({},Uo,s)},g),I=arguments.length,C=new Array(I>1?I-1:0),d=1;d<I;d++)C[d-1]=arguments[d];return c=C.reduce((function(e,t){return To(e,t)}),c)},Bs=["variant"];function Zs(e){return 0===e.length}function ws(e){var t=e.variant,n=sa(e,Bs),i=t||"";return Object.keys(n).sort().forEach((function(t){i+="color"===t?Zs(i)?e[t]:es(e[t]):"".concat(Zs(i)?t:es(t)).concat(es(e[t].toString()))})),i}var Ss=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.reduce((function(e,t){return t.filterProps.forEach((function(n){e[n]=t})),e}),{}),r=function(e){return Object.keys(e).reduce((function(t,n){return i[n]?rs(t,i[n](e)):t}),{})};return r.propTypes={},r.filterProps=t.reduce((function(e,t){return e.concat(t.filterProps)}),[]),r};function Ws(e){return"number"!==typeof e?e:"".concat(e,"px solid")}var xs=is({prop:"border",themeKey:"borders",transform:Ws}),Rs=is({prop:"borderTop",themeKey:"borders",transform:Ws}),Vs=is({prop:"borderRight",themeKey:"borders",transform:Ws}),ks=is({prop:"borderBottom",themeKey:"borders",transform:Ws}),Xs=is({prop:"borderLeft",themeKey:"borders",transform:Ws}),Ys=is({prop:"borderColor",themeKey:"palette"}),Hs=is({prop:"borderTopColor",themeKey:"palette"}),Fs=is({prop:"borderRightColor",themeKey:"palette"}),Ms=is({prop:"borderBottomColor",themeKey:"palette"}),Ks=is({prop:"borderLeftColor",themeKey:"palette"}),Ns=function(e){if(void 0!==e.borderRadius&&null!==e.borderRadius){var t=Is(e.theme,"shape.borderRadius",4);return Oo(e,e.borderRadius,(function(e){return{borderRadius:ds(t,e)}}))}return null};Ns.propTypes={},Ns.filterProps=["borderRadius"];var zs=Ss(xs,Rs,Vs,ks,Xs,Ys,Hs,Fs,Ms,Ks,Ns),Ls=Ss(is({prop:"displayPrint",cssProperty:!1,transform:function(e){return{"@media print":{display:e}}}}),is({prop:"display"}),is({prop:"overflow"}),is({prop:"textOverflow"}),is({prop:"visibility"}),is({prop:"whiteSpace"})),_s=Ss(is({prop:"flexBasis"}),is({prop:"flexDirection"}),is({prop:"flexWrap"}),is({prop:"justifyContent"}),is({prop:"alignItems"}),is({prop:"alignContent"}),is({prop:"order"}),is({prop:"flex"}),is({prop:"flexGrow"}),is({prop:"flexShrink"}),is({prop:"alignSelf"}),is({prop:"justifyItems"}),is({prop:"justifySelf"})),Ts=function(e){if(void 0!==e.gap&&null!==e.gap){var t=Is(e.theme,"spacing",8);return Oo(e,e.gap,(function(e){return{gap:ds(t,e)}}))}return null};Ts.propTypes={},Ts.filterProps=["gap"];var Es=function(e){if(void 0!==e.columnGap&&null!==e.columnGap){var t=Is(e.theme,"spacing",8);return Oo(e,e.columnGap,(function(e){return{columnGap:ds(t,e)}}))}return null};Es.propTypes={},Es.filterProps=["columnGap"];var Js=function(e){if(void 0!==e.rowGap&&null!==e.rowGap){var t=Is(e.theme,"spacing",8);return Oo(e,e.rowGap,(function(e){return{rowGap:ds(t,e)}}))}return null};Js.propTypes={},Js.filterProps=["rowGap"];var Ds=Ss(Ts,Es,Js,is({prop:"gridColumn"}),is({prop:"gridRow"}),is({prop:"gridAutoFlow"}),is({prop:"gridAutoColumns"}),is({prop:"gridAutoRows"}),is({prop:"gridTemplateColumns"}),is({prop:"gridTemplateRows"}),is({prop:"gridTemplateAreas"}),is({prop:"gridArea"})),Us=Ss(is({prop:"position"}),is({prop:"zIndex",themeKey:"zIndex"}),is({prop:"top"}),is({prop:"right"}),is({prop:"bottom"}),is({prop:"left"})),Ps=Ss(is({prop:"color",themeKey:"palette"}),is({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette"}),is({prop:"backgroundColor",themeKey:"palette"})),Qs=is({prop:"boxShadow",themeKey:"shadows"});function Os(e){return e<=1&&0!==e?"".concat(100*e,"%"):e}var js=is({prop:"width",transform:Os}),qs=function(e){if(void 0!==e.maxWidth&&null!==e.maxWidth){return Oo(e,e.maxWidth,(function(t){var n,i,r;return{maxWidth:(null==(n=e.theme)||null==(i=n.breakpoints)||null==(r=i.values)?void 0:r[t])||Po[t]||Os(t)}}))}return null};qs.filterProps=["maxWidth"];var $s=is({prop:"minWidth",transform:Os}),eg=is({prop:"height",transform:Os}),tg=is({prop:"maxHeight",transform:Os}),ng=is({prop:"minHeight",transform:Os}),ig=(is({prop:"size",cssProperty:"width",transform:Os}),is({prop:"size",cssProperty:"height",transform:Os}),Ss(js,qs,$s,eg,tg,ng,is({prop:"boxSizing"}))),rg=is({prop:"fontFamily",themeKey:"typography"}),ag=is({prop:"fontSize",themeKey:"typography"}),og=is({prop:"fontStyle",themeKey:"typography"}),sg=is({prop:"fontWeight",themeKey:"typography"}),gg=is({prop:"letterSpacing"}),lg=is({prop:"textTransform"}),ug=is({prop:"lineHeight"}),cg=is({prop:"textAlign"}),Ig=Ss(is({prop:"typography",cssProperty:!1,themeKey:"typography"}),rg,ag,og,sg,gg,ug,cg,lg),Cg={borders:zs.filterProps,display:Ls.filterProps,flexbox:_s.filterProps,grid:Ds.filterProps,positions:Us.filterProps,palette:Ps.filterProps,shadows:Qs.filterProps,sizing:ig.filterProps,spacing:vs.filterProps,typography:Ig.filterProps},dg={borders:zs,display:Ls,flexbox:_s,grid:Ds,positions:Us,palette:Ps,shadows:Qs,sizing:ig,spacing:vs,typography:Ig},hg=Object.keys(Cg).reduce((function(e,t){return Cg[t].forEach((function(n){e[n]=dg[t]})),e}),{});function Ag(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.reduce((function(e,t){return e.concat(Object.keys(t))}),[]),r=new Set(i);return t.every((function(e){return r.size===Object.keys(e).length}))}function pg(e,t){return"function"===typeof e?e(t):e}var mg=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dg,t=Object.keys(e).reduce((function(t,n){return e[n].filterProps.forEach((function(i){t[i]=e[n]})),t}),{});function n(e,n,i){var r,a=(Eo(r={},e,n),Eo(r,"theme",i),r),o=t[e];return o?o(a):Eo({},e,n)}function i(e){var r=e||{},a=r.sx,o=r.theme,s=void 0===o?{}:o;if(!a)return null;function g(e){var r=e;if("function"===typeof e)r=e(s);else if("object"!==typeof e)return e;if(!r)return null;var a=jo(s.breakpoints),o=Object.keys(a),g=a;return Object.keys(r).forEach((function(e){var a=pg(r[e],s);if(null!==a&&void 0!==a)if("object"===typeof a)if(t[e])g=rs(g,n(e,a,s));else{var o=Oo({theme:s},a,(function(t){return Eo({},e,t)}));Ag(o,a)?g[e]=i({sx:a,theme:s}):g=rs(g,o)}else g=rs(g,n(e,a,s))})),qo(o,g)}return Array.isArray(a)?a.map(g):g(a)}return i}();mg.filterProps=["sx"];var fg=mg,vg=["name","slot","skipVariantsResolver","skipSx","overridesResolver"],bg=["theme"],yg=["theme"];function Gg(e){return 0===Object.keys(e).length}var Bg=function(e,t){return t.components&&t.components[e]&&t.components[e].styleOverrides?t.components[e].styleOverrides:null},Zg=function(e,t){var n=[];t&&t.components&&t.components[e]&&t.components[e].variants&&(n=t.components[e].variants);var i={};return n.forEach((function(e){var t=ws(e.props);i[t]=e.style})),i},wg=function(e,t,n,i){var r,a,o=e.ownerState,s=void 0===o?{}:o,g=[],l=null==n||null==(r=n.components)||null==(a=r[i])?void 0:a.variants;return l&&l.forEach((function(n){var i=!0;Object.keys(n.props).forEach((function(t){s[t]!==n.props[t]&&e[t]!==n.props[t]&&(i=!1)})),i&&g.push(t[ws(n.props)])})),g};function Sg(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}var Wg=Gs();function xg(e,t){var n;return oa({toolbar:(n={minHeight:56},Eo(n,e.up("xs"),{"@media (orientation: landscape)":{minHeight:48}}),Eo(n,e.up("sm"),{minHeight:64}),n)},t)}function Rg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function Vg(e){if(e.type)return e;if("#"===e.charAt(0))return Vg(function(e){e=e.slice(1);var t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g"),n=e.match(t);return n&&1===n[0].length&&(n=n.map((function(e){return e+e}))),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map((function(e,t){return t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3})).join(", "),")"):""}(e));var t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error($o(9,e));var i,r=e.substring(t+1,e.length-1);if("color"===n){if(i=(r=r.split(" ")).shift(),4===r.length&&"/"===r[3].charAt(0)&&(r[3]=r[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(i))throw new Error($o(10,i))}else r=r.split(",");return{type:n,values:r=r.map((function(e){return parseFloat(e)})),colorSpace:i}}function kg(e){var t=e.type,n=e.colorSpace,i=e.values;return-1!==t.indexOf("rgb")?i=i.map((function(e,t){return t<3?parseInt(e,10):e})):-1!==t.indexOf("hsl")&&(i[1]="".concat(i[1],"%"),i[2]="".concat(i[2],"%")),i=-1!==t.indexOf("color")?"".concat(n," ").concat(i.join(" ")):"".concat(i.join(", ")),"".concat(t,"(").concat(i,")")}function Xg(e){var t="hsl"===(e=Vg(e)).type?Vg(function(e){var t=(e=Vg(e)).values,n=t[0],i=t[1]/100,r=t[2]/100,a=i*Math.min(r,1-r),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return r-a*Math.max(Math.min(t-3,9-t,1),-1)},s="rgb",g=[Math.round(255*o(0)),Math.round(255*o(8)),Math.round(255*o(4))];return"hsla"===e.type&&(s+="a",g.push(t[3])),kg({type:s,values:g})}(e)).values:e.values;return t=t.map((function(t){return"color"!==e.type&&(t/=255),t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)})),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function Yg(e,t){return e=Vg(e),t=Rg(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]="/".concat(t):e.values[3]=t,kg(e)}function Hg(e,t){if(e=Vg(e),t=Rg(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(var n=0;n<3;n+=1)e.values[n]*=1-t;return kg(e)}function Fg(e,t){if(e=Vg(e),t=Rg(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(var i=0;i<3;i+=1)e.values[i]+=(1-e.values[i])*t;return kg(e)}var Mg={black:"#000",white:"#fff"},Kg={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Ng={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},zg={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},Lg={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},_g={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},Tg={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},Eg={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},Jg=["mode","contrastThreshold","tonalOffset"],Dg={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Mg.white,default:Mg.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},Ug={text:{primary:Mg.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Mg.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function Pg(e,t,n,i){var r=i.light||i,a=i.dark||1.5*i;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=Fg(e.main,r):"dark"===t&&(e.dark=Hg(e.main,a)))}function Qg(e){var t=e.mode,n=void 0===t?"light":t,i=e.contrastThreshold,r=void 0===i?3:i,a=e.tonalOffset,o=void 0===a?.2:a,s=sa(e,Jg),g=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:_g[200],light:_g[50],dark:_g[400]}:{main:_g[700],light:_g[400],dark:_g[800]}}(n),l=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Ng[200],light:Ng[50],dark:Ng[400]}:{main:Ng[500],light:Ng[300],dark:Ng[700]}}(n),u=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:zg[500],light:zg[300],dark:zg[700]}:{main:zg[700],light:zg[400],dark:zg[800]}}(n),c=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Tg[400],light:Tg[300],dark:Tg[700]}:{main:Tg[700],light:Tg[500],dark:Tg[900]}}(n),I=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Eg[400],light:Eg[300],dark:Eg[700]}:{main:Eg[800],light:Eg[500],dark:Eg[900]}}(n),C=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:Lg[400],light:Lg[300],dark:Lg[700]}:{main:"#ed6c02",light:Lg[500],dark:Lg[900]}}(n);function d(e){var t=function(e,t){var n=Xg(e),i=Xg(t);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)}(e,Ug.text.primary)>=r?Ug.text.primary:Dg.text.primary;return t}var h=function(e){var t=e.color,n=e.name,i=e.mainShade,r=void 0===i?500:i,a=e.lightShade,s=void 0===a?300:a,g=e.darkShade,l=void 0===g?700:g;if(!(t=oa({},t)).main&&t[r]&&(t.main=t[r]),!t.hasOwnProperty("main"))throw new Error($o(11,n?" (".concat(n,")"):"",r));if("string"!==typeof t.main)throw new Error($o(12,n?" (".concat(n,")"):"",JSON.stringify(t.main)));return Pg(t,"light",s,o),Pg(t,"dark",l,o),t.contrastText||(t.contrastText=d(t.main)),t},A={dark:Ug,light:Dg};return To(oa({common:oa({},Mg),mode:n,primary:h({color:g,name:"primary"}),secondary:h({color:l,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:h({color:u,name:"error"}),warning:h({color:C,name:"warning"}),info:h({color:c,name:"info"}),success:h({color:I,name:"success"}),grey:Kg,contrastThreshold:r,getContrastText:d,augmentColor:h,tonalOffset:o},A[n]),s)}var Og=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];var jg={textTransform:"uppercase"},qg='"Roboto", "Helvetica", "Arial", sans-serif';function $g(e,t){var n="function"===typeof t?t(e):t,i=n.fontFamily,r=void 0===i?qg:i,a=n.fontSize,o=void 0===a?14:a,s=n.fontWeightLight,g=void 0===s?300:s,l=n.fontWeightRegular,u=void 0===l?400:l,c=n.fontWeightMedium,I=void 0===c?500:c,C=n.fontWeightBold,d=void 0===C?700:C,h=n.htmlFontSize,A=void 0===h?16:h,p=n.allVariants,m=n.pxToRem,f=sa(n,Og);var v=o/14,b=m||function(e){return"".concat(e/A*v,"rem")},y=function(e,t,n,i,a){return oa({fontFamily:r,fontWeight:e,fontSize:b(t),lineHeight:n},r===qg?{letterSpacing:"".concat((o=i/t,Math.round(1e5*o)/1e5),"em")}:{},a,p);var o},G={h1:y(g,96,1.167,-1.5),h2:y(g,60,1.2,-.5),h3:y(u,48,1.167,0),h4:y(u,34,1.235,.25),h5:y(u,24,1.334,0),h6:y(I,20,1.6,.15),subtitle1:y(u,16,1.75,.15),subtitle2:y(I,14,1.57,.1),body1:y(u,16,1.5,.15),body2:y(u,14,1.43,.15),button:y(I,14,1.75,.4,jg),caption:y(u,12,1.66,.4),overline:y(u,12,2.66,1,jg)};return To(oa({htmlFontSize:A,pxToRem:b,fontFamily:r,fontSize:o,fontWeightLight:g,fontWeightRegular:u,fontWeightMedium:I,fontWeightBold:d},G),f,{clone:!1})}function el(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}var tl=["none",el(0,2,1,-1,0,1,1,0,0,1,3,0),el(0,3,1,-2,0,2,2,0,0,1,5,0),el(0,3,3,-2,0,3,4,0,0,1,8,0),el(0,2,4,-1,0,4,5,0,0,1,10,0),el(0,3,5,-1,0,5,8,0,0,1,14,0),el(0,3,5,-1,0,6,10,0,0,1,18,0),el(0,4,5,-2,0,7,10,1,0,2,16,1),el(0,5,5,-3,0,8,10,1,0,3,14,2),el(0,5,6,-3,0,9,12,1,0,3,16,2),el(0,6,6,-3,0,10,14,1,0,4,18,3),el(0,6,7,-4,0,11,15,1,0,4,20,3),el(0,7,8,-4,0,12,17,2,0,5,22,4),el(0,7,8,-4,0,13,19,2,0,5,24,4),el(0,7,9,-4,0,14,21,2,0,5,26,4),el(0,8,9,-5,0,15,22,2,0,6,28,5),el(0,8,10,-5,0,16,24,2,0,6,30,5),el(0,8,11,-5,0,17,26,2,0,6,32,5),el(0,9,11,-5,0,18,28,2,0,7,34,6),el(0,9,12,-6,0,19,29,2,0,7,36,6),el(0,10,13,-6,0,20,31,3,0,8,38,7),el(0,10,13,-6,0,21,33,3,0,8,40,7),el(0,10,14,-6,0,22,35,3,0,8,42,7),el(0,11,14,-7,0,23,36,3,0,9,44,8),el(0,11,15,-7,0,24,38,3,0,9,46,8)],nl=["duration","easing","delay"],il={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},rl={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function al(e){return"".concat(Math.round(e),"ms")}function ol(e){if(!e)return 0;var t=e/36;return Math.round(10*(4+15*Math.pow(t,.25)+t/5))}function sl(e){var t=oa({},il,e.easing),n=oa({},rl,e.duration);return oa({getAutoHeightDuration:ol,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.duration,a=void 0===r?n.standard:r,o=i.easing,s=void 0===o?t.easeInOut:o,g=i.delay,l=void 0===g?0:g;sa(i,nl);return(Array.isArray(e)?e:[e]).map((function(e){return"".concat(e," ").concat("string"===typeof a?a:al(a)," ").concat(s," ").concat("string"===typeof l?l:al(l))})).join(",")}},e,{easing:t,duration:n})}var gl={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},ll=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function ul(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mixins,n=void 0===t?{}:t,i=e.palette,r=void 0===i?{}:i,a=e.transitions,o=void 0===a?{}:a,s=e.typography,g=void 0===s?{}:s,l=sa(e,ll),u=Qg(r),c=Gs(e),I=To(c,{mixins:xg(c.breakpoints,n),palette:u,shadows:tl.slice(),typography:$g(u,g),transitions:sl(o),zIndex:oa({},gl)});I=To(I,l);for(var C=arguments.length,d=new Array(C>1?C-1:0),h=1;h<C;h++)d[h-1]=arguments[h];return I=d.reduce((function(e,t){return To(e,t)}),I)}var cl=ul,Il=cl(),Cl=function(e){return Sg(e)&&"classes"!==e},dl=Sg,hl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.defaultTheme,n=void 0===t?Wg:t,i=e.rootShouldForwardProp,r=void 0===i?Sg:i,a=e.slotShouldForwardProp,o=void 0===a?Sg:a,s=e.styleFunctionSx,g=void 0===s?fg:s;return function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.name,s=i.slot,l=i.skipVariantsResolver,u=i.skipSx,c=i.overridesResolver,I=sa(i,vg),C=void 0!==l?l:s&&"Root"!==s||!1,d=u||!1;var h=Sg;"Root"===s?h=r:s&&(h=o);var A=Lo(e,oa({shouldForwardProp:h,label:t},I)),p=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var o=i?i.map((function(e){return"function"===typeof e&&e.__emotion_real!==e?function(t){var i=t.theme,r=sa(t,bg);return e(oa({theme:Gg(i)?n:i},r))}:e})):[],s=e;a&&c&&o.push((function(e){var t=Gg(e.theme)?n:e.theme,i=Bg(a,t);if(i){var r={};return Object.entries(i).forEach((function(n){var i=Ir(n,2),a=i[0],o=i[1];r[a]="function"===typeof o?o(oa({},e,{theme:t})):o})),c(e,r)}return null})),a&&!C&&o.push((function(e){var t=Gg(e.theme)?n:e.theme;return wg(e,Zg(a,t),t,a)})),d||o.push((function(e){var t=Gg(e.theme)?n:e.theme;return g(oa({},e,{theme:t}))}));var l=o.length-i.length;if(Array.isArray(e)&&l>0){var u=new Array(l).fill("");(s=[].concat(Ci(e),Ci(u))).raw=[].concat(Ci(e.raw),Ci(u))}else"function"===typeof e&&e.__emotion_real!==e&&(s=function(t){var i=t.theme,r=sa(t,yg);return e(oa({theme:Gg(i)?n:i},r))});var I=A.apply(void 0,[s].concat(Ci(o)));return I};return A.withConfig&&(p.withConfig=A.withConfig),p}}({defaultTheme:Il,rootShouldForwardProp:Cl}),Al=hl;function pl(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=pl(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}var ml=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=pl(e))&&(i&&(i+=" "),i+=t);return i};function fl(e,t,n){var i={};return Object.keys(e).forEach((function(r){i[r]=e[r].reduce((function(e,i){return i&&(n&&n[i]&&e.push(n[i]),e.push(t(i))),e}),[]).join(" ")})),i}var vl=0;var bl=i.useId;function yl(e){if(void 0!==bl){var n=bl();return null!=e?e:n}return function(e){var n=Ir(t.useState(e),2),i=n[0],r=n[1],a=e||i;return t.useEffect((function(){null==i&&r("mui-".concat(vl+=1))}),[i]),a}(e)}function Gl(e){var t=e.theme,n=e.name,i=e.props;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?function(e,t){var n=oa({},t);return Object.keys(e).forEach((function(t){void 0===n[t]&&(n[t]=e[t])})),n}(t.components[n].defaultProps,i):i}var Bl=t.createContext(null);function Zl(){return t.useContext(Bl)}function wl(e){return 0===Object.keys(e).length}var Sl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=Zl();return!t||wl(t)?e:t},Wl=Gs();var xl=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wl;return Sl(e)};function Rl(e){return function(e){var t=e.props,n=e.name,i=e.defaultTheme;return Gl({theme:xl(i),name:n,props:t})}({props:e.props,name:e.name,defaultTheme:Il})}var Vl=n(4164);function kl(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function Xl(e,n){return t.useMemo((function(){return null==e&&null==n?null:function(t){kl(e,t),kl(n,t)}}),[e,n])}function Yl(e){return e&&e.ownerDocument||document}function Hl(e){return Yl(e).defaultView||window}function Fl(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function i(){for(var i=this,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var s=function(){e.apply(i,a)};clearTimeout(t),t=setTimeout(s,n)}return i.clear=function(){clearTimeout(t)},i}var Ml="undefined"!==typeof window?t.useLayoutEffect:t.useEffect,Kl=n(184),Nl=["onChange","maxRows","minRows","style","value"];function zl(e,t){return parseInt(e[t],10)||0}var Ll={visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"};function _l(e){return void 0===e||null===e||0===Object.keys(e).length}var Tl=t.forwardRef((function(e,n){var i=e.onChange,r=e.maxRows,a=e.minRows,o=void 0===a?1:a,s=e.style,g=e.value,l=sa(e,Nl),u=t.useRef(null!=g).current,c=t.useRef(null),I=Xl(n,c),C=t.useRef(null),d=t.useRef(0),h=Ir(t.useState({}),2),A=h[0],p=h[1],m=t.useCallback((function(){var t=c.current,n=Hl(t).getComputedStyle(t);if("0px"===n.width)return{};var i=C.current;i.style.width=n.width,i.value=t.value||e.placeholder||"x","\n"===i.value.slice(-1)&&(i.value+=" ");var a=n["box-sizing"],s=zl(n,"padding-bottom")+zl(n,"padding-top"),g=zl(n,"border-bottom-width")+zl(n,"border-top-width"),l=i.scrollHeight;i.value="x";var u=i.scrollHeight,I=l;return o&&(I=Math.max(Number(o)*u,I)),r&&(I=Math.min(Number(r)*u,I)),{outerHeightStyle:(I=Math.max(I,u))+("border-box"===a?s+g:0),overflow:Math.abs(I-l)<=1}}),[r,o,e.placeholder]),f=function(e,t){var n=t.outerHeightStyle,i=t.overflow;return d.current<20&&(n>0&&Math.abs((e.outerHeightStyle||0)-n)>1||e.overflow!==i)?(d.current+=1,{overflow:i,outerHeightStyle:n}):e},v=t.useCallback((function(){var e=m();_l(e)||p((function(t){return f(t,e)}))}),[m]);t.useEffect((function(){var e,t=Fl((function(){d.current=0,c.current&&function(){var e=m();_l(e)||(0,Vl.flushSync)((function(){p((function(t){return f(t,e)}))}))}()})),n=Hl(c.current);return n.addEventListener("resize",t),"undefined"!==typeof ResizeObserver&&(e=new ResizeObserver(t)).observe(c.current),function(){t.clear(),n.removeEventListener("resize",t),e&&e.disconnect()}})),Ml((function(){v()})),t.useEffect((function(){d.current=0}),[g]);return(0,Kl.jsxs)(t.Fragment,{children:[(0,Kl.jsx)("textarea",oa({value:g,onChange:function(e){d.current=0,u||v(),i&&i(e)},ref:I,rows:o,style:oa({height:A.outerHeightStyle,overflow:A.overflow?"hidden":null},s)},l)),(0,Kl.jsx)("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:C,tabIndex:-1,style:oa({},Ll,s,{padding:0})})]})})),El=Tl;var Jl=function(e){return"string"===typeof e};function Dl(e){var t=e.props,n=e.states,i=e.muiFormControl;return n.reduce((function(e,n){return e[n]=t[n],i&&"undefined"===typeof t[n]&&(e[n]=i[n]),e}),{})}var Ul=t.createContext();function Pl(){return t.useContext(Ul)}var Ql=es,Ol=Xl,jl=Ml,ql=i.useInsertionEffect?i.useInsertionEffect:t.useLayoutEffect,$l=So((function(e,n){var i=e.styles,r=Zo([i],void 0,(0,t.useContext)(Wo)),a=(0,t.useRef)();return ql((function(){var e=n.key+"-global",t=new n.sheet.constructor({key:e,nonce:n.sheet.nonce,container:n.sheet.container,speedy:n.sheet.isSpeedy}),i=!1,o=document.querySelector('style[data-emotion="'+e+" "+r.name+'"]');return n.sheet.tags.length&&(t.before=n.sheet.tags[0]),null!==o&&(i=!0,o.setAttribute("data-emotion",e),t.hydrate([o])),a.current=[t,i],function(){t.flush()}}),[n]),ql((function(){var e=a.current,t=e[0];if(e[1])e[1]=!1;else{if(void 0!==r.next&&Vo(n,r.next,!0),t.tags.length){var i=t.tags[t.tags.length-1].nextElementSibling;t.before=i,t.flush()}n.insert("",r,t,!1)}}),[n,r.name]),null}));function eu(e){var t=e.styles,n=e.defaultTheme,i=void 0===n?{}:n,r="function"===typeof t?function(e){return t(void 0===(n=e)||null===n||0===Object.keys(n).length?i:e);var n}:t;return(0,Kl.jsx)($l,{styles:r})}var tu=function(e){return(0,Kl.jsx)(eu,oa({},e,{defaultTheme:Il}))};function nu(e){return null!=e&&!(Array.isArray(e)&&0===e.length)}function iu(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&(nu(e.value)&&""!==e.value||t&&nu(e.defaultValue)&&""!==e.defaultValue)}var ru=function(e){return e},au=function(){var e=ru;return{configure:function(t){e=t},generate:function(t){return e(t)},reset:function(){e=ru}}}(),ou={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function su(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",i=ou[t];return i?"".concat(n,"-").concat(i):"".concat(au.generate(e),"-").concat(t)}function gu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",i={};return t.forEach((function(t){i[t]=su(e,t,n)})),i}function lu(e){return su("MuiInputBase",e)}var uu=gu("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]),cu=["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","startAdornment","type","value"],Iu=function(e,t){var n=e.ownerState;return[t.root,n.formControl&&t.formControl,n.startAdornment&&t.adornedStart,n.endAdornment&&t.adornedEnd,n.error&&t.error,"small"===n.size&&t.sizeSmall,n.multiline&&t.multiline,n.color&&t["color".concat(Ql(n.color))],n.fullWidth&&t.fullWidth,n.hiddenLabel&&t.hiddenLabel]},Cu=function(e,t){var n=e.ownerState;return[t.input,"small"===n.size&&t.inputSizeSmall,n.multiline&&t.inputMultiline,"search"===n.type&&t.inputTypeSearch,n.startAdornment&&t.inputAdornedStart,n.endAdornment&&t.inputAdornedEnd,n.hiddenLabel&&t.inputHiddenLabel]},du=Al("div",{name:"MuiInputBase",slot:"Root",overridesResolver:Iu})((function(e){var t=e.theme,n=e.ownerState;return oa({},t.typography.body1,Eo({color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center"},"&.".concat(uu.disabled),{color:(t.vars||t).palette.text.disabled,cursor:"default"}),n.multiline&&oa({padding:"4px 0 5px"},"small"===n.size&&{paddingTop:1}),n.fullWidth&&{width:"100%"})})),hu=Al("input",{name:"MuiInputBase",slot:"Input",overridesResolver:Cu})((function(e){var t,n=e.theme,i=e.ownerState,r="light"===n.palette.mode,a=oa({color:"currentColor"},n.vars?{opacity:n.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5},{transition:n.transitions.create("opacity",{duration:n.transitions.duration.shorter})}),o={opacity:"0 !important"},s=n.vars?{opacity:n.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5};return oa((Eo(t={font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":a,"&::-moz-placeholder":a,"&:-ms-input-placeholder":a,"&::-ms-input-placeholder":a,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"}},"label[data-shrink=false] + .".concat(uu.formControl," &"),{"&::-webkit-input-placeholder":o,"&::-moz-placeholder":o,"&:-ms-input-placeholder":o,"&::-ms-input-placeholder":o,"&:focus::-webkit-input-placeholder":s,"&:focus::-moz-placeholder":s,"&:focus:-ms-input-placeholder":s,"&:focus::-ms-input-placeholder":s}),Eo(t,"&.".concat(uu.disabled),{opacity:1,WebkitTextFillColor:(n.vars||n).palette.text.disabled}),Eo(t,"&:-webkit-autofill",{animationDuration:"5000s",animationName:"mui-auto-fill"}),t),"small"===i.size&&{paddingTop:1},i.multiline&&{height:"auto",resize:"none",padding:0,paddingTop:0},"search"===i.type&&{MozAppearance:"textfield"})})),Au=(0,Kl.jsx)(tu,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),pu=t.forwardRef((function(e,n){var i=Rl({props:e,name:"MuiInputBase"}),r=i["aria-describedby"],a=i.autoComplete,o=i.autoFocus,s=i.className,g=i.components,l=void 0===g?{}:g,u=i.componentsProps,c=void 0===u?{}:u,I=i.defaultValue,C=i.disabled,d=i.disableInjectingGlobalStyles,h=i.endAdornment,A=i.fullWidth,p=void 0!==A&&A,m=i.id,f=i.inputComponent,v=void 0===f?"input":f,b=i.inputProps,y=void 0===b?{}:b,G=i.inputRef,B=i.maxRows,Z=i.minRows,w=i.multiline,S=void 0!==w&&w,W=i.name,x=i.onBlur,R=i.onChange,V=i.onClick,k=i.onFocus,X=i.onKeyDown,Y=i.onKeyUp,H=i.placeholder,F=i.readOnly,M=i.renderSuffix,K=i.rows,N=i.startAdornment,z=i.type,L=void 0===z?"text":z,_=i.value,T=sa(i,cu),E=null!=y.value?y.value:_,J=t.useRef(null!=E).current,D=t.useRef(),U=t.useCallback((function(e){0}),[]),P=Ol(y.ref,U),Q=Ol(G,P),O=Ol(D,Q),j=Ir(t.useState(!1),2),q=j[0],$=j[1],ee=Pl();var te=Dl({props:i,muiFormControl:ee,states:["color","disabled","error","hiddenLabel","size","required","filled"]});te.focused=ee?ee.focused:q,t.useEffect((function(){!ee&&C&&q&&($(!1),x&&x())}),[ee,C,q,x]);var ne=ee&&ee.onFilled,ie=ee&&ee.onEmpty,re=t.useCallback((function(e){iu(e)?ne&&ne():ie&&ie()}),[ne,ie]);jl((function(){J&&re({value:E})}),[E,re,J]);t.useEffect((function(){re(D.current)}),[]);var ae=v,oe=y;S&&"input"===ae&&(oe=oa(K?{type:void 0,minRows:K,maxRows:K}:{type:void 0,maxRows:B,minRows:Z},oe),ae=El);t.useEffect((function(){ee&&ee.setAdornedStart(Boolean(N))}),[ee,N]);var se=oa({},i,{color:te.color||"primary",disabled:te.disabled,endAdornment:h,error:te.error,focused:te.focused,formControl:ee,fullWidth:p,hiddenLabel:te.hiddenLabel,multiline:S,size:te.size,startAdornment:N,type:L}),ge=function(e){var t=e.classes,n=e.color,i=e.disabled,r=e.error,a=e.endAdornment,o=e.focused,s=e.formControl,g=e.fullWidth,l=e.hiddenLabel,u=e.multiline,c=e.size,I=e.startAdornment,C=e.type;return fl({root:["root","color".concat(Ql(n)),i&&"disabled",r&&"error",g&&"fullWidth",o&&"focused",s&&"formControl","small"===c&&"sizeSmall",u&&"multiline",I&&"adornedStart",a&&"adornedEnd",l&&"hiddenLabel"],input:["input",i&&"disabled","search"===C&&"inputTypeSearch",u&&"inputMultiline","small"===c&&"inputSizeSmall",l&&"inputHiddenLabel",I&&"inputAdornedStart",a&&"inputAdornedEnd"]},lu,t)}(se),le=l.Root||du,ue=c.root||{},ce=l.Input||hu;return oe=oa({},oe,c.input),(0,Kl.jsxs)(t.Fragment,{children:[!d&&Au,(0,Kl.jsxs)(le,oa({},ue,!Jl(le)&&{ownerState:oa({},se,ue.ownerState)},{ref:n,onClick:function(e){D.current&&e.currentTarget===e.target&&D.current.focus(),V&&V(e)}},T,{className:ml(ge.root,ue.className,s),children:[N,(0,Kl.jsx)(Ul.Provider,{value:null,children:(0,Kl.jsx)(ce,oa({ownerState:se,"aria-invalid":te.error,"aria-describedby":r,autoComplete:a,autoFocus:o,defaultValue:I,disabled:te.disabled,id:m,onAnimationStart:function(e){re("mui-auto-fill-cancel"===e.animationName?D.current:{value:"x"})},name:W,placeholder:H,readOnly:F,required:te.required,rows:K,value:E,onKeyDown:X,onKeyUp:Y,type:L},oe,!Jl(ce)&&{as:ae,ownerState:oa({},se,oe.ownerState)},{ref:O,className:ml(ge.input,oe.className),onBlur:function(e){x&&x(e),y.onBlur&&y.onBlur(e),ee&&ee.onBlur?ee.onBlur(e):$(!1)},onChange:function(e){if(!J){var t=e.target||D.current;if(null==t)throw new Error($o(1));re({value:t.value})}for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];y.onChange&&y.onChange.apply(y,[e].concat(i)),R&&R.apply(void 0,[e].concat(i))},onFocus:function(e){te.disabled?e.stopPropagation():(k&&k(e),y.onFocus&&y.onFocus(e),ee&&ee.onFocus?ee.onFocus(e):$(!0))}}))}),h,M?M(oa({},te,{startAdornment:N})):null]}))]})})),mu=pu;function fu(e){return su("MuiInput",e)}var vu=oa({},uu,gu("MuiInput",["root","underline","input"])),bu=["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","type"],yu=Al(du,{shouldForwardProp:function(e){return Cl(e)||"classes"===e},name:"MuiInput",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[].concat(Ci(Iu(e,t)),[!n.disableUnderline&&t.underline])}})((function(e){var t,n=e.theme,i=e.ownerState,r="light"===n.palette.mode?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return n.vars&&(r="rgba(".concat(n.vars.palette.common.onBackgroundChannel," / ").concat(n.vars.opacity.inputUnderline,")")),oa({position:"relative"},i.formControl&&{"label + &":{marginTop:16}},!i.disableUnderline&&(Eo(t={"&:after":{borderBottom:"2px solid ".concat((n.vars||n).palette[i.color].main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:n.transitions.create("transform",{duration:n.transitions.duration.shorter,easing:n.transitions.easing.easeOut}),pointerEvents:"none"}},"&.".concat(vu.focused,":after"),{transform:"scaleX(1) translateX(0)"}),Eo(t,"&.".concat(vu.error,":after"),{borderBottomColor:(n.vars||n).palette.error.main,transform:"scaleX(1)"}),Eo(t,"&:before",{borderBottom:"1px solid ".concat(r),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:n.transitions.create("border-bottom-color",{duration:n.transitions.duration.shorter}),pointerEvents:"none"}),Eo(t,"&:hover:not(.".concat(vu.disabled,"):before"),{borderBottom:"2px solid ".concat((n.vars||n).palette.text.primary),"@media (hover: none)":{borderBottom:"1px solid ".concat(r)}}),Eo(t,"&.".concat(vu.disabled,":before"),{borderBottomStyle:"dotted"}),t))})),Gu=Al(hu,{name:"MuiInput",slot:"Input",overridesResolver:Cu})({}),Bu=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiInput"}),i=n.disableUnderline,r=n.components,a=void 0===r?{}:r,o=n.componentsProps,s=n.fullWidth,g=void 0!==s&&s,l=n.inputComponent,u=void 0===l?"input":l,c=n.multiline,I=void 0!==c&&c,C=n.type,d=void 0===C?"text":C,h=sa(n,bu),A=function(e){var t=e.classes;return oa({},t,fl({root:["root",!e.disableUnderline&&"underline"],input:["input"]},fu,t))}(n),p={root:{ownerState:{disableUnderline:i}}},m=o?To(o,p):p;return(0,Kl.jsx)(mu,oa({components:oa({Root:yu,Input:Gu},a),componentsProps:m,fullWidth:g,inputComponent:u,multiline:I,ref:t,type:d},h,{classes:A}))}));Bu.muiName="Input";var Zu=Bu;function wu(e){return su("MuiFilledInput",e)}var Su=oa({},uu,gu("MuiFilledInput",["root","underline","input"])),Wu=["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","type"],xu=Al(du,{shouldForwardProp:function(e){return Cl(e)||"classes"===e},name:"MuiFilledInput",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[].concat(Ci(Iu(e,t)),[!n.disableUnderline&&t.underline])}})((function(e){var t,n,i,r=e.theme,a=e.ownerState,o="light"===r.palette.mode,s=o?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",g=o?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",l=o?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",u=o?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return oa((Eo(t={position:"relative",backgroundColor:r.vars?r.vars.palette.FilledInput.bg:g,borderTopLeftRadius:(r.vars||r).shape.borderRadius,borderTopRightRadius:(r.vars||r).shape.borderRadius,transition:r.transitions.create("background-color",{duration:r.transitions.duration.shorter,easing:r.transitions.easing.easeOut}),"&:hover":{backgroundColor:r.vars?r.vars.palette.FilledInput.hoverBg:l,"@media (hover: none)":{backgroundColor:r.vars?r.vars.palette.FilledInput.bg:g}}},"&.".concat(Su.focused),{backgroundColor:r.vars?r.vars.palette.FilledInput.bg:g}),Eo(t,"&.".concat(Su.disabled),{backgroundColor:r.vars?r.vars.palette.FilledInput.disabledBg:u}),t),!a.disableUnderline&&(Eo(n={"&:after":{borderBottom:"2px solid ".concat(null==(i=(r.vars||r).palette[a.color||"primary"])?void 0:i.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:r.transitions.create("transform",{duration:r.transitions.duration.shorter,easing:r.transitions.easing.easeOut}),pointerEvents:"none"}},"&.".concat(Su.focused,":after"),{transform:"scaleX(1) translateX(0)"}),Eo(n,"&.".concat(Su.error,":after"),{borderBottomColor:(r.vars||r).palette.error.main,transform:"scaleX(1)"}),Eo(n,"&:before",{borderBottom:"1px solid ".concat(r.vars?"rgba(".concat(r.vars.palette.common.onBackgroundChannel," / ").concat(r.vars.opacity.inputUnderline,")"):s),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:r.transitions.create("border-bottom-color",{duration:r.transitions.duration.shorter}),pointerEvents:"none"}),Eo(n,"&:hover:not(.".concat(Su.disabled,"):before"),{borderBottom:"1px solid ".concat((r.vars||r).palette.text.primary)}),Eo(n,"&.".concat(Su.disabled,":before"),{borderBottomStyle:"dotted"}),n),a.startAdornment&&{paddingLeft:12},a.endAdornment&&{paddingRight:12},a.multiline&&oa({padding:"25px 12px 8px"},"small"===a.size&&{paddingTop:21,paddingBottom:4},a.hiddenLabel&&{paddingTop:16,paddingBottom:17}))})),Ru=Al(hu,{name:"MuiFilledInput",slot:"Input",overridesResolver:Cu})((function(e){var t=e.theme,n=e.ownerState;return oa({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},t.vars&&Eo({"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},t.getColorSchemeSelector("dark"),{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}),"small"===n.size&&{paddingTop:21,paddingBottom:4},n.hiddenLabel&&{paddingTop:16,paddingBottom:17},n.multiline&&{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0},n.hiddenLabel&&"small"===n.size&&{paddingTop:8,paddingBottom:9})})),Vu=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiFilledInput"}),i=n.components,r=void 0===i?{}:i,a=n.componentsProps,o=n.fullWidth,s=void 0!==o&&o,g=n.inputComponent,l=void 0===g?"input":g,u=n.multiline,c=void 0!==u&&u,I=n.type,C=void 0===I?"text":I,d=sa(n,Wu),h=oa({},n,{fullWidth:s,inputComponent:l,multiline:c,type:C}),A=function(e){var t=e.classes;return oa({},t,fl({root:["root",!e.disableUnderline&&"underline"],input:["input"]},wu,t))}(n),p={root:{ownerState:h},input:{ownerState:h}},m=a?To(a,p):p;return(0,Kl.jsx)(mu,oa({components:oa({Root:xu,Input:Ru},r),componentsProps:m,fullWidth:s,inputComponent:l,multiline:c,ref:t,type:C},d,{classes:A}))}));Vu.muiName="Input";var ku,Xu=Vu,Yu=["children","classes","className","label","notched"],Hu=Al("fieldset")({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Fu=Al("legend")((function(e){var t=e.ownerState,n=e.theme;return oa({float:"unset",overflow:"hidden"},!t.withLabel&&{padding:0,lineHeight:"11px",transition:n.transitions.create("width",{duration:150,easing:n.transitions.easing.easeOut})},t.withLabel&&oa({display:"block",width:"auto",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:n.transitions.create("max-width",{duration:50,easing:n.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}},t.notched&&{maxWidth:"100%",transition:n.transitions.create("max-width",{duration:100,easing:n.transitions.easing.easeOut,delay:50})}))}));function Mu(e){return su("MuiOutlinedInput",e)}var Ku=oa({},uu,gu("MuiOutlinedInput",["root","notchedOutline","input"])),Nu=["components","fullWidth","inputComponent","label","multiline","notched","type"],zu=Al(du,{shouldForwardProp:function(e){return Cl(e)||"classes"===e},name:"MuiOutlinedInput",slot:"Root",overridesResolver:Iu})((function(e){var t,n=e.theme,i=e.ownerState,r="light"===n.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return oa((Eo(t={position:"relative",borderRadius:(n.vars||n).shape.borderRadius},"&:hover .".concat(Ku.notchedOutline),{borderColor:(n.vars||n).palette.text.primary}),Eo(t,"@media (hover: none)",Eo({},"&:hover .".concat(Ku.notchedOutline),{borderColor:n.vars?"rgba(".concat(n.vars.palette.common.onBackgroundChannel," / 0.23)"):r})),Eo(t,"&.".concat(Ku.focused," .").concat(Ku.notchedOutline),{borderColor:(n.vars||n).palette[i.color].main,borderWidth:2}),Eo(t,"&.".concat(Ku.error," .").concat(Ku.notchedOutline),{borderColor:(n.vars||n).palette.error.main}),Eo(t,"&.".concat(Ku.disabled," .").concat(Ku.notchedOutline),{borderColor:(n.vars||n).palette.action.disabled}),t),i.startAdornment&&{paddingLeft:14},i.endAdornment&&{paddingRight:14},i.multiline&&oa({padding:"16.5px 14px"},"small"===i.size&&{padding:"8.5px 14px"}))})),Lu=Al((function(e){var t=e.className,n=e.label,i=e.notched,r=sa(e,Yu),a=null!=n&&""!==n,o=oa({},e,{notched:i,withLabel:a});return(0,Kl.jsx)(Hu,oa({"aria-hidden":!0,className:t,ownerState:o},r,{children:(0,Kl.jsx)(Fu,{ownerState:o,children:a?(0,Kl.jsx)("span",{children:n}):ku||(ku=(0,Kl.jsx)("span",{className:"notranslate",children:"\u200b"}))})}))}),{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:function(e,t){return t.notchedOutline}})((function(e){var t=e.theme,n="light"===t.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?"rgba(".concat(t.vars.palette.common.onBackgroundChannel," / 0.23)"):n}})),_u=Al(hu,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:Cu})((function(e){var t=e.theme,n=e.ownerState;return oa({padding:"16.5px 14px"},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:"light"===t.palette.mode?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:"light"===t.palette.mode?null:"#fff",caretColor:"light"===t.palette.mode?null:"#fff",borderRadius:"inherit"}},t.vars&&Eo({"&:-webkit-autofill":{borderRadius:"inherit"}},t.getColorSchemeSelector("dark"),{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}),"small"===n.size&&{padding:"8.5px 14px"},n.multiline&&{padding:0},n.startAdornment&&{paddingLeft:0},n.endAdornment&&{paddingRight:0})})),Tu=t.forwardRef((function(e,n){var i,r=Rl({props:e,name:"MuiOutlinedInput"}),a=r.components,o=void 0===a?{}:a,s=r.fullWidth,g=void 0!==s&&s,l=r.inputComponent,u=void 0===l?"input":l,c=r.label,I=r.multiline,C=void 0!==I&&I,d=r.notched,h=r.type,A=void 0===h?"text":h,p=sa(r,Nu),m=function(e){var t=e.classes;return oa({},t,fl({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},Mu,t))}(r),f=Pl(),v=Dl({props:r,muiFormControl:f,states:["required"]}),b=oa({},r,{color:v.color||"primary",disabled:v.disabled,error:v.error,focused:v.focused,formControl:f,fullWidth:g,hiddenLabel:v.hiddenLabel,multiline:C,size:v.size,type:A});return(0,Kl.jsx)(mu,oa({components:oa({Root:zu,Input:_u},o),renderSuffix:function(e){return(0,Kl.jsx)(Lu,{ownerState:b,className:m.notchedOutline,label:null!=c&&""!==c&&v.required?i||(i=(0,Kl.jsxs)(t.Fragment,{children:[c,"\xa0","*"]})):c,notched:"undefined"!==typeof d?d:Boolean(e.startAdornment||e.filled||e.focused)})},fullWidth:g,inputComponent:u,multiline:C,ref:n,type:A},p,{classes:oa({},m,{notchedOutline:null})}))}));Tu.muiName="Input";var Eu=Tu;function Ju(e){return su("MuiFormLabel",e)}var Du=gu("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),Uu=["children","className","color","component","disabled","error","filled","focused","required"],Pu=Al("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return oa({},t.root,"secondary"===n.color&&t.colorSecondary,n.filled&&t.filled)}})((function(e){var t,n=e.theme,i=e.ownerState;return oa({color:(n.vars||n).palette.text.secondary},n.typography.body1,(Eo(t={lineHeight:"1.4375em",padding:0,position:"relative"},"&.".concat(Du.focused),{color:(n.vars||n).palette[i.color].main}),Eo(t,"&.".concat(Du.disabled),{color:(n.vars||n).palette.text.disabled}),Eo(t,"&.".concat(Du.error),{color:(n.vars||n).palette.error.main}),t))})),Qu=Al("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:function(e,t){return t.asterisk}})((function(e){var t=e.theme;return Eo({},"&.".concat(Du.error),{color:(t.vars||t).palette.error.main})})),Ou=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiFormLabel"}),i=n.children,r=n.className,a=n.component,o=void 0===a?"label":a,s=sa(n,Uu),g=Dl({props:n,muiFormControl:Pl(),states:["color","required","focused","disabled","error","filled"]}),l=oa({},n,{color:g.color||"primary",component:o,disabled:g.disabled,error:g.error,filled:g.filled,focused:g.focused,required:g.required}),u=function(e){var t=e.classes,n=e.color,i=e.focused,r=e.disabled,a=e.error,o=e.filled,s=e.required;return fl({root:["root","color".concat(Ql(n)),r&&"disabled",a&&"error",o&&"filled",i&&"focused",s&&"required"],asterisk:["asterisk",a&&"error"]},Ju,t)}(l);return(0,Kl.jsxs)(Pu,oa({as:o,ownerState:l,className:ml(u.root,r),ref:t},s,{children:[i,g.required&&(0,Kl.jsxs)(Qu,{ownerState:l,"aria-hidden":!0,className:u.asterisk,children:["\u2009","*"]})]}))})),ju=Ou;function qu(e){return su("MuiInputLabel",e)}gu("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);var $u=["disableAnimation","margin","shrink","variant"],ec=Al(ju,{shouldForwardProp:function(e){return Cl(e)||"classes"===e},name:"MuiInputLabel",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[Eo({},"& .".concat(Du.asterisk),t.asterisk),t.root,n.formControl&&t.formControl,"small"===n.size&&t.sizeSmall,n.shrink&&t.shrink,!n.disableAnimation&&t.animated,t[n.variant]]}})((function(e){var t=e.theme,n=e.ownerState;return oa({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},n.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},"small"===n.size&&{transform:"translate(0, 17px) scale(1)"},n.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!n.disableAnimation&&{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})},"filled"===n.variant&&oa({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(12px, 13px) scale(1)"},n.shrink&&oa({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},"small"===n.size&&{transform:"translate(12px, 4px) scale(0.75)"})),"outlined"===n.variant&&oa({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},"small"===n.size&&{transform:"translate(14px, 9px) scale(1)"},n.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 24px)",transform:"translate(14px, -9px) scale(0.75)"}))})),tc=t.forwardRef((function(e,t){var n=Rl({name:"MuiInputLabel",props:e}),i=n.disableAnimation,r=void 0!==i&&i,a=n.shrink,o=sa(n,$u),s=Pl(),g=a;"undefined"===typeof g&&s&&(g=s.filled||s.focused||s.adornedStart);var l=Dl({props:n,muiFormControl:s,states:["size","variant","required"]}),u=oa({},n,{disableAnimation:r,formControl:s,shrink:g,size:l.size,variant:l.variant,required:l.required}),c=function(e){var t=e.classes,n=e.formControl,i=e.size,r=e.shrink;return oa({},t,fl({root:["root",n&&"formControl",!e.disableAnimation&&"animated",r&&"shrink","small"===i&&"sizeSmall",e.variant],asterisk:[e.required&&"asterisk"]},qu,t))}(u);return(0,Kl.jsx)(ec,oa({"data-shrink":g,ownerState:u,ref:t},o,{classes:c}))}));var nc=function(e,n){return t.isValidElement(e)&&-1!==n.indexOf(e.type.muiName)};function ic(e){return su("MuiFormControl",e)}gu("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);var rc=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],ac=Al("div",{name:"MuiFormControl",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return oa({},t.root,t["margin".concat(Ql(n.margin))],n.fullWidth&&t.fullWidth)}})((function(e){var t=e.ownerState;return oa({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},"normal"===t.margin&&{marginTop:16,marginBottom:8},"dense"===t.margin&&{marginTop:8,marginBottom:4},t.fullWidth&&{width:"100%"})})),oc=t.forwardRef((function(e,n){var i=Rl({props:e,name:"MuiFormControl"}),r=i.children,a=i.className,o=i.color,s=void 0===o?"primary":o,g=i.component,l=void 0===g?"div":g,u=i.disabled,c=void 0!==u&&u,I=i.error,C=void 0!==I&&I,d=i.focused,h=i.fullWidth,A=void 0!==h&&h,p=i.hiddenLabel,m=void 0!==p&&p,f=i.margin,v=void 0===f?"none":f,b=i.required,y=void 0!==b&&b,G=i.size,B=void 0===G?"medium":G,Z=i.variant,w=void 0===Z?"outlined":Z,S=sa(i,rc),W=oa({},i,{color:s,component:l,disabled:c,error:C,fullWidth:A,hiddenLabel:m,margin:v,required:y,size:B,variant:w}),x=function(e){var t=e.classes,n=e.margin,i=e.fullWidth;return fl({root:["root","none"!==n&&"margin".concat(Ql(n)),i&&"fullWidth"]},ic,t)}(W),R=Ir(t.useState((function(){var e=!1;return r&&t.Children.forEach(r,(function(t){if(nc(t,["Input","Select"])){var n=nc(t,["Select"])?t.props.input:t;n&&n.props.startAdornment&&(e=!0)}})),e})),2),V=R[0],k=R[1],X=Ir(t.useState((function(){var e=!1;return r&&t.Children.forEach(r,(function(t){nc(t,["Input","Select"])&&iu(t.props,!0)&&(e=!0)})),e})),2),Y=X[0],H=X[1],F=Ir(t.useState(!1),2),M=F[0],K=F[1];c&&M&&K(!1);var N=void 0===d||c?M:d,z=t.useCallback((function(){H(!0)}),[]),L={adornedStart:V,setAdornedStart:k,color:s,disabled:c,error:C,filled:Y,focused:N,fullWidth:A,hiddenLabel:m,size:B,onBlur:function(){K(!1)},onEmpty:t.useCallback((function(){H(!1)}),[]),onFilled:z,onFocus:function(){K(!0)},registerEffect:undefined,required:y,variant:w};return(0,Kl.jsx)(Ul.Provider,{value:L,children:(0,Kl.jsx)(ac,oa({as:l,ownerState:W,className:ml(x.root,a),ref:n},S,{children:r}))})})),sc=oc;function gc(e){return su("MuiFormHelperText",e)}var lc,uc=gu("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]),cc=["children","className","component","disabled","error","filled","focused","margin","required","variant"],Ic=Al("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,n.size&&t["size".concat(Ql(n.size))],n.contained&&t.contained,n.filled&&t.filled]}})((function(e){var t,n=e.theme,i=e.ownerState;return oa({color:(n.vars||n).palette.text.secondary},n.typography.caption,(Eo(t={textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0},"&.".concat(uc.disabled),{color:(n.vars||n).palette.text.disabled}),Eo(t,"&.".concat(uc.error),{color:(n.vars||n).palette.error.main}),t),"small"===i.size&&{marginTop:4},i.contained&&{marginLeft:14,marginRight:14})})),Cc=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiFormHelperText"}),i=n.children,r=n.className,a=n.component,o=void 0===a?"p":a,s=sa(n,cc),g=Dl({props:n,muiFormControl:Pl(),states:["variant","size","disabled","error","filled","focused","required"]}),l=oa({},n,{component:o,contained:"filled"===g.variant||"outlined"===g.variant,variant:g.variant,size:g.size,disabled:g.disabled,error:g.error,filled:g.filled,focused:g.focused,required:g.required}),u=function(e){var t=e.classes,n=e.contained,i=e.size,r=e.disabled,a=e.error,o=e.filled,s=e.focused,g=e.required;return fl({root:["root",r&&"disabled",a&&"error",i&&"size".concat(Ql(i)),n&&"contained",s&&"focused",o&&"filled",g&&"required"]},gc,t)}(l);return(0,Kl.jsx)(Ic,oa({as:o,ownerState:l,className:ml(u.root,r),ref:t},s,{children:" "===i?lc||(lc=(0,Kl.jsx)("span",{className:"notranslate",children:"\u200b"})):i}))})),dc=(n(8457),Yl);var hc=t.createContext({});function Ac(e){return su("MuiList",e)}gu("MuiList",["root","padding","dense","subheader"]);var pc=["children","className","component","dense","disablePadding","subheader"],mc=Al("ul",{name:"MuiList",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,!n.disablePadding&&t.padding,n.dense&&t.dense,n.subheader&&t.subheader]}})((function(e){var t=e.ownerState;return oa({listStyle:"none",margin:0,padding:0,position:"relative"},!t.disablePadding&&{paddingTop:8,paddingBottom:8},t.subheader&&{paddingTop:0})})),fc=t.forwardRef((function(e,n){var i=Rl({props:e,name:"MuiList"}),r=i.children,a=i.className,o=i.component,s=void 0===o?"ul":o,g=i.dense,l=void 0!==g&&g,u=i.disablePadding,c=void 0!==u&&u,I=i.subheader,C=sa(i,pc),d=t.useMemo((function(){return{dense:l}}),[l]),h=oa({},i,{component:s,dense:l,disablePadding:c}),A=function(e){var t=e.classes;return fl({root:["root",!e.disablePadding&&"padding",e.dense&&"dense",e.subheader&&"subheader"]},Ac,t)}(h);return(0,Kl.jsx)(hc.Provider,{value:d,children:(0,Kl.jsxs)(mc,oa({as:s,className:ml(A.root,a),ref:n,ownerState:h},C,{children:[I,r]}))})})),vc=fc;function bc(e){var t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}var yc=bc,Gc=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function Bc(e,t,n){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:n?null:e.firstChild}function Zc(e,t,n){return e===t?n?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:n?null:e.lastChild}function wc(e,t){if(void 0===t)return!0;var n=e.innerText;return void 0===n&&(n=e.textContent),0!==(n=n.trim().toLowerCase()).length&&(t.repeating?n[0]===t.keys[0]:0===n.indexOf(t.keys.join("")))}function Sc(e,t,n,i,r,a){for(var o=!1,s=r(e,t,!!t&&n);s;){if(s===e.firstChild){if(o)return!1;o=!0}var g=!i&&(s.disabled||"true"===s.getAttribute("aria-disabled"));if(s.hasAttribute("tabindex")&&wc(s,a)&&!g)return s.focus(),!0;s=r(e,s,n)}return!1}var Wc=t.forwardRef((function(e,n){var i=e.actions,r=e.autoFocus,a=void 0!==r&&r,o=e.autoFocusItem,s=void 0!==o&&o,g=e.children,l=e.className,u=e.disabledItemsFocusable,c=void 0!==u&&u,I=e.disableListWrap,C=void 0!==I&&I,d=e.onKeyDown,h=e.variant,A=void 0===h?"selectedMenu":h,p=sa(e,Gc),m=t.useRef(null),f=t.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});jl((function(){a&&m.current.focus()}),[a]),t.useImperativeHandle(i,(function(){return{adjustStyleForScrollbar:function(e,t){var n=!m.current.style.width;if(e.clientHeight<m.current.clientHeight&&n){var i="".concat(yc(dc(e)),"px");m.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=i,m.current.style.width="calc(100% + ".concat(i,")")}return m.current}}}),[]);var v=Ol(m,n),b=-1;t.Children.forEach(g,(function(e,n){t.isValidElement(e)&&(e.props.disabled||("selectedMenu"===A&&e.props.selected||-1===b)&&(b=n))}));var y=t.Children.map(g,(function(e,n){if(n===b){var i={};return s&&(i.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===A&&(i.tabIndex=0),t.cloneElement(e,i)}return e}));return(0,Kl.jsx)(vc,oa({role:"menu",ref:v,className:l,onKeyDown:function(e){var t=m.current,n=e.key,i=dc(t).activeElement;if("ArrowDown"===n)e.preventDefault(),Sc(t,i,C,c,Bc);else if("ArrowUp"===n)e.preventDefault(),Sc(t,i,C,c,Zc);else if("Home"===n)e.preventDefault(),Sc(t,null,C,c,Bc);else if("End"===n)e.preventDefault(),Sc(t,null,C,c,Zc);else if(1===n.length){var r=f.current,a=n.toLowerCase(),o=performance.now();r.keys.length>0&&(o-r.lastTime>500?(r.keys=[],r.repeating=!0,r.previousKeyMatched=!0):r.repeating&&a!==r.keys[0]&&(r.repeating=!1)),r.lastTime=o,r.keys.push(a);var s=i&&!r.repeating&&wc(i,r);r.previousKeyMatched&&(s||Sc(t,i,!1,c,Bc,r))?e.preventDefault():r.previousKeyMatched=!1}d&&d(e)},tabIndex:a?0:-1},p,{children:y}))})),xc=Wc;function Rc(e){return su("MuiPaper",e)}gu("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);var Vc=["className","component","elevation","square","variant"],kc=function(e){return((e<1?5.11916*Math.pow(e,2):4.5*Math.log(e+1)+2)/100).toFixed(2)},Xc=Al("div",{name:"MuiPaper",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,t[n.variant],!n.square&&t.rounded,"elevation"===n.variant&&t["elevation".concat(n.elevation)]]}})((function(e){var t,n=e.theme,i=e.ownerState;return oa({backgroundColor:(n.vars||n).palette.background.paper,color:(n.vars||n).palette.text.primary,transition:n.transitions.create("box-shadow")},!i.square&&{borderRadius:n.shape.borderRadius},"outlined"===i.variant&&{border:"1px solid ".concat((n.vars||n).palette.divider)},"elevation"===i.variant&&oa({boxShadow:(n.vars||n).shadows[i.elevation]},!n.vars&&"dark"===n.palette.mode&&{backgroundImage:"linear-gradient(".concat(Yg("#fff",kc(i.elevation)),", ").concat(Yg("#fff",kc(i.elevation)),")")},n.vars&&{backgroundImage:null==(t=n.vars.overlays)?void 0:t[i.elevation]}))})),Yc=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiPaper"}),i=n.className,r=n.component,a=void 0===r?"div":r,o=n.elevation,s=void 0===o?1:o,g=n.square,l=void 0!==g&&g,u=n.variant,c=void 0===u?"elevation":u,I=sa(n,Vc),C=oa({},n,{component:a,elevation:s,square:l,variant:c}),d=function(e){var t=e.square,n=e.elevation,i=e.variant,r=e.classes;return fl({root:["root",i,!t&&"rounded","elevation"===i&&"elevation".concat(n)]},Rc,r)}(C);return(0,Kl.jsx)(Xc,oa({as:a,ownerState:C,className:ml(d.root,i),ref:t},I))})),Hc=Fl,Fc=Hl;var Mc=!1,Kc=t.createContext(null),Nc="unmounted",zc="exited",Lc="entering",_c="entered",Tc="exiting",Ec=function(e){var n,i;function r(t,n){var i;i=e.call(this,t,n)||this;var r,a=n&&!n.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?a?(r=zc,i.appearStatus=Lc):r=_c:r=t.unmountOnExit||t.mountOnEnter?Nc:zc,i.state={status:r},i.nextCallback=null,i}i=e,(n=r).prototype=Object.create(i.prototype),n.prototype.constructor=n,zi(n,i),r.getDerivedStateFromProps=function(e,t){return e.in&&t.status===Nc?{status:zc}:null};var a=r.prototype;return a.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},a.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==Lc&&n!==_c&&(t=Lc):n!==Lc&&n!==_c||(t=Tc)}this.updateStatus(!1,t)},a.componentWillUnmount=function(){this.cancelNextCallback()},a.getTimeouts=function(){var e,t,n,i=this.props.timeout;return e=t=n=i,null!=i&&"number"!==typeof i&&(e=i.exit,t=i.enter,n=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:n}},a.updateStatus=function(e,t){void 0===e&&(e=!1),null!==t?(this.cancelNextCallback(),t===Lc?this.performEnter(e):this.performExit()):this.props.unmountOnExit&&this.state.status===zc&&this.setState({status:Nc})},a.performEnter=function(e){var t=this,n=this.props.enter,i=this.context?this.context.isMounting:e,r=this.props.nodeRef?[i]:[Vl.findDOMNode(this),i],a=r[0],o=r[1],s=this.getTimeouts(),g=i?s.appear:s.enter;!e&&!n||Mc?this.safeSetState({status:_c},(function(){t.props.onEntered(a)})):(this.props.onEnter(a,o),this.safeSetState({status:Lc},(function(){t.props.onEntering(a,o),t.onTransitionEnd(g,(function(){t.safeSetState({status:_c},(function(){t.props.onEntered(a,o)}))}))})))},a.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),i=this.props.nodeRef?void 0:Vl.findDOMNode(this);t&&!Mc?(this.props.onExit(i),this.safeSetState({status:Tc},(function(){e.props.onExiting(i),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:zc},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:zc},(function(){e.props.onExited(i)}))},a.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},a.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},a.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(i){n&&(n=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},a.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:Vl.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(n&&!i){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],a=r[0],o=r[1];this.props.addEndListener(a,o)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},a.render=function(){var e=this.state.status;if(e===Nc)return null;var n=this.props,i=n.children,r=(n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef,sa(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return t.createElement(Kc.Provider,{value:null},"function"===typeof i?i(e,r):t.cloneElement(t.Children.only(i),r))},r}(t.Component);function Jc(){}Ec.contextType=Kc,Ec.propTypes={},Ec.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Jc,onEntering:Jc,onEntered:Jc,onExit:Jc,onExiting:Jc,onExited:Jc},Ec.UNMOUNTED=Nc,Ec.EXITED=zc,Ec.ENTERING=Lc,Ec.ENTERED=_c,Ec.EXITING=Tc;var Dc=Ec;function Uc(){return xl(Il)}var Pc=function(e){return e.scrollTop};function Qc(e,t){var n,i,r=e.timeout,a=e.easing,o=e.style,s=void 0===o?{}:o;return{duration:null!=(n=s.transitionDuration)?n:"number"===typeof r?r:r[t.mode]||0,easing:null!=(i=s.transitionTimingFunction)?i:"object"===typeof a?a[t.mode]:a,delay:s.transitionDelay}}var Oc=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function jc(e){return"scale(".concat(e,", ").concat(Math.pow(e,2),")")}var qc={entering:{opacity:1,transform:jc(1)},entered:{opacity:1,transform:"none"}},$c="undefined"!==typeof navigator&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),eI=t.forwardRef((function(e,n){var i=e.addEndListener,r=e.appear,a=void 0===r||r,o=e.children,s=e.easing,g=e.in,l=e.onEnter,u=e.onEntered,c=e.onEntering,I=e.onExit,C=e.onExited,d=e.onExiting,h=e.style,A=e.timeout,p=void 0===A?"auto":A,m=e.TransitionComponent,f=void 0===m?Dc:m,v=sa(e,Oc),b=t.useRef(),y=t.useRef(),G=Uc(),B=t.useRef(null),Z=Ol(o.ref,n),w=Ol(B,Z),S=function(e){return function(t){if(e){var n=B.current;void 0===t?e(n):e(n,t)}}},W=S(c),x=S((function(e,t){Pc(e);var n,i=Qc({style:h,timeout:p,easing:s},{mode:"enter"}),r=i.duration,a=i.delay,o=i.easing;"auto"===p?(n=G.transitions.getAutoHeightDuration(e.clientHeight),y.current=n):n=r,e.style.transition=[G.transitions.create("opacity",{duration:n,delay:a}),G.transitions.create("transform",{duration:$c?n:.666*n,delay:a,easing:o})].join(","),l&&l(e,t)})),R=S(u),V=S(d),k=S((function(e){var t,n=Qc({style:h,timeout:p,easing:s},{mode:"exit"}),i=n.duration,r=n.delay,a=n.easing;"auto"===p?(t=G.transitions.getAutoHeightDuration(e.clientHeight),y.current=t):t=i,e.style.transition=[G.transitions.create("opacity",{duration:t,delay:r}),G.transitions.create("transform",{duration:$c?t:.666*t,delay:$c?r:r||.333*t,easing:a})].join(","),e.style.opacity=0,e.style.transform=jc(.75),I&&I(e)})),X=S(C);return t.useEffect((function(){return function(){clearTimeout(b.current)}}),[]),(0,Kl.jsx)(f,oa({appear:a,in:g,nodeRef:B,onEnter:x,onEntered:R,onEntering:W,onExit:k,onExited:X,onExiting:V,addEndListener:function(e){"auto"===p&&(b.current=setTimeout(e,y.current||0)),i&&i(B.current,e)},timeout:"auto"===p?null:p},v,{children:function(e,n){return t.cloneElement(o,oa({style:oa({opacity:0,transform:jc(.75),visibility:"exited"!==e||g?void 0:"hidden"},qc[e],h,o.props.style),ref:w},n))}}))}));eI.muiSupportAuto=!0;var tI=eI;function nI(e){var n=t.useRef(e);return Ml((function(){n.current=e})),t.useCallback((function(){return n.current.apply(void 0,arguments)}),[])}function iI(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return null==t?e:function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];e.apply(this,i),t.apply(this,i)}}),(function(){}))}var rI=t.forwardRef((function(e,n){var i=e.children,r=e.container,a=e.disablePortal,o=void 0!==a&&a,s=Ir(t.useState(null),2),g=s[0],l=s[1],u=Xl(t.isValidElement(i)?i.ref:null,n);return Ml((function(){o||l(function(e){return"function"===typeof e?e():e}(r)||document.body)}),[r,o]),Ml((function(){if(g&&!o)return kl(n,g),function(){kl(n,null)}}),[n,g,o]),o?t.isValidElement(i)?t.cloneElement(i,{ref:u}):i:g?Vl.createPortal(i,g):g}));function aI(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function oI(e){return parseInt(Hl(e).getComputedStyle(e).paddingRight,10)||0}function sI(e){var t=-1!==["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName),n="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||n}function gI(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4?arguments[4]:void 0,a=[t,n].concat(Ci(i));[].forEach.call(e.children,(function(e){var t=-1===a.indexOf(e),n=!sI(e);t&&n&&aI(e,r)}))}function lI(e,t){var n=-1;return e.some((function(e,i){return!!t(e)&&(n=i,!0)})),n}function uI(e,t){var n=[],i=e.container;if(!t.disableScrollLock){if(function(e){var t=Yl(e);return t.body===e?Hl(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(i)){var r=bc(Yl(i));n.push({value:i.style.paddingRight,property:"padding-right",el:i}),i.style.paddingRight="".concat(oI(i)+r,"px");var a=Yl(i).querySelectorAll(".mui-fixed");[].forEach.call(a,(function(e){n.push({value:e.style.paddingRight,property:"padding-right",el:e}),e.style.paddingRight="".concat(oI(e)+r,"px")}))}var o;if(i.parentNode instanceof DocumentFragment)o=Yl(i).body;else{var s=i.parentElement,g=Hl(i);o="HTML"===(null==s?void 0:s.nodeName)&&"scroll"===g.getComputedStyle(s).overflowY?s:i}n.push({value:o.style.overflow,property:"overflow",el:o},{value:o.style.overflowX,property:"overflow-x",el:o},{value:o.style.overflowY,property:"overflow-y",el:o}),o.style.overflow="hidden"}return function(){n.forEach((function(e){var t=e.value,n=e.el,i=e.property;t?n.style.setProperty(i,t):n.style.removeProperty(i)}))}}var cI=function(){function e(){di(this,e),this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}return Ai(e,[{key:"add",value:function(e,t){var n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&aI(e.modalRef,!1);var i=function(e){var t=[];return[].forEach.call(e.children,(function(e){"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);gI(t,e.mount,e.modalRef,i,!0);var r=lI(this.containers,(function(e){return e.container===t}));return-1!==r?(this.containers[r].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:i}),n)}},{key:"mount",value:function(e,t){var n=lI(this.containers,(function(t){return-1!==t.modals.indexOf(e)})),i=this.containers[n];i.restore||(i.restore=uI(i,t))}},{key:"remove",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.modals.indexOf(e);if(-1===n)return n;var i=lI(this.containers,(function(t){return-1!==t.modals.indexOf(e)})),r=this.containers[i];if(r.modals.splice(r.modals.indexOf(e),1),this.modals.splice(n,1),0===r.modals.length)r.restore&&r.restore(),e.modalRef&&aI(e.modalRef,t),gI(r.container,e.mount,e.modalRef,r.hiddenSiblings,!1),this.containers.splice(i,1);else{var a=r.modals[r.modals.length-1];a.modalRef&&aI(a.modalRef,!1)}return n}},{key:"isTopModal",value:function(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}]),e}(),II=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function CI(e){var t=[],n=[];return Array.from(e.querySelectorAll(II)).forEach((function(e,i){var r=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==r&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;var t=function(t){return e.ownerDocument.querySelector('input[type="radio"]'.concat(t))},n=t('[name="'.concat(e.name,'"]:checked'));return n||(n=t('[name="'.concat(e.name,'"]'))),n!==e}(e))}(e)&&(0===r?t.push(e):n.push({documentOrder:i,tabIndex:r,node:e}))})),n.sort((function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex})).map((function(e){return e.node})).concat(t)}function dI(){return!0}var hI=function(e){var n=e.children,i=e.disableAutoFocus,r=void 0!==i&&i,a=e.disableEnforceFocus,o=void 0!==a&&a,s=e.disableRestoreFocus,g=void 0!==s&&s,l=e.getTabbable,u=void 0===l?CI:l,c=e.isEnabled,I=void 0===c?dI:c,C=e.open,d=t.useRef(),h=t.useRef(null),A=t.useRef(null),p=t.useRef(null),m=t.useRef(null),f=t.useRef(!1),v=t.useRef(null),b=Xl(n.ref,v),y=t.useRef(null);t.useEffect((function(){C&&v.current&&(f.current=!r)}),[r,C]),t.useEffect((function(){if(C&&v.current){var e=Yl(v.current);return v.current.contains(e.activeElement)||(v.current.hasAttribute("tabIndex")||v.current.setAttribute("tabIndex",-1),f.current&&v.current.focus()),function(){g||(p.current&&p.current.focus&&(d.current=!0,p.current.focus()),p.current=null)}}}),[C]),t.useEffect((function(){if(C&&v.current){var e=Yl(v.current),t=function(t){var n=v.current;if(null!==n)if(e.hasFocus()&&!o&&I()&&!d.current){if(!n.contains(e.activeElement)){if(t&&m.current!==t.target||e.activeElement!==m.current)m.current=null;else if(null!==m.current)return;if(!f.current)return;var i=[];if(e.activeElement!==h.current&&e.activeElement!==A.current||(i=u(v.current)),i.length>0){var r,a,s=Boolean((null==(r=y.current)?void 0:r.shiftKey)&&"Tab"===(null==(a=y.current)?void 0:a.key)),g=i[0],l=i[i.length-1];s?l.focus():g.focus()}else n.focus()}}else d.current=!1},n=function(t){y.current=t,!o&&I()&&"Tab"===t.key&&e.activeElement===v.current&&t.shiftKey&&(d.current=!0,A.current.focus())};e.addEventListener("focusin",t),e.addEventListener("keydown",n,!0);var i=setInterval((function(){"BODY"===e.activeElement.tagName&&t()}),50);return function(){clearInterval(i),e.removeEventListener("focusin",t),e.removeEventListener("keydown",n,!0)}}}),[r,o,g,I,C,u]);var G=function(e){null===p.current&&(p.current=e.relatedTarget),f.current=!0};return(0,Kl.jsxs)(t.Fragment,{children:[(0,Kl.jsx)("div",{tabIndex:0,onFocus:G,ref:h,"data-test":"sentinelStart"}),t.cloneElement(n,{ref:b,onFocus:function(e){null===p.current&&(p.current=e.relatedTarget),f.current=!0,m.current=e.target;var t=n.props.onFocus;t&&t(e)}}),(0,Kl.jsx)("div",{tabIndex:0,onFocus:G,ref:A,"data-test":"sentinelEnd"})]})};function AI(e){return su("MuiModal",e)}gu("MuiModal",["root","hidden"]);function pI(e){if(void 0===e)return{};var t={};return Object.keys(e).filter((function(t){return!(t.match(/^on[A-Z]/)&&"function"===typeof e[t])})).forEach((function(n){t[n]=e[n]})),t}function mI(e){var t=e.getSlotProps,n=e.additionalProps,i=e.externalSlotProps,r=e.externalForwardedProps,a=e.className;if(!t){var o=ml(null==r?void 0:r.className,null==i?void 0:i.className,a,null==n?void 0:n.className),s=oa({},null==n?void 0:n.style,null==r?void 0:r.style,null==i?void 0:i.style),g=oa({},n,r,i);return o.length>0&&(g.className=o),Object.keys(s).length>0&&(g.style=s),{props:g,internalRef:void 0}}var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};var n={};return Object.keys(e).filter((function(n){return n.match(/^on[A-Z]/)&&"function"===typeof e[n]&&!t.includes(n)})).forEach((function(t){n[t]=e[t]})),n}(oa({},r,i)),u=pI(i),c=pI(r),I=t(l),C=ml(null==I?void 0:I.className,null==n?void 0:n.className,a,null==r?void 0:r.className,null==i?void 0:i.className),d=oa({},null==I?void 0:I.style,null==n?void 0:n.style,null==r?void 0:r.style,null==i?void 0:i.style),h=oa({},I,n,c,u);return C.length>0&&(h.className=C),Object.keys(d).length>0&&(h.style=d),{props:h,internalRef:I.ref}}function fI(e,t){return"function"===typeof e?e(t):e}var vI=["elementType","externalSlotProps","ownerState"];function bI(e){var t,n=e.elementType,i=e.externalSlotProps,r=e.ownerState,a=sa(e,vI),o=fI(i,r),s=mI(oa({},a,{externalSlotProps:o})),g=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return Jl(e)?t:oa({},t,{ownerState:oa({},t.ownerState,n)})}(n,oa({},s.props,{ref:Xl(s.internalRef,Xl(null==o?void 0:o.ref,null==(t=e.additionalProps)?void 0:t.ref))}),r);return g}var yI=["children","classes","closeAfterTransition","component","components","componentsProps","container","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onKeyDown","open","onTransitionEnter","onTransitionExited"];var GI=new cI,BI=t.forwardRef((function(e,n){var i,r=e.children,a=e.classes,o=e.closeAfterTransition,s=void 0!==o&&o,g=e.component,l=void 0===g?"div":g,u=e.components,c=void 0===u?{}:u,I=e.componentsProps,C=void 0===I?{}:I,d=e.container,h=e.disableAutoFocus,A=void 0!==h&&h,p=e.disableEnforceFocus,m=void 0!==p&&p,f=e.disableEscapeKeyDown,v=void 0!==f&&f,b=e.disablePortal,y=void 0!==b&&b,G=e.disableRestoreFocus,B=void 0!==G&&G,Z=e.disableScrollLock,w=void 0!==Z&&Z,S=e.hideBackdrop,W=void 0!==S&&S,x=e.keepMounted,R=void 0!==x&&x,V=e.manager,k=void 0===V?GI:V,X=e.onBackdropClick,Y=e.onClose,H=e.onKeyDown,F=e.open,M=e.onTransitionEnter,K=e.onTransitionExited,N=sa(e,yI),z=Ir(t.useState(!0),2),L=z[0],_=z[1],T=t.useRef({}),E=t.useRef(null),J=t.useRef(null),D=Xl(J,n),U=function(e){return!!e.children&&e.children.props.hasOwnProperty("in")}(e),P=null==(i=e["aria-hidden"])||i,Q=function(){return T.current.modalRef=J.current,T.current.mountNode=E.current,T.current},O=function(){k.mount(Q(),{disableScrollLock:w}),J.current.scrollTop=0},j=nI((function(){var e=function(e){return"function"===typeof e?e():e}(d)||Yl(E.current).body;k.add(Q(),e),J.current&&O()})),q=t.useCallback((function(){return k.isTopModal(Q())}),[k]),$=nI((function(e){E.current=e,e&&(F&&q()?O():aI(J.current,P))})),ee=t.useCallback((function(){k.remove(Q(),P)}),[k,P]);t.useEffect((function(){return function(){ee()}}),[ee]),t.useEffect((function(){F?j():U&&s||ee()}),[F,ee,U,s,j]);var te=oa({},e,{classes:a,closeAfterTransition:s,disableAutoFocus:A,disableEnforceFocus:m,disableEscapeKeyDown:v,disablePortal:y,disableRestoreFocus:B,disableScrollLock:w,exited:L,hideBackdrop:W,keepMounted:R}),ne=function(e){var t=e.open,n=e.exited;return fl({root:["root",!t&&n&&"hidden"]},AI,e.classes)}(te),ie={};void 0===r.props.tabIndex&&(ie.tabIndex="-1"),U&&(ie.onEnter=iI((function(){_(!1),M&&M()}),r.props.onEnter),ie.onExited=iI((function(){_(!0),K&&K(),s&&ee()}),r.props.onExited));var re=c.Root||l,ae=bI({elementType:re,externalSlotProps:C.root,externalForwardedProps:N,additionalProps:{ref:D,role:"presentation",onKeyDown:function(e){H&&H(e),"Escape"===e.key&&q()&&(v||(e.stopPropagation(),Y&&Y(e,"escapeKeyDown")))}},className:ne.root,ownerState:te}),oe=c.Backdrop,se=bI({elementType:oe,externalSlotProps:C.backdrop,additionalProps:{"aria-hidden":!0,onClick:function(e){e.target===e.currentTarget&&(X&&X(e),Y&&Y(e,"backdropClick"))},open:F},ownerState:te});return R||F||U&&!L?(0,Kl.jsx)(rI,{ref:$,container:d,disablePortal:y,children:(0,Kl.jsxs)(re,oa({},ae,{children:[!W&&oe?(0,Kl.jsx)(oe,oa({},se)):null,(0,Kl.jsx)(hI,{disableEnforceFocus:m,disableAutoFocus:A,disableRestoreFocus:B,isEnabled:q,open:F,children:t.cloneElement(r,ie)})]}))}):null})),ZI=BI,wI=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],SI={entering:{opacity:1},entered:{opacity:1}},WI=t.forwardRef((function(e,n){var i=Uc(),r={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},a=e.addEndListener,o=e.appear,s=void 0===o||o,g=e.children,l=e.easing,u=e.in,c=e.onEnter,I=e.onEntered,C=e.onEntering,d=e.onExit,h=e.onExited,A=e.onExiting,p=e.style,m=e.timeout,f=void 0===m?r:m,v=e.TransitionComponent,b=void 0===v?Dc:v,y=sa(e,wI),G=t.useRef(null),B=Ol(g.ref,n),Z=Ol(G,B),w=function(e){return function(t){if(e){var n=G.current;void 0===t?e(n):e(n,t)}}},S=w(C),W=w((function(e,t){Pc(e);var n=Qc({style:p,timeout:f,easing:l},{mode:"enter"});e.style.webkitTransition=i.transitions.create("opacity",n),e.style.transition=i.transitions.create("opacity",n),c&&c(e,t)})),x=w(I),R=w(A),V=w((function(e){var t=Qc({style:p,timeout:f,easing:l},{mode:"exit"});e.style.webkitTransition=i.transitions.create("opacity",t),e.style.transition=i.transitions.create("opacity",t),d&&d(e)})),k=w(h);return(0,Kl.jsx)(b,oa({appear:s,in:u,nodeRef:G,onEnter:W,onEntered:x,onEntering:S,onExit:V,onExited:k,onExiting:R,addEndListener:function(e){a&&a(G.current,e)},timeout:f},y,{children:function(e,n){return t.cloneElement(g,oa({style:oa({opacity:0,visibility:"exited"!==e||u?void 0:"hidden"},SI[e],p,g.props.style),ref:Z},n))}}))})),xI=WI;function RI(e){return su("MuiBackdrop",e)}gu("MuiBackdrop",["root","invisible"]);var VI=["children","component","components","componentsProps","className","invisible","open","transitionDuration","TransitionComponent"],kI=Al("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,n.invisible&&t.invisible]}})((function(e){return oa({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},e.ownerState.invisible&&{backgroundColor:"transparent"})})),XI=t.forwardRef((function(e,t){var n,i,r=Rl({props:e,name:"MuiBackdrop"}),a=r.children,o=r.component,s=void 0===o?"div":o,g=r.components,l=void 0===g?{}:g,u=r.componentsProps,c=void 0===u?{}:u,I=r.className,C=r.invisible,d=void 0!==C&&C,h=r.open,A=r.transitionDuration,p=r.TransitionComponent,m=void 0===p?xI:p,f=sa(r,VI),v=oa({},r,{component:s,invisible:d}),b=function(e){var t=e.classes;return fl({root:["root",e.invisible&&"invisible"]},RI,t)}(v);return(0,Kl.jsx)(m,oa({in:h,timeout:A},f,{children:(0,Kl.jsx)(kI,{"aria-hidden":!0,as:null!=(n=l.Root)?n:s,className:ml(b.root,I),ownerState:oa({},v,null==(i=c.root)?void 0:i.ownerState),classes:b,ref:t,children:a})}))})),YI=["BackdropComponent","BackdropProps","closeAfterTransition","children","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","theme"],HI=Al("div",{name:"MuiModal",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,!n.open&&n.exited&&t.hidden]}})((function(e){var t=e.theme,n=e.ownerState;return oa({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!n.open&&n.exited&&{visibility:"hidden"})})),FI=Al(XI,{name:"MuiModal",slot:"Backdrop",overridesResolver:function(e,t){return t.backdrop}})({zIndex:-1}),MI=t.forwardRef((function(e,n){var i,r,a=Rl({name:"MuiModal",props:e}),o=a.BackdropComponent,s=void 0===o?FI:o,g=a.BackdropProps,l=a.closeAfterTransition,u=void 0!==l&&l,c=a.children,I=a.component,C=a.components,d=void 0===C?{}:C,h=a.componentsProps,A=void 0===h?{}:h,p=a.disableAutoFocus,m=void 0!==p&&p,f=a.disableEnforceFocus,v=void 0!==f&&f,b=a.disableEscapeKeyDown,y=void 0!==b&&b,G=a.disablePortal,B=void 0!==G&&G,Z=a.disableRestoreFocus,w=void 0!==Z&&Z,S=a.disableScrollLock,W=void 0!==S&&S,x=a.hideBackdrop,R=void 0!==x&&x,V=a.keepMounted,k=void 0!==V&&V,X=a.theme,Y=sa(a,YI),H=Ir(t.useState(!0),2),F=H[0],M=H[1],K={closeAfterTransition:u,disableAutoFocus:m,disableEnforceFocus:v,disableEscapeKeyDown:y,disablePortal:B,disableRestoreFocus:w,disableScrollLock:W,hideBackdrop:R,keepMounted:k},N=oa({},a,K,{exited:F}),z=function(e){return e.classes}(N),L=null!=(i=null!=(r=d.Root)?r:I)?i:HI;return(0,Kl.jsx)(ZI,oa({components:oa({Root:L,Backdrop:s},d),componentsProps:{root:function(){return oa({},fI(A.root,N),!Jl(L)&&{as:I,theme:X})},backdrop:function(){return oa({},g,fI(A.backdrop,N))}},onTransitionEnter:function(){return M(!1)},onTransitionExited:function(){return M(!0)},ref:n},Y,{classes:z},K,{children:c}))})),KI=MI;function NI(e){return su("MuiPopover",e)}gu("MuiPopover",["root","paper"]);var zI=["onEntering"],LI=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"];function _I(e,t){var n=0;return"number"===typeof t?n=t:"center"===t?n=e.height/2:"bottom"===t&&(n=e.height),n}function TI(e,t){var n=0;return"number"===typeof t?n=t:"center"===t?n=e.width/2:"right"===t&&(n=e.width),n}function EI(e){return[e.horizontal,e.vertical].map((function(e){return"number"===typeof e?"".concat(e,"px"):e})).join(" ")}function JI(e){return"function"===typeof e?e():e}var DI=Al(KI,{name:"MuiPopover",slot:"Root",overridesResolver:function(e,t){return t.root}})({}),UI=Al(Yc,{name:"MuiPopover",slot:"Paper",overridesResolver:function(e,t){return t.paper}})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),PI=t.forwardRef((function(e,n){var i=Rl({props:e,name:"MuiPopover"}),r=i.action,a=i.anchorEl,o=i.anchorOrigin,s=void 0===o?{vertical:"top",horizontal:"left"}:o,g=i.anchorPosition,l=i.anchorReference,u=void 0===l?"anchorEl":l,c=i.children,I=i.className,C=i.container,d=i.elevation,h=void 0===d?8:d,A=i.marginThreshold,p=void 0===A?16:A,m=i.open,f=i.PaperProps,v=void 0===f?{}:f,b=i.transformOrigin,y=void 0===b?{vertical:"top",horizontal:"left"}:b,G=i.TransitionComponent,B=void 0===G?tI:G,Z=i.transitionDuration,w=void 0===Z?"auto":Z,S=i.TransitionProps,W=(S=void 0===S?{}:S).onEntering,x=sa(i.TransitionProps,zI),R=sa(i,LI),V=t.useRef(),k=Ol(V,v.ref),X=oa({},i,{anchorOrigin:s,anchorReference:u,elevation:h,marginThreshold:p,PaperProps:v,transformOrigin:y,TransitionComponent:B,transitionDuration:w,TransitionProps:x}),Y=function(e){return fl({root:["root"],paper:["paper"]},NI,e.classes)}(X),H=t.useCallback((function(){if("anchorPosition"===u)return g;var e=JI(a),t=(e&&1===e.nodeType?e:dc(V.current).body).getBoundingClientRect();return{top:t.top+_I(t,s.vertical),left:t.left+TI(t,s.horizontal)}}),[a,s.horizontal,s.vertical,g,u]),F=t.useCallback((function(e){return{vertical:_I(e,y.vertical),horizontal:TI(e,y.horizontal)}}),[y.horizontal,y.vertical]),M=t.useCallback((function(e){var t={width:e.offsetWidth,height:e.offsetHeight},n=F(t);if("none"===u)return{top:null,left:null,transformOrigin:EI(n)};var i=H(),r=i.top-n.vertical,o=i.left-n.horizontal,s=r+t.height,g=o+t.width,l=Fc(JI(a)),c=l.innerHeight-p,I=l.innerWidth-p;if(r<p){var C=r-p;r-=C,n.vertical+=C}else if(s>c){var d=s-c;r-=d,n.vertical+=d}if(o<p){var h=o-p;o-=h,n.horizontal+=h}else if(g>I){var A=g-I;o-=A,n.horizontal+=A}return{top:"".concat(Math.round(r),"px"),left:"".concat(Math.round(o),"px"),transformOrigin:EI(n)}}),[a,u,H,F,p]),K=t.useCallback((function(){var e=V.current;if(e){var t=M(e);null!==t.top&&(e.style.top=t.top),null!==t.left&&(e.style.left=t.left),e.style.transformOrigin=t.transformOrigin}}),[M]);t.useEffect((function(){m&&K()})),t.useImperativeHandle(r,(function(){return m?{updatePosition:function(){K()}}:null}),[m,K]),t.useEffect((function(){if(m){var e=Hc((function(){K()})),t=Fc(a);return t.addEventListener("resize",e),function(){e.clear(),t.removeEventListener("resize",e)}}}),[a,m,K]);var N=w;"auto"!==w||B.muiSupportAuto||(N=void 0);var z=C||(a?dc(JI(a)).body:void 0);return(0,Kl.jsx)(DI,oa({BackdropProps:{invisible:!0},className:ml(Y.root,I),container:z,open:m,ref:n,ownerState:X},R,{children:(0,Kl.jsx)(B,oa({appear:!0,in:m,onEntering:function(e,t){W&&W(e,t),K()},timeout:N},x,{children:(0,Kl.jsx)(UI,oa({elevation:h},v,{ref:k,className:ml(Y.paper,v.className),children:c}))}))}))})),QI=PI;function OI(e){return su("MuiMenu",e)}gu("MuiMenu",["root","paper","list"]);var jI=["onEntering"],qI=["autoFocus","children","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant"],$I={vertical:"top",horizontal:"right"},eC={vertical:"top",horizontal:"left"},tC=Al(QI,{shouldForwardProp:function(e){return Cl(e)||"classes"===e},name:"MuiMenu",slot:"Root",overridesResolver:function(e,t){return t.root}})({}),nC=Al(Yc,{name:"MuiMenu",slot:"Paper",overridesResolver:function(e,t){return t.paper}})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),iC=Al(xc,{name:"MuiMenu",slot:"List",overridesResolver:function(e,t){return t.list}})({outline:0}),rC=t.forwardRef((function(e,n){var i=Rl({props:e,name:"MuiMenu"}),r=i.autoFocus,a=void 0===r||r,o=i.children,s=i.disableAutoFocusItem,g=void 0!==s&&s,l=i.MenuListProps,u=void 0===l?{}:l,c=i.onClose,I=i.open,C=i.PaperProps,d=void 0===C?{}:C,h=i.PopoverClasses,A=i.transitionDuration,p=void 0===A?"auto":A,m=i.TransitionProps,f=(m=void 0===m?{}:m).onEntering,v=i.variant,b=void 0===v?"selectedMenu":v,y=sa(i.TransitionProps,jI),G=sa(i,qI),B=Uc(),Z="rtl"===B.direction,w=oa({},i,{autoFocus:a,disableAutoFocusItem:g,MenuListProps:u,onEntering:f,PaperProps:d,transitionDuration:p,TransitionProps:y,variant:b}),S=function(e){return fl({root:["root"],paper:["paper"],list:["list"]},OI,e.classes)}(w),W=a&&!g&&I,x=t.useRef(null),R=-1;return t.Children.map(o,(function(e,n){t.isValidElement(e)&&(e.props.disabled||("selectedMenu"===b&&e.props.selected||-1===R)&&(R=n))})),(0,Kl.jsx)(tC,oa({classes:h,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:Z?"right":"left"},transformOrigin:Z?$I:eC,PaperProps:oa({component:nC},d,{classes:oa({},d.classes,{root:S.paper})}),className:S.root,open:I,ref:n,transitionDuration:p,TransitionProps:oa({onEntering:function(e,t){x.current&&x.current.adjustStyleForScrollbar(e,B),f&&f(e,t)}},y),ownerState:w},G,{children:(0,Kl.jsx)(iC,oa({onKeyDown:function(e){"Tab"===e.key&&(e.preventDefault(),c&&c(e,"tabKeyDown"))},actions:x,autoFocus:a&&(-1===R||g),autoFocusItem:W,variant:b},u,{className:ml(S.list,u.className),children:o}))}))})),aC=rC;function oC(e){return su("MuiNativeSelect",e)}var sC=gu("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput"]),gC=["className","disabled","IconComponent","inputRef","variant"],lC=function(e){var t,n=e.ownerState,i=e.theme;return oa((Eo(t={MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{backgroundColor:"light"===i.palette.mode?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",borderRadius:0},"&::-ms-expand":{display:"none"}},"&.".concat(sC.disabled),{cursor:"default"}),Eo(t,"&[multiple]",{height:"auto"}),Eo(t,"&:not([multiple]) option, &:not([multiple]) optgroup",{backgroundColor:i.palette.background.paper}),Eo(t,"&&&",{paddingRight:24,minWidth:16}),t),"filled"===n.variant&&{"&&&":{paddingRight:32}},"outlined"===n.variant&&{borderRadius:i.shape.borderRadius,"&:focus":{borderRadius:i.shape.borderRadius},"&&&":{paddingRight:32}})},uC=Al("select",{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Cl,overridesResolver:function(e,t){var n=e.ownerState;return[t.select,t[n.variant],Eo({},"&.".concat(sC.multiple),t.multiple)]}})(lC),cC=function(e){var t=e.ownerState,n=e.theme;return oa(Eo({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:n.palette.action.active},"&.".concat(sC.disabled),{color:n.palette.action.disabled}),t.open&&{transform:"rotate(180deg)"},"filled"===t.variant&&{right:7},"outlined"===t.variant&&{right:7})},IC=Al("svg",{name:"MuiNativeSelect",slot:"Icon",overridesResolver:function(e,t){var n=e.ownerState;return[t.icon,n.variant&&t["icon".concat(Ql(n.variant))],n.open&&t.iconOpen]}})(cC),CC=t.forwardRef((function(e,n){var i=e.className,r=e.disabled,a=e.IconComponent,o=e.inputRef,s=e.variant,g=void 0===s?"standard":s,l=sa(e,gC),u=oa({},e,{disabled:r,variant:g}),c=function(e){var t=e.classes,n=e.variant,i=e.disabled,r=e.multiple,a=e.open;return fl({select:["select",n,i&&"disabled",r&&"multiple"],icon:["icon","icon".concat(Ql(n)),a&&"iconOpen",i&&"disabled"]},oC,t)}(u);return(0,Kl.jsxs)(t.Fragment,{children:[(0,Kl.jsx)(uC,oa({ownerState:u,className:ml(c.select,i),disabled:r,ref:o||n},l)),e.multiple?null:(0,Kl.jsx)(IC,{as:a,ownerState:u,className:c.icon})]})}));var dC=function(e){var n=e.controlled,i=e.default,r=(e.name,e.state,t.useRef(void 0!==n).current),a=Ir(t.useState(i),2),o=a[0],s=a[1];return[r?n:o,t.useCallback((function(e){r||s(e)}),[])]};function hC(e){return su("MuiSelect",e)}var AC,pC=gu("MuiSelect",["select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput"]),mC=["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"],fC=Al("div",{name:"MuiSelect",slot:"Select",overridesResolver:function(e,t){var n=e.ownerState;return[Eo({},"&.".concat(pC.select),t.select),Eo({},"&.".concat(pC.select),t[n.variant]),Eo({},"&.".concat(pC.multiple),t.multiple)]}})(lC,Eo({},"&.".concat(pC.select),{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"})),vC=Al("svg",{name:"MuiSelect",slot:"Icon",overridesResolver:function(e,t){var n=e.ownerState;return[t.icon,n.variant&&t["icon".concat(Ql(n.variant))],n.open&&t.iconOpen]}})(cC),bC=Al("input",{shouldForwardProp:function(e){return dl(e)&&"classes"!==e},name:"MuiSelect",slot:"NativeInput",overridesResolver:function(e,t){return t.nativeInput}})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function yC(e,t){return"object"===typeof t&&null!==t?e===t:String(e)===String(t)}function GC(e){return null==e||"string"===typeof e&&!e.trim()}var BC=t.forwardRef((function(e,n){var i=e["aria-describedby"],r=e["aria-label"],a=e.autoFocus,o=e.autoWidth,s=e.children,g=e.className,l=e.defaultOpen,u=e.defaultValue,c=e.disabled,I=e.displayEmpty,C=e.IconComponent,d=e.inputRef,h=e.labelId,A=e.MenuProps,p=void 0===A?{}:A,m=e.multiple,f=e.name,v=e.onBlur,b=e.onChange,y=e.onClose,G=e.onFocus,B=e.onOpen,Z=e.open,w=e.readOnly,S=e.renderValue,W=e.SelectDisplayProps,x=void 0===W?{}:W,R=e.tabIndex,V=e.value,k=e.variant,X=void 0===k?"standard":k,Y=sa(e,mC),H=Ir(dC({controlled:V,default:u,name:"Select"}),2),F=H[0],M=H[1],K=Ir(dC({controlled:Z,default:l,name:"Select"}),2),N=K[0],z=K[1],L=t.useRef(null),_=t.useRef(null),T=Ir(t.useState(null),2),E=T[0],J=T[1],D=t.useRef(null!=Z).current,U=Ir(t.useState(),2),P=U[0],Q=U[1],O=Ol(n,d),j=t.useCallback((function(e){_.current=e,e&&J(e)}),[]);t.useImperativeHandle(O,(function(){return{focus:function(){_.current.focus()},node:L.current,value:F}}),[F]),t.useEffect((function(){l&&N&&E&&!D&&(Q(o?null:E.clientWidth),_.current.focus())}),[E,o]),t.useEffect((function(){a&&_.current.focus()}),[a]),t.useEffect((function(){if(h){var e=dc(_.current).getElementById(h);if(e){var t=function(){getSelection().isCollapsed&&_.current.focus()};return e.addEventListener("click",t),function(){e.removeEventListener("click",t)}}}}),[h]);var q,$,ee=function(e,t){e?B&&B(t):y&&y(t),D||(Q(o?null:E.clientWidth),z(e))},te=t.Children.toArray(s),ne=function(e){return function(t){var n;if(t.currentTarget.hasAttribute("tabindex")){if(m){n=Array.isArray(F)?F.slice():[];var i=F.indexOf(e.props.value);-1===i?n.push(e.props.value):n.splice(i,1)}else n=e.props.value;if(e.props.onClick&&e.props.onClick(t),F!==n&&(M(n),b)){var r=t.nativeEvent||t,a=new r.constructor(r.type,r);Object.defineProperty(a,"target",{writable:!0,value:{value:n,name:f}}),b(a,e)}m||ee(!1,t)}}},ie=null!==E&&N;delete Y["aria-invalid"];var re=[],ae=!1;(iu({value:F})||I)&&(S?q=S(F):ae=!0);var oe=te.map((function(e,n,i){if(!t.isValidElement(e))return null;var r;if(m){if(!Array.isArray(F))throw new Error($o(2));r=F.some((function(t){return yC(t,e.props.value)})),r&&ae&&re.push(e.props.children)}else(r=yC(F,e.props.value))&&ae&&($=e.props.children);if(r&&!0,void 0===e.props.value)return t.cloneElement(e,{"aria-readonly":!0,role:"option"});return t.cloneElement(e,{"aria-selected":r?"true":"false",onClick:ne(e),onKeyUp:function(t){" "===t.key&&t.preventDefault(),e.props.onKeyUp&&e.props.onKeyUp(t)},role:"option",selected:void 0===i[0].props.value||!0===i[0].props.disabled?function(){if(F)return r;var t=i.find((function(e){return void 0!==e.props.value&&!0!==e.props.disabled}));return e===t||r}():r,value:void 0,"data-value":e.props.value})}));ae&&(q=m?0===re.length?null:re.reduce((function(e,t,n){return e.push(t),n<re.length-1&&e.push(", "),e}),[]):$);var se,ge=P;!o&&D&&E&&(ge=E.clientWidth),se="undefined"!==typeof R?R:c?null:0;var le=x.id||(f?"mui-component-select-".concat(f):void 0),ue=oa({},e,{variant:X,value:F,open:ie}),ce=function(e){var t=e.classes,n=e.variant,i=e.disabled,r=e.multiple,a=e.open;return fl({select:["select",n,i&&"disabled",r&&"multiple"],icon:["icon","icon".concat(Ql(n)),a&&"iconOpen",i&&"disabled"],nativeInput:["nativeInput"]},hC,t)}(ue);return(0,Kl.jsxs)(t.Fragment,{children:[(0,Kl.jsx)(fC,oa({ref:j,tabIndex:se,role:"button","aria-disabled":c?"true":void 0,"aria-expanded":ie?"true":"false","aria-haspopup":"listbox","aria-label":r,"aria-labelledby":[h,le].filter(Boolean).join(" ")||void 0,"aria-describedby":i,onKeyDown:function(e){if(!w){-1!==[" ","ArrowUp","ArrowDown","Enter"].indexOf(e.key)&&(e.preventDefault(),ee(!0,e))}},onMouseDown:c||w?null:function(e){0===e.button&&(e.preventDefault(),_.current.focus(),ee(!0,e))},onBlur:function(e){!ie&&v&&(Object.defineProperty(e,"target",{writable:!0,value:{value:F,name:f}}),v(e))},onFocus:G},x,{ownerState:ue,className:ml(ce.select,g,x.className),id:le,children:GC(q)?AC||(AC=(0,Kl.jsx)("span",{className:"notranslate",children:"\u200b"})):q})),(0,Kl.jsx)(bC,oa({value:Array.isArray(F)?F.join(","):F,name:f,ref:L,"aria-hidden":!0,onChange:function(e){var t=te.map((function(e){return e.props.value})).indexOf(e.target.value);if(-1!==t){var n=te[t];M(n.props.value),b&&b(e,n)}},tabIndex:-1,disabled:c,className:ce.nativeInput,autoFocus:a,ownerState:ue},Y)),(0,Kl.jsx)(vC,{as:C,className:ce.icon,ownerState:ue}),(0,Kl.jsx)(aC,oa({id:"menu-".concat(f||""),anchorEl:E,open:ie,onClose:function(e){ee(!1,e)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},p,{MenuListProps:oa({"aria-labelledby":h,role:"listbox",disableListWrap:!0},p.MenuListProps),PaperProps:oa({},p.PaperProps,{style:oa({minWidth:ge},null!=p.PaperProps?p.PaperProps.style:null)}),children:oe}))]})})),ZC=BC;function wC(e){return su("MuiSvgIcon",e)}gu("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var SC=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],WC=Al("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,"inherit"!==n.color&&t["color".concat(Ql(n.color))],t["fontSize".concat(Ql(n.fontSize))]]}})((function(e){var t,n,i,r,a,o,s,g,l,u,c,I,C,d,h,A,p,m=e.theme,f=e.ownerState;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,transition:null==(t=m.transitions)||null==(n=t.create)?void 0:n.call(t,"fill",{duration:null==(i=m.transitions)||null==(r=i.duration)?void 0:r.shorter}),fontSize:{inherit:"inherit",small:(null==(a=m.typography)||null==(o=a.pxToRem)?void 0:o.call(a,20))||"1.25rem",medium:(null==(s=m.typography)||null==(g=s.pxToRem)?void 0:g.call(s,24))||"1.5rem",large:(null==(l=m.typography)||null==(u=l.pxToRem)?void 0:u.call(l,35))||"2.1875"}[f.fontSize],color:null!=(c=null==(I=(m.vars||m).palette)||null==(C=I[f.color])?void 0:C.main)?c:{action:null==(d=(m.vars||m).palette)||null==(h=d.action)?void 0:h.active,disabled:null==(A=(m.vars||m).palette)||null==(p=A.action)?void 0:p.disabled,inherit:void 0}[f.color]}})),xC=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiSvgIcon"}),i=n.children,r=n.className,a=n.color,o=void 0===a?"inherit":a,s=n.component,g=void 0===s?"svg":s,l=n.fontSize,u=void 0===l?"medium":l,c=n.htmlColor,I=n.inheritViewBox,C=void 0!==I&&I,d=n.titleAccess,h=n.viewBox,A=void 0===h?"0 0 24 24":h,p=sa(n,SC),m=oa({},n,{color:o,component:g,fontSize:u,instanceFontSize:e.fontSize,inheritViewBox:C,viewBox:A}),f={};C||(f.viewBox=A);var v=function(e){var t=e.color,n=e.fontSize,i=e.classes;return fl({root:["root","inherit"!==t&&"color".concat(Ql(t)),"fontSize".concat(Ql(n))]},wC,i)}(m);return(0,Kl.jsxs)(WC,oa({as:g,className:ml(v.root,r),ownerState:m,focusable:"false",color:c,"aria-hidden":!d||void 0,role:d?"img":void 0,ref:t},f,p,{children:[i,d?(0,Kl.jsx)("title",{children:d}):null]}))}));xC.muiName="SvgIcon";var RC=xC;function VC(e,n){var i=function(t,i){return(0,Kl.jsx)(RC,oa({"data-testid":"".concat(n,"Icon"),ref:i},t,{children:e}))};return i.muiName=RC.muiName,t.memo(t.forwardRef(i))}var kC,XC,YC=VC((0,Kl.jsx)("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),HC=["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"],FC={name:"MuiSelect",overridesResolver:function(e,t){return t.root},shouldForwardProp:function(e){return Cl(e)&&"variant"!==e},slot:"Root"},MC=Al(Zu,FC)(""),KC=Al(Eu,FC)(""),NC=Al(Xu,FC)(""),zC=t.forwardRef((function(e,n){var i=Rl({name:"MuiSelect",props:e}),r=i.autoWidth,a=void 0!==r&&r,o=i.children,s=i.classes,g=void 0===s?{}:s,l=i.className,u=i.defaultOpen,c=void 0!==u&&u,I=i.displayEmpty,C=void 0!==I&&I,d=i.IconComponent,h=void 0===d?YC:d,A=i.id,p=i.input,m=i.inputProps,f=i.label,v=i.labelId,b=i.MenuProps,y=i.multiple,G=void 0!==y&&y,B=i.native,Z=void 0!==B&&B,w=i.onClose,S=i.onOpen,W=i.open,x=i.renderValue,R=i.SelectDisplayProps,V=i.variant,k=void 0===V?"outlined":V,X=sa(i,HC),Y=Z?CC:ZC,H=Dl({props:i,muiFormControl:Pl(),states:["variant"]}).variant||k,F=p||{standard:kC||(kC=(0,Kl.jsx)(MC,{})),outlined:(0,Kl.jsx)(KC,{label:f}),filled:XC||(XC=(0,Kl.jsx)(NC,{}))}[H],M=function(e){return e.classes}(oa({},i,{variant:H,classes:g})),K=Ol(n,F.ref);return t.cloneElement(F,oa({inputComponent:Y,inputProps:oa({children:o,IconComponent:h,variant:H,type:void 0,multiple:G},Z?{id:A}:{autoWidth:a,defaultOpen:c,displayEmpty:C,labelId:v,MenuProps:b,onClose:w,onOpen:S,open:W,renderValue:x,SelectDisplayProps:oa({id:A},R)},m,{classes:m?To(M,m.classes):M},p?p.props.inputProps:{})},G&&Z&&"outlined"===H?{notched:!0}:{},{ref:K,className:ml(F.props.className,l),variant:H},X))}));zC.muiName="Select";var LC=zC;function _C(e){return su("MuiTextField",e)}gu("MuiTextField",["root"]);var TC=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],EC={standard:Zu,filled:Xu,outlined:Eu},JC=Al(sc,{name:"MuiTextField",slot:"Root",overridesResolver:function(e,t){return t.root}})({}),DC=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiTextField"}),i=n.autoComplete,r=n.autoFocus,a=void 0!==r&&r,o=n.children,s=n.className,g=n.color,l=void 0===g?"primary":g,u=n.defaultValue,c=n.disabled,I=void 0!==c&&c,C=n.error,d=void 0!==C&&C,h=n.FormHelperTextProps,A=n.fullWidth,p=void 0!==A&&A,m=n.helperText,f=n.id,v=n.InputLabelProps,b=n.inputProps,y=n.InputProps,G=n.inputRef,B=n.label,Z=n.maxRows,w=n.minRows,S=n.multiline,W=void 0!==S&&S,x=n.name,R=n.onBlur,V=n.onChange,k=n.onFocus,X=n.placeholder,Y=n.required,H=void 0!==Y&&Y,F=n.rows,M=n.select,K=void 0!==M&&M,N=n.SelectProps,z=n.type,L=n.value,_=n.variant,T=void 0===_?"outlined":_,E=sa(n,TC),J=oa({},n,{autoFocus:a,color:l,disabled:I,error:d,fullWidth:p,multiline:W,required:H,select:K,variant:T}),D=function(e){return fl({root:["root"]},_C,e.classes)}(J);var U={};"outlined"===T&&(v&&"undefined"!==typeof v.shrink&&(U.notched=v.shrink),U.label=B),K&&(N&&N.native||(U.id=void 0),U["aria-describedby"]=void 0);var P=yl(f),Q=m&&P?"".concat(P,"-helper-text"):void 0,O=B&&P?"".concat(P,"-label"):void 0,j=EC[T],q=(0,Kl.jsx)(j,oa({"aria-describedby":Q,autoComplete:i,autoFocus:a,defaultValue:u,fullWidth:p,multiline:W,name:x,rows:F,maxRows:Z,minRows:w,type:z,value:L,id:P,inputRef:G,onBlur:R,onChange:V,onFocus:k,placeholder:X,inputProps:b},U,y));return(0,Kl.jsxs)(JC,oa({className:ml(D.root,s),disabled:I,error:d,fullWidth:p,ref:t,required:H,color:l,variant:T,ownerState:J},E,{children:[null!=B&&""!==B&&(0,Kl.jsx)(tc,oa({htmlFor:P,id:O},v,{children:B})),K?(0,Kl.jsx)(LC,oa({"aria-describedby":Q,id:P,labelId:O,value:L,input:q},N,{children:o})):q,m&&(0,Kl.jsx)(Cc,oa({id:Q},h,{children:m}))]}))}));Al(DC)((function(e){var t=e.theme;return{"label + &":{marginTop:t.spacing(3)},"& .MuiInputBase-input":{color:t.palette.primary.main,borderBottom:"1px solid #ced4da",fontSize:14,padding:"10px 12px"},"& .MuiInput-root":{padding:0},"& MuiInputBase-multiline":{padding:0}}}));var UC="function"===typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__";var PC=function(e){var n=e.children,i=e.theme,r=Zl(),a=t.useMemo((function(){var e=null===r?i:function(e,t){return"function"===typeof t?t(e):oa({},e,t)}(r,i);return null!=e&&(e[UC]=null!==r),e}),[i,r]);return(0,Kl.jsx)(Bl.Provider,{value:a,children:n})};function QC(e){var t=xl();return(0,Kl.jsx)(Wo.Provider,{value:"object"===typeof t?t:{},children:e.children})}var OC=function(e){var t=e.children,n=e.theme;return(0,Kl.jsx)(PC,{theme:n,children:(0,Kl.jsx)(QC,{children:t})})},jC=cl({palette:{primary:{main:"rgb(255, 255, 255)",contrastText:"rgb(25,, 255, 255)"}},typography:{fontFamily:"DM Sans, sans-serif"}});function qC(e){var t=e.children;return(0,Kl.jsx)(OC,{theme:jC,children:t})}var $C=["sx"];function ed(e){var t,n=e.sx,i=function(e){var t={systemProps:{},otherProps:{}};return Object.keys(e).forEach((function(n){hg[n]?t.systemProps[n]=e[n]:t.otherProps[n]=e[n]})),t}(sa(e,$C)),r=i.systemProps,a=i.otherProps;return t=Array.isArray(n)?[r].concat(Ci(n)):"function"===typeof n?function(){var e=n.apply(void 0,arguments);return _o(e)?oa({},r,e):r}:oa({},r,n),oa({},a,{sx:t})}var td=["className","component"];var nd=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.defaultTheme,i=e.defaultClassName,r=void 0===i?"MuiBox-root":i,a=e.generateClassName,o=e.styleFunctionSx,s=void 0===o?fg:o,g=Lo("div")(s),l=t.forwardRef((function(e,t){var i=xl(n),o=ed(e),s=o.className,l=o.component,u=void 0===l?"div":l,c=sa(o,td);return(0,Kl.jsx)(g,oa({as:u,ref:t,className:ml(s,a?a(r):r),theme:i},c))}));return l}({defaultTheme:cl(),defaultClassName:"MuiBox-root",generateClassName:au.generate}),id=nd;function rd(e){return su("MuiTypography",e)}gu("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);var ad=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],od=Al("span",{name:"MuiTypography",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,n.variant&&t[n.variant],"inherit"!==n.align&&t["align".concat(Ql(n.align))],n.noWrap&&t.noWrap,n.gutterBottom&&t.gutterBottom,n.paragraph&&t.paragraph]}})((function(e){var t=e.theme,n=e.ownerState;return oa({margin:0},n.variant&&t.typography[n.variant],"inherit"!==n.align&&{textAlign:n.align},n.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},n.gutterBottom&&{marginBottom:"0.35em"},n.paragraph&&{marginBottom:16})})),sd={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},gd={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},ld=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiTypography"}),i=function(e){return gd[e]||e}(n.color),r=ed(oa({},n,{color:i})),a=r.align,o=void 0===a?"inherit":a,s=r.className,g=r.component,l=r.gutterBottom,u=void 0!==l&&l,c=r.noWrap,I=void 0!==c&&c,C=r.paragraph,d=void 0!==C&&C,h=r.variant,A=void 0===h?"body1":h,p=r.variantMapping,m=void 0===p?sd:p,f=sa(r,ad),v=oa({},r,{align:o,color:i,className:s,component:g,gutterBottom:u,noWrap:I,paragraph:d,variant:A,variantMapping:m}),b=g||(d?"p":m[A]||sd[A])||"span",y=function(e){var t=e.align,n=e.gutterBottom,i=e.noWrap,r=e.paragraph,a=e.variant,o=e.classes;return fl({root:["root",a,"inherit"!==e.align&&"align".concat(Ql(t)),n&&"gutterBottom",i&&"noWrap",r&&"paragraph"]},rd,o)}(v);return(0,Kl.jsx)(od,oa({as:b,ref:t,ownerState:v,className:ml(y.root,s)},f))})),ud=ld;function cd(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Id(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var Cd,dd,hd,Ad,pd,md,fd,vd,bd,yd={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Gd={duration:.5,overwrite:!1,delay:0},Bd=1e8,Zd=1e-8,wd=2*Math.PI,Sd=wd/4,Wd=0,xd=Math.sqrt,Rd=Math.cos,Vd=Math.sin,kd=function(e){return"string"===typeof e},Xd=function(e){return"function"===typeof e},Yd=function(e){return"number"===typeof e},Hd=function(e){return"undefined"===typeof e},Fd=function(e){return"object"===typeof e},Md=function(e){return!1!==e},Kd=function(){return"undefined"!==typeof window},Nd=function(e){return Xd(e)||kd(e)},zd="function"===typeof ArrayBuffer&&ArrayBuffer.isView||function(){},Ld=Array.isArray,_d=/(?:-?\.?\d|\.)+/gi,Td=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Ed=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Jd=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Dd=/[+-]=-?[.\d]+/,Ud=/[^,'"\[\]\s]+/gi,Pd=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Qd={},Od={},jd=function(e){return(Od=Gh(e,Qd))&&Ip},qd=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},$d=function(e,t){return!t&&console.warn(e)},eh=function(e,t){return e&&(Qd[e]=t)&&Od&&(Od[e]=t)||Qd},th=function(){return 0},nh={},ih=[],rh={},ah={},oh={},sh=30,gh=[],lh="",uh=function(e){var t,n,i=e[0];if(Fd(i)||Xd(i)||(e=[e]),!(t=(i._gsap||{}).harness)){for(n=gh.length;n--&&!gh[n].targetTest(i););t=gh[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new HA(e[n],t)))||e.splice(n,1);return e},ch=function(e){return e._gsap||uh(eA(e))[0]._gsap},Ih=function(e,t,n){return(n=e[t])&&Xd(n)?e[t]():Hd(n)&&e.getAttribute&&e.getAttribute(t)||n},Ch=function(e,t){return(e=e.split(",")).forEach(t)||e},dh=function(e){return Math.round(1e5*e)/1e5||0},hh=function(e){return Math.round(1e7*e)/1e7||0},Ah=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),"+"===n?e+i:"-"===n?e-i:"*"===n?e*i:e/i},ph=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},mh=function(){var e,t,n=ih.length,i=ih.slice(0);for(rh={},ih.length=0,e=0;e<n;e++)(t=i[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},fh=function(e,t,n,i){ih.length&&mh(),e.render(t,n,i),ih.length&&mh()},vh=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(Ud).length<2?t:kd(e)?e.trim():e},bh=function(e){return e},yh=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Gh=function(e,t){for(var n in t)e[n]=t[n];return e},Bh=function e(t,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(t[i]=Fd(n[i])?e(t[i]||(t[i]={}),n[i]):n[i]);return t},Zh=function(e,t){var n,i={};for(n in e)n in t||(i[n]=e[n]);return i},wh=function(e){var t,n=e.parent||dd,i=e.keyframes?(t=Ld(e.keyframes),function(e,n){for(var i in n)i in e||"duration"===i&&t||"ease"===i||(e[i]=n[i])}):yh;if(Md(e.inherit))for(;n;)i(e,n.vars.defaults),n=n.parent||n._dp;return e},Sh=function(e,t,n,i,r){void 0===n&&(n="_first"),void 0===i&&(i="_last");var a,o=e[i];if(r)for(a=t[r];o&&o[r]>a;)o=o._prev;return o?(t._next=o._next,o._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=o,t.parent=t._dp=e,t},Wh=function(e,t,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=t._prev,a=t._next;r?r._next=a:e[n]===t&&(e[n]=a),a?a._prev=r:e[i]===t&&(e[i]=r),t._next=t._prev=t.parent=null},xh=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},Rh=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},Vh=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},kh=function e(t){return!t||t._ts&&e(t.parent)},Xh=function(e){return e._repeat?Yh(e._tTime,e=e.duration()+e._rDelay)*e:0},Yh=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},Hh=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Fh=function(e){return e._end=hh(e._start+(e._tDur/Math.abs(e._ts||e._rts||Zd)||0))},Mh=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=hh(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Fh(e),n._dirty||Rh(n,e)),e},Kh=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=Hh(e.rawTime(),t),(!t._dur||Oh(0,t.totalDuration(),n)-t._tTime>Zd)&&t.render(n,!0)),Rh(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},Nh=function(e,t,n,i){return t.parent&&xh(t),t._start=hh((Yd(n)?n:n||e!==dd?Uh(e,n,t):e._time)+t._delay),t._end=hh(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Sh(e,t,"_first","_last",e._sort?"_start":0),Th(t)||(e._recent=t),i||Kh(e,t),e},zh=function(e,t){return(Qd.ScrollTrigger||qd("scrollTrigger",t))&&Qd.ScrollTrigger.create(t,e)},Lh=function(e,t,n,i){return TA(e,t),e._initted?!n&&e._pt&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&fd!==yA.frame?(ih.push(e),e._lazy=[t,i],1):void 0:1},_h=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},Th=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},Eh=function(e,t,n,i){var r=e._repeat,a=hh(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=a/e._dur),e._dur=a,e._tDur=r?r<0?1e10:hh(a*(r+1)+e._rDelay*r):a,o>0&&!i?Mh(e,e._tTime=e._tDur*o):e.parent&&Fh(e),n||Rh(e.parent,e),e},Jh=function(e){return e instanceof MA?Rh(e):Eh(e,e._dur)},Dh={_start:0,endTime:th,totalDuration:th},Uh=function e(t,n,i){var r,a,o,s=t.labels,g=t._recent||Dh,l=t.duration()>=Bd?g.endTime(!1):t._dur;return kd(n)&&(isNaN(n)||n in s)?(a=n.charAt(0),o="%"===n.substr(-1),r=n.indexOf("="),"<"===a||">"===a?(r>=0&&(n=n.replace(/=/,"")),("<"===a?g._start:g.endTime(g._repeat>=0))+(parseFloat(n.substr(1))||0)*(o?(r<0?g:i).totalDuration()/100:1)):r<0?(n in s||(s[n]=l),s[n]):(a=parseFloat(n.charAt(r-1)+n.substr(r+1)),o&&i&&(a=a/100*(Ld(i)?i[0]:i).totalDuration()),r>1?e(t,n.substr(0,r-1),i)+a:l+a)):null==n?l:+n},Ph=function(e,t,n){var i,r,a=Yd(t[1]),o=(a?2:1)+(e<2?0:1),s=t[o];if(a&&(s.duration=t[1]),s.parent=n,e){for(i=s,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=Md(r.vars.inherit)&&r.parent;s.immediateRender=Md(i.immediateRender),e<2?s.runBackwards=1:s.startAt=t[o-1]}return new PA(t[0],s,t[o+1])},Qh=function(e,t){return e||0===e?t(e):t},Oh=function(e,t,n){return n<e?e:n>t?t:n},jh=function(e,t){return kd(e)&&(t=Pd.exec(e))?t[1]:""},qh=[].slice,$h=function(e,t){return e&&Fd(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Fd(e[0]))&&!e.nodeType&&e!==hd},eA=function(e,t,n){return!kd(e)||n||!Ad&&GA()?Ld(e)?function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var i;return kd(e)&&!t||$h(e,1)?(i=n).push.apply(i,eA(e)):n.push(e)}))||n}(e,n):$h(e)?qh.call(e,0):e?[e]:[]:qh.call((t||pd).querySelectorAll(e),0)},tA=function(e){return e.sort((function(){return.5-Math.random()}))},nA=function(e){if(Xd(e))return e;var t=Fd(e)?e:{each:e},n=RA(t.ease),i=t.from||0,r=parseFloat(t.base)||0,a={},o=i>0&&i<1,s=isNaN(i)||o,g=t.axis,l=i,u=i;return kd(i)?l=u={center:.5,edges:.5,end:1}[i]||0:!o&&s&&(l=i[0],u=i[1]),function(e,o,c){var I,C,d,h,A,p,m,f,v,b=(c||t).length,y=a[b];if(!y){if(!(v="auto"===t.grid?0:(t.grid||[1,Bd])[1])){for(m=-Bd;m<(m=c[v++].getBoundingClientRect().left)&&v<b;);v--}for(y=a[b]=[],I=s?Math.min(v,b)*l-.5:i%v,C=v===Bd?0:s?b*u/v-.5:i/v|0,m=0,f=Bd,p=0;p<b;p++)d=p%v-I,h=C-(p/v|0),y[p]=A=g?Math.abs("y"===g?h:d):xd(d*d+h*h),A>m&&(m=A),A<f&&(f=A);"random"===i&&tA(y),y.max=m-f,y.min=f,y.v=b=(parseFloat(t.amount)||parseFloat(t.each)*(v>b?b-1:g?"y"===g?b/v:v:Math.max(v,b/v))||0)*("edges"===i?-1:1),y.b=b<0?r-b:r,y.u=jh(t.amount||t.each)||0,n=n&&b<0?WA(n):n}return b=(y[e]-y.min)/y.max||0,hh(y.b+(n?n(b):b)*y.v)+y.u}},iA=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=Math.round(parseFloat(n)/e)*e*t;return(i-i%1)/t+(Yd(n)?0:jh(n))}},rA=function(e,t){var n,i,r=Ld(e);return!r&&Fd(e)&&(n=r=e.radius||Bd,e.values?(e=eA(e.values),(i=!Yd(e[0]))&&(n*=n)):e=iA(e.increment)),Qh(t,r?Xd(e)?function(t){return i=e(t),Math.abs(i-t)<=n?i:t}:function(t){for(var r,a,o=parseFloat(i?t.x:t),s=parseFloat(i?t.y:0),g=Bd,l=0,u=e.length;u--;)(r=i?(r=e[u].x-o)*r+(a=e[u].y-s)*a:Math.abs(e[u]-o))<g&&(g=r,l=u);return l=!n||g<=n?e[l]:t,i||l===t||Yd(t)?l:l+jh(t)}:iA(e))},aA=function(e,t,n,i){return Qh(Ld(e)?!t:!0===n?!!(n=0):!i,(function(){return Ld(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*i)/i}))},oA=function(e,t,n){return Qh(n,(function(n){return e[~~t(n)]}))},sA=function(e){for(var t,n,i,r,a=0,o="";~(t=e.indexOf("random(",a));)i=e.indexOf(")",t),r="["===e.charAt(t+7),n=e.substr(t+7,i-t-7).match(r?Ud:_d),o+=e.substr(a,t-a)+aA(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),a=i+1;return o+e.substr(a,e.length-a)},gA=function(e,t,n,i,r){var a=t-e,o=i-n;return Qh(r,(function(t){return n+((t-e)/a*o||0)}))},lA=function(e,t,n){var i,r,a,o=e.labels,s=Bd;for(i in o)(r=o[i]-t)<0===!!n&&r&&s>(r=Math.abs(r))&&(a=i,s=r);return a},uA=function(e,t,n){var i,r,a=e.vars,o=a[t];if(o)return i=a[t+"Params"],r=a.callbackScope||e,n&&ih.length&&mh(),i?o.apply(r,i):o.call(r)},cA=function(e){return xh(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&uA(e,"onInterrupt"),e},IA=function(e){var t=(e=!e.name&&e.default||e).name,n=Xd(e),i=t&&!n&&e.init?function(){this._props=[]}:e,r={init:th,render:ip,add:LA,kill:ap,modifier:rp,rawVars:0},a={targetTest:0,get:0,getSetter:$A,aliases:{},register:0};if(GA(),e!==i){if(ah[t])return;yh(i,yh(Zh(e,r),a)),Gh(i.prototype,Gh(r,Zh(e,a))),ah[i.prop=t]=i,e.targetTest&&(gh.push(i),nh[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}eh(t,i),e.register&&e.register(Ip,i,gp)},CA=255,dA={aqua:[0,CA,CA],lime:[0,CA,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,CA],navy:[0,0,128],white:[CA,CA,CA],olive:[128,128,0],yellow:[CA,CA,0],orange:[CA,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[CA,0,0],pink:[CA,192,203],cyan:[0,CA,CA],transparent:[CA,CA,CA,0]},hA=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*CA+.5|0},AA=function(e,t,n){var i,r,a,o,s,g,l,u,c,I,C=e?Yd(e)?[e>>16,e>>8&CA,e&CA]:0:dA.black;if(!C){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),dA[e])C=dA[e];else if("#"===e.charAt(0)){if(e.length<6&&(i=e.charAt(1),r=e.charAt(2),a=e.charAt(3),e="#"+i+i+r+r+a+a+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(C=parseInt(e.substr(1,6),16))>>16,C>>8&CA,C&CA,parseInt(e.substr(7),16)/255];C=[(e=parseInt(e.substr(1),16))>>16,e>>8&CA,e&CA]}else if("hsl"===e.substr(0,3))if(C=I=e.match(_d),t){if(~e.indexOf("="))return C=e.match(Td),n&&C.length<4&&(C[3]=1),C}else o=+C[0]%360/360,s=+C[1]/100,i=2*(g=+C[2]/100)-(r=g<=.5?g*(s+1):g+s-g*s),C.length>3&&(C[3]*=1),C[0]=hA(o+1/3,i,r),C[1]=hA(o,i,r),C[2]=hA(o-1/3,i,r);else C=e.match(_d)||dA.transparent;C=C.map(Number)}return t&&!I&&(i=C[0]/CA,r=C[1]/CA,a=C[2]/CA,g=((l=Math.max(i,r,a))+(u=Math.min(i,r,a)))/2,l===u?o=s=0:(c=l-u,s=g>.5?c/(2-l-u):c/(l+u),o=l===i?(r-a)/c+(r<a?6:0):l===r?(a-i)/c+2:(i-r)/c+4,o*=60),C[0]=~~(o+.5),C[1]=~~(100*s+.5),C[2]=~~(100*g+.5)),n&&C.length<4&&(C[3]=1),C},pA=function(e){var t=[],n=[],i=-1;return e.split(fA).forEach((function(e){var r=e.match(Ed)||[];t.push.apply(t,r),n.push(i+=r.length+1)})),t.c=n,t},mA=function(e,t,n){var i,r,a,o,s="",g=(e+s).match(fA),l=t?"hsla(":"rgba(",u=0;if(!g)return e;if(g=g.map((function(e){return(e=AA(e,t,1))&&l+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(a=pA(e),(i=n.c).join(s)!==a.c.join(s)))for(o=(r=e.replace(fA,"1").split(Ed)).length-1;u<o;u++)s+=r[u]+(~i.indexOf(u)?g.shift()||l+"0,0,0,0)":(a.length?a:g.length?g:n).shift());if(!r)for(o=(r=e.split(fA)).length-1;u<o;u++)s+=r[u]+g[u];return s+r[o]},fA=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in dA)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),vA=/hsl[a]?\(/,bA=function(e){var t,n=e.join(" ");if(fA.lastIndex=0,fA.test(n))return t=vA.test(n),e[1]=mA(e[1],t),e[0]=mA(e[0],t,pA(e[1])),!0},yA=function(){var e,t,n,i,r,a,o=Date.now,s=500,g=33,l=o(),u=l,c=1e3/240,I=c,C=[],d=function n(d){var h,A,p,m,f=o()-u,v=!0===d;if(f>s&&(l+=f-g),((h=(p=(u+=f)-l)-I)>0||v)&&(m=++i.frame,r=p-1e3*i.time,i.time=p/=1e3,I+=h+(h>=c?4:c-h),A=1),v||(e=t(n)),A)for(a=0;a<C.length;a++)C[a](p,r,m,d)};return i={time:0,frame:0,tick:function(){d(!0)},deltaRatio:function(e){return r/(1e3/(e||60))},wake:function(){md&&(!Ad&&Kd()&&(hd=Ad=window,pd=hd.document||{},Qd.gsap=Ip,(hd.gsapVersions||(hd.gsapVersions=[])).push(Ip.version),jd(Od||hd.GreenSockGlobals||!hd.gsap&&hd||{}),n=hd.requestAnimationFrame),e&&i.sleep(),t=n||function(e){return setTimeout(e,I-1e3*i.time+1|0)},bd=1,d(2))},sleep:function(){(n?hd.cancelAnimationFrame:clearTimeout)(e),bd=0,t=th},lagSmoothing:function(e,t){s=e||1e8,g=Math.min(t,s,0)},fps:function(e){c=1e3/(e||240),I=1e3*i.time+c},add:function(e,t,n){var r=t?function(t,n,a,o){e(t,n,a,o),i.remove(r)}:e;return i.remove(e),C[n?"unshift":"push"](r),GA(),r},remove:function(e,t){~(t=C.indexOf(e))&&C.splice(t,1)&&a>=t&&a--},_listeners:C},i}(),GA=function(){return!bd&&yA.wake()},BA={},ZA=/^[\d.\-M][\d.\-,\s]/,wA=/["']/g,SA=function(e){for(var t,n,i,r={},a=e.substr(1,e.length-3).split(":"),o=a[0],s=1,g=a.length;s<g;s++)n=a[s],t=s!==g-1?n.lastIndexOf(","):n.length,i=n.substr(0,t),r[o]=isNaN(i)?i.replace(wA,"").trim():+i,o=n.substr(t+1).trim();return r},WA=function(e){return function(t){return 1-e(1-t)}},xA=function e(t,n){for(var i,r=t._first;r;)r instanceof MA?e(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?e(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},RA=function(e,t){return e&&(Xd(e)?e:BA[e]||function(e){var t=(e+"").split("("),n=BA[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[SA(t[1])]:function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)}(e).split(",").map(vh)):BA._CE&&ZA.test(e)?BA._CE("",e):n}(e))||t},VA=function(e,t,n,i){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===i&&(i=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var r,a={easeIn:t,easeOut:n,easeInOut:i};return Ch(e,(function(e){for(var t in BA[e]=Qd[e]=a,BA[r=e.toLowerCase()]=n,a)BA[r+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=BA[e+"."+t]=a[t]})),a},kA=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},XA=function e(t,n,i){var r=n>=1?n:1,a=(i||(t?.3:.45))/(n<1?n:1),o=a/wd*(Math.asin(1/r)||0),s=function(e){return 1===e?1:r*Math.pow(2,-10*e)*Vd((e-o)*a)+1},g="out"===t?s:"in"===t?function(e){return 1-s(1-e)}:kA(s);return a=wd/a,g.config=function(n,i){return e(t,n,i)},g},YA=function e(t,n){void 0===n&&(n=1.70158);var i=function(e){return e?--e*e*((n+1)*e+n)+1:0},r="out"===t?i:"in"===t?function(e){return 1-i(1-e)}:kA(i);return r.config=function(n){return e(t,n)},r};Ch("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;VA(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),BA.Linear.easeNone=BA.none=BA.Linear.easeIn,VA("Elastic",XA("in"),XA("out"),XA()),function(e,t){var n=1/t,i=function(i){return i<n?e*i*i:i<.7272727272727273?e*Math.pow(i-1.5/t,2)+.75:i<.9090909090909092?e*(i-=2.25/t)*i+.9375:e*Math.pow(i-2.625/t,2)+.984375};VA("Bounce",(function(e){return 1-i(1-e)}),i)}(7.5625,2.75),VA("Expo",(function(e){return e?Math.pow(2,10*(e-1)):0})),VA("Circ",(function(e){return-(xd(1-e*e)-1)})),VA("Sine",(function(e){return 1===e?1:1-Rd(e*Sd)})),VA("Back",YA("in"),YA("out"),YA()),BA.SteppedEase=BA.steps=Qd.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,i=e+(t?0:1),r=t?1:0;return function(e){return((i*Oh(0,.99999999,e)|0)+r)*n}}},Gd.ease=BA["quad.out"],Ch("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return lh+=e+","+e+"Params,"}));var HA=function(e,t){this.id=Wd++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Ih,this.set=t?t.getSetter:$A},FA=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Eh(this,+e.duration,1,1),this.data=e.data,bd||yA.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,Eh(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(GA(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Mh(this,e),!n._dp||n.parent||Kh(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&Nh(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===Zd||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),fh(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+Xh(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+Xh(this),t):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?Yh(this._tTime,n)+1:1},t.timeScale=function(e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var t=this.parent&&this._ts?Hh(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,this.totalTime(Oh(-this._delay,this._tDur,t),!0),Fh(this),Vh(this)},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(GA(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==Zd&&(this._tTime-=Zd)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&Nh(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(Md(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Hh(t.rawTime(e),this):this._tTime:this._tTime},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(t._ts||1),t=t._dp;return n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,Jh(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,Jh(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(Uh(this,e),Md(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,Md(t))},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-Zd))},t.eventCallback=function(e,t,n){var i=this.vars;return arguments.length>1?(t?(i[e]=t,n&&(i[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete i[e],this):i[e]},t.then=function(e){var t=this;return new Promise((function(n){var i=Xd(e)?e:bh,r=function(){var e=t.then;t.then=null,Xd(i)&&(i=i(t))&&(i.then||i===t)&&(t.then=e),n(i),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?r():t._prom=r}))},t.kill=function(){cA(this)},e}();yh(FA.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var MA=function(e){function t(t,n){var i;return void 0===t&&(t={}),(i=e.call(this,t)||this).labels={},i.smoothChildTiming=!!t.smoothChildTiming,i.autoRemoveChildren=!!t.autoRemoveChildren,i._sort=Md(t.sortChildren),dd&&Nh(t.parent||dd,cd(i),n),t.reversed&&i.reverse(),t.paused&&i.paused(!0),t.scrollTrigger&&zh(cd(i),t.scrollTrigger),i}Id(t,e);var n=t.prototype;return n.to=function(e,t,n){return Ph(0,arguments,this),this},n.from=function(e,t,n){return Ph(1,arguments,this),this},n.fromTo=function(e,t,n,i){return Ph(2,arguments,this),this},n.set=function(e,t,n){return t.duration=0,t.parent=this,wh(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new PA(e,t,Uh(this,n),1),this},n.call=function(e,t,n){return Nh(this,PA.delayedCall(0,e,t),n)},n.staggerTo=function(e,t,n,i,r,a,o){return n.duration=t,n.stagger=n.stagger||i,n.onComplete=a,n.onCompleteParams=o,n.parent=this,new PA(e,n,Uh(this,r)),this},n.staggerFrom=function(e,t,n,i,r,a,o){return n.runBackwards=1,wh(n).immediateRender=Md(n.immediateRender),this.staggerTo(e,t,n,i,r,a,o)},n.staggerFromTo=function(e,t,n,i,r,a,o,s){return i.startAt=n,wh(i).immediateRender=Md(i.immediateRender),this.staggerTo(e,t,i,r,a,o,s)},n.render=function(e,t,n){var i,r,a,o,s,g,l,u,c,I,C,d,h=this._time,A=this._dirty?this.totalDuration():this._tDur,p=this._dur,m=e<=0?0:hh(e),f=this._zTime<0!==e<0&&(this._initted||!p);if(this!==dd&&m>A&&e>=0&&(m=A),m!==this._tTime||n||f){if(h!==this._time&&p&&(m+=this._time-h,e+=this._time-h),i=m,c=this._start,g=!(u=this._ts),f&&(p||(h=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(C=this._yoyo,s=p+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*s+e,t,n);if(i=hh(m%s),m===A?(o=this._repeat,i=p):((o=~~(m/s))&&o===m/s&&(i=p,o--),i>p&&(i=p)),I=Yh(this._tTime,s),!h&&this._tTime&&I!==o&&(I=o),C&&1&o&&(i=p-i,d=1),o!==I&&!this._lock){var v=C&&1&I,b=v===(C&&1&o);if(o<I&&(v=!v),h=v?0:p,this._lock=1,this.render(h||(d?0:hh(o*s)),t,!p)._lock=0,this._tTime=m,!t&&this.parent&&uA(this,"onRepeat"),this.vars.repeatRefresh&&!d&&(this.invalidate()._lock=1),h&&h!==this._time||g!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(p=this._dur,A=this._tDur,b&&(this._lock=2,h=v?p:-1e-4,this.render(h,!0),this.vars.repeatRefresh&&!d&&this.invalidate()),this._lock=0,!this._ts&&!g)return this;xA(this,d)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(l=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<t)return i;i=i._prev}}(this,hh(h),hh(i)),l&&(m-=i-(i=l._start))),this._tTime=m,this._time=i,this._act=!u,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,h=0),!h&&i&&!t&&(uA(this,"onStart"),this._tTime!==m))return this;if(i>=h&&e>=0)for(r=this._first;r;){if(a=r._next,(r._act||i>=r._start)&&r._ts&&l!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(i-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(i-r._start)*r._ts,t,n),i!==this._time||!this._ts&&!g){l=0,a&&(m+=this._zTime=-1e-8);break}}r=a}else{r=this._last;for(var y=e<0?e:i;r;){if(a=r._prev,(r._act||y<=r._end)&&r._ts&&l!==r){if(r.parent!==this)return this.render(e,t,n);if(r.render(r._ts>0?(y-r._start)*r._ts:(r._dirty?r.totalDuration():r._tDur)+(y-r._start)*r._ts,t,n),i!==this._time||!this._ts&&!g){l=0,a&&(m+=this._zTime=y?-1e-8:Zd);break}}r=a}}if(l&&!t&&(this.pause(),l.render(i>=h?0:-1e-8)._zTime=i>=h?1:-1,this._ts))return this._start=c,Fh(this),this.render(e,t,n);this._onUpdate&&!t&&uA(this,"onUpdate",!0),(m===A&&this._tTime>=this.totalDuration()||!m&&h)&&(c!==this._start&&Math.abs(u)===Math.abs(this._ts)||this._lock||((e||!p)&&(m===A&&this._ts>0||!m&&this._ts<0)&&xh(this,1),t||e<0&&!h||!m&&!h&&A||(uA(this,m===A&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(m<A&&this.timeScale()>0)&&this._prom())))}return this},n.add=function(e,t){var n=this;if(Yd(t)||(t=Uh(this,t,e)),!(e instanceof FA)){if(Ld(e))return e.forEach((function(e){return n.add(e,t)})),this;if(kd(e))return this.addLabel(e,t);if(!Xd(e))return this;e=PA.delayedCall(0,e)}return this!==e?Nh(this,e,t):this},n.getChildren=function(e,t,n,i){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===i&&(i=-Bd);for(var r=[],a=this._first;a;)a._start>=i&&(a instanceof PA?t&&r.push(a):(n&&r.push(a),e&&r.push.apply(r,a.getChildren(!0,t,n)))),a=a._next;return r},n.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},n.remove=function(e){return kd(e)?this.removeLabel(e):Xd(e)?this.killTweensOf(e):(Wh(this,e),e===this._recent&&(this._recent=this._last),Rh(this))},n.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=hh(yA.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},n.addLabel=function(e,t){return this.labels[e]=Uh(this,t),this},n.removeLabel=function(e){return delete this.labels[e],this},n.addPause=function(e,t,n){var i=PA.delayedCall(0,t||th,n);return i.data="isPause",this._hasPause=1,Nh(this,i,Uh(this,e))},n.removePause=function(e){var t=this._first;for(e=Uh(this,e);t;)t._start===e&&"isPause"===t.data&&xh(t),t=t._next},n.killTweensOf=function(e,t,n){for(var i=this.getTweensOf(e,n),r=i.length;r--;)KA!==i[r]&&i[r].kill(e,t);return this},n.getTweensOf=function(e,t){for(var n,i=[],r=eA(e),a=this._first,o=Yd(t);a;)a instanceof PA?ph(a._targets,r)&&(o?(!KA||a._initted&&a._ts)&&a.globalTime(0)<=t&&a.globalTime(a.totalDuration())>t:!t||a.isActive())&&i.push(a):(n=a.getTweensOf(r,t)).length&&i.push.apply(i,n),a=a._next;return i},n.tweenTo=function(e,t){t=t||{};var n,i=this,r=Uh(i,e),a=t,o=a.startAt,s=a.onStart,g=a.onStartParams,l=a.immediateRender,u=PA.to(i,yh({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:t.duration||Math.abs((r-(o&&"time"in o?o.time:i._time))/i.timeScale())||Zd,onStart:function(){if(i.pause(),!n){var e=t.duration||Math.abs((r-(o&&"time"in o?o.time:i._time))/i.timeScale());u._dur!==e&&Eh(u,e,0,1).render(u._time,!0,!0),n=1}s&&s.apply(u,g||[])}},t));return l?u.render(0):u},n.tweenFromTo=function(e,t,n){return this.tweenTo(t,yh({startAt:{time:Uh(this,e)}},n))},n.recent=function(){return this._recent},n.nextLabel=function(e){return void 0===e&&(e=this._time),lA(this,Uh(this,e))},n.previousLabel=function(e){return void 0===e&&(e=this._time),lA(this,Uh(this,e),1)},n.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+Zd)},n.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var i,r=this._first,a=this.labels;r;)r._start>=n&&(r._start+=e,r._end+=e),r=r._next;if(t)for(i in a)a[i]>=n&&(a[i]+=e);return Rh(this)},n.invalidate=function(){var t=this._first;for(this._lock=0;t;)t.invalidate(),t=t._next;return e.prototype.invalidate.call(this)},n.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),Rh(this)},n.totalDuration=function(e){var t,n,i,r=0,a=this,o=a._last,s=Bd;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-e:e));if(a._dirty){for(i=a.parent;o;)t=o._prev,o._dirty&&o.totalDuration(),(n=o._start)>s&&a._sort&&o._ts&&!a._lock?(a._lock=1,Nh(a,o,n-o._delay,1)._lock=0):s=n,n<0&&o._ts&&(r-=n,(!i&&!a._dp||i&&i.smoothChildTiming)&&(a._start+=n/a._ts,a._time-=n,a._tTime-=n),a.shiftChildren(-n,!1,-Infinity),s=0),o._end>r&&o._ts&&(r=o._end),o=t;Eh(a,a===dd&&a._time>r?a._time:r,1,1),a._dirty=0}return a._tDur},t.updateRoot=function(e){if(dd._ts&&(fh(dd,Hh(e,dd)),fd=yA.frame),yA.frame>=sh){sh+=yd.autoSleep||120;var t=dd._first;if((!t||!t._ts)&&yd.autoSleep&&yA._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||yA.sleep()}}},t}(FA);yh(MA.prototype,{_lock:0,_hasPause:0,_forcing:0});var KA,NA,zA=function(e,t,n,i,r,a,o){var s,g,l,u,c,I,C,d,h=new gp(this._pt,e,t,0,1,np,null,r),A=0,p=0;for(h.b=n,h.e=i,n+="",(C=~(i+="").indexOf("random("))&&(i=sA(i)),a&&(a(d=[n,i],e,t),n=d[0],i=d[1]),g=n.match(Jd)||[];s=Jd.exec(i);)u=s[0],c=i.substring(A,s.index),l?l=(l+1)%5:"rgba("===c.substr(-5)&&(l=1),u!==g[p++]&&(I=parseFloat(g[p-1])||0,h._pt={_next:h._pt,p:c||1===p?c:",",s:I,c:"="===u.charAt(1)?Ah(I,u)-I:parseFloat(u)-I,m:l&&l<4?Math.round:0},A=Jd.lastIndex);return h.c=A<i.length?i.substring(A,i.length):"",h.fp=o,(Dd.test(i)||C)&&(h.e=0),this._pt=h,h},LA=function(e,t,n,i,r,a,o,s,g){Xd(i)&&(i=i(r||0,e,a));var l,u=e[t],c="get"!==n?n:Xd(u)?g?e[t.indexOf("set")||!Xd(e["get"+t.substr(3)])?t:"get"+t.substr(3)](g):e[t]():u,I=Xd(u)?g?jA:OA:QA;if(kd(i)&&(~i.indexOf("random(")&&(i=sA(i)),"="===i.charAt(1)&&((l=Ah(c,i)+(jh(c)||0))||0===l)&&(i=l)),c!==i||NA)return isNaN(c*i)||""===i?(!u&&!(t in e)&&qd(t,i),zA.call(this,e,t,c,i,I,s||yd.stringFilter,g)):(l=new gp(this._pt,e,t,+c||0,i-(c||0),"boolean"===typeof u?tp:ep,0,I),g&&(l.fp=g),o&&l.modifier(o,this,e),this._pt=l)},_A=function(e,t,n,i,r,a){var o,s,g,l;if(ah[e]&&!1!==(o=new ah[e]).init(r,o.rawVars?t[e]:function(e,t,n,i,r){if(Xd(e)&&(e=JA(e,r,t,n,i)),!Fd(e)||e.style&&e.nodeType||Ld(e)||zd(e))return kd(e)?JA(e,r,t,n,i):e;var a,o={};for(a in e)o[a]=JA(e[a],r,t,n,i);return o}(t[e],i,r,a,n),n,i,a)&&(n._pt=s=new gp(n._pt,r,e,0,1,o.render,o,0,o.priority),n!==vd))for(g=n._ptLookup[n._targets.indexOf(r)],l=o._props.length;l--;)g[o._props[l]]=s;return o},TA=function e(t,n){var i,r,a,o,s,g,l,u,c,I,C,d,h,A=t.vars,p=A.ease,m=A.startAt,f=A.immediateRender,v=A.lazy,b=A.onUpdate,y=A.onUpdateParams,G=A.callbackScope,B=A.runBackwards,Z=A.yoyoEase,w=A.keyframes,S=A.autoRevert,W=t._dur,x=t._startAt,R=t._targets,V=t.parent,k=V&&"nested"===V.data?V.parent._targets:R,X="auto"===t._overwrite&&!Cd,Y=t.timeline;if(Y&&(!w||!p)&&(p="none"),t._ease=RA(p,Gd.ease),t._yEase=Z?WA(RA(!0===Z?p:Z,Gd.ease)):0,Z&&t._yoyo&&!t._repeat&&(Z=t._yEase,t._yEase=t._ease,t._ease=Z),t._from=!Y&&!!A.runBackwards,!Y||w&&!A.stagger){if(d=(u=R[0]?ch(R[0]).harness:0)&&A[u.prop],i=Zh(A,nh),x&&(xh(x.render(-1,!0)),x._lazy=0),m)if(xh(t._startAt=PA.set(R,yh({data:"isStart",overwrite:!1,parent:V,immediateRender:!0,lazy:Md(v),startAt:null,delay:0,onUpdate:b,onUpdateParams:y,callbackScope:G,stagger:0},m))),n<0&&!f&&!S&&t._startAt.render(-1,!0),f){if(n>0&&!S&&(t._startAt=0),W&&n<=0)return void(n&&(t._zTime=n))}else!1===S&&(t._startAt=0);else if(B&&W)if(x)!S&&(t._startAt=0);else if(n&&(f=!1),a=yh({overwrite:!1,data:"isFromStart",lazy:f&&Md(v),immediateRender:f,stagger:0,parent:V},i),d&&(a[u.prop]=d),xh(t._startAt=PA.set(R,a)),n<0&&t._startAt.render(-1,!0),t._zTime=n,f){if(!n)return}else e(t._startAt,Zd);for(t._pt=t._ptCache=0,v=W&&Md(v)||v&&!W,r=0;r<R.length;r++){if(l=(s=R[r])._gsap||uh(R)[r]._gsap,t._ptLookup[r]=I={},rh[l.id]&&ih.length&&mh(),C=k===R?r:k.indexOf(s),u&&!1!==(c=new u).init(s,d||i,t,C,k)&&(t._pt=o=new gp(t._pt,s,c.name,0,1,c.render,c,0,c.priority),c._props.forEach((function(e){I[e]=o})),c.priority&&(g=1)),!u||d)for(a in i)ah[a]&&(c=_A(a,i,t,C,s,k))?c.priority&&(g=1):I[a]=o=LA.call(t,s,a,"get",i[a],C,k,0,A.stringFilter);t._op&&t._op[r]&&t.kill(s,t._op[r]),X&&t._pt&&(KA=t,dd.killTweensOf(s,I,t.globalTime(n)),h=!t.parent,KA=0),t._pt&&v&&(rh[l.id]=1)}g&&sp(t),t._onInit&&t._onInit(t)}t._onUpdate=b,t._initted=(!t._op||t._pt)&&!h,w&&n<=0&&Y.render(Bd,!0,!0)},EA=function(e,t,n,i){var r,a,o=t.ease||i||"power1.inOut";if(Ld(t))a=n[e]||(n[e]=[]),t.forEach((function(e,n){return a.push({t:n/(t.length-1)*100,v:e,e:o})}));else for(r in t)a=n[r]||(n[r]=[]),"ease"===r||a.push({t:parseFloat(e),v:t[r],e:o})},JA=function(e,t,n,i,r){return Xd(e)?e.call(t,n,i,r):kd(e)&&~e.indexOf("random(")?sA(e):e},DA=lh+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",UA={};Ch(DA+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return UA[e]=1}));var PA=function(e){function t(t,n,i,r){var a;"number"===typeof n&&(i.duration=n,n=i,i=null);var o,s,g,l,u,c,I,C,d=(a=e.call(this,r?n:wh(n))||this).vars,h=d.duration,A=d.delay,p=d.immediateRender,m=d.stagger,f=d.overwrite,v=d.keyframes,b=d.defaults,y=d.scrollTrigger,G=d.yoyoEase,B=n.parent||dd,Z=(Ld(t)||zd(t)?Yd(t[0]):"length"in n)?[t]:eA(t);if(a._targets=Z.length?uh(Z):$d("GSAP target "+t+" not found. https://greensock.com",!yd.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,v||m||Nd(h)||Nd(A)){if(n=a.vars,(o=a.timeline=new MA({data:"nested",defaults:b||{}})).kill(),o.parent=o._dp=cd(a),o._start=0,m||Nd(h)||Nd(A)){if(l=Z.length,I=m&&nA(m),Fd(m))for(u in m)~DA.indexOf(u)&&(C||(C={}),C[u]=m[u]);for(s=0;s<l;s++)(g=Zh(n,UA)).stagger=0,G&&(g.yoyoEase=G),C&&Gh(g,C),c=Z[s],g.duration=+JA(h,cd(a),s,c,Z),g.delay=(+JA(A,cd(a),s,c,Z)||0)-a._delay,!m&&1===l&&g.delay&&(a._delay=A=g.delay,a._start+=A,g.delay=0),o.to(c,g,I?I(s,c,Z):0),o._ease=BA.none;o.duration()?h=A=0:a.timeline=0}else if(v){wh(yh(o.vars.defaults,{ease:"none"})),o._ease=RA(v.ease||n.ease||"none");var w,S,W,x=0;if(Ld(v))v.forEach((function(e){return o.to(Z,e,">")}));else{for(u in g={},v)"ease"===u||"easeEach"===u||EA(u,v[u],g,v.easeEach);for(u in g)for(w=g[u].sort((function(e,t){return e.t-t.t})),x=0,s=0;s<w.length;s++)(W={ease:(S=w[s]).e,duration:(S.t-(s?w[s-1].t:0))/100*h})[u]=S.v,o.to(Z,W,x),x+=W.duration;o.duration()<h&&o.to({},{duration:h-o.duration()})}}h||a.duration(h=o.duration())}else a.timeline=0;return!0!==f||Cd||(KA=cd(a),dd.killTweensOf(Z),KA=0),Nh(B,cd(a),i),n.reversed&&a.reverse(),n.paused&&a.paused(!0),(p||!h&&!v&&a._start===hh(B._time)&&Md(p)&&kh(cd(a))&&"nested"!==B.data)&&(a._tTime=-1e-8,a.render(Math.max(0,-A))),y&&zh(cd(a),y),a}Id(t,e);var n=t.prototype;return n.render=function(e,t,n){var i,r,a,o,s,g,l,u,c,I=this._time,C=this._tDur,d=this._dur,h=e>C-Zd&&e>=0?C:e<Zd?0:e;if(d){if(h!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==e<0){if(i=h,u=this.timeline,this._repeat){if(o=d+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*o+e,t,n);if(i=hh(h%o),h===C?(a=this._repeat,i=d):((a=~~(h/o))&&a===h/o&&(i=d,a--),i>d&&(i=d)),(g=this._yoyo&&1&a)&&(c=this._yEase,i=d-i),s=Yh(this._tTime,o),i===I&&!n&&this._initted)return this._tTime=h,this;a!==s&&(u&&this._yEase&&xA(u,g),!this.vars.repeatRefresh||g||this._lock||(this._lock=n=1,this.render(hh(o*a),!0).invalidate()._lock=0))}if(!this._initted){if(Lh(this,e<0?e:i,n,t))return this._tTime=0,this;if(I!==this._time)return this;if(d!==this._dur)return this.render(e,t,n)}if(this._tTime=h,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=l=(c||this._ease)(i/d),this._from&&(this.ratio=l=1-l),i&&!I&&!t&&(uA(this,"onStart"),this._tTime!==h))return this;for(r=this._pt;r;)r.r(l,r.d),r=r._next;u&&u.render(e<0?e:!i&&g?-1e-8:u._dur*u._ease(i/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(e<0&&this._startAt&&this._startAt.render(e,!0,n),uA(this,"onUpdate")),this._repeat&&a!==s&&this.vars.onRepeat&&!t&&this.parent&&uA(this,"onRepeat"),h!==this._tDur&&h||this._tTime!==h||(e<0&&this._startAt&&!this._onUpdate&&this._startAt.render(e,!0,!0),(e||!d)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&xh(this,1),t||e<0&&!I||!h&&!I||(uA(this,h===C?"onComplete":"onReverseComplete",!0),this._prom&&!(h<C&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,i){var r,a,o,s=e.ratio,g=t<0||!t&&(!e._start&&_h(e)&&(e._initted||!Th(e))||(e._ts<0||e._dp._ts<0)&&!Th(e))?0:1,l=e._rDelay,u=0;if(l&&e._repeat&&(u=Oh(0,e._tDur,t),a=Yh(u,l),e._yoyo&&1&a&&(g=1-g),a!==Yh(e._tTime,l)&&(s=1-g,e.vars.repeatRefresh&&e._initted&&e.invalidate())),g!==s||i||e._zTime===Zd||!t&&e._zTime){if(!e._initted&&Lh(e,t,i,n))return;for(o=e._zTime,e._zTime=t||(n?Zd:0),n||(n=t&&!o),e.ratio=g,e._from&&(g=1-g),e._time=0,e._tTime=u,r=e._pt;r;)r.r(g,r.d),r=r._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!n&&uA(e,"onUpdate"),u&&e._repeat&&!n&&e.parent&&uA(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===g&&(g&&xh(e,1),n||(uA(e,g?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},n.targets=function(){return this._targets},n.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),e.prototype.invalidate.call(this)},n.resetTo=function(e,t,n,i){bd||yA.wake(),this._ts||this.play();var r=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||TA(this,r),function(e,t,n,i,r,a,o){var s,g,l,u=(e._pt&&e._ptCache||(e._ptCache={}))[t];if(!u)for(u=e._ptCache[t]=[],g=e._ptLookup,l=e._targets.length;l--;){if((s=g[l][t])&&s.d&&s.d._pt)for(s=s.d._pt;s&&s.p!==t;)s=s._next;if(!s)return NA=1,e.vars[t]="+=0",TA(e,o),NA=0,1;u.push(s)}for(l=u.length;l--;)(s=u[l]).s=!i&&0!==i||r?s.s+(i||0)+a*s.c:i,s.c=n-s.s,s.e&&(s.e=dh(n)+jh(s.e)),s.b&&(s.b=s.s+jh(s.b))}(this,e,t,n,i,this._ease(r/this._dur),r)?this.resetTo(e,t,n,i):(Mh(this,0),this.parent||Sh(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},n.kill=function(e,t){if(void 0===t&&(t="all"),!e&&(!t||"all"===t))return this._lazy=this._pt=0,this.parent?cA(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,KA&&!0!==KA.vars.overwrite)._first||cA(this),this.parent&&n!==this.timeline.totalDuration()&&Eh(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,a,o,s,g,l,u=this._targets,c=e?eA(e):u,I=this._ptLookup,C=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0}(u,c))return"all"===t&&(this._pt=0),cA(this);for(i=this._op=this._op||[],"all"!==t&&(kd(t)&&(s={},Ch(t,(function(e){return s[e]=1})),t=s),t=function(e,t){var n,i,r,a,o=e[0]?ch(e[0]).harness:0,s=o&&o.aliases;if(!s)return t;for(i in n=Gh({},t),s)if(i in n)for(r=(a=s[i].split(",")).length;r--;)n[a[r]]=n[i];return n}(u,t)),l=u.length;l--;)if(~c.indexOf(u[l]))for(s in r=I[l],"all"===t?(i[l]=t,o=r,a={}):(a=i[l]=i[l]||{},o=t),o)(g=r&&r[s])&&("kill"in g.d&&!0!==g.d.kill(s)||Wh(this,g,"_pt"),delete r[s]),"all"!==a&&(a[s]=1);return this._initted&&!this._pt&&C&&cA(this),this},t.to=function(e,n){return new t(e,n,arguments[2])},t.from=function(e,t){return Ph(1,arguments)},t.delayedCall=function(e,n,i,r){return new t(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:n,onReverseComplete:n,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:r})},t.fromTo=function(e,t,n){return Ph(2,arguments)},t.set=function(e,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new t(e,n)},t.killTweensOf=function(e,t,n){return dd.killTweensOf(e,t,n)},t}(FA);yh(PA.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Ch("staggerTo,staggerFrom,staggerFromTo",(function(e){PA[e]=function(){var t=new MA,n=qh.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var QA=function(e,t,n){return e[t]=n},OA=function(e,t,n){return e[t](n)},jA=function(e,t,n,i){return e[t](i.fp,n)},qA=function(e,t,n){return e.setAttribute(t,n)},$A=function(e,t){return Xd(e[t])?OA:Hd(e[t])&&e.setAttribute?qA:QA},ep=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},tp=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},np=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(1===e&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},ip=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},rp=function(e,t,n,i){for(var r,a=this._pt;a;)r=a._next,a.p===i&&a.modifier(e,t,n),a=r},ap=function(e){for(var t,n,i=this._pt;i;)n=i._next,i.p===e&&!i.op||i.op===e?Wh(this,i,"_pt"):i.dep||(t=1),i=n;return!t},op=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},sp=function(e){for(var t,n,i,r,a=e._pt;a;){for(t=a._next,n=i;n&&n.pr>a.pr;)n=n._next;(a._prev=n?n._prev:r)?a._prev._next=a:i=a,(a._next=n)?n._prev=a:r=a,a=t}e._pt=i},gp=function(){function e(e,t,n,i,r,a,o,s,g){this.t=t,this.s=i,this.c=r,this.p=n,this.r=a||ep,this.d=o||this,this.set=s||QA,this.pr=g||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=op,this.m=e,this.mt=n,this.tween=t},e}();Ch(lh+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return nh[e]=1})),Qd.TweenMax=Qd.TweenLite=PA,Qd.TimelineLite=Qd.TimelineMax=MA,dd=new MA({sortChildren:!1,defaults:Gd,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),yd.stringFilter=bA;var lp={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return IA(e)}))},timeline:function(e){return new MA(e)},getTweensOf:function(e,t){return dd.getTweensOf(e,t)},getProperty:function(e,t,n,i){kd(e)&&(e=eA(e)[0]);var r=ch(e||{}).get,a=n?bh:vh;return"native"===n&&(n=""),e?t?a((ah[t]&&ah[t].get||r)(e,t,n,i)):function(t,n,i){return a((ah[t]&&ah[t].get||r)(e,t,n,i))}:e},quickSetter:function(e,t,n){if((e=eA(e)).length>1){var i=e.map((function(e){return Ip.quickSetter(e,t,n)})),r=i.length;return function(e){for(var t=r;t--;)i[t](e)}}e=e[0]||{};var a=ah[t],o=ch(e),s=o.harness&&(o.harness.aliases||{})[t]||t,g=a?function(t){var i=new a;vd._pt=0,i.init(e,n?t+n:t,vd,0,[e]),i.render(1,i),vd._pt&&ip(1,vd)}:o.set(e,s);return a?g:function(t){return g(e,s,n?t+n:t,o,1)}},quickTo:function(e,t,n){var i,r=Ip.to(e,Gh(((i={})[t]="+=0.1",i.paused=!0,i),n||{})),a=function(e,n,i){return r.resetTo(t,e,n,i)};return a.tween=r,a},isTweening:function(e){return dd.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=RA(e.ease,Gd.ease)),Bh(Gd,e||{})},config:function(e){return Bh(yd,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,r=e.defaults,a=e.extendTimeline;(i||"").split(",").forEach((function(e){return e&&!ah[e]&&!Qd[e]&&$d(t+" effect requires "+e+" plugin.")})),oh[t]=function(e,t,i){return n(eA(e),yh(t||{},r),i)},a&&(MA.prototype[t]=function(e,n,i){return this.add(oh[t](e,Fd(n)?n:(i=n)&&{},this),i)})},registerEase:function(e,t){BA[e]=RA(t)},parseEase:function(e,t){return arguments.length?RA(e,t):BA},getById:function(e){return dd.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,i,r=new MA(e);for(r.smoothChildTiming=Md(e.smoothChildTiming),dd.remove(r),r._dp=0,r._time=r._tTime=dd._time,n=dd._first;n;)i=n._next,!t&&!n._dur&&n instanceof PA&&n.vars.onComplete===n._targets[0]||Nh(r,n,n._start-n._delay),n=i;return Nh(dd,r,0),r},utils:{wrap:function e(t,n,i){var r=n-t;return Ld(t)?oA(t,e(0,t.length),n):Qh(i,(function(e){return(r+(e-t)%r)%r+t}))},wrapYoyo:function e(t,n,i){var r=n-t,a=2*r;return Ld(t)?oA(t,e(0,t.length-1),n):Qh(i,(function(e){return t+((e=(a+(e-t)%a)%a||0)>r?a-e:e)}))},distribute:nA,random:aA,snap:rA,normalize:function(e,t,n){return gA(e,t,0,1,n)},getUnit:jh,clamp:function(e,t,n){return Qh(n,(function(n){return Oh(e,t,n)}))},splitColor:AA,toArray:eA,selector:function(e){return e=eA(e)[0]||$d("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return eA(t,n.querySelectorAll?n:n===e?$d("Invalid scope")||pd.createElement("div"):e)}},mapRange:gA,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||jh(n))}},interpolate:function e(t,n,i,r){var a=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!a){var o,s,g,l,u,c=kd(t),I={};if(!0===i&&(r=1)&&(i=null),c)t={p:t},n={p:n};else if(Ld(t)&&!Ld(n)){for(g=[],l=t.length,u=l-2,s=1;s<l;s++)g.push(e(t[s-1],t[s]));l--,a=function(e){e*=l;var t=Math.min(u,~~e);return g[t](e-t)},i=n}else r||(t=Gh(Ld(t)?[]:{},t));if(!g){for(o in n)LA.call(I,t,o,"get",n[o]);a=function(e){return ip(e,I)||(c?t.p:t)}}}return Qh(i,a)},shuffle:tA},install:jd,effects:oh,ticker:yA,updateRoot:MA.updateRoot,plugins:ah,globalTimeline:dd,core:{PropTween:gp,globals:eh,Tween:PA,Timeline:MA,Animation:FA,getCache:ch,_removeLinkedListItem:Wh,suppressOverwrites:function(e){return Cd=e}}};Ch("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return lp[e]=PA[e]})),yA.add(MA.updateRoot),vd=lp.to({},{duration:0});var up=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},cp=function(e,t){return{name:e,rawVars:1,init:function(e,n,i){i._onInit=function(e){var i,r;if(kd(n)&&(i={},Ch(n,(function(e){return i[e]=1})),n=i),t){for(r in i={},n)i[r]=t(n[r]);n=i}!function(e,t){var n,i,r,a=e._targets;for(n in t)for(i=a.length;i--;)(r=e._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=up(r,n)),r&&r.modifier&&r.modifier(t[n],e,a[i],n))}(e,n)}}}},Ip=lp.registerPlugin({name:"attr",init:function(e,t,n,i,r){var a,o;for(a in t)(o=this.add(e,"setAttribute",(e.getAttribute(a)||0)+"",t[a],i,r,0,0,a))&&(o.op=a),this._props.push(a)}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n])}},cp("roundProps",iA),cp("modifiers"),cp("snap",rA))||lp;PA.version=MA.version=Ip.version="3.10.4",md=1,Kd()&&GA();BA.Power0,BA.Power1,BA.Power2,BA.Power3,BA.Power4,BA.Linear,BA.Quad,BA.Cubic,BA.Quart,BA.Quint,BA.Strong,BA.Elastic,BA.Back,BA.SteppedEase,BA.Bounce,BA.Sine,BA.Expo,BA.Circ;var Cp,dp,hp,Ap,pp,mp,fp,vp={},bp=180/Math.PI,yp=Math.PI/180,Gp=Math.atan2,Bp=/([A-Z])/g,Zp=/(left|right|width|margin|padding|x)/i,wp=/[\s,\(]\S/,Sp={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Wp=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},xp=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},Rp=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},Vp=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},kp=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Xp=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},Yp=function(e,t,n){return e.style[t]=n},Hp=function(e,t,n){return e.style.setProperty(t,n)},Fp=function(e,t,n){return e._gsap[t]=n},Mp=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},Kp=function(e,t,n,i,r){var a=e._gsap;a.scaleX=a.scaleY=n,a.renderTransform(r,a)},Np=function(e,t,n,i,r){var a=e._gsap;a[t]=n,a.renderTransform(r,a)},zp="transform",Lp=zp+"Origin",_p=function(e,t){var n=dp.createElementNS?dp.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):dp.createElement(e);return n.style?n:dp.createElement(e)},Tp=function e(t,n,i){var r=getComputedStyle(t);return r[n]||r.getPropertyValue(n.replace(Bp,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&e(t,Jp(n)||n,1)||""},Ep="O,Moz,ms,Ms,Webkit".split(","),Jp=function(e,t,n){var i=(t||pp).style,r=5;if(e in i&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);r--&&!(Ep[r]+e in i););return r<0?null:(3===r?"ms":r>=0?Ep[r]:"")+e},Dp=function(){"undefined"!==typeof window&&window.document&&(Cp=window,dp=Cp.document,hp=dp.documentElement,pp=_p("div")||{style:{}},_p("div"),zp=Jp(zp),Lp=zp+"Origin",pp.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",fp=!!Jp("perspective"),Ap=1)},Up=function e(t){var n,i=_p("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,a=this.nextSibling,o=this.style.cssText;if(hp.appendChild(i),i.appendChild(this),this.style.display="block",t)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=e}catch(CL){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(a?r.insertBefore(this,a):r.appendChild(this)),hp.removeChild(i),this.style.cssText=o,n},Pp=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Qp=function(e){var t;try{t=e.getBBox()}catch(n){t=Up.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===Up||(t=Up.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+Pp(e,["x","cx","x1"])||0,y:+Pp(e,["y","cy","y1"])||0,width:0,height:0}},Op=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!Qp(e))},jp=function(e,t){if(t){var n=e.style;t in vp&&t!==Lp&&(t=zp),n.removeProperty?("ms"!==t.substr(0,2)&&"webkit"!==t.substr(0,6)||(t="-"+t),n.removeProperty(t.replace(Bp,"-$1").toLowerCase())):n.removeAttribute(t)}},qp=function(e,t,n,i,r,a){var o=new gp(e._pt,t,n,0,1,a?Xp:kp);return e._pt=o,o.b=i,o.e=r,e._props.push(n),o},$p={deg:1,rad:1,turn:1},em=function e(t,n,i,r){var a,o,s,g,l=parseFloat(i)||0,u=(i+"").trim().substr((l+"").length)||"px",c=pp.style,I=Zp.test(n),C="svg"===t.tagName.toLowerCase(),d=(C?"client":"offset")+(I?"Width":"Height"),h=100,A="px"===r,p="%"===r;return r===u||!l||$p[r]||$p[u]?l:("px"!==u&&!A&&(l=e(t,n,i,"px")),g=t.getCTM&&Op(t),!p&&"%"!==u||!vp[n]&&!~n.indexOf("adius")?(c[I?"width":"height"]=h+(A?u:r),o=~n.indexOf("adius")||"em"===r&&t.appendChild&&!C?t:t.parentNode,g&&(o=(t.ownerSVGElement||{}).parentNode),o&&o!==dp&&o.appendChild||(o=dp.body),(s=o._gsap)&&p&&s.width&&I&&s.time===yA.time?dh(l/s.width*h):((p||"%"===u)&&(c.position=Tp(t,"position")),o===t&&(c.position="static"),o.appendChild(pp),a=pp[d],o.removeChild(pp),c.position="absolute",I&&p&&((s=ch(o)).time=yA.time,s.width=o[d]),dh(A?a*l/h:a&&l?h/a*l:0))):(a=g?t.getBBox()[I?"width":"height"]:t[d],dh(p?l/a*h:l/100*a)))},tm=function(e,t,n,i){var r;return Ap||Dp(),t in Sp&&"transform"!==t&&~(t=Sp[t]).indexOf(",")&&(t=t.split(",")[0]),vp[t]&&"transform"!==t?(r=Cm(e,i),r="transformOrigin"!==t?r[t]:r.svg?r.origin:dm(Tp(e,Lp))+" "+r.zOrigin+"px"):(!(r=e.style[t])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=om[t]&&om[t](e,t,n)||Tp(e,t)||Ih(e,t)||("opacity"===t?1:0)),n&&!~(r+"").trim().indexOf(" ")?em(e,t,r,n)+n:r},nm=function(e,t,n,i){if(!n||"none"===n){var r=Jp(t,e,1),a=r&&Tp(e,r,1);a&&a!==n?(t=r,n=a):"borderColor"===t&&(n=Tp(e,"borderTopColor"))}var o,s,g,l,u,c,I,C,d,h,A,p=new gp(this._pt,e.style,t,0,1,np),m=0,f=0;if(p.b=n,p.e=i,n+="","auto"===(i+="")&&(e.style[t]=i,i=Tp(e,t)||i,e.style[t]=n),bA(o=[n,i]),i=o[1],g=(n=o[0]).match(Ed)||[],(i.match(Ed)||[]).length){for(;s=Ed.exec(i);)I=s[0],d=i.substring(m,s.index),u?u=(u+1)%5:"rgba("!==d.substr(-5)&&"hsla("!==d.substr(-5)||(u=1),I!==(c=g[f++]||"")&&(l=parseFloat(c)||0,A=c.substr((l+"").length),"="===I.charAt(1)&&(I=Ah(l,I)+A),C=parseFloat(I),h=I.substr((C+"").length),m=Ed.lastIndex-h.length,h||(h=h||yd.units[t]||A,m===i.length&&(i+=h,p.e+=h)),A!==h&&(l=em(e,t,c,h)||0),p._pt={_next:p._pt,p:d||1===f?d:",",s:l,c:C-l,m:u&&u<4||"zIndex"===t?Math.round:0});p.c=m<i.length?i.substring(m,i.length):""}else p.r="display"===t&&"none"===i?Xp:kp;return Dd.test(i)&&(p.e=0),this._pt=p,p},im={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},rm=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return"top"!==n&&"bottom"!==n&&"left"!==i&&"right"!==i||(e=n,n=i,i=e),t[0]=im[n]||n,t[1]=im[i]||i,t.join(" ")},am=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,i,r,a=t.t,o=a.style,s=t.u,g=a._gsap;if("all"===s||!0===s)o.cssText="",i=1;else for(r=(s=s.split(",")).length;--r>-1;)n=s[r],vp[n]&&(i=1,n="transformOrigin"===n?Lp:zp),jp(a,n);i&&(jp(a,zp),g&&(g.svg&&a.removeAttribute("transform"),Cm(a,1),g.uncache=1))}},om={clearProps:function(e,t,n,i,r){if("isFromStart"!==r.data){var a=e._pt=new gp(e._pt,t,n,0,0,am);return a.u=i,a.pr=-10,a.tween=r,e._props.push(n),1}}},sm=[1,0,0,1,0,0],gm={},lm=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},um=function(e){var t=Tp(e,zp);return lm(t)?sm:t.substr(7).match(Td).map(dh)},cm=function(e,t){var n,i,r,a,o=e._gsap||ch(e),s=e.style,g=um(e);return o.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(g=[(r=e.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?sm:g:(g!==sm||e.offsetParent||e===hp||o.svg||(r=s.display,s.display="block",(n=e.parentNode)&&e.offsetParent||(a=1,i=e.nextSibling,hp.appendChild(e)),g=um(e),r?s.display=r:jp(e,"display"),a&&(i?n.insertBefore(e,i):n?n.appendChild(e):hp.removeChild(e))),t&&g.length>6?[g[0],g[1],g[4],g[5],g[12],g[13]]:g)},Im=function(e,t,n,i,r,a){var o,s,g,l=e._gsap,u=r||cm(e,!0),c=l.xOrigin||0,I=l.yOrigin||0,C=l.xOffset||0,d=l.yOffset||0,h=u[0],A=u[1],p=u[2],m=u[3],f=u[4],v=u[5],b=t.split(" "),y=parseFloat(b[0])||0,G=parseFloat(b[1])||0;n?u!==sm&&(s=h*m-A*p)&&(g=y*(-A/s)+G*(h/s)-(h*v-A*f)/s,y=y*(m/s)+G*(-p/s)+(p*v-m*f)/s,G=g):(y=(o=Qp(e)).x+(~b[0].indexOf("%")?y/100*o.width:y),G=o.y+(~(b[1]||b[0]).indexOf("%")?G/100*o.height:G)),i||!1!==i&&l.smooth?(f=y-c,v=G-I,l.xOffset=C+(f*h+v*p)-f,l.yOffset=d+(f*A+v*m)-v):l.xOffset=l.yOffset=0,l.xOrigin=y,l.yOrigin=G,l.smooth=!!i,l.origin=t,l.originIsAbsolute=!!n,e.style[Lp]="0px 0px",a&&(qp(a,l,"xOrigin",c,y),qp(a,l,"yOrigin",I,G),qp(a,l,"xOffset",C,l.xOffset),qp(a,l,"yOffset",d,l.yOffset)),e.setAttribute("data-svg-origin",y+" "+G)},Cm=function(e,t){var n=e._gsap||new HA(e);if("x"in n&&!t&&!n.uncache)return n;var i,r,a,o,s,g,l,u,c,I,C,d,h,A,p,m,f,v,b,y,G,B,Z,w,S,W,x,R,V,k,X,Y,H=e.style,F=n.scaleX<0,M="px",K="deg",N=Tp(e,Lp)||"0";return i=r=a=g=l=u=c=I=C=0,o=s=1,n.svg=!(!e.getCTM||!Op(e)),A=cm(e,n.svg),n.svg&&(w=(!n.uncache||"0px 0px"===N)&&!t&&e.getAttribute("data-svg-origin"),Im(e,w||N,!!w||n.originIsAbsolute,!1!==n.smooth,A)),d=n.xOrigin||0,h=n.yOrigin||0,A!==sm&&(v=A[0],b=A[1],y=A[2],G=A[3],i=B=A[4],r=Z=A[5],6===A.length?(o=Math.sqrt(v*v+b*b),s=Math.sqrt(G*G+y*y),g=v||b?Gp(b,v)*bp:0,(c=y||G?Gp(y,G)*bp+g:0)&&(s*=Math.abs(Math.cos(c*yp))),n.svg&&(i-=d-(d*v+h*y),r-=h-(d*b+h*G))):(Y=A[6],k=A[7],x=A[8],R=A[9],V=A[10],X=A[11],i=A[12],r=A[13],a=A[14],l=(p=Gp(Y,V))*bp,p&&(w=B*(m=Math.cos(-p))+x*(f=Math.sin(-p)),S=Z*m+R*f,W=Y*m+V*f,x=B*-f+x*m,R=Z*-f+R*m,V=Y*-f+V*m,X=k*-f+X*m,B=w,Z=S,Y=W),u=(p=Gp(-y,V))*bp,p&&(m=Math.cos(-p),X=G*(f=Math.sin(-p))+X*m,v=w=v*m-x*f,b=S=b*m-R*f,y=W=y*m-V*f),g=(p=Gp(b,v))*bp,p&&(w=v*(m=Math.cos(p))+b*(f=Math.sin(p)),S=B*m+Z*f,b=b*m-v*f,Z=Z*m-B*f,v=w,B=S),l&&Math.abs(l)+Math.abs(g)>359.9&&(l=g=0,u=180-u),o=dh(Math.sqrt(v*v+b*b+y*y)),s=dh(Math.sqrt(Z*Z+Y*Y)),p=Gp(B,Z),c=Math.abs(p)>2e-4?p*bp:0,C=X?1/(X<0?-X:X):0),n.svg&&(w=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!lm(Tp(e,zp)),w&&e.setAttribute("transform",w))),Math.abs(c)>90&&Math.abs(c)<270&&(F?(o*=-1,c+=g<=0?180:-180,g+=g<=0?180:-180):(s*=-1,c+=c<=0?180:-180)),t=t||n.uncache,n.x=i-((n.xPercent=i&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-i)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+M,n.y=r-((n.yPercent=r&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-r)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+M,n.z=a+M,n.scaleX=dh(o),n.scaleY=dh(s),n.rotation=dh(g)+K,n.rotationX=dh(l)+K,n.rotationY=dh(u)+K,n.skewX=c+K,n.skewY=I+K,n.transformPerspective=C+M,(n.zOrigin=parseFloat(N.split(" ")[2])||0)&&(H[Lp]=dm(N)),n.xOffset=n.yOffset=0,n.force3D=yd.force3D,n.renderTransform=n.svg?bm:fp?vm:Am,n.uncache=0,n},dm=function(e){return(e=e.split(" "))[0]+" "+e[1]},hm=function(e,t,n){var i=jh(t);return dh(parseFloat(t)+parseFloat(em(e,"x",n+"px",i)))+i},Am=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,vm(e,t)},pm="0deg",mm="0px",fm=") ",vm=function(e,t){var n=t||this,i=n.xPercent,r=n.yPercent,a=n.x,o=n.y,s=n.z,g=n.rotation,l=n.rotationY,u=n.rotationX,c=n.skewX,I=n.skewY,C=n.scaleX,d=n.scaleY,h=n.transformPerspective,A=n.force3D,p=n.target,m=n.zOrigin,f="",v="auto"===A&&e&&1!==e||!0===A;if(m&&(u!==pm||l!==pm)){var b,y=parseFloat(l)*yp,G=Math.sin(y),B=Math.cos(y);y=parseFloat(u)*yp,b=Math.cos(y),a=hm(p,a,G*b*-m),o=hm(p,o,-Math.sin(y)*-m),s=hm(p,s,B*b*-m+m)}h!==mm&&(f+="perspective("+h+fm),(i||r)&&(f+="translate("+i+"%, "+r+"%) "),(v||a!==mm||o!==mm||s!==mm)&&(f+=s!==mm||v?"translate3d("+a+", "+o+", "+s+") ":"translate("+a+", "+o+fm),g!==pm&&(f+="rotate("+g+fm),l!==pm&&(f+="rotateY("+l+fm),u!==pm&&(f+="rotateX("+u+fm),c===pm&&I===pm||(f+="skew("+c+", "+I+fm),1===C&&1===d||(f+="scale("+C+", "+d+fm),p.style[zp]=f||"translate(0, 0)"},bm=function(e,t){var n,i,r,a,o,s=t||this,g=s.xPercent,l=s.yPercent,u=s.x,c=s.y,I=s.rotation,C=s.skewX,d=s.skewY,h=s.scaleX,A=s.scaleY,p=s.target,m=s.xOrigin,f=s.yOrigin,v=s.xOffset,b=s.yOffset,y=s.forceCSS,G=parseFloat(u),B=parseFloat(c);I=parseFloat(I),C=parseFloat(C),(d=parseFloat(d))&&(C+=d=parseFloat(d),I+=d),I||C?(I*=yp,C*=yp,n=Math.cos(I)*h,i=Math.sin(I)*h,r=Math.sin(I-C)*-A,a=Math.cos(I-C)*A,C&&(d*=yp,o=Math.tan(C-d),r*=o=Math.sqrt(1+o*o),a*=o,d&&(o=Math.tan(d),n*=o=Math.sqrt(1+o*o),i*=o)),n=dh(n),i=dh(i),r=dh(r),a=dh(a)):(n=h,a=A,i=r=0),(G&&!~(u+"").indexOf("px")||B&&!~(c+"").indexOf("px"))&&(G=em(p,"x",u,"px"),B=em(p,"y",c,"px")),(m||f||v||b)&&(G=dh(G+m-(m*n+f*r)+v),B=dh(B+f-(m*i+f*a)+b)),(g||l)&&(o=p.getBBox(),G=dh(G+g/100*o.width),B=dh(B+l/100*o.height)),o="matrix("+n+","+i+","+r+","+a+","+G+","+B+")",p.setAttribute("transform",o),y&&(p.style[zp]=o)},ym=function(e,t,n,i,r){var a,o,s=360,g=kd(r),l=parseFloat(r)*(g&&~r.indexOf("rad")?bp:1)-i,u=i+l+"deg";return g&&("short"===(a=r.split("_")[1])&&(l%=s)!==l%180&&(l+=l<0?s:-360),"cw"===a&&l<0?l=(l+36e9)%s-~~(l/s)*s:"ccw"===a&&l>0&&(l=(l-36e9)%s-~~(l/s)*s)),e._pt=o=new gp(e._pt,t,n,i,l,xp),o.e=u,o.u="deg",e._props.push(n),o},Gm=function(e,t){for(var n in t)e[n]=t[n];return e},Bm=function(e,t,n){var i,r,a,o,s,g,l,u=Gm({},n._gsap),c=n.style;for(r in u.svg?(a=n.getAttribute("transform"),n.setAttribute("transform",""),c[zp]=t,i=Cm(n,1),jp(n,zp),n.setAttribute("transform",a)):(a=getComputedStyle(n)[zp],c[zp]=t,i=Cm(n,1),c[zp]=a),vp)(a=u[r])!==(o=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(s=jh(a)!==(l=jh(o))?em(n,r,a,l):parseFloat(a),g=parseFloat(o),e._pt=new gp(e._pt,i,r,s,g-s,Wp),e._pt.u=l||0,e._props.push(r));Gm(i,u)};Ch("padding,margin,Width,Radius",(function(e,t){var n="Top",i="Right",r="Bottom",a="Left",o=(t<3?[n,i,r,a]:[n+a,n+i,r+i,r+a]).map((function(n){return t<2?e+n:"border"+n+e}));om[t>1?"border"+e:e]=function(e,t,n,i,r){var a,s;if(arguments.length<4)return a=o.map((function(t){return tm(e,t,n)})),5===(s=a.join(" ")).split(a[0]).length?a[0]:s;a=(i+"").split(" "),s={},o.forEach((function(e,t){return s[e]=a[t]=a[t]||a[(t-1)/2|0]})),e.init(t,s,r)}}));var Zm={name:"css",register:Dp,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,r){var a,o,s,g,l,u,c,I,C,d,h,A,p,m,f,v=this._props,b=e.style,y=n.vars.startAt;for(c in Ap||Dp(),t)if("autoRound"!==c&&(o=t[c],!ah[c]||!_A(c,t,n,i,e,r)))if(l=typeof o,u=om[c],"function"===l&&(l=typeof(o=o.call(n,i,e,r))),"string"===l&&~o.indexOf("random(")&&(o=sA(o)),u)u(this,e,c,o,n)&&(f=1);else if("--"===c.substr(0,2))a=(getComputedStyle(e).getPropertyValue(c)+"").trim(),o+="",fA.lastIndex=0,fA.test(a)||(I=jh(a),C=jh(o)),C?I!==C&&(a=em(e,c,a,C)+C):I&&(o+=I),this.add(b,"setProperty",a,o,i,r,0,0,c),v.push(c);else if("undefined"!==l){if(y&&c in y?(a="function"===typeof y[c]?y[c].call(n,i,e,r):y[c],kd(a)&&~a.indexOf("random(")&&(a=sA(a)),jh(a+"")||(a+=yd.units[c]||jh(tm(e,c))||""),"="===(a+"").charAt(1)&&(a=tm(e,c))):a=tm(e,c),g=parseFloat(a),(d="string"===l&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),s=parseFloat(o),c in Sp&&("autoAlpha"===c&&(1===g&&"hidden"===tm(e,"visibility")&&s&&(g=0),qp(this,b,"visibility",g?"inherit":"hidden",s?"inherit":"hidden",!s)),"scale"!==c&&"transform"!==c&&~(c=Sp[c]).indexOf(",")&&(c=c.split(",")[0])),h=c in vp)if(A||((p=e._gsap).renderTransform&&!t.parseTransform||Cm(e,t.parseTransform),m=!1!==t.smoothOrigin&&p.smooth,(A=this._pt=new gp(this._pt,b,zp,0,1,p.renderTransform,p,0,-1)).dep=1),"scale"===c)this._pt=new gp(this._pt,p,"scaleY",p.scaleY,(d?Ah(p.scaleY,d+s):s)-p.scaleY||0),v.push("scaleY",c),c+="X";else{if("transformOrigin"===c){o=rm(o),p.svg?Im(e,o,0,m,0,this):((C=parseFloat(o.split(" ")[2])||0)!==p.zOrigin&&qp(this,p,"zOrigin",p.zOrigin,C),qp(this,b,c,dm(a),dm(o)));continue}if("svgOrigin"===c){Im(e,o,1,m,0,this);continue}if(c in gm){ym(this,p,c,g,d?Ah(g,d+o):o);continue}if("smoothOrigin"===c){qp(this,p,"smooth",p.smooth,o);continue}if("force3D"===c){p[c]=o;continue}if("transform"===c){Bm(this,o,e);continue}}else c in b||(c=Jp(c)||c);if(h||(s||0===s)&&(g||0===g)&&!wp.test(o)&&c in b)s||(s=0),(I=(a+"").substr((g+"").length))!==(C=jh(o)||(c in yd.units?yd.units[c]:I))&&(g=em(e,c,a,C)),this._pt=new gp(this._pt,h?p:b,c,g,(d?Ah(g,d+s):s)-g,h||"px"!==C&&"zIndex"!==c||!1===t.autoRound?Wp:Vp),this._pt.u=C||0,I!==C&&"%"!==C&&(this._pt.b=a,this._pt.r=Rp);else if(c in b)nm.call(this,e,c,a,d?d+o:o);else{if(!(c in e)){qd(c,o);continue}this.add(e,c,a||e[c],d?d+o:o,i,r)}v.push(c)}f&&sp(this)},get:tm,aliases:Sp,getSetter:function(e,t,n){var i=Sp[t];return i&&i.indexOf(",")<0&&(t=i),t in vp&&t!==Lp&&(e._gsap.x||tm(e,"x"))?n&&mp===n?"scale"===t?Mp:Fp:(mp=n||{})&&("scale"===t?Kp:Np):e.style&&!Hd(e.style[t])?Yp:~t.indexOf("-")?Hp:$A(e,t)},core:{_removeProperty:jp,_getMatrix:cm}};Ip.utils.checkPrefix=Jp,function(e,t,n,i){var r=Ch(e+","+t+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){vp[e]=1}));Ch(t,(function(e){yd.units[e]="deg",gm[e]=1})),Sp[r[13]]=e+","+t,Ch("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");Sp[t[1]]=r[t[0]]}))}("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY"),Ch("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){yd.units[e]="px"})),Ip.registerPlugin(Zm);var wm=Ip.registerPlugin(Zm)||Ip;wm.core.Tween;function Sm(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Wm,xm,Rm,Vm,km,Xm,Ym,Hm,Fm,Mm,Km,Nm,zm=function(){return Wm||"undefined"!==typeof window&&(Wm=window.gsap)&&Wm.registerPlugin&&Wm},Lm=1,_m=[],Tm=[],Em=[],Jm=Date.now,Dm=function(e,t){return t},Um=function(e,t){return~Em.indexOf(e)&&Em[Em.indexOf(e)+1][t]},Pm=function(e){return!!~Mm.indexOf(e)},Qm=function(e,t,n,i,r){return e.addEventListener(t,n,{passive:!i,capture:!!r})},Om=function(e,t,n,i){return e.removeEventListener(t,n,!!i)},jm="scrollLeft",qm="scrollTop",$m=function(){return Km&&Km.isPressed||Tm.cache++},ef=function(e,t){var n=function n(i){if(i||0===i){Lm&&(Rm.history.scrollRestoration="manual");var r=Km&&Km.isPressed;i=n.v=Math.round(i)||(Km&&Km.iOS?1:0),e(i),n.cacheID=Tm.cache,r&&Dm("ss",i)}else(t||Tm.cache!==n.cacheID||Dm("ref"))&&(n.cacheID=Tm.cache,n.v=e());return n.v+n.offset};return n.offset=0,e&&n},tf={s:jm,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:ef((function(e){return arguments.length?Rm.scrollTo(e,nf.sc()):Rm.pageXOffset||Vm.scrollLeft||km.scrollLeft||Xm.scrollLeft||0}))},nf={s:qm,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:tf,sc:ef((function(e){return arguments.length?Rm.scrollTo(tf.sc(),e):Rm.pageYOffset||Vm.scrollTop||km.scrollTop||Xm.scrollTop||0}))},rf=function(e){return Wm.utils.toArray(e)[0]||("string"===typeof e&&!1!==Wm.config().nullTargetWarn?console.warn("Element not found:",e):null)},af=function(e,t){var n=t.s,i=t.sc,r=Tm.indexOf(e),a=i===nf.sc?1:2;return!~r&&(r=Tm.push(e)-1),Tm[r+a]||(Tm[r+a]=ef(Um(e,n),!0)||(Pm(e)?i:ef((function(t){return arguments.length?e[n]=t:e[n]}))))},of=function(e,t,n){var i=e,r=e,a=Jm(),o=a,s=t||50,g=Math.max(500,3*s),l=function(e,t){var g=Jm();t||g-a>s?(r=i,i=e,o=a,a=g):n?i+=e:i=r+(e-r)/(g-o)*(a-o)};return{update:l,reset:function(){r=i=n?0:i,o=a=0},getVelocity:function(e){var t=o,s=r,u=Jm();return(e||0===e)&&e!==i&&l(e),a===o||u-o>g?0:(i+(n?s:-s))/((n?u:a)-t)*1e3}}},sf=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},gf=function(e){var t=Math.max.apply(Math,e),n=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(n)?t:n},lf=function(){(Fm=Wm.core.globals().ScrollTrigger)&&Fm.core&&function(){var e=Fm.core,t=e.bridge||{},n=e._scrollers,i=e._proxies;n.push.apply(n,Tm),i.push.apply(i,Em),Tm=n,Em=i,Dm=function(e,n){return t[e](n)}}()},uf=function(e){return(Wm=e||zm())&&"undefined"!==typeof document&&document.body&&(Rm=window,Vm=document,km=Vm.documentElement,Xm=Vm.body,Mm=[Rm,Vm,km,Xm],Wm.utils.clamp,Hm="onpointerenter"in Xm?"pointer":"mouse",Ym=cf.isTouch=Rm.matchMedia&&Rm.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Rm||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,Nm=cf.eventTypes=("ontouchstart"in km?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in km?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout((function(){return Lm=0}),500),lf(),xm=1),xm};tf.op=nf,Tm.cache=0;var cf=function(){function e(e){this.init(e)}var t,n,i;return e.prototype.init=function(e){xm||uf(Wm)||console.warn("Please gsap.registerPlugin(Observer)"),Fm||lf();var t=e.tolerance,n=e.dragMinimum,i=e.type,r=e.target,a=e.lineHeight,o=e.debounce,s=e.preventDefault,g=e.onStop,l=e.onStopDelay,u=e.ignore,c=e.wheelSpeed,I=e.event,C=e.onDragStart,d=e.onDragEnd,h=e.onDrag,A=e.onPress,p=e.onRelease,m=e.onRight,f=e.onLeft,v=e.onUp,b=e.onDown,y=e.onChangeX,G=e.onChangeY,B=e.onChange,Z=e.onToggleX,w=e.onToggleY,S=e.onHover,W=e.onHoverEnd,x=e.onMove,R=e.ignoreCheck,V=e.isNormalizer,k=e.onGestureStart,X=e.onGestureEnd,Y=e.onWheel,H=e.onEnable,F=e.onDisable,M=e.onClick,K=e.scrollSpeed,N=e.capture,z=e.allowClicks,L=e.lockAxis,_=e.onLockAxis;this.target=r=rf(r)||km,this.vars=e,u&&(u=Wm.utils.toArray(u)),t=t||0,n=n||0,c=c||1,K=K||1,i=i||"wheel,touch,pointer",o=!1!==o,a||(a=parseFloat(Rm.getComputedStyle(Xm).lineHeight)||22);var T,E,J,D,U,P,Q,O=this,j=0,q=0,$=af(r,tf),ee=af(r,nf),te=$(),ne=ee(),ie=~i.indexOf("touch")&&!~i.indexOf("pointer")&&"pointerdown"===Nm[0],re=Pm(r),ae=r.ownerDocument||Vm,oe=[0,0,0],se=[0,0,0],ge=0,le=function(){return ge=Jm()},ue=function(e,t){return(O.event=e)&&u&&~u.indexOf(e.target)||t&&ie&&"touch"!==e.pointerType||R&&R(e,t)},ce=function(){var e=O.deltaX=gf(oe),n=O.deltaY=gf(se),i=Math.abs(e)>=t,r=Math.abs(n)>=t;B&&(i||r)&&B(O,e,n,oe,se),i&&(m&&O.deltaX>0&&m(O),f&&O.deltaX<0&&f(O),y&&y(O),Z&&O.deltaX<0!==j<0&&Z(O),j=O.deltaX,oe[0]=oe[1]=oe[2]=0),r&&(b&&O.deltaY>0&&b(O),v&&O.deltaY<0&&v(O),G&&G(O),w&&O.deltaY<0!==q<0&&w(O),q=O.deltaY,se[0]=se[1]=se[2]=0),(D||J)&&(x&&x(O),_&&P&&_(O),J&&(h(O),J=!1),D=P=!1),U&&(Y(O),U=!1),T=0},Ie=function(e,t,n){oe[n]+=e,se[n]+=t,O._vx.update(e),O._vy.update(t),o?T||(T=requestAnimationFrame(ce)):ce()},Ce=function(e,t){"y"!==Q&&(oe[2]+=e,O._vx.update(e,!0)),"x"!==Q&&(se[2]+=t,O._vy.update(t,!0)),L&&!Q&&(O.axis=Q=Math.abs(e)>Math.abs(t)?"x":"y",P=!0),o?T||(T=requestAnimationFrame(ce)):ce()},de=function(e){if(!ue(e,1)){var t=(e=sf(e,s)).clientX,i=e.clientY,r=t-O.x,a=i-O.y,o=O.isDragging;O.x=t,O.y=i,(o||Math.abs(O.startX-t)>=n||Math.abs(O.startY-i)>=n)&&(h&&(J=!0),o||(O.isDragging=!0),Ce(r,a),o||C&&C(O))}},he=O.onPress=function(e){ue(e,1)||(O.axis=Q=null,E.pause(),O.isPressed=!0,e=sf(e),j=q=0,O.startX=O.x=e.clientX,O.startY=O.y=e.clientY,O._vx.reset(),O._vy.reset(),Qm(V?r:ae,Nm[1],de,s,!0),O.deltaX=O.deltaY=0,A&&A(O))},Ae=function(e){if(!ue(e,1)){Om(V?r:ae,Nm[1],de,!0);var t=O.isDragging&&(Math.abs(O.x-O.startX)>3||Math.abs(O.y-O.startY)>3),n=sf(e);t||(O._vx.reset(),O._vy.reset(),s&&z&&Wm.delayedCall(.08,(function(){if(Jm()-ge>300&&!e.defaultPrevented)if(e.target.click)e.target.click();else if(ae.createEvent){var t=ae.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,Rm,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(t)}}))),O.isDragging=O.isGesturing=O.isPressed=!1,g&&!V&&E.restart(!0),d&&t&&d(O),p&&p(O,t)}},pe=function(e){return e.touches&&e.touches.length>1&&(O.isGesturing=!0)&&k(e,O.isDragging)},me=function(){return(O.isGesturing=!1)||X(O)},fe=function(e){if(!ue(e)){var t=$(),n=ee();Ie((t-te)*K,(n-ne)*K,1),te=t,ne=n,g&&E.restart(!0)}},ve=function(e){if(!ue(e)){e=sf(e,s),Y&&(U=!0);var t=(1===e.deltaMode?a:2===e.deltaMode?Rm.innerHeight:1)*c;Ie(e.deltaX*t,e.deltaY*t,0),g&&!V&&E.restart(!0)}},be=function(e){if(!ue(e)){var t=e.clientX,n=e.clientY,i=t-O.x,r=n-O.y;O.x=t,O.y=n,D=!0,(i||r)&&Ce(i,r)}},ye=function(e){O.event=e,S(O)},Ge=function(e){O.event=e,W(O)},Be=function(e){return ue(e)||sf(e,s)&&M(O)};E=O._dc=Wm.delayedCall(l||.25,(function(){O._vx.reset(),O._vy.reset(),E.pause(),g&&g(O)})).pause(),O.deltaX=O.deltaY=0,O._vx=of(0,50,!0),O._vy=of(0,50,!0),O.scrollX=$,O.scrollY=ee,O.isDragging=O.isGesturing=O.isPressed=!1,O.enable=function(e){return O.isEnabled||(Qm(re?ae:r,"scroll",$m),i.indexOf("scroll")>=0&&Qm(re?ae:r,"scroll",fe,s,N),i.indexOf("wheel")>=0&&Qm(r,"wheel",ve,s,N),(i.indexOf("touch")>=0&&Ym||i.indexOf("pointer")>=0)&&(Qm(r,Nm[0],he,s,N),Qm(ae,Nm[2],Ae),Qm(ae,Nm[3],Ae),z&&Qm(r,"click",le,!1,!0),M&&Qm(r,"click",Be),k&&Qm(ae,"gesturestart",pe),X&&Qm(ae,"gestureend",me),S&&Qm(r,Hm+"enter",ye),W&&Qm(r,Hm+"leave",Ge),x&&Qm(r,Hm+"move",be)),O.isEnabled=!0,e&&e.type&&he(e),H&&H(O)),O},O.disable=function(){O.isEnabled&&(_m.filter((function(e){return e!==O&&Pm(e.target)})).length||Om(re?ae:r,"scroll",$m),O.isPressed&&(O._vx.reset(),O._vy.reset(),Om(V?r:ae,Nm[1],de,!0)),Om(re?ae:r,"scroll",fe,N),Om(r,"wheel",ve,N),Om(r,Nm[0],he,N),Om(ae,Nm[2],Ae),Om(ae,Nm[3],Ae),Om(r,"click",le,!0),Om(r,"click",Be),Om(ae,"gesturestart",pe),Om(ae,"gestureend",me),Om(r,Hm+"enter",ye),Om(r,Hm+"leave",Ge),Om(r,Hm+"move",be),O.isEnabled=O.isPressed=O.isDragging=!1,F&&F(O))},O.kill=function(){O.disable();var e=_m.indexOf(O);e>=0&&_m.splice(e,1),Km===O&&(Km=0)},_m.push(O),V&&Pm(r)&&(Km=O),O.enable(I)},t=e,(n=[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}])&&Sm(t.prototype,n),i&&Sm(t,i),e}();cf.version="3.10.4",cf.create=function(e){return new cf(e)},cf.register=uf,cf.getAll=function(){return _m.slice()},cf.getById=function(e){return _m.filter((function(t){return t.vars.id===e}))[0]},zm()&&Wm.registerPlugin(cf);var If,Cf,df,hf,Af,pf,mf,ff,vf,bf,yf,Gf,Bf,Zf,wf,Sf,Wf,xf,Rf,Vf,kf,Xf,Yf,Hf,Ff,Mf,Kf,Nf,zf,Lf,_f,Tf,Ef,Jf=1,Df=Date.now,Uf=Df(),Pf=0,Qf=0,Of=function(){return Zf=1},jf=function(){return Zf=0},qf=function(e){return e},$f=function(e){return Math.round(1e5*e)/1e5||0},ev=function(){return"undefined"!==typeof window},tv=function(){return If||ev()&&(If=window.gsap)&&If.registerPlugin&&If},nv=function(e){return!!~mf.indexOf(e)},iv=function(e){return Um(e,"getBoundingClientRect")||(nv(e)?function(){return Cb.width=df.innerWidth,Cb.height=df.innerHeight,Cb}:function(){return wv(e)})},rv=function(e,t){var n=t.s,i=t.d2,r=t.d,a=t.a;return(n="scroll"+i)&&(a=Um(e,n))?a()-iv(e)()[r]:nv(e)?(Af[n]||pf[n])-(df["inner"+i]||Af["client"+i]||pf["client"+i]):e[n]-e["offset"+i]},av=function(e,t){for(var n=0;n<Rf.length;n+=3)(!t||~t.indexOf(Rf[n+1]))&&e(Rf[n],Rf[n+1],Rf[n+2])},ov=function(e){return"string"===typeof e},sv=function(e){return"function"===typeof e},gv=function(e){return"number"===typeof e},lv=function(e){return"object"===typeof e},uv=function(e){return sv(e)&&e()},cv=function(e,t){return function(){var n=uv(e),i=uv(t);return function(){uv(n),uv(i)}}},Iv=function(e,t,n){return e&&e.progress(t?0:1)&&n&&e.pause()},Cv=function(e,t){if(e.enabled){var n=t(e);n&&n.totalTime&&(e.callbackAnimation=n)}},dv=Math.abs,hv="left",Av="right",pv="bottom",mv="width",fv="height",vv="padding",bv="margin",yv="Width",Gv="px",Bv=function(e){return df.getComputedStyle(e)},Zv=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},wv=function(e,t){var n=t&&"matrix(1, 0, 0, 1, 0, 0)"!==Bv(e)[wf]&&If.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),i=e.getBoundingClientRect();return n&&n.progress(0).kill(),i},Sv=function(e,t){var n=t.d2;return e["offset"+n]||e["client"+n]||0},Wv=function(e){var t,n=[],i=e.labels,r=e.duration();for(t in i)n.push(i[t]/r);return n},xv=function(e){var t=If.utils.snap(e),n=Array.isArray(e)&&e.slice(0).sort((function(e,t){return e-t}));return n?function(e,i,r){var a;if(void 0===r&&(r=.001),!i)return t(e);if(i>0){for(e-=r,a=0;a<n.length;a++)if(n[a]>=e)return n[a];return n[a-1]}for(a=n.length,e+=r;a--;)if(n[a]<=e)return n[a];return n[0]}:function(n,i,r){void 0===r&&(r=.001);var a=t(n);return!i||Math.abs(a-n)<r||a-n<0===i<0?a:t(i<0?n-e:n+e)}},Rv=function(e,t,n,i){return n.split(",").forEach((function(n){return e(t,n,i)}))},Vv=function(e,t,n,i,r){return e.addEventListener(t,n,{passive:!i,capture:!!r})},kv=function(e,t,n,i){return e.removeEventListener(t,n,!!i)},Xv=function(e,t,n){return n&&n.wheelHandler&&e(t,"wheel",n)},Yv={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Hv={toggleActions:"play",anticipatePin:0},Fv={top:0,left:0,center:.5,bottom:1,right:1},Mv=function(e,t){if(ov(e)){var n=e.indexOf("="),i=~n?+(e.charAt(n-1)+1)*parseFloat(e.substr(n+1)):0;~n&&(e.indexOf("%")>n&&(i*=t/100),e=e.substr(0,n-1)),e=i+(e in Fv?Fv[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},Kv=function(e,t,n,i,r,a,o,s){var g=r.startColor,l=r.endColor,u=r.fontSize,c=r.indent,I=r.fontWeight,C=hf.createElement("div"),d=nv(n)||"fixed"===Um(n,"pinType"),h=-1!==e.indexOf("scroller"),A=d?pf:n,p=-1!==e.indexOf("start"),m=p?g:l,f="border-color:"+m+";font-size:"+u+";color:"+m+";font-weight:"+I+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return f+="position:"+((h||s)&&d?"fixed;":"absolute;"),(h||s||!d)&&(f+=(i===nf?Av:pv)+":"+(a+parseFloat(c))+"px;"),o&&(f+="box-sizing:border-box;text-align:left;width:"+o.offsetWidth+"px;"),C._isStart=p,C.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),C.style.cssText=f,C.innerText=t||0===t?e+"-"+t:e,A.children[0]?A.insertBefore(C,A.children[0]):A.appendChild(C),C._offset=C["offset"+i.op.d2],Nv(C,0,i,p),C},Nv=function(e,t,n,i){var r={display:"block"},a=n[i?"os2":"p2"],o=n[i?"p2":"os2"];e._isFlipped=i,r[n.a+"Percent"]=i?-100:0,r[n.a]=i?"1px":0,r["border"+a+yv]=1,r["border"+o+yv]=0,r[n.p]=t+"px",If.set(e,r)},zv=[],Lv={},_v=function(){return Df()-Pf>34&&ob()},Tv=function(){(!Yf||!Yf.isPressed||Yf.startX>pf.clientWidth)&&(Tm.cache++,zf||(zf=requestAnimationFrame(ob)),Pf||jv("scrollStart"),Pf=Df())},Ev=function(){Mf=df.innerWidth,Ff=df.innerHeight},Jv=function(){Tm.cache++,!Bf&&!Xf&&!hf.fullscreenElement&&!hf.webkitFullscreenElement&&(!Hf||Mf!==df.innerWidth||Math.abs(df.innerHeight-Ff)>.25*df.innerHeight)&&ff.restart(!0)},Dv={},Uv=[],Pv=[],Qv=function(e){var t,n=If.ticker.frame,i=[],r=0;if(_f!==n||Jf){for(eb();r<Pv.length;r+=4)(t=df.matchMedia(Pv[r]).matches)!==Pv[r+3]&&(Pv[r+3]=t,t?i.push(r):eb(1,Pv[r])||sv(Pv[r+2])&&Pv[r+2]());for($v(),r=0;r<i.length;r++)t=i[r],Lf=Pv[t],Pv[t+2]=Pv[t+1](e);Lf=0,Cf&&ib(0,1),_f=n,jv("matchMedia")}},Ov=function e(){return kv(mb,"scrollEnd",e)||ib(!0)},jv=function(e){return Dv[e]&&Dv[e].map((function(e){return e()}))||Uv},qv=[],$v=function(e){for(var t=0;t<qv.length;t+=5)e&&qv[t+4]!==e||(qv[t].style.cssText=qv[t+1],qv[t].getBBox&&qv[t].setAttribute("transform",qv[t+2]||""),qv[t+3].uncache=1)},eb=function(e,t){var n;for(Sf=0;Sf<zv.length;Sf++)n=zv[Sf],t&&n.media!==t||(e?n.kill(1):n.revert());t&&$v(t),t||jv("revert")},tb=function(){return Tm.cache++&&Tm.forEach((function(e){return"function"===typeof e&&(e.rec=0)}))},nb=0,ib=function(e,t){if(!Pf||e){Tf=!0;var n=jv("refreshInit");Vf&&mb.sort(),t||eb(),zv.slice(0).forEach((function(e){return e.refresh()})),zv.forEach((function(e){return"max"===e.vars.end&&e.setPositions(e.start,rv(e.scroller,e._dir))})),n.forEach((function(e){return e&&e.render&&e.render(-1)})),tb(),ff.pause(),nb++,Tf=!1,jv("refresh")}else Vv(mb,"scrollEnd",Ov)},rb=0,ab=1,ob=function(){if(!Tf){mb.isUpdating=!0,Ef&&Ef.update(0);var e=zv.length,t=Df(),n=t-Uf>=50,i=e&&zv[0].scroll();if(ab=rb>i?-1:1,rb=i,n&&(Pf&&!Zf&&t-Pf>200&&(Pf=0,jv("scrollEnd")),yf=Uf,Uf=t),ab<0){for(Sf=e;Sf-- >0;)zv[Sf]&&zv[Sf].update(0,n);ab=1}else for(Sf=0;Sf<e;Sf++)zv[Sf]&&zv[Sf].update(0,n);mb.isUpdating=!1}zf=0},sb=[hv,"top",pv,Av,"marginBottom","marginRight","marginTop","marginLeft","display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],gb=sb.concat([mv,fv,"boxSizing","maxWidth","maxHeight","position",bv,vv,"paddingTop","paddingRight","paddingBottom","paddingLeft"]),lb=function(e,t,n,i){if(e.parentNode!==t){for(var r,a=sb.length,o=t.style,s=e.style;a--;)o[r=sb[a]]=n[r];o.position="absolute"===n.position?"absolute":"relative","inline"===n.display&&(o.display="inline-block"),s.bottom=s.right=o.flexBasis="auto",o.overflow="visible",o.boxSizing="border-box",o.width=Sv(e,tf)+Gv,o.height=Sv(e,nf)+Gv,o.padding=s.margin=s.top=s.left="0",cb(i),s.width=s.maxWidth=n.width,s.height=s.maxHeight=n.height,s.padding=n.padding,e.parentNode.insertBefore(t,e),t.appendChild(e)}},ub=/([A-Z])/g,cb=function(e){if(e){var t,n,i=e.t.style,r=e.length,a=0;for((e.t._gsap||If.core.getCache(e.t)).uncache=1;a<r;a+=2)n=e[a+1],t=e[a],n?i[t]=n:i[t]&&i.removeProperty(t.replace(ub,"-$1").toLowerCase())}},Ib=function(e){for(var t=gb.length,n=e.style,i=[],r=0;r<t;r++)i.push(gb[r],n[gb[r]]);return i.t=e,i},Cb={left:0,top:0},db=function(e,t,n,i,r,a,o,s,g,l,u,c,I){sv(e)&&(e=e(s)),ov(e)&&"max"===e.substr(0,3)&&(e=c+("="===e.charAt(4)?Mv("0"+e.substr(3),n):0));var C,d,h,A=I?I.time():0;if(I&&I.seek(0),gv(e))o&&Nv(o,n,i,!0);else{sv(t)&&(t=t(s));var p,m,f,v,b=e.split(" ");h=rf(t)||pf,(p=wv(h)||{})&&(p.left||p.top)||"none"!==Bv(h).display||(v=h.style.display,h.style.display="block",p=wv(h),v?h.style.display=v:h.style.removeProperty("display")),m=Mv(b[0],p[i.d]),f=Mv(b[1]||"0",n),e=p[i.p]-g[i.p]-l+m+r-f,o&&Nv(o,f,i,n-f<20||o._isStart&&f>20),n-=n-f}if(a){var y=e+n,G=a._isStart;C="scroll"+i.d2,Nv(a,y,i,G&&y>20||!G&&(u?Math.max(pf[C],Af[C]):a.parentNode[C])<=y+1),u&&(g=wv(o),u&&(a.style[i.op.p]=g[i.op.p]-i.op.m-a._offset+Gv))}return I&&h&&(C=wv(h),I.seek(c),d=wv(h),I._caScrollDist=C[i.p]-d[i.p],e=e/I._caScrollDist*c),I&&I.seek(A),I?e:Math.round(e)},hb=/(webkit|moz|length|cssText|inset)/i,Ab=function(e,t,n,i){if(e.parentNode!==t){var r,a,o=e.style;if(t===pf){for(r in e._stOrig=o.cssText,a=Bv(e))+r||hb.test(r)||!a[r]||"string"!==typeof o[r]||"0"===r||(o[r]=a[r]);o.top=n,o.left=i}else o.cssText=e._stOrig;If.core.getCache(e).uncache=1,t.appendChild(e)}},pb=function(e,t){var n,i,r=af(e,t),a="_scroll"+t.p2,o=function t(o,s,g,l,u){var c=t.tween,I=s.onComplete,C={};return g=g||r(),u=l&&u||0,l=l||o-g,c&&c.kill(),n=Math.round(g),s[a]=o,s.modifiers=C,C[a]=function(e){return(e=$f(r()))!==n&&e!==i&&Math.abs(e-n)>2&&Math.abs(e-i)>2?(c.kill(),t.tween=0):e=g+l*c.ratio+u*c.ratio*c.ratio,i=n,n=$f(e)},s.onComplete=function(){t.tween=0,I&&I.call(c)},c=t.tween=If.to(e,s)};return e[a]=r,r.wheelHandler=function(){return o.tween&&o.tween.kill()&&(o.tween=0)},Vv(e,"wheel",r.wheelHandler),o},mb=function(){function e(t,n){Cf||e.register(If)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),this.init(t,n)}return e.prototype.init=function(t,n){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),Qf){var i,r,a,o,s,g,l,u,c,I,C,d,h,A,p,m,f,v,b,y,G,B,Z,w,S,W,x,R,V,k,X,Y,H,F,M,K,N,z,L,_=t=Zv(ov(t)||gv(t)||t.nodeType?{trigger:t}:t,Hv),T=_.onUpdate,E=_.toggleClass,J=_.id,D=_.onToggle,U=_.onRefresh,P=_.scrub,Q=_.trigger,O=_.pin,j=_.pinSpacing,q=_.invalidateOnRefresh,$=_.anticipatePin,ee=_.onScrubComplete,te=_.onSnapComplete,ne=_.once,ie=_.snap,re=_.pinReparent,ae=_.pinSpacer,oe=_.containerAnimation,se=_.fastScrollEnd,ge=_.preventOverlaps,le=t.horizontal||t.containerAnimation&&!1!==t.horizontal?tf:nf,ue=!P&&0!==P,ce=rf(t.scroller||df),Ie=If.core.getCache(ce),Ce=nv(ce),de="fixed"===("pinType"in t?t.pinType:Um(ce,"pinType")||Ce&&"fixed"),he=[t.onEnter,t.onLeave,t.onEnterBack,t.onLeaveBack],Ae=ue&&t.toggleActions.split(" "),pe="markers"in t?t.markers:Hv.markers,me=Ce?0:parseFloat(Bv(ce)["border"+le.p2+yv])||0,fe=this,ve=t.onRefreshInit&&function(){return t.onRefreshInit(fe)},be=function(e,t,n){var i=n.d,r=n.d2,a=n.a;return(a=Um(e,"getBoundingClientRect"))?function(){return a()[i]}:function(){return(t?df["inner"+r]:e["client"+r])||0}}(ce,Ce,le),ye=function(e,t){return!t||~Em.indexOf(e)?iv(e):function(){return Cb}}(ce,Ce),Ge=0,Be=0,Ze=af(ce,le);if(fe.media=Lf,fe._dir=le,$*=45,fe.scroller=ce,fe.scroll=oe?oe.time.bind(oe):Ze,o=Ze(),fe.vars=t,n=n||t.animation,"refreshPriority"in t&&(Vf=1,-9999===t.refreshPriority&&(Ef=fe)),Ie.tweenScroll=Ie.tweenScroll||{top:pb(ce,nf),left:pb(ce,tf)},fe.tweenTo=i=Ie.tweenScroll[le.p],fe.scrubDuration=function(e){(X=gv(e)&&e)?k?k.duration(e):k=If.to(n,{ease:"expo",totalProgress:"+=0.001",duration:X,paused:!0,onComplete:function(){return ee&&ee(fe)}}):(k&&k.progress(1).kill(),k=0)},n&&(n.vars.lazy=!1,n._initted||!1!==n.vars.immediateRender&&!1!==t.immediateRender&&n.render(0,!0,!0),fe.animation=n.pause(),n.scrollTrigger=fe,fe.scrubDuration(P),R=0,J||(J=n.vars.id)),zv.push(fe),ie&&(lv(ie)&&!ie.push||(ie={snapTo:ie}),"scrollBehavior"in pf.style&&If.set(Ce?[pf,Af]:ce,{scrollBehavior:"auto"}),a=sv(ie.snapTo)?ie.snapTo:"labels"===ie.snapTo?function(e){return function(t){return If.utils.snap(Wv(e),t)}}(n):"labelsDirectional"===ie.snapTo?(L=n,function(e,t){return xv(Wv(L))(e,t.direction)}):!1!==ie.directional?function(e,t){return xv(ie.snapTo)(e,Df()-Be<500?0:t.direction)}:If.utils.snap(ie.snapTo),Y=ie.duration||{min:.1,max:2},Y=lv(Y)?bf(Y.min,Y.max):bf(Y,Y),H=If.delayedCall(ie.delay||X/2||.1,(function(){var e=Ze(),t=Df()-Be<500,r=i.tween;if(!(t||Math.abs(fe.getVelocity())<10)||r||Zf||Ge===e)fe.isActive&&Ge!==e&&H.restart(!0);else{var o=(e-g)/h,s=n&&!ue?n.totalProgress():o,u=t?0:(s-V)/(Df()-yf)*1e3||0,c=If.utils.clamp(-o,1-o,dv(u/2)*u/.185),I=o+(!1===ie.inertia?0:c),C=bf(0,1,a(I,fe)),d=Math.round(g+C*h),A=ie,p=A.onStart,m=A.onInterrupt,f=A.onComplete;if(e<=l&&e>=g&&d!==e){if(r&&!r._initted&&r.data<=dv(d-e))return;!1===ie.inertia&&(c=C-o),i(d,{duration:Y(dv(.185*Math.max(dv(I-s),dv(C-s))/u/.05||0)),ease:ie.ease||"power3",data:dv(d-e),onInterrupt:function(){return H.restart(!0)&&m&&m(fe)},onComplete:function(){fe.update(),Ge=Ze(),R=V=n&&!ue?n.totalProgress():fe.progress,te&&te(fe),f&&f(fe)}},e,c*h,d-e-c*h),p&&p(fe,i.tween)}}})).pause()),J&&(Lv[J]=fe),(z=(Q=fe.trigger=rf(Q||O))&&Q._gsap&&Q._gsap.stRevert)&&(z=z(fe)),O=!0===O?Q:rf(O),ov(E)&&(E={targets:Q,className:E}),O&&(!1===j||j===bv||(j=!(!j&&"flex"===Bv(O.parentNode).display)&&vv),fe.pin=O,!1!==t.force3D&&If.set(O,{force3D:!0}),(r=If.core.getCache(O)).spacer?A=r.pinState:(ae&&((ae=rf(ae))&&!ae.nodeType&&(ae=ae.current||ae.nativeElement),r.spacerIsNative=!!ae,ae&&(r.spacerState=Ib(ae))),r.spacer=f=ae||hf.createElement("div"),f.classList.add("pin-spacer"),J&&f.classList.add("pin-spacer-"+J),r.pinState=A=Ib(O)),fe.spacer=f=r.spacer,x=Bv(O),Z=x[j+le.os2],b=If.getProperty(O),y=If.quickSetter(O,le.a,Gv),lb(O,f,x),m=Ib(O)),pe){d=lv(pe)?Zv(pe,Yv):Yv,I=Kv("scroller-start",J,ce,le,d,0),C=Kv("scroller-end",J,ce,le,d,0,I),v=I["offset"+le.op.d2];var we=rf(Um(ce,"content")||ce);u=this.markerStart=Kv("start",J,we,le,d,v,0,oe),c=this.markerEnd=Kv("end",J,we,le,d,v,0,oe),oe&&(N=If.quickSetter([u,c],le.a,Gv)),de||Em.length&&!0===Um(ce,"fixedMarkers")||(!function(e){var t=Bv(e).position;e.style.position="absolute"===t||"fixed"===t?t:"relative"}(Ce?pf:ce),If.set([I,C],{force3D:!0}),S=If.quickSetter(I,le.a,Gv),W=If.quickSetter(C,le.a,Gv))}if(oe){var Se=oe.vars.onUpdate,We=oe.vars.onUpdateParams;oe.eventCallback("onUpdate",(function(){fe.update(0,0,1),Se&&Se.apply(We||[])}))}fe.previous=function(){return zv[zv.indexOf(fe)-1]},fe.next=function(){return zv[zv.indexOf(fe)+1]},fe.revert=function(e){var t=!1!==e||!fe.enabled,i=Bf;t!==fe.isReverted&&(t&&(fe.scroll.rec||!Bf||!Tf||(fe.scroll.rec=Ze()),M=Math.max(Ze(),fe.scroll.rec||0),F=fe.progress,K=n&&n.progress()),u&&[u,c,I,C].forEach((function(e){return e.style.display=t?"none":"block"})),t&&(Bf=1),fe.update(t),Bf=i,O&&(t?function(e,t,n){cb(n);var i=e._gsap;if(i.spacerIsNative)cb(i.spacerState);else if(e.parentNode===t){var r=t.parentNode;r&&(r.insertBefore(e,t),r.removeChild(t))}}(O,f,A):(!re||!fe.isActive)&&lb(O,f,Bv(O),w)),fe.isReverted=t)},fe.refresh=function(r,a){if(!Bf&&fe.enabled||a)if(O&&r&&Pf)Vv(e,"scrollEnd",Ov);else{!Tf&&ve&&ve(fe),Bf=1,Be=Df(),i.tween&&(i.tween.kill(),i.tween=0),k&&k.pause(),q&&n&&n.time(-.01,!0).invalidate(),fe.isReverted||fe.revert();for(var d,v,y,Z,S,W,x,R,V,X,Y=be(),N=ye(),z=oe?oe.duration():rv(ce,le),L=0,_=0,T=t.end,E=t.endTrigger||Q,J=t.start||(0!==t.start&&Q?O?"0 0":"0 100%":0),D=fe.pinnedContainer=t.pinnedContainer&&rf(t.pinnedContainer),P=Q&&Math.max(0,zv.indexOf(fe))||0,$=P;$--;)(W=zv[$]).end||W.refresh(0,1)||(Bf=1),!(x=W.pin)||x!==Q&&x!==O||W.isReverted||(X||(X=[]),X.unshift(W),W.revert()),W!==zv[$]&&(P--,$--);for(sv(J)&&(J=J(fe)),g=db(J,Q,Y,le,Ze(),u,I,fe,N,me,de,z,oe)||(O?-.001:0),sv(T)&&(T=T(fe)),ov(T)&&!T.indexOf("+=")&&(~T.indexOf(" ")?T=(ov(J)?J.split(" ")[0]:"")+T:(L=Mv(T.substr(2),Y),T=ov(J)?J:g+L,E=Q)),l=Math.max(g,db(T||(E?"100% 0":z),E,Y,le,Ze()+L,c,C,fe,N,me,de,z,oe))||-.001,h=l-g||(g-=.01)&&.001,L=0,$=P;$--;)(x=(W=zv[$]).pin)&&W.start-W._pinPush<g&&!oe&&W.end>0&&(d=W.end-W.start,x!==Q&&x!==D||gv(J)||(L+=d*(1-W.progress)),x===O&&(_+=d));if(g+=L,l+=L,fe._pinPush=_,u&&L&&((d={})[le.a]="+="+L,D&&(d[le.p]="-="+Ze()),If.set([u,c],d)),O)d=Bv(O),Z=le===nf,y=Ze(),G=parseFloat(b(le.a))+_,!z&&l>1&&((Ce?pf:ce).style["overflow-"+le.a]="scroll"),lb(O,f,d),m=Ib(O),v=wv(O,!0),R=de&&af(ce,Z?tf:nf)(),j&&((w=[j+le.os2,h+_+Gv]).t=f,($=j===vv?Sv(O,le)+h+_:0)&&w.push(le.d,$+Gv),cb(w),de&&Ze(M)),de&&((S={top:v.top+(Z?y-g:R)+Gv,left:v.left+(Z?R:y-g)+Gv,boxSizing:"border-box",position:"fixed"}).width=S.maxWidth=Math.ceil(v.width)+Gv,S.height=S.maxHeight=Math.ceil(v.height)+Gv,S.margin=S.marginTop=S.marginRight=S.marginBottom=S.marginLeft="0",S.padding=d.padding,S.paddingTop=d.paddingTop,S.paddingRight=d.paddingRight,S.paddingBottom=d.paddingBottom,S.paddingLeft=d.paddingLeft,p=function(e,t,n){for(var i,r=[],a=e.length,o=n?8:0;o<a;o+=2)i=e[o],r.push(i,i in t?t[i]:e[o+1]);return r.t=e.t,r}(A,S,re)),n?(V=n._initted,kf(1),n.render(n.duration(),!0,!0),B=b(le.a)-G+h+_,h!==B&&de&&p.splice(p.length-2,2),n.render(0,!0,!0),V||n.invalidate(),kf(0)):B=h;else if(Q&&Ze()&&!oe)for(v=Q.parentNode;v&&v!==pf;)v._pinOffset&&(g-=v._pinOffset,l-=v._pinOffset),v=v.parentNode;X&&X.forEach((function(e){return e.revert(!1)})),fe.start=g,fe.end=l,o=s=Ze(),oe||(o<M&&Ze(M),fe.scroll.rec=0),fe.revert(!1),H&&(Ge=-1,fe.isActive&&Ze(g+h*F),H.restart(!0)),Bf=0,n&&ue&&(n._initted||K)&&n.progress()!==K&&n.progress(K,!0).render(n.time(),!0,!0),(F!==fe.progress||oe)&&(n&&!ue&&n.totalProgress(F,!0),fe.progress=F,fe.update(0,0,1)),O&&j&&(f._pinOffset=Math.round(fe.progress*B)),U&&U(fe)}},fe.getVelocity=function(){return(Ze()-s)/(Df()-yf)*1e3||0},fe.endAnimation=function(){Iv(fe.callbackAnimation),n&&(k?k.progress(1):n.paused()?ue||Iv(n,fe.direction<0,1):Iv(n,n.reversed()))},fe.labelToScroll=function(e){return n&&n.labels&&(g||fe.refresh()||g)+n.labels[e]/n.duration()*h||0},fe.getTrailing=function(e){var t=zv.indexOf(fe),n=fe.direction>0?zv.slice(0,t).reverse():zv.slice(t+1);return(ov(e)?n.filter((function(t){return t.vars.preventOverlaps===e})):n).filter((function(e){return fe.direction>0?e.end<=g:e.start>=l}))},fe.update=function(e,t,r){if(!oe||r||e){var a,u,c,C,d,A,v,b=fe.scroll(),w=e?0:(b-g)/h,x=w<0?0:w>1?1:w||0,X=fe.progress;if(t&&(s=o,o=oe?Ze():b,ie&&(V=R,R=n&&!ue?n.totalProgress():x)),$&&!x&&O&&!Bf&&!Jf&&Pf&&g<b+(b-s)/(Df()-yf)*$&&(x=1e-4),x!==X&&fe.enabled){if(C=(d=(a=fe.isActive=!!x&&x<1)!==(!!X&&X<1))||!!x!==!!X,fe.direction=x>X?1:-1,fe.progress=x,C&&!Bf&&(u=x&&!X?0:1===x?1:1===X?2:3,ue&&(c=!d&&"none"!==Ae[u+1]&&Ae[u+1]||Ae[u],v=n&&("complete"===c||"reset"===c||c in n))),ge&&(d||v)&&(v||P||!n)&&(sv(ge)?ge(fe):fe.getTrailing(ge).forEach((function(e){return e.endAnimation()}))),ue||(!k||Bf||Jf?n&&n.totalProgress(x,!!Bf):((oe||Ef&&Ef!==fe)&&k.render(k._dp._time-k._start),k.resetTo?k.resetTo("totalProgress",x,n._tTime/n._tDur):(k.vars.totalProgress=x,k.invalidate().restart()))),O)if(e&&j&&(f.style[j+le.os2]=Z),de){if(C){if(A=!e&&x>X&&l+1>b&&b+1>=rv(ce,le),re)if(e||!a&&!A)Ab(O,f);else{var Y=wv(O,!0),F=b-g;Ab(O,pf,Y.top+(le===nf?F:0)+Gv,Y.left+(le===nf?0:F)+Gv)}cb(a||A?p:m),B!==h&&x<1&&a||y(G+(1!==x||A?0:B))}}else y($f(G+B*x));ie&&!i.tween&&!Bf&&!Jf&&H.restart(!0),E&&(d||ne&&x&&(x<1||!Nf))&&vf(E.targets).forEach((function(e){return e.classList[a||ne?"add":"remove"](E.className)})),T&&!ue&&!e&&T(fe),C&&!Bf?(ue&&(v&&("complete"===c?n.pause().totalProgress(1):"reset"===c?n.restart(!0).pause():"restart"===c?n.restart(!0):n[c]()),T&&T(fe)),!d&&Nf||(D&&d&&Cv(fe,D),he[u]&&Cv(fe,he[u]),ne&&(1===x?fe.kill(!1,1):he[u]=0),d||he[u=1===x?1:3]&&Cv(fe,he[u])),se&&!a&&Math.abs(fe.getVelocity())>(gv(se)?se:2500)&&(Iv(fe.callbackAnimation),k?k.progress(1):Iv(n,!x,1))):ue&&T&&!Bf&&T(fe)}if(W){var M=oe?b/oe.duration()*(oe._caScrollDist||0):b;S(M+(I._isFlipped?1:0)),W(M)}N&&N(-b/oe.duration()*(oe._caScrollDist||0))}},fe.enable=function(t,n){fe.enabled||(fe.enabled=!0,Vv(ce,"resize",Jv),Vv(Ce?hf:ce,"scroll",Tv),ve&&Vv(e,"refreshInit",ve),!1!==t&&(fe.progress=F=0,o=s=Ge=Ze()),!1!==n&&fe.refresh())},fe.getTween=function(e){return e&&i?i.tween:k},fe.setPositions=function(e,t){O&&(G+=e-g,B+=t-e-h),fe.start=g=e,fe.end=l=t,h=t-e,fe.update()},fe.disable=function(t,n){if(fe.enabled&&(!1!==t&&fe.revert(),fe.enabled=fe.isActive=!1,n||k&&k.pause(),M=0,r&&(r.uncache=1),ve&&kv(e,"refreshInit",ve),H&&(H.pause(),i.tween&&i.tween.kill()&&(i.tween=0)),!Ce)){for(var a=zv.length;a--;)if(zv[a].scroller===ce&&zv[a]!==fe)return;kv(ce,"resize",Jv),kv(ce,"scroll",Tv)}},fe.kill=function(e,i){fe.disable(e,i),k&&!i&&k.kill(),J&&delete Lv[J];var a=zv.indexOf(fe);a>=0&&zv.splice(a,1),a===Sf&&ab>0&&Sf--,a=0,zv.forEach((function(e){return e.scroller===fe.scroller&&(a=1)})),a||(fe.scroll.rec=0),n&&(n.scrollTrigger=null,e&&n.render(-1),i||n.kill()),u&&[u,c,I,C].forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),Ef===fe&&(Ef=0),O&&(r&&(r.uncache=1),a=0,zv.forEach((function(e){return e.pin===O&&a++})),a||(r.spacer=0)),t.onKill&&t.onKill(fe)},fe.enable(!1,!1),z&&z(fe),n&&n.add&&!h?If.delayedCall(.01,(function(){return g||l||fe.refresh()}))&&(h=.01)&&(g=l=0):fe.refresh()}else this.update=this.refresh=this.kill=qf},e.register=function(t){return Cf||(If=t||tv(),ev()&&window.document&&e.enable(),Cf=Qf),Cf},e.defaults=function(e){if(e)for(var t in e)Hv[t]=e[t];return Hv},e.disable=function(e,t){Qf=0,zv.forEach((function(n){return n[t?"kill":"disable"](e)})),kv(df,"wheel",Tv),kv(hf,"scroll",Tv),clearInterval(Gf),kv(hf,"touchcancel",qf),kv(pf,"touchstart",qf),Rv(kv,hf,"pointerdown,touchstart,mousedown",Of),Rv(kv,hf,"pointerup,touchend,mouseup",jf),ff.kill(),av(kv);for(var n=0;n<Tm.length;n+=3)Xv(kv,Tm[n],Tm[n+1]),Xv(kv,Tm[n],Tm[n+2])},e.enable=function(){if(df=window,hf=document,Af=hf.documentElement,pf=hf.body,If&&(vf=If.utils.toArray,bf=If.utils.clamp,kf=If.core.suppressOverwrites||qf,If.core.globals("ScrollTrigger",e),pf)){Qf=1,cf.register(If),e.isTouch=cf.isTouch,Kf=cf.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),Vv(df,"wheel",Tv),mf=[df,hf,Af,pf],e.matchMedia({"(orientation: portrait)":function(){return Ev(),Ev}}),Vv(hf,"scroll",Tv);var t,n,i=pf.style,r=i.borderTopStyle;for(i.borderTopStyle="solid",t=wv(pf),nf.m=Math.round(t.top+nf.sc())||0,tf.m=Math.round(t.left+tf.sc())||0,r?i.borderTopStyle=r:i.removeProperty("border-top-style"),Gf=setInterval(_v,250),If.delayedCall(.5,(function(){return Jf=0})),Vv(hf,"touchcancel",qf),Vv(pf,"touchstart",qf),Rv(Vv,hf,"pointerdown,touchstart,mousedown",Of),Rv(Vv,hf,"pointerup,touchend,mouseup",jf),wf=If.utils.checkPrefix("transform"),gb.push(wf),Cf=Df(),ff=If.delayedCall(.2,ib).pause(),Rf=[hf,"visibilitychange",function(){var e=df.innerWidth,t=df.innerHeight;hf.hidden?(Wf=e,xf=t):Wf===e&&xf===t||Jv()},hf,"DOMContentLoaded",ib,df,"load",ib,df,"resize",Jv],av(Vv),zv.forEach((function(e){return e.enable(0,1)})),n=0;n<Tm.length;n+=3)Xv(kv,Tm[n],Tm[n+1]),Xv(kv,Tm[n],Tm[n+2])}},e.config=function(t){"limitCallbacks"in t&&(Nf=!!t.limitCallbacks);var n=t.syncInterval;n&&clearInterval(Gf)||(Gf=n)&&setInterval(_v,n),"ignoreMobileResize"in t&&(Hf=1===e.isTouch&&t.ignoreMobileResize),"autoRefreshEvents"in t&&(av(kv)||av(Vv,t.autoRefreshEvents||"none"),Xf=-1===(t.autoRefreshEvents+"").indexOf("resize"))},e.scrollerProxy=function(e,t){var n=rf(e),i=Tm.indexOf(n),r=nv(n);~i&&Tm.splice(i,r?6:2),t&&(r?Em.unshift(df,t,pf,t,Af,t):Em.unshift(n,t))},e.matchMedia=function(e){var t,n,i,r,a;for(n in e)i=Pv.indexOf(n),r=e[n],Lf=n,"all"===n?r():(t=df.matchMedia(n))&&(t.matches&&(a=r()),~i?(Pv[i+1]=cv(Pv[i+1],r),Pv[i+2]=cv(Pv[i+2],a)):(i=Pv.length,Pv.push(n,r,a),t.addListener?t.addListener(Qv):t.addEventListener("change",Qv)),Pv[i+3]=t.matches),Lf=0;return Pv},e.clearMatchMedia=function(e){e||(Pv.length=0),(e=Pv.indexOf(e))>=0&&Pv.splice(e,4)},e.isInViewport=function(e,t,n){var i=(ov(e)?rf(e):e).getBoundingClientRect(),r=i[n?mv:fv]*t||0;return n?i.right-r>0&&i.left+r<df.innerWidth:i.bottom-r>0&&i.top+r<df.innerHeight},e.positionInViewport=function(e,t,n){ov(e)&&(e=rf(e));var i=e.getBoundingClientRect(),r=i[n?mv:fv],a=null==t?r/2:t in Fv?Fv[t]*r:~t.indexOf("%")?parseFloat(t)*r/100:parseFloat(t)||0;return n?(i.left+a)/df.innerWidth:(i.top+a)/df.innerHeight},e}();mb.version="3.10.4",mb.saveStyles=function(e){return e?vf(e).forEach((function(e){if(e&&e.style){var t=qv.indexOf(e);t>=0&&qv.splice(t,5),qv.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),If.core.getCache(e),Lf)}})):qv},mb.revert=function(e,t){return eb(!e,t)},mb.create=function(e,t){return new mb(e,t)},mb.refresh=function(e){return e?Jv():(Cf||mb.register())&&ib(!0)},mb.update=ob,mb.clearScrollMemory=tb,mb.maxScroll=function(e,t){return rv(e,t?tf:nf)},mb.getScrollFunc=function(e,t){return af(rf(e),t?tf:nf)},mb.getById=function(e){return Lv[e]},mb.getAll=function(){return zv.filter((function(e){return"ScrollSmoother"!==e.vars.id}))},mb.isScrolling=function(){return!!Pf},mb.snapDirectional=xv,mb.addEventListener=function(e,t){var n=Dv[e]||(Dv[e]=[]);~n.indexOf(t)||n.push(t)},mb.removeEventListener=function(e,t){var n=Dv[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},mb.batch=function(e,t){var n,i=[],r={},a=t.interval||.016,o=t.batchMax||1e9,s=function(e,t){var n=[],i=[],r=If.delayedCall(a,(function(){t(n,i),n=[],i=[]})).pause();return function(e){n.length||r.restart(!0),n.push(e.trigger),i.push(e),o<=n.length&&r.progress(1)}};for(n in t)r[n]="on"===n.substr(0,2)&&sv(t[n])&&"onRefreshInit"!==n?s(0,t[n]):t[n];return sv(o)&&(o=o(),Vv(mb,"refresh",(function(){return o=t.batchMax()}))),vf(e).forEach((function(e){var t={};for(n in r)t[n]=r[n];t.trigger=e,i.push(mb.create(t))})),i};var fb,vb,bb=function(e,t,n,i){return t>i?e(i):t<0&&e(0),n>i?(i-t)/(n-t):n<0?t/(t-n):1},yb=function e(t,n){!0===n?t.style.removeProperty("touch-action"):t.style.touchAction=!0===n?"auto":n?"pan-"+n+(cf.isTouch?" pinch-zoom":""):"none",t===Af&&e(pf,n)},Gb={auto:1,scroll:1},Bb=function(e){var t,n=e.event,i=e.target,r=e.axis,a=(n.changedTouches?n.changedTouches[0]:n).target,o=a._gsap||If.core.getCache(a),s=Df();if(!o._isScrollT||s-o._isScrollT>2e3){for(;a&&a.scrollHeight<=a.clientHeight;)a=a.parentNode;o._isScroll=a&&!nv(a)&&a!==i&&(Gb[(t=Bv(a)).overflowY]||Gb[t.overflowX]),o._isScrollT=s}(o._isScroll||"x"===r)&&(n._gsapAllow=!0)},Zb=function(e,t,n,i){return cf.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:i=i&&Bb,onPress:i,onDrag:i,onScroll:i,onEnable:function(){return n&&Vv(hf,cf.eventTypes[0],Sb,!1,!0)},onDisable:function(){return kv(hf,cf.eventTypes[0],Sb,!0)}})},wb=/(input|label|select|textarea)/i,Sb=function(e){var t=wb.test(e.target.tagName);(t||fb)&&(e._gsapAllow=!0,fb=t)},Wb=function(e){lv(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t,n,i,r,a,o,s,g,l=e,u=l.normalizeScrollX,c=l.momentum,I=l.allowNestedScroll,C=rf(e.target)||Af,d=If.core.globals().ScrollSmoother,h=Kf&&(e.content&&rf(e.content)||d&&d.get()&&d.get().content()),A=af(C,nf),p=af(C,tf),m=1,f=(cf.isTouch&&df.visualViewport?df.visualViewport.scale*df.visualViewport.width:df.outerWidth)/df.innerWidth,v=0,b=sv(c)?function(){return c(t)}:function(){return c||2.8},y=Zb(C,e.type,!0,I),G=function(){return i=!1},B=qf,Z=qf,w=function(){n=rv(C,nf),Z=bf(Kf?1:0,n),u&&(B=bf(0,rv(C,tf))),r=nb},S=function(){w(),a.isActive()&&a.vars.scrollY>n&&(A()>n?a.progress(1)&&A(n):a.resetTo("scrollY",n))};return e.ignoreCheck=function(e){return Kf&&"touchmove"===e.type&&function(){if(i){requestAnimationFrame(G);var e=$f(t.deltaY/2),n=Z(A.v-e);return h&&n!==A.v+A.offset&&(A.offset=n-A.v,h.style.transform="translateY("+-A.offset+"px)",h._gsap&&(h._gsap.y=-A.offset+"px"),A.cacheID=Tm.cache,ob()),!0}h&&(h.style.transform="translateY(0px)",A.offset=A.cacheID=0,h._gsap&&(h._gsap.y="0px")),i=!0}()||m>1.05&&"touchstart"!==e.type||t.isGesturing||e.touches&&e.touches.length>1},e.onPress=function(){var e=m;m=$f((df.visualViewport&&df.visualViewport.scale||1)/f),a.pause(),e!==m&&yb(C,m>1.01||!u&&"x"),i=!1,o=p(),s=A(),w(),r=nb},e.onRelease=e.onGestureStart=function(e,t){if(h&&(h.style.transform="translateY(0px)",A.offset=A.cacheID=0,h._gsap&&(h._gsap.y="0px")),t){Tm.cache++;var i,r,o=b();u&&(r=(i=p())+.05*o*-e.velocityX/.227,o*=bb(p,i,r,rv(C,tf)),a.vars.scrollX=B(r)),r=(i=A())+.05*o*-e.velocityY/.227,o*=bb(A,i,r,rv(C,nf)),a.vars.scrollY=Z(r),a.invalidate().duration(o).play(.01),(Kf&&a.vars.scrollY>=n||i>=n-1)&&If.to({},{onUpdate:S,duration:o})}else g.restart(!0)},e.onWheel=function(){a._ts&&a.pause(),Df()-v>1e3&&(r=0,v=Df())},e.onChange=function(e,t,n,i,a){nb!==r&&w(),t&&u&&p(B(i[2]===t?o+(e.startX-e.x):p()+t-i[1])),n&&A(Z(a[2]===n?s+(e.startY-e.y):A()+n-a[1])),ob()},e.onEnable=function(){yb(C,!u&&"x"),Vv(df,"resize",S),y.enable()},e.onDisable=function(){yb(C,!0),kv(df,"resize",S),y.kill()},(t=new cf(e)).iOS=Kf,Kf&&!A()&&A(1),g=t._dc,a=If.to(t,{ease:"power4",paused:!0,scrollX:u?"+=0.1":"+=0",scrollY:"+=0.1",onComplete:g.vars.onComplete}),t};function xb(e){e.textShadow1,e.textShadow2;var n=e.titleSectionRef,i=(0,t.useRef)(),r=(0,t.useRef)(),a=(0,t.useRef)();return(0,t.useEffect)((function(){wm.registerPlugin(mb);var e=wm.to(n.current,{scrollTrigger:{trigger:n.current,pin:n.current,start:"top top",scrub:1},scale:0});return r.current=wm.timeline(),i.current=wm.timeline().add(r.current).add(e),function(){e.kill(),i.current.kill(),r.current.kill()}}),[]),(0,Kl.jsx)(id,{ref:n,sx:{height:"100vh",width:"100vw",display:"flex",justifyContent:"center",alignItems:"center"},textAlign:"center",children:(0,Kl.jsx)(ud,{id:"title-text",sx:{fontSize:"12rem"},color:"white",ref:a,children:"Siqi Liu"})})}function Rb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Vb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rb(Object(n),!0).forEach((function(t){Eo(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kb(e,t){if(null==e)return{};var n,i,r=sa(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Xb(e,t,n,i,r,a,o){try{var s=e[a](o),g=s.value}catch(l){return void n(l)}s.done?t(g):Promise.resolve(g).then(i,r)}function Yb(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var a=e.apply(t,n);function o(e){Xb(a,i,r,o,s,"next",e)}function s(e){Xb(a,i,r,o,s,"throw",e)}o(void 0)}))}}function Hb(){Hb=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(w){s=function(e,t,n){return e[t]=n}}function g(e,t,n,i){var r=t&&t.prototype instanceof c?t:c,a=Object.create(r.prototype),o=new G(i||[]);return a._invoke=function(e,t,n){var i="suspendedStart";return function(r,a){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw a;return Z()}for(n.method=r,n.arg=a;;){var o=n.delegate;if(o){var s=v(o,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var g=l(e,t,n);if("normal"===g.type){if(i=n.done?"completed":"suspendedYield",g.arg===u)continue;return{value:g.arg,done:n.done}}"throw"===g.type&&(i="completed",n.method="throw",n.arg=g.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(w){return{type:"throw",arg:w}}}e.wrap=g;var u={};function c(){}function I(){}function C(){}var d={};s(d,r,(function(){return this}));var h=Object.getPrototypeOf,A=h&&h(h(B([])));A&&A!==t&&n.call(A,r)&&(d=A);var p=C.prototype=c.prototype=Object.create(d);function m(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function f(e,t){function i(r,a,o,s){var g=l(e[r],e,a);if("throw"!==g.type){var u=g.arg,c=u.value;return c&&"object"==Ei(c)&&n.call(c,"__await")?t.resolve(c.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(g.arg)}var r;this._invoke=function(e,n){function a(){return new t((function(t,r){i(e,n,t,r)}))}return r=r?r.then(a,a):a()}}function v(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,v(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function y(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function G(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function B(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:Z}}function Z(){return{value:void 0,done:!0}}return I.prototype=C,s(p,"constructor",C),s(C,"constructor",I),I.displayName=s(C,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===I||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,s(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e},e.awrap=function(e){return{__await:e}},m(f.prototype),s(f.prototype,a,(function(){return this})),e.AsyncIterator=f,e.async=function(t,n,i,r,a){void 0===a&&(a=Promise);var o=new f(g(t,n,i,r),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},m(p),s(p,o,"Generator"),s(p,r,(function(){return this})),s(p,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=B,G.prototype={constructor:G,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(y),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),g=n.call(a,"finallyLoc");if(s&&g){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!g)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),y(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;y(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:B(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}mb.sort=function(e){return zv.sort(e||function(e,t){return-1e6*(e.vars.refreshPriority||0)+e.start-(t.start+-1e6*(t.vars.refreshPriority||0))})},mb.observe=function(e){return new cf(e)},mb.normalizeScroll=function(e){if("undefined"===typeof e)return Yf;if(!0===e&&Yf)return Yf.enable();if(!1===e)return Yf&&Yf.kill();var t=e instanceof cf?e:Wb(e);return Yf&&Yf.target===t.target&&Yf.kill(),nv(t.target)&&(Yf=t),t},mb.core={_getVelocityProp:of,_inputObserver:Zb,_scrollers:Tm,_proxies:Em,bridge:{ss:function(){Pf||jv("scrollStart"),Pf=Df()},ref:function(){return Bf}}},tv()&&If.registerPlugin(mb);var Fb="142",Mb={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Kb={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Nb=0,zb=1,Lb=2,_b=3,Tb=0,Eb=1,Jb=2,Db=3,Ub=0,Pb=1,Qb=2,Ob=1,jb=2,qb=0,$b=1,ey=2,ty=3,ny=4,iy=5,ry=100,ay=101,oy=102,sy=103,gy=104,ly=200,uy=201,cy=202,Iy=203,Cy=204,dy=205,hy=206,Ay=207,py=208,my=209,fy=210,vy=0,by=1,yy=2,Gy=3,By=4,Zy=5,wy=6,Sy=7,Wy=0,xy=1,Ry=2,Vy=0,ky=1,Xy=2,Yy=3,Hy=4,Fy=5,My=300,Ky=301,Ny=302,zy=303,Ly=304,_y=306,Ty=1e3,Ey=1001,Jy=1002,Dy=1003,Uy=1004,Py=1004,Qy=1005,Oy=1005,jy=1006,qy=1007,$y=1007,eG=1008,tG=1008,nG=1009,iG=1010,rG=1011,aG=1012,oG=1013,sG=1014,gG=1015,lG=1016,uG=1017,cG=1018,IG=1020,CG=1021,dG=1022,hG=1023,AG=1024,pG=1025,mG=1026,fG=1027,vG=1028,bG=1029,yG=1030,GG=1031,BG=1033,ZG=33776,wG=33777,SG=33778,WG=33779,xG=35840,RG=35841,VG=35842,kG=35843,XG=36196,YG=37492,HG=37496,FG=37808,MG=37809,KG=37810,NG=37811,zG=37812,LG=37813,_G=37814,TG=37815,EG=37816,JG=37817,DG=37818,UG=37819,PG=37820,QG=37821,OG=36492,jG=2200,qG=2201,$G=2202,eB=2300,tB=2301,nB=2302,iB=2400,rB=2401,aB=2402,oB=2500,sB=2501,gB=0,lB=1,uB=2,cB=3e3,IB=3001,CB=3200,dB=3201,hB=0,AB=1,pB="",mB="srgb",fB="srgb-linear",vB=0,bB=7680,yB=7681,GB=7682,BB=7683,ZB=34055,wB=34056,SB=5386,WB=512,xB=513,RB=514,VB=515,kB=516,XB=517,YB=518,HB=519,FB=35044,MB=35048,KB=35040,NB=35045,zB=35049,LB=35041,_B=35046,TB=35050,EB=35042,JB="100",DB="300 es",UB=1035,PB=function(){function e(){di(this,e)}return Ai(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}}]),e}(),QB=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],OB=1234567,jB=Math.PI/180,qB=180/Math.PI;function $B(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(QB[255&e]+QB[e>>8&255]+QB[e>>16&255]+QB[e>>24&255]+"-"+QB[255&t]+QB[t>>8&255]+"-"+QB[t>>16&15|64]+QB[t>>24&255]+"-"+QB[63&n|128]+QB[n>>8&255]+"-"+QB[n>>16&255]+QB[n>>24&255]+QB[255&i]+QB[i>>8&255]+QB[i>>16&255]+QB[i>>24&255]).toLowerCase()}function eZ(e,t,n){return Math.max(t,Math.min(n,e))}function tZ(e,t){return(e%t+t)%t}function nZ(e,t,n){return(1-n)*e+n*t}function iZ(e){return 0===(e&e-1)&&0!==e}function rZ(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function aZ(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var oZ=Object.freeze({__proto__:null,DEG2RAD:jB,RAD2DEG:qB,generateUUID:$B,clamp:eZ,euclideanModulo:tZ,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:nZ,damp:function(e,t,n,i){return nZ(e,t,1-Math.exp(-n*i))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(tZ(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(OB=e);var t=OB+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*jB},radToDeg:function(e){return e*qB},isPowerOfTwo:iZ,ceilPowerOfTwo:rZ,floorPowerOfTwo:aZ,setQuaternionFromProperEuler:function(e,t,n,i,r){var a=Math.cos,o=Math.sin,s=a(n/2),g=o(n/2),l=a((t+i)/2),u=o((t+i)/2),c=a((t-i)/2),I=o((t-i)/2),C=a((i-t)/2),d=o((i-t)/2);switch(r){case"XYX":e.set(s*u,g*c,g*I,s*l);break;case"YZY":e.set(g*I,s*u,g*c,s*l);break;case"ZXZ":e.set(g*c,g*I,s*u,s*l);break;case"XZX":e.set(s*u,g*d,g*C,s*l);break;case"YXY":e.set(g*C,s*u,g*d,s*l);break;case"ZYZ":e.set(g*d,g*C,s*u,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}},denormalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}}),sZ=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;di(this,t),t.prototype.isVector2=!0,this.x=e,this.y=n}return Ai(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:Hb().mark((function e(){return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}(),gZ=function(){function e(){di(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return Ai(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,g){var l=this.elements;return l[0]=e,l[1]=i,l[2]=o,l[3]=t,l[4]=r,l[5]=s,l[6]=n,l[7]=a,l[8]=g,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],g=n[1],l=n[4],u=n[7],c=n[2],I=n[5],C=n[8],d=i[0],h=i[3],A=i[6],p=i[1],m=i[4],f=i[7],v=i[2],b=i[5],y=i[8];return r[0]=a*d+o*p+s*v,r[3]=a*h+o*m+s*b,r[6]=a*A+o*f+s*y,r[1]=g*d+l*p+u*v,r[4]=g*h+l*m+u*b,r[7]=g*A+l*f+u*y,r[2]=c*d+I*p+C*v,r[5]=c*h+I*m+C*b,r[8]=c*A+I*f+C*y,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],g=e[7],l=e[8];return t*a*l-t*o*g-n*r*l+n*o*s+i*r*g-i*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],g=e[7],l=e[8],u=l*a-o*g,c=o*s-l*r,I=g*r-a*s,C=t*u+n*c+i*I;if(0===C)return this.set(0,0,0,0,0,0,0,0,0);var d=1/C;return e[0]=u*d,e[1]=(i*g-l*n)*d,e[2]=(o*n-i*a)*d,e[3]=c*d,e[4]=(l*t-i*s)*d,e[5]=(i*r-o*t)*d,e[6]=I*d,e[7]=(n*s-g*t)*d,e[8]=(a*t-n*r)*d,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,i,r,a,o){var s=Math.cos(r),g=Math.sin(r);return this.set(n*s,n*g,-n*(s*a+g*o)+a+e,-i*g,i*s,-i*(-g*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],o=i[6],s=i[1],g=i[4],l=i[7];return i[0]=t*r+n*s,i[3]=t*a+n*g,i[6]=t*o+n*l,i[1]=-n*r+t*s,i[4]=-n*a+t*g,i[7]=-n*o+t*l,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();function lZ(e){for(var t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}var uZ={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function cZ(e,t){return new uZ[e](t)}function IZ(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function CZ(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function dZ(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var hZ=(Eo(vb={},mB,Eo({},fB,CZ)),Eo(vb,fB,Eo({},mB,dZ)),vb),AZ={legacyMode:!0,get workingColorSpace(){return fB},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(hZ[t]&&void 0!==hZ[t][n]){var i=hZ[t][n];return e.r=i(e.r),e.g=i(e.g),e.b=i(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},pZ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},mZ={r:0,g:0,b:0},fZ={h:0,s:0,l:0},vZ={h:0,s:0,l:0};function bZ(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function yZ(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var GZ,BZ=function(e){function t(e,n,i){return di(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===n&&void 0===i?this.set(e):this.setRGB(e,n,i)}return Ai(t,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mB;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,AZ.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fB;return this.r=e,this.g=t,this.b=n,AZ.toWorkingColorSpace(this,i),this}},{key:"setHSL",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fB;if(e=tZ(e,1),t=eZ(t,0,1),n=eZ(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,a=2*n-r;this.r=bZ(a,r,e+1/3),this.g=bZ(a,r,e),this.b=bZ(a,r,e-1/3)}return AZ.toWorkingColorSpace(this,i),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mB;function i(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var r,a=t[1],o=t[2];switch(a){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,AZ.toWorkingColorSpace(this,n),i(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,AZ.toWorkingColorSpace(this,n),i(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var s=parseFloat(r[1])/360,g=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return i(r[4]),this.setHSL(s,g,l,n)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var u=t[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,AZ.toWorkingColorSpace(this,n),this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,AZ.toWorkingColorSpace(this,n),this}return e&&e.length>0?this.setColorName(e,n):this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mB,n=pZ[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=CZ(e.r),this.g=CZ(e.g),this.b=CZ(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=dZ(e.r),this.g=dZ(e.g),this.b=dZ(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mB;return AZ.fromWorkingColorSpace(yZ(this,mZ),e),eZ(255*mZ.r,0,255)<<16^eZ(255*mZ.g,0,255)<<8^eZ(255*mZ.b,0,255)<<0}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mB;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fB;AZ.fromWorkingColorSpace(yZ(this,mZ),t);var n,i,r=mZ.r,a=mZ.g,o=mZ.b,s=Math.max(r,a,o),g=Math.min(r,a,o),l=(g+s)/2;if(g===s)n=0,i=0;else{var u=s-g;switch(i=l<=.5?u/(s+g):u/(2-s-g),s){case r:n=(a-o)/u+(a<o?6:0);break;case a:n=(o-r)/u+2;break;case o:n=(r-a)/u+4}n/=6}return e.h=n,e.s=i,e.l=l,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fB;return AZ.fromWorkingColorSpace(yZ(this,mZ),t),e.r=mZ.r,e.g=mZ.g,e.b=mZ.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mB;return AZ.fromWorkingColorSpace(yZ(this,mZ),e),e!==mB?"color(".concat(e," ").concat(mZ.r," ").concat(mZ.g," ").concat(mZ.b,")"):"rgb(".concat(255*mZ.r|0,",").concat(255*mZ.g|0,",").concat(255*mZ.b|0,")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(fZ),fZ.h+=e,fZ.s+=t,fZ.l+=n,this.setHSL(fZ.h,fZ.s,fZ.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(fZ),e.getHSL(vZ);var n=nZ(fZ.h,vZ.h,t),i=nZ(fZ.s,vZ.s,t),r=nZ(fZ.l,vZ.l,t);return this.setHSL(n,i,r),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:Hb().mark((function e(){return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),t}();BZ.NAMES=pZ;var ZZ=function(){function e(){di(this,e)}return Ai(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===GZ&&(GZ=IZ("canvas")),GZ.width=e.width,GZ.height=e.height;var n=GZ.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=GZ}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var t=IZ("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var i=n.getImageData(0,0,e.width,e.height),r=i.data,a=0;a<r.length;a++)r[a]=255*CZ(r[a]/255);return n.putImageData(i,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*CZ(o[s]/255)):o[s]=CZ(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),wZ=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;di(this,e),this.isSource=!0,this.uuid=$B(),this.data=t,this.version=0}return Ai(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},i=this.data;if(null!==i){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)i[a].isDataTexture?r.push(SZ(i[a].image)):r.push(SZ(i[a]))}else r=SZ(i);n.url=r}return t||(e.images[this.uuid]=n),n}}]),e}();function SZ(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?ZZ.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var WZ=0,xZ=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ey,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ey,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:jy,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:eG,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:hG,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:nG,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:cB;return di(this,n),(e=t.call(this)).isTexture=!0,Object.defineProperty(Ni(e),"id",{value:WZ++}),e.uuid=$B(),e.name="",e.source=new wZ(i),e.mipmaps=[],e.mapping=r,e.wrapS=a,e.wrapT=o,e.magFilter=s,e.minFilter=g,e.anisotropy=c,e.format=l,e.internalFormat=null,e.type=u,e.offset=new sZ(0,0),e.repeat=new sZ(1,1),e.center=new sZ(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new gZ,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=I,e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return Ai(n,[{key:"image",get:function(){return this.source.data},set:function(e){this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(this.mapping!==My)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ty:e.x=e.x-Math.floor(e.x);break;case Ey:e.x=e.x<0?0:1;break;case Jy:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ty:e.y=e.y-Math.floor(e.y);break;case Ey:e.y=e.y<0?0:1;break;case Jy:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}]),n}(PB);xZ.DEFAULT_IMAGE=null,xZ.DEFAULT_MAPPING=My;var RZ=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;di(this,t),t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=i,this.w=r}return Ai(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,g=s[0],l=s[4],u=s[8],c=s[1],I=s[5],C=s[9],d=s[2],h=s[6],A=s[10];if(Math.abs(l-c)<a&&Math.abs(u-d)<a&&Math.abs(C-h)<a){if(Math.abs(l+c)<o&&Math.abs(u+d)<o&&Math.abs(C+h)<o&&Math.abs(g+I+A-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var p=(g+1)/2,m=(I+1)/2,f=(A+1)/2,v=(l+c)/4,b=(u+d)/4,y=(C+h)/4;return p>m&&p>f?p<a?(n=0,i=.707106781,r=.707106781):(i=v/(n=Math.sqrt(p)),r=b/n):m>f?m<a?(n=.707106781,i=0,r=.707106781):(n=v/(i=Math.sqrt(m)),r=y/i):f<a?(n=.707106781,i=.707106781,r=0):(n=b/(r=Math.sqrt(f)),i=y/r),this.set(n,i,r,t),this}var G=Math.sqrt((h-C)*(h-C)+(u-d)*(u-d)+(c-l)*(c-l));return Math.abs(G)<.001&&(G=1),this.x=(h-C)/G,this.y=(u-d)/G,this.z=(c-l)/G,this.w=Math.acos((g+I+A-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:Hb().mark((function e(){return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(),VZ=function(e){Li(n,e);var t=Di(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};di(this,n),(r=t.call(this)).isWebGLRenderTarget=!0,r.width=e,r.height=i,r.depth=1,r.scissor=new RZ(0,0,e,i),r.scissorTest=!1,r.viewport=new RZ(0,0,e,i);var o={width:e,height:i,depth:1};return r.texture=new xZ(o,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),r.texture.isRenderTargetTexture=!0,r.texture.flipY=!1,r.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,r.texture.internalFormat=void 0!==a.internalFormat?a.internalFormat:null,r.texture.minFilter=void 0!==a.minFilter?a.minFilter:jy,r.depthBuffer=void 0===a.depthBuffer||a.depthBuffer,r.stencilBuffer=void 0!==a.stencilBuffer&&a.stencilBuffer,r.depthTexture=void 0!==a.depthTexture?a.depthTexture:null,r.samples=void 0!==a.samples?a.samples:0,r}return Ai(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new wZ(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(PB),kZ=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return di(this,n),(e=t.call(this,null)).isDataArrayTexture=!0,e.image={data:i,width:r,height:a,depth:o},e.magFilter=Dy,e.minFilter=Dy,e.wrapR=Ey,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Ai(n)}(xZ),XZ=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;return di(this,n),(a=t.call(this,e,i)).isWebGLArrayRenderTarget=!0,a.depth=r,a.texture=new kZ(null,e,i,r),a.texture.isRenderTargetTexture=!0,a}return Ai(n)}(VZ),YZ=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return di(this,n),(e=t.call(this,null)).isData3DTexture=!0,e.image={data:i,width:r,height:a,depth:o},e.magFilter=Dy,e.minFilter=Dy,e.wrapR=Ey,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Ai(n)}(xZ),HZ=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;return di(this,n),(a=t.call(this,e,i)).isWebGL3DRenderTarget=!0,a.depth=r,a.texture=new YZ(null,e,i,r),a.texture.isRenderTargetTexture=!0,a}return Ai(n)}(VZ),FZ=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};di(this,n),(a=t.call(this,e,i,o)).isWebGLMultipleRenderTargets=!0;var s=a.texture;a.texture=[];for(var g=0;g<r;g++)a.texture[g]=s.clone(),a.texture[g].isRenderTargetTexture=!0;return a}return Ai(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}]),n}(VZ),MZ=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;di(this,t),this.isQuaternion=!0,this._x=e,this._y=n,this._z=i,this._w=r}return Ai(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,g=o(n/2),l=o(i/2),u=o(r/2),c=s(n/2),I=s(i/2),C=s(r/2);switch(a){case"XYZ":this._x=c*l*u+g*I*C,this._y=g*I*u-c*l*C,this._z=g*l*C+c*I*u,this._w=g*l*u-c*I*C;break;case"YXZ":this._x=c*l*u+g*I*C,this._y=g*I*u-c*l*C,this._z=g*l*C-c*I*u,this._w=g*l*u+c*I*C;break;case"ZXY":this._x=c*l*u-g*I*C,this._y=g*I*u+c*l*C,this._z=g*l*C+c*I*u,this._w=g*l*u-c*I*C;break;case"ZYX":this._x=c*l*u-g*I*C,this._y=g*I*u+c*l*C,this._z=g*l*C-c*I*u,this._w=g*l*u+c*I*C;break;case"YZX":this._x=c*l*u+g*I*C,this._y=g*I*u+c*l*C,this._z=g*l*C-c*I*u,this._w=g*l*u-c*I*C;break;case"XZY":this._x=c*l*u-g*I*C,this._y=g*I*u-c*l*C,this._z=g*l*C+c*I*u,this._w=g*l*u+c*I*C;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],g=t[2],l=t[6],u=t[10],c=n+o+u;if(c>0){var I=.5/Math.sqrt(c+1);this._w=.25/I,this._x=(l-s)*I,this._y=(r-g)*I,this._z=(a-i)*I}else if(n>o&&n>u){var C=2*Math.sqrt(1+n-o-u);this._w=(l-s)/C,this._x=.25*C,this._y=(i+a)/C,this._z=(r+g)/C}else if(o>u){var d=2*Math.sqrt(1+o-n-u);this._w=(r-g)/d,this._x=(i+a)/d,this._y=.25*d,this._z=(s+l)/d}else{var h=2*Math.sqrt(1+u-n-o);this._w=(a-i)/h,this._x=(r+g)/h,this._y=(s+l)/h,this._z=.25*h}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(eZ(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,g=t._z,l=t._w;return this._x=n*l+a*o+i*g-r*s,this._y=i*l+a*s+r*o-n*g,this._z=r*l+a*g+n*s-i*o,this._w=a*l-n*o-i*s-r*g,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var g=1-t;return this._w=g*a+t*this._w,this._x=g*n+t*this._x,this._y=g*i+t*this._y,this._z=g*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),u=Math.atan2(l,o),c=Math.sin((1-t)*u)/l,I=Math.sin(t*u)/l;return this._w=a*c+this._w*I,this._x=n*c+this._x*I,this._y=i*c+this._y*I,this._z=r*c+this._z*I,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:Hb().mark((function e(){return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerp",value:function(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}},{key:"slerpFlat",value:function(e,t,n,i,r,a,o){var s=n[i+0],g=n[i+1],l=n[i+2],u=n[i+3],c=r[a+0],I=r[a+1],C=r[a+2],d=r[a+3];if(0===o)return e[t+0]=s,e[t+1]=g,e[t+2]=l,void(e[t+3]=u);if(1===o)return e[t+0]=c,e[t+1]=I,e[t+2]=C,void(e[t+3]=d);if(u!==d||s!==c||g!==I||l!==C){var h=1-o,A=s*c+g*I+l*C+u*d,p=A>=0?1:-1,m=1-A*A;if(m>Number.EPSILON){var f=Math.sqrt(m),v=Math.atan2(f,A*p);h=Math.sin(h*v)/f,o=Math.sin(o*v)/f}var b=o*p;if(s=s*h+c*b,g=g*h+I*b,l=l*h+C*b,u=u*h+d*b,h===1-o){var y=1/Math.sqrt(s*s+g*g+l*l+u*u);s*=y,g*=y,l*=y,u*=y}}e[t]=s,e[t+1]=g,e[t+2]=l,e[t+3]=u}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,i,r,a){var o=n[i],s=n[i+1],g=n[i+2],l=n[i+3],u=r[a],c=r[a+1],I=r[a+2],C=r[a+3];return e[t]=o*C+l*u+s*I-g*c,e[t+1]=s*C+l*c+g*u-o*I,e[t+2]=g*C+l*I+o*c-s*u,e[t+3]=l*C-o*u-s*c-g*I,e}}]),t}(),KZ=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;di(this,t),t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=i}return Ai(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(zZ.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(zZ.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,g=s*t+a*i-o*n,l=s*n+o*t-r*i,u=s*i+r*n-a*t,c=-r*t-a*n-o*i;return this.x=g*s+c*-r+l*-o-u*-a,this.y=l*s+c*-a+u*-r-g*-o,this.z=u*s+c*-o+g*-a-l*-r,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return NZ.copy(this).projectOnVector(e),this.sub(NZ)}},{key:"reflect",value:function(e){return this.sub(NZ.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(eZ(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:Symbol.iterator,value:Hb().mark((function e(){return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(),NZ=new KZ,zZ=new MZ,LZ=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ(-1/0,-1/0,-1/0);di(this,e),this.isBox3=!0,this.min=t,this.max=n}return Ai(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,g=e.length;s<g;s+=3){var l=e[s],u=e[s+1],c=e[s+2];l<t&&(t=l),u<n&&(n=u),c<i&&(i=c),l>r&&(r=l),u>a&&(a=u),c>o&&(o=c)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,g=e.count;s<g;s++){var l=e.getX(s),u=e.getY(s),c=e.getZ(s);l<t&&(t=l),u<n&&(n=u),c<i&&(i=c),l>r&&(r=l),u>a&&(a=u),c>o&&(o=c)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=TZ.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n)if(t&&void 0!=n.attributes&&void 0!==n.attributes.position)for(var i=n.attributes.position,r=0,a=i.count;r<a;r++)TZ.fromBufferAttribute(i,r).applyMatrix4(e.matrixWorld),this.expandByPoint(TZ);else null===n.boundingBox&&n.computeBoundingBox(),EZ.copy(n.boundingBox),EZ.applyMatrix4(e.matrixWorld),this.union(EZ);for(var o=e.children,s=0,g=o.length;s<g;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,TZ),TZ.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(jZ),qZ.subVectors(this.max,jZ),JZ.subVectors(e.a,jZ),DZ.subVectors(e.b,jZ),UZ.subVectors(e.c,jZ),PZ.subVectors(DZ,JZ),QZ.subVectors(UZ,DZ),OZ.subVectors(JZ,UZ);var t=[0,-PZ.z,PZ.y,0,-QZ.z,QZ.y,0,-OZ.z,OZ.y,PZ.z,0,-PZ.x,QZ.z,0,-QZ.x,OZ.z,0,-OZ.x,-PZ.y,PZ.x,0,-QZ.y,QZ.x,0,-OZ.y,OZ.x,0];return!!tw(t,JZ,DZ,UZ,qZ)&&(!!tw(t=[1,0,0,0,1,0,0,0,1],JZ,DZ,UZ,qZ)&&($Z.crossVectors(PZ,QZ),tw(t=[$Z.x,$Z.y,$Z.z],JZ,DZ,UZ,qZ)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return TZ.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(TZ).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(_Z[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_Z[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_Z[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_Z[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_Z[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_Z[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_Z[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_Z[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_Z)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),_Z=[new KZ,new KZ,new KZ,new KZ,new KZ,new KZ,new KZ,new KZ],TZ=new KZ,EZ=new LZ,JZ=new KZ,DZ=new KZ,UZ=new KZ,PZ=new KZ,QZ=new KZ,OZ=new KZ,jZ=new KZ,qZ=new KZ,$Z=new KZ,ew=new KZ;function tw(e,t,n,i,r){for(var a=0,o=e.length-3;a<=o;a+=3){ew.fromArray(e,a);var s=r.x*Math.abs(ew.x)+r.y*Math.abs(ew.y)+r.z*Math.abs(ew.z),g=t.dot(ew),l=n.dot(ew),u=i.dot(ew);if(Math.max(-Math.max(g,l,u),Math.min(g,l,u))>s)return!1}return!0}var nw=new LZ,iw=new KZ,rw=new KZ,aw=new KZ,ow=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;di(this,e),this.center=t,this.radius=n}return Ai(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):nw.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){aw.subVectors(e,this.center);var t=aw.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),i=.5*(n-this.radius);this.center.add(aw.multiplyScalar(i/n)),this.radius+=i}return this}},{key:"union",value:function(e){return!0===this.center.equals(e.center)?rw.set(0,0,1).multiplyScalar(e.radius):rw.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(iw.copy(e.center).add(rw)),this.expandByPoint(iw.copy(e.center).sub(rw)),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),sw=new KZ,gw=new KZ,lw=new KZ,uw=new KZ,cw=new KZ,Iw=new KZ,Cw=new KZ,dw=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ(0,0,-1);di(this,e),this.origin=t,this.direction=n}return Ai(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,sw)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=sw.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(sw.copy(this.direction).multiplyScalar(t).add(this.origin),sw.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,i){gw.copy(e).add(t).multiplyScalar(.5),lw.copy(t).sub(e).normalize(),uw.copy(this.origin).sub(gw);var r,a,o,s,g=.5*e.distanceTo(t),l=-this.direction.dot(lw),u=uw.dot(this.direction),c=-uw.dot(lw),I=uw.lengthSq(),C=Math.abs(1-l*l);if(C>0)if(a=l*u-c,s=g*C,(r=l*c-u)>=0)if(a>=-s)if(a<=s){var d=1/C;o=(r*=d)*(r+l*(a*=d)+2*u)+a*(l*r+a+2*c)+I}else a=g,o=-(r=Math.max(0,-(l*a+u)))*r+a*(a+2*c)+I;else a=-g,o=-(r=Math.max(0,-(l*a+u)))*r+a*(a+2*c)+I;else a<=-s?o=-(r=Math.max(0,-(-l*g+u)))*r+(a=r>0?-g:Math.min(Math.max(-g,-c),g))*(a+2*c)+I:a<=s?(r=0,o=(a=Math.min(Math.max(-g,-c),g))*(a+2*c)+I):o=-(r=Math.max(0,-(l*g+u)))*r+(a=r>0?g:Math.min(Math.max(-g,-c),g))*(a+2*c)+I;else a=l>0?-g:g,o=-(r=Math.max(0,-(l*a+u)))*r+a*(a+2*c)+I;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(lw).multiplyScalar(a).add(gw),o}},{key:"intersectSphere",value:function(e,t){sw.subVectors(e.center,this.origin);var n=sw.dot(this.direction),i=sw.dot(sw)-n*n,r=e.radius*e.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,i,r,a,o,s,g=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,c=this.origin;return g>=0?(n=(e.min.x-c.x)*g,i=(e.max.x-c.x)*g):(n=(e.max.x-c.x)*g,i=(e.min.x-c.x)*g),l>=0?(r=(e.min.y-c.y)*l,a=(e.max.y-c.y)*l):(r=(e.max.y-c.y)*l,a=(e.min.y-c.y)*l),n>a||r>i?null:((r>n||n!==n)&&(n=r),(a<i||i!==i)&&(i=a),u>=0?(o=(e.min.z-c.z)*u,s=(e.max.z-c.z)*u):(o=(e.max.z-c.z)*u,s=(e.min.z-c.z)*u),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,sw)}},{key:"intersectTriangle",value:function(e,t,n,i,r){cw.subVectors(t,e),Iw.subVectors(n,e),Cw.crossVectors(cw,Iw);var a,o=this.direction.dot(Cw);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}uw.subVectors(this.origin,e);var s=a*this.direction.dot(Iw.crossVectors(uw,Iw));if(s<0)return null;var g=a*this.direction.dot(cw.cross(uw));if(g<0)return null;if(s+g>o)return null;var l=-a*uw.dot(Cw);return l<0?null:this.at(l/o,r)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),hw=function(){function e(){di(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return Ai(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,g,l,u,c,I,C,d,h){var A=this.elements;return A[0]=e,A[4]=t,A[8]=n,A[12]=i,A[1]=r,A[5]=a,A[9]=o,A[13]=s,A[2]=g,A[6]=l,A[10]=u,A[14]=c,A[3]=I,A[7]=C,A[11]=d,A[15]=h,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,i=1/Aw.setFromMatrixColumn(e,0).length(),r=1/Aw.setFromMatrixColumn(e,1).length(),a=1/Aw.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),g=Math.sin(i),l=Math.cos(r),u=Math.sin(r);if("XYZ"===e.order){var c=a*l,I=a*u,C=o*l,d=o*u;t[0]=s*l,t[4]=-s*u,t[8]=g,t[1]=I+C*g,t[5]=c-d*g,t[9]=-o*s,t[2]=d-c*g,t[6]=C+I*g,t[10]=a*s}else if("YXZ"===e.order){var h=s*l,A=s*u,p=g*l,m=g*u;t[0]=h+m*o,t[4]=p*o-A,t[8]=a*g,t[1]=a*u,t[5]=a*l,t[9]=-o,t[2]=A*o-p,t[6]=m+h*o,t[10]=a*s}else if("ZXY"===e.order){var f=s*l,v=s*u,b=g*l,y=g*u;t[0]=f-y*o,t[4]=-a*u,t[8]=b+v*o,t[1]=v+b*o,t[5]=a*l,t[9]=y-f*o,t[2]=-a*g,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var G=a*l,B=a*u,Z=o*l,w=o*u;t[0]=s*l,t[4]=Z*g-B,t[8]=G*g+w,t[1]=s*u,t[5]=w*g+G,t[9]=B*g-Z,t[2]=-g,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var S=a*s,W=a*g,x=o*s,R=o*g;t[0]=s*l,t[4]=R-S*u,t[8]=x*u+W,t[1]=u,t[5]=a*l,t[9]=-o*l,t[2]=-g*l,t[6]=W*u+x,t[10]=S-R*u}else if("XZY"===e.order){var V=a*s,k=a*g,X=o*s,Y=o*g;t[0]=s*l,t[4]=-u,t[8]=g*l,t[1]=V*u+Y,t[5]=a*l,t[9]=k*u-X,t[2]=X*u-k,t[6]=o*l,t[10]=Y*u+V}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(mw,e,fw)}},{key:"lookAt",value:function(e,t,n){var i=this.elements;return yw.subVectors(e,t),0===yw.lengthSq()&&(yw.z=1),yw.normalize(),vw.crossVectors(n,yw),0===vw.lengthSq()&&(1===Math.abs(n.z)?yw.x+=1e-4:yw.z+=1e-4,yw.normalize(),vw.crossVectors(n,yw)),vw.normalize(),bw.crossVectors(yw,vw),i[0]=vw.x,i[4]=bw.x,i[8]=yw.x,i[1]=vw.y,i[5]=bw.y,i[9]=yw.y,i[2]=vw.z,i[6]=bw.z,i[10]=yw.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],g=n[12],l=n[1],u=n[5],c=n[9],I=n[13],C=n[2],d=n[6],h=n[10],A=n[14],p=n[3],m=n[7],f=n[11],v=n[15],b=i[0],y=i[4],G=i[8],B=i[12],Z=i[1],w=i[5],S=i[9],W=i[13],x=i[2],R=i[6],V=i[10],k=i[14],X=i[3],Y=i[7],H=i[11],F=i[15];return r[0]=a*b+o*Z+s*x+g*X,r[4]=a*y+o*w+s*R+g*Y,r[8]=a*G+o*S+s*V+g*H,r[12]=a*B+o*W+s*k+g*F,r[1]=l*b+u*Z+c*x+I*X,r[5]=l*y+u*w+c*R+I*Y,r[9]=l*G+u*S+c*V+I*H,r[13]=l*B+u*W+c*k+I*F,r[2]=C*b+d*Z+h*x+A*X,r[6]=C*y+d*w+h*R+A*Y,r[10]=C*G+d*S+h*V+A*H,r[14]=C*B+d*W+h*k+A*F,r[3]=p*b+m*Z+f*x+v*X,r[7]=p*y+m*w+f*R+v*Y,r[11]=p*G+m*S+f*V+v*H,r[15]=p*B+m*W+f*k+v*F,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],g=e[13],l=e[2],u=e[6],c=e[10],I=e[14];return e[3]*(+r*s*u-i*g*u-r*o*c+n*g*c+i*o*I-n*s*I)+e[7]*(+t*s*I-t*g*c+r*a*c-i*a*I+i*g*l-r*s*l)+e[11]*(+t*g*u-t*o*I-r*a*u+n*a*I+r*o*l-n*g*l)+e[15]*(-i*o*l-t*s*u+t*o*c+i*a*u-n*a*c+n*s*l)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],g=e[7],l=e[8],u=e[9],c=e[10],I=e[11],C=e[12],d=e[13],h=e[14],A=e[15],p=u*h*g-d*c*g+d*s*I-o*h*I-u*s*A+o*c*A,m=C*c*g-l*h*g-C*s*I+a*h*I+l*s*A-a*c*A,f=l*d*g-C*u*g+C*o*I-a*d*I-l*o*A+a*u*A,v=C*u*s-l*d*s-C*o*c+a*d*c+l*o*h-a*u*h,b=t*p+n*m+i*f+r*v;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var y=1/b;return e[0]=p*y,e[1]=(d*c*r-u*h*r-d*i*I+n*h*I+u*i*A-n*c*A)*y,e[2]=(o*h*r-d*s*r+d*i*g-n*h*g-o*i*A+n*s*A)*y,e[3]=(u*s*r-o*c*r-u*i*g+n*c*g+o*i*I-n*s*I)*y,e[4]=m*y,e[5]=(l*h*r-C*c*r+C*i*I-t*h*I-l*i*A+t*c*A)*y,e[6]=(C*s*r-a*h*r-C*i*g+t*h*g+a*i*A-t*s*A)*y,e[7]=(a*c*r-l*s*r+l*i*g-t*c*g-a*i*I+t*s*I)*y,e[8]=f*y,e[9]=(C*u*r-l*d*r-C*n*I+t*d*I+l*n*A-t*u*A)*y,e[10]=(a*d*r-C*o*r+C*n*g-t*d*g-a*n*A+t*o*A)*y,e[11]=(l*o*r-a*u*r-l*n*g+t*u*g+a*n*I-t*o*I)*y,e[12]=v*y,e[13]=(l*d*i-C*u*i+C*n*c-t*d*c-l*n*h+t*u*h)*y,e[14]=(C*o*i-a*d*i-C*n*s+t*d*s+a*n*h-t*o*h)*y,e[15]=(a*u*i-l*o*i+l*n*s-t*u*s-a*n*c+t*o*c)*y,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,g=r*a,l=r*o;return this.set(g*a+n,g*o-i*s,g*s+i*o,0,g*o+i*s,l*o+n,l*s-i*a,0,g*s-i*o,l*s+i*a,r*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,g=r+r,l=a+a,u=o+o,c=r*g,I=r*l,C=r*u,d=a*l,h=a*u,A=o*u,p=s*g,m=s*l,f=s*u,v=n.x,b=n.y,y=n.z;return i[0]=(1-(d+A))*v,i[1]=(I+f)*v,i[2]=(C-m)*v,i[3]=0,i[4]=(I-f)*b,i[5]=(1-(c+A))*b,i[6]=(h+p)*b,i[7]=0,i[8]=(C+m)*y,i[9]=(h-p)*y,i[10]=(1-(c+d))*y,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,n){var i=this.elements,r=Aw.set(i[0],i[1],i[2]).length(),a=Aw.set(i[4],i[5],i[6]).length(),o=Aw.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],pw.copy(this);var s=1/r,g=1/a,l=1/o;return pw.elements[0]*=s,pw.elements[1]*=s,pw.elements[2]*=s,pw.elements[4]*=g,pw.elements[5]*=g,pw.elements[6]*=g,pw.elements[8]*=l,pw.elements[9]*=l,pw.elements[10]*=l,t.setFromRotationMatrix(pw),n.x=r,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(t-e),g=2*r/(n-i),l=(t+e)/(t-e),u=(n+i)/(n-i),c=-(a+r)/(a-r),I=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=g,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=I,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),g=1/(n-i),l=1/(a-r),u=(t+e)*s,c=(n+i)*g,I=(a+r)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*g,o[9]=0,o[13]=-c,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-I,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),Aw=new KZ,pw=new hw,mw=new KZ(0,0,0),fw=new KZ(1,1,1),vw=new KZ,bw=new KZ,yw=new KZ,Gw=new hw,Bw=new MZ,Zw=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;di(this,t),this.isEuler=!0,this._x=e,this._y=n,this._z=i,this._order=r}return Ai(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],g=i[5],l=i[9],u=i[2],c=i[6],I=i[10];switch(t){case"XYZ":this._y=Math.asin(eZ(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,I),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(c,g),this._z=0);break;case"YXZ":this._x=Math.asin(-eZ(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,I),this._z=Math.atan2(s,g)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(eZ(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-u,I),this._z=Math.atan2(-a,g)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-eZ(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(c,I),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,g));break;case"YZX":this._z=Math.asin(eZ(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,g),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,I));break;case"XZY":this._z=Math.asin(-eZ(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(c,g),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-l,I),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Gw.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Gw,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return Bw.setFromEuler(this),this.setFromQuaternion(Bw,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:Hb().mark((function e(){return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))},{key:"toVector3",value:function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}]),t}();Zw.DefaultOrder="XYZ",Zw.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var ww=function(){function e(){di(this,e),this.mask=1}return Ai(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!==(this.mask&(1<<e|0))}}]),e}(),Sw=0,Ww=new KZ,xw=new MZ,Rw=new hw,Vw=new KZ,kw=new KZ,Xw=new KZ,Yw=new MZ,Hw=new KZ(1,0,0),Fw=new KZ(0,1,0),Mw=new KZ(0,0,1),Kw={type:"added"},Nw={type:"removed"},zw=function(e){Li(n,e);var t=Di(n);function n(){var e;di(this,n),(e=t.call(this)).isObject3D=!0,Object.defineProperty(Ni(e),"id",{value:Sw++}),e.uuid=$B(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DefaultUp.clone();var i=new KZ,r=new Zw,a=new MZ,o=new KZ(1,1,1);return r._onChange((function(){a.setFromEuler(r,!1)})),a._onChange((function(){r.setFromQuaternion(a,void 0,!1)})),Object.defineProperties(Ni(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new hw},normalMatrix:{value:new gZ}}),e.matrix=new hw,e.matrixWorld=new hw,e.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.layers=new ww,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return Ai(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return xw.setFromAxisAngle(e,t),this.quaternion.multiply(xw),this}},{key:"rotateOnWorldAxis",value:function(e,t){return xw.setFromAxisAngle(e,t),this.quaternion.premultiply(xw),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(Hw,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(Fw,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(Mw,e)}},{key:"translateOnAxis",value:function(e,t){return Ww.copy(e).applyQuaternion(this.quaternion),this.position.add(Ww.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(Hw,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(Fw,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(Mw,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(Rw.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?Vw.copy(e):Vw.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),kw.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Rw.lookAt(kw,Vw,this.up):Rw.lookAt(Vw,kw,this.up),this.quaternion.setFromRotationMatrix(Rw),i&&(Rw.extractRotation(i.matrixWorld),xw.setFromRotationMatrix(Rw),this.quaternion.premultiply(xw.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Kw)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Nw)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Nw)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Rw.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Rw.multiply(e.parent.matrixWorld)),e.applyMatrix4(Rw),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(kw,e,Xw),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(kw,Yw,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,g=o.length;s<g;s++){var l=o[s];r(e.shapes,l)}else r(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var u=[],c=0,I=this.material.length;c<I;c++)u.push(r(e.materials,this.material[c]));i.material=u}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(var C=0;C<this.children.length;C++)i.children.push(this.children[C].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(var d=0;d<this.animations.length;d++){var h=this.animations[d];i.animations.push(r(e.animations,h))}}if(t){var A=B(e.geometries),p=B(e.materials),m=B(e.textures),f=B(e.images),v=B(e.shapes),b=B(e.skeletons),y=B(e.animations),G=B(e.nodes);A.length>0&&(n.geometries=A),p.length>0&&(n.materials=p),m.length>0&&(n.textures=m),f.length>0&&(n.images=f),v.length>0&&(n.shapes=v),b.length>0&&(n.skeletons=b),y.length>0&&(n.animations=y),G.length>0&&(n.nodes=G)}return n.object=i,n;function B(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}]),n}(PB);zw.DefaultUp=new KZ(0,1,0),zw.DefaultMatrixAutoUpdate=!0;var Lw=new KZ,_w=new KZ,Tw=new KZ,Ew=new KZ,Jw=new KZ,Dw=new KZ,Uw=new KZ,Pw=new KZ,Qw=new KZ,Ow=new KZ,jw=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new KZ;di(this,e),this.a=t,this.b=n,this.c=i}return Ai(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return Lw.subVectors(this.c,this.b),_w.subVectors(this.a,this.b),.5*Lw.cross(_w).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,i,r,a){return e.getUV(t,this.a,this.b,this.c,n,i,r,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,i,r=this.a,a=this.b,o=this.c;Jw.subVectors(a,r),Dw.subVectors(o,r),Pw.subVectors(e,r);var s=Jw.dot(Pw),g=Dw.dot(Pw);if(s<=0&&g<=0)return t.copy(r);Qw.subVectors(e,a);var l=Jw.dot(Qw),u=Dw.dot(Qw);if(l>=0&&u<=l)return t.copy(a);var c=s*u-l*g;if(c<=0&&s>=0&&l<=0)return n=s/(s-l),t.copy(r).addScaledVector(Jw,n);Ow.subVectors(e,o);var I=Jw.dot(Ow),C=Dw.dot(Ow);if(C>=0&&I<=C)return t.copy(o);var d=I*g-s*C;if(d<=0&&g>=0&&C<=0)return i=g/(g-C),t.copy(r).addScaledVector(Dw,i);var h=l*C-I*u;if(h<=0&&u-l>=0&&I-C>=0)return Uw.subVectors(o,a),i=(u-l)/(u-l+(I-C)),t.copy(a).addScaledVector(Uw,i);var A=1/(h+d+c);return n=d*A,i=c*A,t.copy(r).addScaledVector(Jw,n).addScaledVector(Dw,i)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,i){i.subVectors(n,t),Lw.subVectors(e,t),i.cross(Lw);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,i,r){Lw.subVectors(i,t),_w.subVectors(n,t),Tw.subVectors(e,t);var a=Lw.dot(Lw),o=Lw.dot(_w),s=Lw.dot(Tw),g=_w.dot(_w),l=_w.dot(Tw),u=a*g-o*o;if(0===u)return r.set(-2,-1,-1);var c=1/u,I=(g*s-o*l)*c,C=(a*l-o*s)*c;return r.set(1-I-C,C,I)}},{key:"containsPoint",value:function(e,t,n,i){return this.getBarycoord(e,t,n,i,Ew),Ew.x>=0&&Ew.y>=0&&Ew.x+Ew.y<=1}},{key:"getUV",value:function(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,Ew),s.set(0,0),s.addScaledVector(r,Ew.x),s.addScaledVector(a,Ew.y),s.addScaledVector(o,Ew.z),s}},{key:"isFrontFacing",value:function(e,t,n,i){return Lw.subVectors(n,t),_w.subVectors(e,t),Lw.cross(_w).dot(i)<0}}]),e}(),qw=0,$w=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).isMaterial=!0,Object.defineProperty(Ni(e),"id",{value:qw++}),e.uuid=$B(),e.name="",e.type="Material",e.blending=$b,e.side=Ub,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=Cy,e.blendDst=dy,e.blendEquation=ry,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=Gy,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=HB,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=bB,e.stencilZFail=bB,e.stencilZPass=bB,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return Ai(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===Ob;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==$b&&(n.blending=this.blending),this.side!==Ub&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(PB),eS=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshBasicMaterial=!0,i.type="MeshBasicMaterial",i.color=new BZ(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=Wy,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}($w),tS=new KZ,nS=new sZ,iS=function(){function e(t,n,i){if(di(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===i,this.usage=FB,this.updateRange={offset:0,count:-1},this.version=0}return Ai(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"copyColorsArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new BZ),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this}},{key:"copyVector2sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new sZ),t[n++]=a.x,t[n++]=a.y}return this}},{key:"copyVector3sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new KZ),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this}},{key:"copyVector4sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new RZ),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)nS.fromBufferAttribute(this,t),nS.applyMatrix3(e),this.setXY(t,nS.x,nS.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)tS.fromBufferAttribute(this,i),tS.applyMatrix3(e),this.setXYZ(i,tS.x,tS.y,tS.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)tS.fromBufferAttribute(this,t),tS.applyMatrix4(e),this.setXYZ(t,tS.x,tS.y,tS.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)tS.fromBufferAttribute(this,t),tS.applyNormalMatrix(e),this.setXYZ(t,tS.x,tS.y,tS.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)tS.fromBufferAttribute(this,t),tS.transformDirection(e),this.setXYZ(t,tS.x,tS.y,tS.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){return this.array[e*this.itemSize]}},{key:"setX",value:function(e,t){return this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function(e,t){return this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function(e,t){return this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function(e,t){return this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==FB&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}]),e}(),rS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Int8Array(e),i,r)}return Ai(n)}(iS),aS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Uint8Array(e),i,r)}return Ai(n)}(iS),oS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Uint8ClampedArray(e),i,r)}return Ai(n)}(iS),sS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Int16Array(e),i,r)}return Ai(n)}(iS),gS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Uint16Array(e),i,r)}return Ai(n)}(iS),lS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Int32Array(e),i,r)}return Ai(n)}(iS),uS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Uint32Array(e),i,r)}return Ai(n)}(iS),cS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;return di(this,n),(a=t.call(this,new Uint16Array(e),i,r)).isFloat16BufferAttribute=!0,a}return Ai(n)}(iS),IS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Float32Array(e),i,r)}return Ai(n)}(iS),CS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){return di(this,n),t.call(this,new Float64Array(e),i,r)}return Ai(n)}(iS),dS=0,hS=new hw,AS=new zw,pS=new KZ,mS=new LZ,fS=new LZ,vS=new KZ,bS=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).isBufferGeometry=!0,Object.defineProperty(Ni(e),"id",{value:dS++}),e.uuid=$B(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return Ai(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(lZ(e)?uS:gS)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new gZ).getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return hS.makeRotationFromQuaternion(e),this.applyMatrix4(hS),this}},{key:"rotateX",value:function(e){return hS.makeRotationX(e),this.applyMatrix4(hS),this}},{key:"rotateY",value:function(e){return hS.makeRotationY(e),this.applyMatrix4(hS),this}},{key:"rotateZ",value:function(e){return hS.makeRotationZ(e),this.applyMatrix4(hS),this}},{key:"translate",value:function(e,t,n){return hS.makeTranslation(e,t,n),this.applyMatrix4(hS),this}},{key:"scale",value:function(e,t,n){return hS.makeScale(e,t,n),this.applyMatrix4(hS),this}},{key:"lookAt",value:function(e){return AS.lookAt(e),AS.updateMatrix(),this.applyMatrix4(AS.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(pS).negate(),this.translate(pS.x,pS.y,pS.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new IS(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new LZ);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new KZ(-1/0,-1/0,-1/0),new KZ(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++){var r=t[n];mS.setFromBufferAttribute(r),this.morphTargetsRelative?(vS.addVectors(this.boundingBox.min,mS.min),this.boundingBox.expandByPoint(vS),vS.addVectors(this.boundingBox.max,mS.max),this.boundingBox.expandByPoint(vS)):(this.boundingBox.expandByPoint(mS.min),this.boundingBox.expandByPoint(mS.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new ow);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new KZ,1/0);if(e){var n=this.boundingSphere.center;if(mS.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++){var a=t[i];fS.setFromBufferAttribute(a),this.morphTargetsRelative?(vS.addVectors(mS.min,fS.min),mS.expandByPoint(vS),vS.addVectors(mS.max,fS.max),mS.expandByPoint(vS)):(mS.expandByPoint(fS.min),mS.expandByPoint(fS.max))}mS.getCenter(n);for(var o=0,s=0,g=e.count;s<g;s++)vS.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(vS));if(t)for(var l=0,u=t.length;l<u;l++)for(var c=t[l],I=this.morphTargetsRelative,C=0,d=c.count;C<d;C++)vS.fromBufferAttribute(c,C),I&&(pS.fromBufferAttribute(e,C),vS.add(pS)),o=Math.max(o,n.distanceToSquared(vS));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new iS(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,g=[],l=[],u=0;u<o;u++)g[u]=new KZ,l[u]=new KZ;var c=new KZ,I=new KZ,C=new KZ,d=new sZ,h=new sZ,A=new sZ,p=new KZ,m=new KZ,f=this.groups;0===f.length&&(f=[{start:0,count:n.length}]);for(var v=0,b=f.length;v<b;++v)for(var y=f[v],G=y.start,B=G,Z=G+y.count;B<Z;B+=3)F(n[B+0],n[B+1],n[B+2]);for(var w=new KZ,S=new KZ,W=new KZ,x=new KZ,R=0,V=f.length;R<V;++R)for(var k=f[R],X=k.start,Y=X,H=X+k.count;Y<H;Y+=3)M(n[Y+0]),M(n[Y+1]),M(n[Y+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function F(e,t,n){c.fromArray(i,3*e),I.fromArray(i,3*t),C.fromArray(i,3*n),d.fromArray(a,2*e),h.fromArray(a,2*t),A.fromArray(a,2*n),I.sub(c),C.sub(c),h.sub(d),A.sub(d);var r=1/(h.x*A.y-A.x*h.y);isFinite(r)&&(p.copy(I).multiplyScalar(A.y).addScaledVector(C,-h.y).multiplyScalar(r),m.copy(C).multiplyScalar(h.x).addScaledVector(I,-A.x).multiplyScalar(r),g[e].add(p),g[t].add(p),g[n].add(p),l[e].add(m),l[t].add(m),l[n].add(m))}function M(e){W.fromArray(r,3*e),x.copy(W);var t=g[e];w.copy(t),w.sub(W.multiplyScalar(W.dot(t))).normalize(),S.crossVectors(x,t);var n=S.dot(l[e])<0?-1:1;s[4*e]=w.x,s[4*e+1]=w.y,s[4*e+2]=w.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new iS(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var a=new KZ,o=new KZ,s=new KZ,g=new KZ,l=new KZ,u=new KZ,c=new KZ,I=new KZ;if(e)for(var C=0,d=e.count;C<d;C+=3){var h=e.getX(C+0),A=e.getX(C+1),p=e.getX(C+2);a.fromBufferAttribute(t,h),o.fromBufferAttribute(t,A),s.fromBufferAttribute(t,p),c.subVectors(s,o),I.subVectors(a,o),c.cross(I),g.fromBufferAttribute(n,h),l.fromBufferAttribute(n,A),u.fromBufferAttribute(n,p),g.add(c),l.add(c),u.add(c),n.setXYZ(h,g.x,g.y,g.z),n.setXYZ(A,l.x,l.y,l.z),n.setXYZ(p,u.x,u.y,u.z)}else for(var m=0,f=t.count;m<f;m+=3)a.fromBufferAttribute(t,m+0),o.fromBufferAttribute(t,m+1),s.fromBufferAttribute(t,m+2),c.subVectors(s,o),I.subVectors(a,o),c.cross(I),n.setXYZ(m+0,c.x,c.y,c.z),n.setXYZ(m+1,c.x,c.y,c.z),n.setXYZ(m+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,a=e.attributes[i],o=a.array,s=a.itemSize*t,g=Math.min(o.length,r.length-s),l=0,u=s;l<g;l++,u++)r[u]=o[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)vS.fromBufferAttribute(e,t),vS.normalize(),e.setXYZ(t,vS.x,vS.y,vS.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i),o=0,s=0,g=0,l=t.length;g<l;g++){o=e.isInterleavedBufferAttribute?t[g]*e.data.stride+e.offset:t[g]*i;for(var u=0;u<i;u++)a[s++]=n[o++]}return new iS(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,i=this.index.array,r=this.attributes;for(var a in r){var o=e(r[a],i);t.setAttribute(a,o)}var s=this.morphAttributes;for(var g in s){for(var l=[],u=s[g],c=0,I=u.length;c<I;c++){var C=e(u[c],i);l.push(C)}t.morphAttributes[g]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var d=this.groups,h=0,A=d.length;h<A;h++){var p=d[h];t.addGroup(p.start,p.count,p.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var a in r){var o=r[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},g=!1;for(var l in this.morphAttributes){for(var u=this.morphAttributes[l],c=[],I=0,C=u.length;I<C;I++){var d=u[I];c.push(d.toJSON(e.data))}c.length>0&&(s[l]=c,g=!0)}g&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var h=this.groups;h.length>0&&(e.data.groups=JSON.parse(JSON.stringify(h)));var A=this.boundingSphere;return null!==A&&(e.data.boundingSphere={center:A.center.toArray(),radius:A.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var i=e.attributes;for(var r in i){var a=i[r];this.setAttribute(r,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var g=[],l=o[s],u=0,c=l.length;u<c;u++)g.push(l[u].clone(t));this.morphAttributes[s]=g}this.morphTargetsRelative=e.morphTargetsRelative;for(var I=e.groups,C=0,d=I.length;C<d;C++){var h=I[C];this.addGroup(h.start,h.count,h.materialIndex)}var A=e.boundingBox;null!==A&&(this.boundingBox=A.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(PB),yS=new hw,GS=new dw,BS=new ow,ZS=new KZ,wS=new KZ,SS=new KZ,WS=new KZ,xS=new KZ,RS=new KZ,VS=new KZ,kS=new KZ,XS=new KZ,YS=new sZ,HS=new sZ,FS=new sZ,MS=new KZ,KS=new KZ,NS=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bS,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new eS;return di(this,n),(e=t.call(this)).isMesh=!0,e.type="Mesh",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),BS.copy(n.boundingSphere),BS.applyMatrix4(r),!1!==e.ray.intersectsSphere(BS)&&(yS.copy(r).invert(),GS.copy(e.ray).applyMatrix4(yS),null===n.boundingBox||!1!==GS.intersectsBox(n.boundingBox)))){var a,o=n.index,s=n.attributes.position,g=n.morphAttributes.position,l=n.morphTargetsRelative,u=n.attributes.uv,c=n.attributes.uv2,I=n.groups,C=n.drawRange;if(null!==o)if(Array.isArray(i))for(var d=0,h=I.length;d<h;d++)for(var A=I[d],p=i[A.materialIndex],m=Math.max(A.start,C.start),f=Math.min(o.count,Math.min(A.start+A.count,C.start+C.count));m<f;m+=3){var v=o.getX(m),b=o.getX(m+1),y=o.getX(m+2);(a=zS(this,p,e,GS,s,g,l,u,c,v,b,y))&&(a.faceIndex=Math.floor(m/3),a.face.materialIndex=A.materialIndex,t.push(a))}else for(var G=Math.max(0,C.start),B=Math.min(o.count,C.start+C.count);G<B;G+=3){var Z=o.getX(G),w=o.getX(G+1),S=o.getX(G+2);(a=zS(this,i,e,GS,s,g,l,u,c,Z,w,S))&&(a.faceIndex=Math.floor(G/3),t.push(a))}else if(void 0!==s)if(Array.isArray(i))for(var W=0,x=I.length;W<x;W++)for(var R=I[W],V=i[R.materialIndex],k=Math.max(R.start,C.start),X=Math.min(s.count,Math.min(R.start+R.count,C.start+C.count));k<X;k+=3){(a=zS(this,V,e,GS,s,g,l,u,c,k,k+1,k+2))&&(a.faceIndex=Math.floor(k/3),a.face.materialIndex=R.materialIndex,t.push(a))}else for(var Y=Math.max(0,C.start),H=Math.min(s.count,C.start+C.count);Y<H;Y+=3){(a=zS(this,i,e,GS,s,g,l,u,c,Y,Y+1,Y+2))&&(a.faceIndex=Math.floor(Y/3),t.push(a))}}}}]),n}(zw);function zS(e,t,n,i,r,a,o,s,g,l,u,c){ZS.fromBufferAttribute(r,l),wS.fromBufferAttribute(r,u),SS.fromBufferAttribute(r,c);var I=e.morphTargetInfluences;if(a&&I){VS.set(0,0,0),kS.set(0,0,0),XS.set(0,0,0);for(var C=0,d=a.length;C<d;C++){var h=I[C],A=a[C];0!==h&&(WS.fromBufferAttribute(A,l),xS.fromBufferAttribute(A,u),RS.fromBufferAttribute(A,c),o?(VS.addScaledVector(WS,h),kS.addScaledVector(xS,h),XS.addScaledVector(RS,h)):(VS.addScaledVector(WS.sub(ZS),h),kS.addScaledVector(xS.sub(wS),h),XS.addScaledVector(RS.sub(SS),h)))}ZS.add(VS),wS.add(kS),SS.add(XS)}e.isSkinnedMesh&&(e.boneTransform(l,ZS),e.boneTransform(u,wS),e.boneTransform(c,SS));var p=function(e,t,n,i,r,a,o,s){if(null===(t.side===Pb?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,t.side!==Qb,s)))return null;KS.copy(s),KS.applyMatrix4(e.matrixWorld);var g=n.ray.origin.distanceTo(KS);return g<n.near||g>n.far?null:{distance:g,point:KS.clone(),object:e}}(e,t,n,i,ZS,wS,SS,MS);if(p){s&&(YS.fromBufferAttribute(s,l),HS.fromBufferAttribute(s,u),FS.fromBufferAttribute(s,c),p.uv=jw.getUV(MS,ZS,wS,SS,YS,HS,FS,new sZ)),g&&(YS.fromBufferAttribute(g,l),HS.fromBufferAttribute(g,u),FS.fromBufferAttribute(g,c),p.uv2=jw.getUV(MS,ZS,wS,SS,YS,HS,FS,new sZ));var m={a:l,b:u,c:c,normal:new KZ,materialIndex:0};jw.getNormal(ZS,wS,SS,m.normal),p.face=m}return p}var LS=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;di(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:i,height:r,depth:a,widthSegments:o,heightSegments:s,depthSegments:g};var l=Ni(e);o=Math.floor(o),s=Math.floor(s),g=Math.floor(g);var u=[],c=[],I=[],C=[],d=0,h=0;function A(e,t,n,i,r,a,o,s,g,A,p){for(var m=a/g,f=o/A,v=a/2,b=o/2,y=s/2,G=g+1,B=A+1,Z=0,w=0,S=new KZ,W=0;W<B;W++)for(var x=W*f-b,R=0;R<G;R++){var V=R*m-v;S[e]=V*i,S[t]=x*r,S[n]=y,c.push(S.x,S.y,S.z),S[e]=0,S[t]=0,S[n]=s>0?1:-1,I.push(S.x,S.y,S.z),C.push(R/g),C.push(1-W/A),Z+=1}for(var k=0;k<A;k++)for(var X=0;X<g;X++){var Y=d+X+G*k,H=d+X+G*(k+1),F=d+(X+1)+G*(k+1),M=d+(X+1)+G*k;u.push(Y,H,M),u.push(H,F,M),w+=6}l.addGroup(h,w,p),h+=w,d+=Z}return A("z","y","x",-1,-1,a,r,i,g,s,0),A("z","y","x",1,-1,a,r,-i,g,s,1),A("x","z","y",1,1,i,a,r,o,g,2),A("x","z","y",1,-1,i,a,-r,o,g,3),A("x","y","z",1,-1,i,r,a,o,s,4),A("x","y","z",-1,-1,i,r,-a,o,s,5),e.setIndex(u),e.setAttribute("position",new IS(c,3)),e.setAttribute("normal",new IS(I,3)),e.setAttribute("uv",new IS(C,2)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(bS);function _S(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}return t}function TS(e){for(var t={},n=0;n<e.length;n++){var i=_S(e[n]);for(var r in i)t[r]=i[r]}return t}var ES={clone:_S,merge:TS},JS=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isShaderMaterial=!0,i.type="ShaderMaterial",i.defines={},i.uniforms={},i.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",i.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",i.linewidth=1,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.lights=!1,i.clipping=!1,i.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},i.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},i.index0AttributeName=void 0,i.uniformsNeedUpdate=!1,i.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),i.setValues(e)),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=_S(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),n}($w),DS=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).isCamera=!0,e.type="Camera",e.matrixWorldInverse=new hw,e.projectionMatrix=new hw,e.projectionMatrixInverse=new hw,e}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){Rr(_i(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){Rr(_i(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(zw),US=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return di(this,n),(e=t.call(this)).isPerspectiveCamera=!0,e.type="PerspectiveCamera",e.fov=i,e.zoom=1,e.near=a,e.far=o,e.focus=10,e.aspect=r,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*qB*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*jB*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*qB*Math.atan(Math.tan(.5*jB*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*jB*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var g=this.filmOffset;0!==g&&(r+=e*g/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(DS),PS=90,QS=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;if(di(this,n),(a=t.call(this)).type="CubeCamera",!0!==r.isWebGLCubeRenderTarget)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),Ji(a);a.renderTarget=r;var o=new US(PS,1,e,i);o.layers=a.layers,o.up.set(0,-1,0),o.lookAt(new KZ(1,0,0)),a.add(o);var s=new US(PS,1,e,i);s.layers=a.layers,s.up.set(0,-1,0),s.lookAt(new KZ(-1,0,0)),a.add(s);var g=new US(PS,1,e,i);g.layers=a.layers,g.up.set(0,0,1),g.lookAt(new KZ(0,1,0)),a.add(g);var l=new US(PS,1,e,i);l.layers=a.layers,l.up.set(0,0,-1),l.lookAt(new KZ(0,-1,0)),a.add(l);var u=new US(PS,1,e,i);u.layers=a.layers,u.up.set(0,-1,0),u.lookAt(new KZ(0,0,1)),a.add(u);var c=new US(PS,1,e,i);return c.layers=a.layers,c.up.set(0,-1,0),c.lookAt(new KZ(0,0,-1)),a.add(c),a}return Ai(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,i=Ir(this.children,6),r=i[0],a=i[1],o=i[2],s=i[3],g=i[4],l=i[5],u=e.getRenderTarget(),c=e.toneMapping,I=e.xr.enabled;e.toneMapping=Vy,e.xr.enabled=!1;var C=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,g),n.texture.generateMipmaps=C,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.toneMapping=c,e.xr.enabled=I,n.texture.needsPMREMUpdate=!0}}]),n}(zw),OS=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a,o,s,g,l,u,c){var I;return di(this,n),e=void 0!==e?e:[],i=void 0!==i?i:Ky,(I=t.call(this,e,i,r,a,o,s,g,l,u,c)).isCubeTexture=!0,I.flipY=!1,I}return Ai(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(xZ),jS=function(e){Li(n,e);var t=Di(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};di(this,n),(i=t.call(this,e,e,r)).isWebGLCubeRenderTarget=!0;var a={width:e,height:e,depth:1},o=[a,a,a,a,a,a];return i.texture=new OS(o,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),i.texture.isRenderTargetTexture=!0,i.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,i.texture.minFilter=void 0!==r.minFilter?r.minFilter:jy,i}return Ai(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new LS(5,5,5),o=new JS({name:"CubemapFromEquirect",uniforms:_S(n),vertexShader:i,fragmentShader:r,side:Pb,blending:qb});o.uniforms.tEquirect.value=t;var s=new NS(a,o),g=t.minFilter;return t.minFilter===eG&&(t.minFilter=jy),new QS(1,10,this).update(e,s),t.minFilter=g,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,i){for(var r=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}]),n}(VZ),qS=new KZ,$S=new KZ,eW=new gZ,tW=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;di(this,e),this.isPlane=!0,this.normal=t,this.constant=n}return Ai(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=qS.subVectors(n,t).cross($S.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(qS),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||eW.getNormalMatrix(e),i=this.coplanarPoint(qS).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),nW=new ow,iW=new KZ,rW=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new tW,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new tW,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new tW,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new tW,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new tW,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new tW;di(this,e),this.planes=[t,n,i,r,a,o]}return Ai(e,[{key:"set",value:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],g=n[5],l=n[6],u=n[7],c=n[8],I=n[9],C=n[10],d=n[11],h=n[12],A=n[13],p=n[14],m=n[15];return t[0].setComponents(o-i,u-s,d-c,m-h).normalize(),t[1].setComponents(o+i,u+s,d+c,m+h).normalize(),t[2].setComponents(o+r,u+g,d+I,m+A).normalize(),t[3].setComponents(o-r,u-g,d-I,m-A).normalize(),t[4].setComponents(o-a,u-l,d-C,m-p).normalize(),t[5].setComponents(o+a,u+l,d+C,m+p).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),nW.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(nW)}},{key:"intersectsSprite",value:function(e){return nW.center.set(0,0,0),nW.radius=.7071067811865476,nW.applyMatrix4(e.matrixWorld),this.intersectsSphere(nW)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){if(t[r].distanceToPoint(n)<i)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(iW.x=i.normal.x>0?e.max.x:e.min.x,iW.y=i.normal.y>0?e.max.y:e.min.y,iW.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(iW)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function aW(){var e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function oW(e,t){var n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){var a=i.get(t);(!a||a.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=i.get(t);void 0===o?i.set(t,function(t,i){var r,a=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(i,s),e.bufferData(i,a,o),t.onUploadCallback(),a instanceof Float32Array)r=5126;else if(a instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");r=5131}else r=5123;else if(a instanceof Int16Array)r=5122;else if(a instanceof Uint32Array)r=5125;else if(a instanceof Int32Array)r=5124;else if(a instanceof Int8Array)r=5120;else if(a instanceof Uint8Array)r=5121;else{if(!(a instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);r=5121}return{buffer:s,type:r,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(!function(t,i,r){var a=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,a):(n?e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,r),o.version=t.version)}}}}var sW=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;di(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:i,height:r,widthSegments:a,heightSegments:o};for(var s=i/2,g=r/2,l=Math.floor(a),u=Math.floor(o),c=l+1,I=u+1,C=i/l,d=r/u,h=[],A=[],p=[],m=[],f=0;f<I;f++)for(var v=f*d-g,b=0;b<c;b++){var y=b*C-s;A.push(y,-v,0),p.push(0,0,1),m.push(b/l),m.push(1-f/u)}for(var G=0;G<u;G++)for(var B=0;B<l;B++){var Z=B+c*G,w=B+c*(G+1),S=B+1+c*(G+1),W=B+1+c*G;h.push(Z,w,W),h.push(w,S,W)}return e.setIndex(h),e.setAttribute("position",new IS(A,3)),e.setAttribute("normal",new IS(p,3)),e.setAttribute("uv",new IS(m,2)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(bS),gW={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\nvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\nconst mat3 XYZ_TO_REC709 = mat3(\n    3.2404542, -0.9692660,  0.0556434,\n   -1.5371385,  1.8760108, -0.2040259,\n   -0.4985314,  0.0415560,  1.0572252\n);\nvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n   vec3 sqrtF0 = sqrt( fresnel0 );\n   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n}\nvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n}\nfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n}\nvec3 evalSensitivity( float OPD, vec3 shift ) {\n   float phase = 2.0 * PI * OPD * 1.0e-9;\n   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );\n   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );\n   xyz /= 1.0685e-7;\n   vec3 srgb = XYZ_TO_REC709 * xyz;\n   return srgb;\n}\nvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n   vec3 I;\n   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n   float cosTheta2Sq = 1.0 - sinTheta2Sq;\n   if ( cosTheta2Sq < 0.0 ) {\n       return vec3( 1.0 );\n   }\n   float cosTheta2 = sqrt( cosTheta2Sq );\n   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n   float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n   float R21 = R12;\n   float T121 = 1.0 - R12;\n   float phi12 = 0.0;\n   if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n   float phi21 = PI - phi12;\n   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n   vec3 phi23 = vec3( 0.0 );\n   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;\n   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;\n   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;\n   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n   vec3 phi = vec3( phi21 ) + phi23;\n   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n   vec3 r123 = sqrt( R123 );\n   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n   vec3 C0 = R12 + Rs;\n   I = C0;\n   vec3 Cm = Rs - T121;\n   for ( int m = 1; m <= 2; ++m ) {\n       Cm *= r123;\n       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n       I += Cm * Sm;\n   }\n   return max( I, vec3( 0.0 ) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\nfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\nif ( material.iridescenceThickness == 0.0 ) {\n\tmaterial.iridescence = 0.0;\n} else {\n\tmaterial.iridescence = saturate( material.iridescence );\n}\nif ( material.iridescence > 0.0 ) {\n\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},lW={common:{diffuse:{value:new BZ(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new gZ},uv2Transform:{value:new gZ},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new sZ(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new BZ(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new BZ(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new gZ}},sprite:{diffuse:{value:new BZ(16777215)},opacity:{value:1},center:{value:new sZ(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new gZ}}},uW={basic:{uniforms:TS([lW.common,lW.specularmap,lW.envmap,lW.aomap,lW.lightmap,lW.fog]),vertexShader:gW.meshbasic_vert,fragmentShader:gW.meshbasic_frag},lambert:{uniforms:TS([lW.common,lW.specularmap,lW.envmap,lW.aomap,lW.lightmap,lW.emissivemap,lW.fog,lW.lights,{emissive:{value:new BZ(0)}}]),vertexShader:gW.meshlambert_vert,fragmentShader:gW.meshlambert_frag},phong:{uniforms:TS([lW.common,lW.specularmap,lW.envmap,lW.aomap,lW.lightmap,lW.emissivemap,lW.bumpmap,lW.normalmap,lW.displacementmap,lW.fog,lW.lights,{emissive:{value:new BZ(0)},specular:{value:new BZ(1118481)},shininess:{value:30}}]),vertexShader:gW.meshphong_vert,fragmentShader:gW.meshphong_frag},standard:{uniforms:TS([lW.common,lW.envmap,lW.aomap,lW.lightmap,lW.emissivemap,lW.bumpmap,lW.normalmap,lW.displacementmap,lW.roughnessmap,lW.metalnessmap,lW.fog,lW.lights,{emissive:{value:new BZ(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:gW.meshphysical_vert,fragmentShader:gW.meshphysical_frag},toon:{uniforms:TS([lW.common,lW.aomap,lW.lightmap,lW.emissivemap,lW.bumpmap,lW.normalmap,lW.displacementmap,lW.gradientmap,lW.fog,lW.lights,{emissive:{value:new BZ(0)}}]),vertexShader:gW.meshtoon_vert,fragmentShader:gW.meshtoon_frag},matcap:{uniforms:TS([lW.common,lW.bumpmap,lW.normalmap,lW.displacementmap,lW.fog,{matcap:{value:null}}]),vertexShader:gW.meshmatcap_vert,fragmentShader:gW.meshmatcap_frag},points:{uniforms:TS([lW.points,lW.fog]),vertexShader:gW.points_vert,fragmentShader:gW.points_frag},dashed:{uniforms:TS([lW.common,lW.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:gW.linedashed_vert,fragmentShader:gW.linedashed_frag},depth:{uniforms:TS([lW.common,lW.displacementmap]),vertexShader:gW.depth_vert,fragmentShader:gW.depth_frag},normal:{uniforms:TS([lW.common,lW.bumpmap,lW.normalmap,lW.displacementmap,{opacity:{value:1}}]),vertexShader:gW.meshnormal_vert,fragmentShader:gW.meshnormal_frag},sprite:{uniforms:TS([lW.sprite,lW.fog]),vertexShader:gW.sprite_vert,fragmentShader:gW.sprite_frag},background:{uniforms:{uvTransform:{value:new gZ},t2D:{value:null}},vertexShader:gW.background_vert,fragmentShader:gW.background_frag},cube:{uniforms:TS([lW.envmap,{opacity:{value:1}}]),vertexShader:gW.cube_vert,fragmentShader:gW.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:gW.equirect_vert,fragmentShader:gW.equirect_frag},distanceRGBA:{uniforms:TS([lW.common,lW.displacementmap,{referencePosition:{value:new KZ},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:gW.distanceRGBA_vert,fragmentShader:gW.distanceRGBA_frag},shadow:{uniforms:TS([lW.lights,lW.fog,{color:{value:new BZ(0)},opacity:{value:1}}]),vertexShader:gW.shadow_vert,fragmentShader:gW.shadow_frag}};function cW(e,t,n,i,r,a){var o,s,g=new BZ(0),l=!0===r?0:1,u=null,c=0,I=null;function C(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,a)}return{getClearColor:function(){return g},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;g.set(e),C(g,l=t)},getClearAlpha:function(){return l},setClearAlpha:function(e){C(g,l=e)},render:function(n,r){var a=!1,d=!0===r.isScene?r.background:null;d&&d.isTexture&&(d=t.get(d));var h=e.xr,A=h.getSession&&h.getSession();A&&"additive"===A.environmentBlendMode&&(d=null),null===d?C(g,l):d&&d.isColor&&(C(d,1),a=!0),(e.autoClear||a)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&(d.isCubeTexture||d.mapping===_y)?(void 0===s&&((s=new NS(new LS(1,1,1),new JS({name:"BackgroundCubeMaterial",uniforms:_S(uW.cube.uniforms),vertexShader:uW.cube.vertexShader,fragmentShader:uW.cube.fragmentShader,side:Pb,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(s)),s.material.uniforms.envMap.value=d,s.material.uniforms.flipEnvMap.value=d.isCubeTexture&&!1===d.isRenderTargetTexture?-1:1,u===d&&c===d.version&&I===e.toneMapping||(s.material.needsUpdate=!0,u=d,c=d.version,I=e.toneMapping),s.layers.enableAll(),n.unshift(s,s.geometry,s.material,0,0,null)):d&&d.isTexture&&(void 0===o&&((o=new NS(new sW(2,2),new JS({name:"BackgroundMaterial",uniforms:_S(uW.background.uniforms),vertexShader:uW.background.vertexShader,fragmentShader:uW.background.fragmentShader,side:Ub,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(o)),o.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),o.material.uniforms.uvTransform.value.copy(d.matrix),u===d&&c===d.version&&I===e.toneMapping||(o.material.needsUpdate=!0,u=d,c=d.version,I=e.toneMapping),o.layers.enableAll(),n.unshift(o,o.geometry,o.material,0,0,null))}}}function IW(e,t,n,i){var r=e.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},g=C(null),l=g,u=!1;function c(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function I(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function C(e){for(var t=[],n=[],i=[],a=0;a<r;a++)t[a]=0,n[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function d(){for(var e=l.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function h(e){A(e,0)}function A(n,r){var a=l.newAttributes,o=l.enabledAttributes,s=l.attributeDivisors;(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==r)&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function p(){for(var t=l.newAttributes,n=l.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function m(t,n,r,a,o,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,a,o,s):e.vertexAttribIPointer(t,n,r,o,s)}function f(){v(),u=!0,l!==g&&c((l=g).object)}function v(){g.geometry=null,g.program=null,g.wireframe=!1}return{setup:function(r,g,I,f,v){var b=!1;if(o){var y=function(t,n,r){var o=!0===r.wireframe,g=s[t.id];void 0===g&&(g={},s[t.id]=g);var l=g[n.id];void 0===l&&(l={},g[n.id]=l);var u=l[o];void 0===u&&(u=C(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),l[o]=u);return u}(f,I,g);l!==y&&c((l=y).object),b=function(e,t,n,i){var r=l.attributes,a=t.attributes,o=0,s=n.getAttributes();for(var g in s){if(s[g].location>=0){var u=r[g],c=a[g];if(void 0===c&&("instanceMatrix"===g&&e.instanceMatrix&&(c=e.instanceMatrix),"instanceColor"===g&&e.instanceColor&&(c=e.instanceColor)),void 0===u)return!0;if(u.attribute!==c)return!0;if(c&&u.data!==c.data)return!0;o++}}return l.attributesNum!==o||l.index!==i}(r,f,I,v),b&&function(e,t,n,i){var r={},a=t.attributes,o=0,s=n.getAttributes();for(var g in s){if(s[g].location>=0){var u=a[g];void 0===u&&("instanceMatrix"===g&&e.instanceMatrix&&(u=e.instanceMatrix),"instanceColor"===g&&e.instanceColor&&(u=e.instanceColor));var c={};c.attribute=u,u&&u.data&&(c.data=u.data),r[g]=c,o++}}l.attributes=r,l.attributesNum=o,l.index=i}(r,f,I,v)}else{var G=!0===g.wireframe;l.geometry===f.id&&l.program===I.id&&l.wireframe===G||(l.geometry=f.id,l.program=I.id,l.wireframe=G,b=!0)}null!==v&&n.update(v,34963),(b||u)&&(u=!1,function(r,a,o,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;d();var g=s.attributes,l=o.getAttributes(),u=a.defaultAttributeValues;for(var c in l){var I=l[c];if(I.location>=0){var C=g[c];if(void 0===C&&("instanceMatrix"===c&&r.instanceMatrix&&(C=r.instanceMatrix),"instanceColor"===c&&r.instanceColor&&(C=r.instanceColor)),void 0!==C){var f=C.normalized,v=C.itemSize,b=n.get(C);if(void 0===b)continue;var y=b.buffer,G=b.type,B=b.bytesPerElement;if(C.isInterleavedBufferAttribute){var Z=C.data,w=Z.stride,S=C.offset;if(Z.isInstancedInterleavedBuffer){for(var W=0;W<I.locationSize;W++)A(I.location+W,Z.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=Z.meshPerAttribute*Z.count)}else for(var x=0;x<I.locationSize;x++)h(I.location+x);e.bindBuffer(34962,y);for(var R=0;R<I.locationSize;R++)m(I.location+R,v/I.locationSize,G,f,w*B,(S+v/I.locationSize*R)*B)}else{if(C.isInstancedBufferAttribute){for(var V=0;V<I.locationSize;V++)A(I.location+V,C.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=C.meshPerAttribute*C.count)}else for(var k=0;k<I.locationSize;k++)h(I.location+k);e.bindBuffer(34962,y);for(var X=0;X<I.locationSize;X++)m(I.location+X,v/I.locationSize,G,f,v*B,v/I.locationSize*X*B)}}else if(void 0!==u){var Y=u[c];if(void 0!==Y)switch(Y.length){case 2:e.vertexAttrib2fv(I.location,Y);break;case 3:e.vertexAttrib3fv(I.location,Y);break;case 4:e.vertexAttrib4fv(I.location,Y);break;default:e.vertexAttrib1fv(I.location,Y)}}}}p()}(r,g,I,f),null!==v&&e.bindBuffer(34963,n.get(v).buffer))},reset:f,resetDefaultState:v,dispose:function(){for(var e in f(),s){var t=s[e];for(var n in t){var i=t[n];for(var r in i)I(i[r].object),delete i[r];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var i=t[n];for(var r in i)I(i[r].object),delete i[r];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var i=n[e.id];for(var r in i)I(i[r].object),delete i[r];delete n[e.id]}}},initAttributes:d,enableAttribute:h,disableUnusedAttributes:p}}function CW(e,t,n,i){var r,a=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,o,s){if(0!==s){var g,l;if(a)g=e,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(g=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g[l](r,i,o,s),n.update(o,r,s)}}}function dW(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var g=a||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),I=e.getParameter(3379),C=e.getParameter(34076),d=e.getParameter(34921),h=e.getParameter(36347),A=e.getParameter(36348),p=e.getParameter(36349),m=c>0,f=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:g,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:I,maxCubemapSize:C,maxAttributes:d,maxVertexUniforms:h,maxVaryings:A,maxFragmentUniforms:p,vertexTextures:m,floatFragmentTextures:f,floatVertexTextures:m&&f,maxSamples:a?e.getParameter(36183):0}}function hW(e){var t=this,n=null,i=0,r=!1,a=!1,o=new tW,s=new gZ,g={value:null,needsUpdate:!1};function l(){g.value!==n&&(g.value=n,g.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function u(e,n,i,r){var a=null!==e?e.length:0,l=null;if(0!==a){if(l=g.value,!0!==r||null===l){var u=i+4*a,c=n.matrixWorldInverse;s.getNormalMatrix(c),(null===l||l.length<u)&&(l=new Float32Array(u));for(var I=0,C=i;I!==a;++I,C+=4)o.copy(e[I]).applyMatrix4(c,s),o.normal.toArray(l,C),l[C+3]=o.constant}g.value=l,g.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,l}this.uniform=g,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==i||r;return r=t,n=u(e,a,0),i=e.length,o},this.beginShadows=function(){a=!0,u(null)},this.endShadows=function(){a=!1,l()},this.setState=function(t,o,s){var c=t.clippingPlanes,I=t.clipIntersection,C=t.clipShadows,d=e.get(t);if(!r||null===c||0===c.length||a&&!C)a?u(null):l();else{var h=a?0:i,A=4*h,p=d.clippingState||null;g.value=p,p=u(c,o,A,s);for(var m=0;m!==A;++m)p[m]=n[m];d.clippingState=p,this.numIntersection=I?this.numPlanes:0,this.numPlanes+=h}}}function AW(e){var t=new WeakMap;function n(e,t){return t===zy?e.mapping=Ky:t===Ly&&(e.mapping=Ny),e}function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){var a=r.mapping;if(a===zy||a===Ly){if(t.has(r))return n(t.get(r).texture,r.mapping);var o=r.image;if(o&&o.height>0){var s=new jS(o.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}return r},dispose:function(){t=new WeakMap}}}uW.physical={uniforms:TS([uW.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new sZ(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new BZ(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new sZ},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new BZ(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new BZ(1,1,1)},specularColorMap:{value:null}}]),vertexShader:gW.meshphysical_vert,fragmentShader:gW.meshphysical_frag};var pW=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return di(this,n),(e=t.call(this)).isOrthographicCamera=!0,e.type="OrthographicCamera",e.zoom=1,e.view=null,e.left=i,e.right=r,e.top=a,e.bottom=o,e.near=s,e.far=g,e.updateProjectionMatrix(),e}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var g=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(r+=g*this.view.offsetX)+g*this.view.width,s=(o-=l*this.view.offsetY)-l*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(DS),mW=[.125,.215,.35,.446,.526,.582],fW=20,vW=new pW,bW=new BZ,yW=null,GW=(1+Math.sqrt(5))/2,BW=1/GW,ZW=[new KZ(1,1,1),new KZ(-1,1,1),new KZ(1,1,-1),new KZ(-1,1,-1),new KZ(0,GW,BW),new KZ(0,GW,-BW),new KZ(BW,0,GW),new KZ(-BW,0,GW),new KZ(GW,BW,0),new KZ(-GW,BW,0)],wW=function(){function e(t){di(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return Ai(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;yW=this._renderer.getRenderTarget(),this._setSize(256);var r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=RW(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=xW(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(yW),e.scissorTest=!1,WW(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===Ky||e.mapping===Ny?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),yW=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:jy,minFilter:jy,generateMipmaps:!1,type:lG,format:hG,encoding:cB,depthBuffer:!1},i=SW(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=SW(e,t,n);var r=this._lodMax,a=function(e){for(var t=[],n=[],i=[],r=e,a=e-4+1+mW.length,o=0;o<a;o++){var s=Math.pow(2,r);n.push(s);var g=1/s;o>e-4?g=mW[o-e+4-1]:0===o&&(g=0),i.push(g);for(var l=1/(s-2),u=-l,c=1+l,I=[u,u,c,u,c,c,u,u,c,c,u,c],C=6,d=6,h=3,A=2,p=1,m=new Float32Array(h*d*C),f=new Float32Array(A*d*C),v=new Float32Array(p*d*C),b=0;b<C;b++){var y=b%3*2/3-1,G=b>2?0:-1,B=[y,G,0,y+2/3,G,0,y+2/3,G+1,0,y,G,0,y+2/3,G+1,0,y,G+1,0];m.set(B,h*d*b),f.set(I,A*d*b);var Z=[b,b,b,b,b,b];v.set(Z,p*d*b)}var w=new bS;w.setAttribute("position",new iS(m,h)),w.setAttribute("uv",new iS(f,A)),w.setAttribute("faceIndex",new iS(v,p)),t.push(w),r>4&&r--}return{lodPlanes:t,sizeLods:n,sigmas:i}}(r);this._sizeLods=a.sizeLods,this._lodPlanes=a.lodPlanes,this._sigmas=a.sigmas,this._blurMaterial=function(e,t,n){var i=new Float32Array(fW),r=new KZ(0,1,0);return new JS({name:"SphericalGaussianBlur",defines:{n:fW,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:qb,depthTest:!1,depthWrite:!1})}(r,e,t)}return i}},{key:"_compileMaterial",value:function(e){var t=new NS(this._lodPlanes[0],e);this._renderer.compile(t,vW)}},{key:"_sceneToCubeUV",value:function(e,t,n,i){var r=new US(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,g=s.autoClear,l=s.toneMapping;s.getClearColor(bW),s.toneMapping=Vy,s.autoClear=!1;var u=new eS({name:"PMREM.Background",side:Pb,depthWrite:!1,depthTest:!1}),c=new NS(new LS,u),I=!1,C=e.background;C?C.isColor&&(u.color.copy(C),e.background=null,I=!0):(u.color.copy(bW),I=!0);for(var d=0;d<6;d++){var h=d%3;0===h?(r.up.set(0,a[d],0),r.lookAt(o[d],0,0)):1===h?(r.up.set(0,0,a[d]),r.lookAt(0,o[d],0)):(r.up.set(0,a[d],0),r.lookAt(0,0,o[d]));var A=this._cubeSize;WW(i,h*A,d>2?A:0,A,A),s.setRenderTarget(i),I&&s.render(c,r),s.render(e,r)}c.geometry.dispose(),c.material.dispose(),s.toneMapping=l,s.autoClear=g,e.background=C}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,i=e.mapping===Ky||e.mapping===Ny;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=RW()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=xW());var r=i?this._cubemapMaterial:this._equirectMaterial,a=new NS(this._lodPlanes[0],r);r.uniforms.envMap.value=e;var o=this._cubeSize;WW(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,vW)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var i=1;i<this._lodPlanes.length;i++){var r=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),a=ZW[(i-1)%ZW.length];this._blur(e,i-1,i,r,a)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,i,r){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}},{key:"_halfBlur",value:function(e,t,n,i,r,a,o){var s=this._renderer,g=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var l=new NS(this._lodPlanes[i],g),u=g.uniforms,c=this._sizeLods[n]-1,I=isFinite(r)?Math.PI/(2*c):2*Math.PI/39,C=r/I,d=isFinite(r)?1+Math.floor(3*C):fW;d>fW&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(d," samples when the maximum is set to ").concat(fW));for(var h=[],A=0,p=0;p<fW;++p){var m=p/C,f=Math.exp(-m*m/2);h.push(f),0===p?A+=f:p<d&&(A+=2*f)}for(var v=0;v<h.length;v++)h[v]=h[v]/A;u.envMap.value=e.texture,u.samples.value=d,u.weights.value=h,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o);var b=this._lodMax;u.dTheta.value=I,u.mipInt.value=b-n;var y=this._sizeLods[i];WW(t,3*y*(i>b-4?i-b+4:0),4*(this._cubeSize-y),3*y,2*y),s.setRenderTarget(t),s.render(l,vW)}}]),e}();function SW(e,t,n){var i=new VZ(e,t,n);return i.texture.mapping=_y,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function WW(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function xW(){return new JS({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:qb,depthTest:!1,depthWrite:!1})}function RW(){return new JS({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:qb,depthTest:!1,depthWrite:!1})}function VW(e){var t=new WeakMap,n=null;function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture){var a=r.mapping,o=a===zy||a===Ly,s=a===Ky||a===Ny;if(o||s){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;var g=t.get(r);return null===n&&(n=new wW(e)),g=o?n.fromEquirectangular(r,g):n.fromCubemap(r,g),t.set(r,g),g.texture}if(t.has(r))return t.get(r).texture;var l=r.image;if(o&&l&&l.height>0||s&&l&&function(e){for(var t=0,n=6,i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(l)){null===n&&(n=new wW(e));var u=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,u),r.addEventListener("dispose",i),u.texture}return null}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function kW(e){var t={};function n(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function XW(e,t,n,i){var r={},a=new WeakMap;function o(e){var s=e.target;for(var g in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[g]);s.removeEventListener("dispose",o),delete r[s.id];var l=a.get(s);l&&(t.remove(l),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],i=e.index,r=e.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var g=0,l=s.length;g<l;g+=3){var u=s[g+0],c=s[g+1],I=s[g+2];n.push(u,c,c,I,I,u)}}else{var C=r.array;o=r.version;for(var d=0,h=C.length/3-1;d<h;d+=3){var A=d+0,p=d+1,m=d+2;n.push(A,p,p,m,m,A)}}var f=new(lZ(n)?uS:gS)(n,1);f.version=o;var v=a.get(e);v&&t.remove(v),a.set(e,f)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var i in n)t.update(n[i],34962);var r=e.morphAttributes;for(var a in r)for(var o=r[a],s=0,g=o.length;s<g;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function YW(e,t,n,i){var r,a,o,s=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r,1)},this.renderInstances=function(i,g,l){if(0!==l){var u,c;if(s)u=e,c="drawElementsInstanced";else if(c="drawElementsInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[c](r,g,a,i*o,l),n.update(g,r,l)}}}function HW(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function FW(e,t){return e[0]-t[0]}function MW(e,t){return Math.abs(t[1])-Math.abs(e[1])}function KW(e,t){var n=1,i=t.isInterleavedBufferAttribute?t.data.array:t.array;i instanceof Int8Array?n=127:i instanceof Uint8Array?n=255:i instanceof Uint16Array?n=65535:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),e.divideScalar(n)}function NW(e,t,n){for(var i={},r=new Float32Array(8),a=new WeakMap,o=new RZ,s=[],g=0;g<8;g++)s[g]=[g,0];return{update:function(g,l,u,c){var I=g.morphTargetInfluences;if(!0===t.isWebGL2){var C=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,d=void 0!==C?C.length:0,h=a.get(l);if(void 0===h||h.count!==d){void 0!==h&&h.texture.dispose();var A=void 0!==l.morphAttributes.position,p=void 0!==l.morphAttributes.normal,m=void 0!==l.morphAttributes.color,f=l.morphAttributes.position||[],v=l.morphAttributes.normal||[],b=l.morphAttributes.color||[],y=0;!0===A&&(y=1),!0===p&&(y=2),!0===m&&(y=3);var G=l.attributes.position.count*y,B=1;G>t.maxTextureSize&&(B=Math.ceil(G/t.maxTextureSize),G=t.maxTextureSize);var Z=new Float32Array(G*B*4*d),w=new kZ(Z,G,B,d);w.type=gG,w.needsUpdate=!0;for(var S=4*y,W=0;W<d;W++)for(var x=f[W],R=v[W],V=b[W],k=G*B*4*W,X=0;X<x.count;X++){var Y=X*S;!0===A&&(o.fromBufferAttribute(x,X),!0===x.normalized&&KW(o,x),Z[k+Y+0]=o.x,Z[k+Y+1]=o.y,Z[k+Y+2]=o.z,Z[k+Y+3]=0),!0===p&&(o.fromBufferAttribute(R,X),!0===R.normalized&&KW(o,R),Z[k+Y+4]=o.x,Z[k+Y+5]=o.y,Z[k+Y+6]=o.z,Z[k+Y+7]=0),!0===m&&(o.fromBufferAttribute(V,X),!0===V.normalized&&KW(o,V),Z[k+Y+8]=o.x,Z[k+Y+9]=o.y,Z[k+Y+10]=o.z,Z[k+Y+11]=4===V.itemSize?o.w:1)}h={count:d,texture:w,size:new sZ(G,B)},a.set(l,h),l.addEventListener("dispose",(function e(){w.dispose(),a.delete(l),l.removeEventListener("dispose",e)}))}for(var H=0,F=0;F<I.length;F++)H+=I[F];var M=l.morphTargetsRelative?1:1-H;c.getUniforms().setValue(e,"morphTargetBaseInfluence",M),c.getUniforms().setValue(e,"morphTargetInfluences",I),c.getUniforms().setValue(e,"morphTargetsTexture",h.texture,n),c.getUniforms().setValue(e,"morphTargetsTextureSize",h.size)}else{var K=void 0===I?0:I.length,N=i[l.id];if(void 0===N||N.length!==K){N=[];for(var z=0;z<K;z++)N[z]=[z,0];i[l.id]=N}for(var L=0;L<K;L++){var _=N[L];_[0]=L,_[1]=I[L]}N.sort(MW);for(var T=0;T<8;T++)T<K&&N[T][1]?(s[T][0]=N[T][0],s[T][1]=N[T][1]):(s[T][0]=Number.MAX_SAFE_INTEGER,s[T][1]=0);s.sort(FW);for(var E=l.morphAttributes.position,J=l.morphAttributes.normal,D=0,U=0;U<8;U++){var P=s[U],Q=P[0],O=P[1];Q!==Number.MAX_SAFE_INTEGER&&O?(E&&l.getAttribute("morphTarget"+U)!==E[Q]&&l.setAttribute("morphTarget"+U,E[Q]),J&&l.getAttribute("morphNormal"+U)!==J[Q]&&l.setAttribute("morphNormal"+U,J[Q]),r[U]=O,D+=O):(E&&!0===l.hasAttribute("morphTarget"+U)&&l.deleteAttribute("morphTarget"+U),J&&!0===l.hasAttribute("morphNormal"+U)&&l.deleteAttribute("morphNormal"+U),r[U]=0)}var j=l.morphTargetsRelative?1:1-D;c.getUniforms().setValue(e,"morphTargetBaseInfluence",j),c.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function zW(e,t,n,i){var r=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=i.render.frame,s=e.geometry,g=t.get(e,s);return r.get(g)!==o&&(t.update(g),r.set(g,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),g},dispose:function(){r=new WeakMap}}}var LW=new xZ,_W=new kZ,TW=new YZ,EW=new OS,JW=[],DW=[],UW=new Float32Array(16),PW=new Float32Array(9),QW=new Float32Array(4);function OW(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=JW[r];if(void 0===a&&(a=new Float32Array(r),JW[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function jW(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function qW(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function $W(e,t){var n=DW[t];void 0===n&&(n=new Int32Array(t),DW[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function ex(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function tx(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(jW(n,t))return;e.uniform2fv(this.addr,t),qW(n,t)}}function nx(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(jW(n,t))return;e.uniform3fv(this.addr,t),qW(n,t)}}function ix(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(jW(n,t))return;e.uniform4fv(this.addr,t),qW(n,t)}}function rx(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(jW(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),qW(n,t)}else{if(jW(n,i))return;QW.set(i),e.uniformMatrix2fv(this.addr,!1,QW),qW(n,i)}}function ax(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(jW(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),qW(n,t)}else{if(jW(n,i))return;PW.set(i),e.uniformMatrix3fv(this.addr,!1,PW),qW(n,i)}}function ox(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(jW(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),qW(n,t)}else{if(jW(n,i))return;UW.set(i),e.uniformMatrix4fv(this.addr,!1,UW),qW(n,i)}}function sx(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function gx(e,t){var n=this.cache;jW(n,t)||(e.uniform2iv(this.addr,t),qW(n,t))}function lx(e,t){var n=this.cache;jW(n,t)||(e.uniform3iv(this.addr,t),qW(n,t))}function ux(e,t){var n=this.cache;jW(n,t)||(e.uniform4iv(this.addr,t),qW(n,t))}function cx(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Ix(e,t){var n=this.cache;jW(n,t)||(e.uniform2uiv(this.addr,t),qW(n,t))}function Cx(e,t){var n=this.cache;jW(n,t)||(e.uniform3uiv(this.addr,t),qW(n,t))}function dx(e,t){var n=this.cache;jW(n,t)||(e.uniform4uiv(this.addr,t),qW(n,t))}function hx(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(t||LW,r)}function Ax(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||TW,r)}function px(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(t||EW,r)}function mx(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||_W,r)}function fx(e,t){e.uniform1fv(this.addr,t)}function vx(e,t){var n=OW(t,this.size,2);e.uniform2fv(this.addr,n)}function bx(e,t){var n=OW(t,this.size,3);e.uniform3fv(this.addr,n)}function yx(e,t){var n=OW(t,this.size,4);e.uniform4fv(this.addr,n)}function Gx(e,t){var n=OW(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Bx(e,t){var n=OW(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Zx(e,t){var n=OW(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function wx(e,t){e.uniform1iv(this.addr,t)}function Sx(e,t){e.uniform2iv(this.addr,t)}function Wx(e,t){e.uniform3iv(this.addr,t)}function xx(e,t){e.uniform4iv(this.addr,t)}function Rx(e,t){e.uniform1uiv(this.addr,t)}function Vx(e,t){e.uniform2uiv(this.addr,t)}function kx(e,t){e.uniform3uiv(this.addr,t)}function Xx(e,t){e.uniform4uiv(this.addr,t)}function Yx(e,t,n){var i=t.length,r=$W(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.setTexture2D(t[a]||LW,r[a])}function Hx(e,t,n){var i=t.length,r=$W(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.setTexture3D(t[a]||TW,r[a])}function Fx(e,t,n){var i=t.length,r=$W(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.setTextureCube(t[a]||EW,r[a])}function Mx(e,t,n){var i=t.length,r=$W(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.setTexture2DArray(t[a]||_W,r[a])}var Kx=Ai((function e(t,n,i){di(this,e),this.id=t,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return ex;case 35664:return tx;case 35665:return nx;case 35666:return ix;case 35674:return rx;case 35675:return ax;case 35676:return ox;case 5124:case 35670:return sx;case 35667:case 35671:return gx;case 35668:case 35672:return lx;case 35669:case 35673:return ux;case 5125:return cx;case 36294:return Ix;case 36295:return Cx;case 36296:return dx;case 35678:case 36198:case 36298:case 36306:case 35682:return hx;case 35679:case 36299:case 36307:return Ax;case 35680:case 36300:case 36308:case 36293:return px;case 36289:case 36303:case 36311:case 36292:return mx}}(n.type)})),Nx=Ai((function e(t,n,i){di(this,e),this.id=t,this.addr=i,this.cache=[],this.size=n.size,this.setValue=function(e){switch(e){case 5126:return fx;case 35664:return vx;case 35665:return bx;case 35666:return yx;case 35674:return Gx;case 35675:return Bx;case 35676:return Zx;case 5124:case 35670:return wx;case 35667:case 35671:return Sx;case 35668:case 35672:return Wx;case 35669:case 35673:return xx;case 5125:return Rx;case 36294:return Vx;case 36295:return kx;case 36296:return Xx;case 35678:case 36198:case 36298:case 36306:case 35682:return Yx;case 35679:case 36299:case 36307:return Hx;case 35680:case 36300:case 36308:case 36293:return Fx;case 36289:case 36303:case 36311:case 36292:return Mx}}(n.type)})),zx=function(){function e(t){di(this,e),this.id=t,this.seq=[],this.map={}}return Ai(e,[{key:"setValue",value:function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}}}]),e}(),Lx=/(\w+)(\])?(\[|\.)?/g;function _x(e,t){e.seq.push(t),e.map[t.id]=t}function Tx(e,t,n){var i=e.name,r=i.length;for(Lx.lastIndex=0;;){var a=Lx.exec(i),o=Lx.lastIndex,s=a[1],g="]"===a[2],l=a[3];if(g&&(s|=0),void 0===l||"["===l&&o+2===r){_x(n,void 0===l?new Kx(s,e,t):new Nx(s,e,t));break}var u=n.map[s];void 0===u&&_x(n,u=new zx(s)),n=u}}var Ex=function(){function e(t,n){di(this,e),this.seq=[],this.map={};for(var i=t.getProgramParameter(n,35718),r=0;r<i;++r){var a=t.getActiveUniform(n,r);Tx(a,t.getUniformLocation(n,a.name),this)}}return Ai(e,[{key:"setValue",value:function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)}},{key:"setOptional",value:function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)}}],[{key:"upload",value:function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n}}]),e}();function Jx(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}var Dx=0;function Ux(e,t,n){var i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(i&&""===r)return"";var a=/ERROR: 0:(\d+)/.exec(r);if(a){var o=parseInt(a[1]);return n.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){for(var n=e.split("\n"),i=[],r=Math.max(t-6,0),a=Math.min(t+6,n.length),o=r;o<a;o++){var s=o+1;i.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return i.join("\n")}(e.getShaderSource(t),o)}return r}function Px(e,t){var n=function(e){switch(e){case cB:return["Linear","( value )"];case IB:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Qx(e,t){var n;switch(t){case ky:n="Linear";break;case Xy:n="Reinhard";break;case Yy:n="OptimizedCineon";break;case Hy:n="ACESFilmic";break;case Fy:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Ox(e){return""!==e}function jx(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function qx(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var $x=/^[ \t]*#include +<([\w\d./]+)>/gm;function eR(e){return e.replace($x,tR)}function tR(e,t){var n=gW[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return eR(n)}var nR=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,iR=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function rR(e){return e.replace(iR,oR).replace(nR,aR)}function aR(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),oR(e,t,n,i)}function oR(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function sR(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function gR(e,t,n,i){var r,a,o=e.getContext(),s=n.defines,g=n.vertexShader,l=n.fragmentShader,u=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===Eb?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===Jb?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===Db&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Ky:case Ny:t="ENVMAP_TYPE_CUBE";break;case _y:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),I=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Ny&&(t="ENVMAP_MODE_REFRACTION");return t}(n),C=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Wy:t="ENVMAP_BLENDING_MULTIPLY";break;case xy:t="ENVMAP_BLENDING_MIX";break;case Ry:t="ENVMAP_BLENDING_ADD"}return t}(n),d=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),h=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ox).join("\n")}(n),A=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),p=o.createProgram(),m=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((r=[A].filter(Ox).join("\n")).length>0&&(r+="\n"),(a=[h,A].filter(Ox).join("\n")).length>0&&(a+="\n")):(r=[sR(n),"#define SHADER_NAME "+n.shaderName,A,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+I:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ox).join("\n"),a=[h,sR(n),"#define SHADER_NAME "+n.shaderName,A,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+I:"",n.envMap?"#define "+C:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Vy?"#define TONE_MAPPING":"",n.toneMapping!==Vy?gW.tonemapping_pars_fragment:"",n.toneMapping!==Vy?Qx("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",gW.encodings_pars_fragment,Px("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Ox).join("\n")),g=qx(g=jx(g=eR(g),n),n),l=qx(l=jx(l=eR(l),n),n),g=rR(g),l=rR(l),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(m="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["#define varying in",n.glslVersion===DB?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===DB?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var f,v,b=m+a+l,y=Jx(o,35633,m+r+g),G=Jx(o,35632,b);if(o.attachShader(p,y),o.attachShader(p,G),void 0!==n.index0AttributeName?o.bindAttribLocation(p,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(p,0,"position"),o.linkProgram(p),e.debug.checkShaderErrors){var B=o.getProgramInfoLog(p).trim(),Z=o.getShaderInfoLog(y).trim(),w=o.getShaderInfoLog(G).trim(),S=!0,W=!0;if(!1===o.getProgramParameter(p,35714)){S=!1;var x=Ux(o,y,"vertex"),R=Ux(o,G,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(p,35715)+"\n\nProgram Info Log: "+B+"\n"+x+"\n"+R)}else""!==B?console.warn("THREE.WebGLProgram: Program Info Log:",B):""!==Z&&""!==w||(W=!1);W&&(this.diagnostics={runnable:S,programLog:B,vertexShader:{log:Z,prefix:r},fragmentShader:{log:w,prefix:a}})}return o.deleteShader(y),o.deleteShader(G),this.getUniforms=function(){return void 0===f&&(f=new Ex(o,p)),f},this.getAttributes=function(){return void 0===v&&(v=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var a=e.getActiveAttrib(t,r),o=a.name,s=1;35674===a.type&&(s=2),35675===a.type&&(s=3),35676===a.type&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,p)),v},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(p),this.program=void 0},this.name=n.shaderName,this.id=Dx++,this.cacheKey=t,this.usedTimes=1,this.program=p,this.vertexShader=y,this.fragmentShader=G,this}var lR=0,uR=function(){function e(){di(this,e),this.shaderCache=new Map,this.materialCache=new Map}return Ai(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),r=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(i)&&(a.add(i),i.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}},{key:"remove",value:function(e){var t,n=Cr(this.materialCache.get(e));try{for(n.s();!(t=n.n()).done;){var i=t.value;i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code)}}catch(r){n.e(r)}finally{n.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache;if(!1===t.has(e)){var n=new cR(e);t.set(e,n)}return t.get(e)}}]),e}(),cR=Ai((function e(t){di(this,e),this.id=lR++,this.code=t,this.usedTimes=0}));function IR(e,t,n,i,r,a,o){var s=new ww,g=new uR,l=[],u=r.isWebGL2,c=r.logarithmicDepthBuffer,I=r.vertexTextures,C=r.precision,d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(a,s,l,h,A){var p=h.fog,m=A.geometry,f=a.isMeshStandardMaterial?h.environment:null,v=(a.isMeshStandardMaterial?n:t).get(a.envMap||f),b=v&&v.mapping===_y?v.image.height:null,y=d[a.type];null!==a.precision&&(C=r.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",C,"instead.");var G,B,Z,w,S=m.morphAttributes.position||m.morphAttributes.normal||m.morphAttributes.color,W=void 0!==S?S.length:0,x=0;if(void 0!==m.morphAttributes.position&&(x=1),void 0!==m.morphAttributes.normal&&(x=2),void 0!==m.morphAttributes.color&&(x=3),y){var R=uW[y];G=R.vertexShader,B=R.fragmentShader}else G=a.vertexShader,B=a.fragmentShader,g.update(a),Z=g.getVertexShaderID(a),w=g.getFragmentShaderID(a);var V=e.getRenderTarget(),k=a.alphaTest>0,X=a.clearcoat>0,Y=a.iridescence>0;return{isWebGL2:u,shaderID:y,shaderName:a.type,vertexShader:G,fragmentShader:B,defines:a.defines,customVertexShaderID:Z,customFragmentShaderID:w,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:C,instancing:!0===A.isInstancedMesh,instancingColor:!0===A.isInstancedMesh&&null!==A.instanceColor,supportsVertexTextures:I,outputEncoding:null===V?e.outputEncoding:!0===V.isXRRenderTarget?V.texture.encoding:cB,map:!!a.map,matcap:!!a.matcap,envMap:!!v,envMapMode:v&&v.mapping,envMapCubeUVHeight:b,lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===AB,tangentSpaceNormalMap:a.normalMapType===hB,decodeVideoTexture:!!a.map&&!0===a.map.isVideoTexture&&a.map.encoding===IB,clearcoat:X,clearcoatMap:X&&!!a.clearcoatMap,clearcoatRoughnessMap:X&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:X&&!!a.clearcoatNormalMap,iridescence:Y,iridescenceMap:Y&&!!a.iridescenceMap,iridescenceThicknessMap:Y&&!!a.iridescenceThicknessMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,opaque:!1===a.transparent&&a.blending===$b,alphaMap:!!a.alphaMap,alphaTest:k,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!m.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!m.attributes.color&&4===m.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.iridescenceMap||!!a.iridescenceThicknessMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||!!a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!p,useFog:!0===a.fog,fogExp2:p&&p.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===A.isSkinnedMesh,morphTargets:void 0!==m.morphAttributes.position,morphNormals:void 0!==m.morphAttributes.normal,morphColors:void 0!==m.morphAttributes.color,morphTargetsCount:W,morphTextureStride:x,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:Vy,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===Qb,flipSided:a.side===Pb,useDepthPacking:!!a.depthPacking,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.lightMap&&s.enable(7);t.aoMap&&s.enable(8);t.emissiveMap&&s.enable(9);t.bumpMap&&s.enable(10);t.normalMap&&s.enable(11);t.objectSpaceNormalMap&&s.enable(12);t.tangentSpaceNormalMap&&s.enable(13);t.clearcoat&&s.enable(14);t.clearcoatMap&&s.enable(15);t.clearcoatRoughnessMap&&s.enable(16);t.clearcoatNormalMap&&s.enable(17);t.iridescence&&s.enable(18);t.iridescenceMap&&s.enable(19);t.iridescenceThicknessMap&&s.enable(20);t.displacementMap&&s.enable(21);t.specularMap&&s.enable(22);t.roughnessMap&&s.enable(23);t.metalnessMap&&s.enable(24);t.gradientMap&&s.enable(25);t.alphaMap&&s.enable(26);t.alphaTest&&s.enable(27);t.vertexColors&&s.enable(28);t.vertexAlphas&&s.enable(29);t.vertexUvs&&s.enable(30);t.vertexTangents&&s.enable(31);t.uvsVertexOnly&&s.enable(32);t.fog&&s.enable(33);e.push(s.mask),s.disableAll(),t.useFog&&s.enable(0);t.flatShading&&s.enable(1);t.logarithmicDepthBuffer&&s.enable(2);t.skinning&&s.enable(3);t.morphTargets&&s.enable(4);t.morphNormals&&s.enable(5);t.morphColors&&s.enable(6);t.premultipliedAlpha&&s.enable(7);t.shadowMapEnabled&&s.enable(8);t.physicallyCorrectLights&&s.enable(9);t.doubleSided&&s.enable(10);t.flipSided&&s.enable(11);t.useDepthPacking&&s.enable(12);t.dithering&&s.enable(13);t.specularIntensityMap&&s.enable(14);t.specularColorMap&&s.enable(15);t.transmission&&s.enable(16);t.transmissionMap&&s.enable(17);t.thicknessMap&&s.enable(18);t.sheen&&s.enable(19);t.sheenColorMap&&s.enable(20);t.sheenRoughnessMap&&s.enable(21);t.decodeVideoTexture&&s.enable(22);t.opaque&&s.enable(23);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=d[e.type];if(n){var i=uW[n];t=ES.clone(i.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var i,r=0,o=l.length;r<o;r++){var s=l[r];if(s.cacheKey===n){++(i=s).usedTimes;break}}return void 0===i&&(i=new gR(e,n,t,a),l.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){var t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},releaseShaderCache:function(e){g.remove(e)},programs:l,dispose:function(){g.dispose()}}}function CR(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function dR(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function hR(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function AR(){var e=[],t=0,n=[],i=[],r=[];function a(n,i,r,a,o,s){var g=e[t];return void 0===g?(g={id:n.id,object:n,geometry:i,material:r,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=g):(g.id=n.id,g.object=n,g.geometry=i,g.material=r,g.groupOrder=a,g.renderOrder=n.renderOrder,g.z=o,g.group=s),t++,g}return{opaque:n,transmissive:i,transparent:r,init:function(){t=0,n.length=0,i.length=0,r.length=0},push:function(e,t,o,s,g,l){var u=a(e,t,o,s,g,l);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(e,t,o,s,g,l){var u=a(e,t,o,s,g,l);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(var n=t,i=e.length;n<i;n++){var r=e[n];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.group=null}},sort:function(e,t){n.length>1&&n.sort(e||dR),i.length>1&&i.sort(t||hR),r.length>1&&r.sort(t||hR)}}}function pR(){var e=new WeakMap;return{get:function(t,n){var i;return!1===e.has(t)?(i=new AR,e.set(t,[i])):n>=e.get(t).length?(i=new AR,e.get(t).push(i)):i=e.get(t)[n],i},dispose:function(){e=new WeakMap}}}function mR(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new KZ,color:new BZ};break;case"SpotLight":n={position:new KZ,direction:new KZ,color:new BZ,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new KZ,color:new BZ,distance:0,decay:0};break;case"HemisphereLight":n={direction:new KZ,skyColor:new BZ,groundColor:new BZ};break;case"RectAreaLight":n={color:new BZ,position:new KZ,halfWidth:new KZ,halfHeight:new KZ}}return e[t.id]=n,n}}}var fR=0;function vR(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function bR(e,t){for(var n=new mR,i=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sZ};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new sZ,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)r.probe.push(new KZ);var o=new KZ,s=new hw,g=new hw;return{setup:function(a,o){for(var s=0,g=0,l=0,u=0;u<9;u++)r.probe[u].set(0,0,0);var c=0,I=0,C=0,d=0,h=0,A=0,p=0,m=0;a.sort(vR);for(var f=!0!==o?Math.PI:1,v=0,b=a.length;v<b;v++){var y=a[v],G=y.color,B=y.intensity,Z=y.distance,w=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)s+=G.r*B*f,g+=G.g*B*f,l+=G.b*B*f;else if(y.isLightProbe)for(var S=0;S<9;S++)r.probe[S].addScaledVector(y.sh.coefficients[S],B);else if(y.isDirectionalLight){var W=n.get(y);if(W.color.copy(y.color).multiplyScalar(y.intensity*f),y.castShadow){var x=y.shadow,R=i.get(y);R.shadowBias=x.bias,R.shadowNormalBias=x.normalBias,R.shadowRadius=x.radius,R.shadowMapSize=x.mapSize,r.directionalShadow[c]=R,r.directionalShadowMap[c]=w,r.directionalShadowMatrix[c]=y.shadow.matrix,A++}r.directional[c]=W,c++}else if(y.isSpotLight){var V=n.get(y);if(V.position.setFromMatrixPosition(y.matrixWorld),V.color.copy(G).multiplyScalar(B*f),V.distance=Z,V.coneCos=Math.cos(y.angle),V.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),V.decay=y.decay,y.castShadow){var k=y.shadow,X=i.get(y);X.shadowBias=k.bias,X.shadowNormalBias=k.normalBias,X.shadowRadius=k.radius,X.shadowMapSize=k.mapSize,r.spotShadow[C]=X,r.spotShadowMap[C]=w,r.spotShadowMatrix[C]=y.shadow.matrix,m++}r.spot[C]=V,C++}else if(y.isRectAreaLight){var Y=n.get(y);Y.color.copy(G).multiplyScalar(B),Y.halfWidth.set(.5*y.width,0,0),Y.halfHeight.set(0,.5*y.height,0),r.rectArea[d]=Y,d++}else if(y.isPointLight){var H=n.get(y);if(H.color.copy(y.color).multiplyScalar(y.intensity*f),H.distance=y.distance,H.decay=y.decay,y.castShadow){var F=y.shadow,M=i.get(y);M.shadowBias=F.bias,M.shadowNormalBias=F.normalBias,M.shadowRadius=F.radius,M.shadowMapSize=F.mapSize,M.shadowCameraNear=F.camera.near,M.shadowCameraFar=F.camera.far,r.pointShadow[I]=M,r.pointShadowMap[I]=w,r.pointShadowMatrix[I]=y.shadow.matrix,p++}r.point[I]=H,I++}else if(y.isHemisphereLight){var K=n.get(y);K.skyColor.copy(y.color).multiplyScalar(B*f),K.groundColor.copy(y.groundColor).multiplyScalar(B*f),r.hemi[h]=K,h++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=lW.LTC_FLOAT_1,r.rectAreaLTC2=lW.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=lW.LTC_HALF_1,r.rectAreaLTC2=lW.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=g,r.ambient[2]=l;var N=r.hash;N.directionalLength===c&&N.pointLength===I&&N.spotLength===C&&N.rectAreaLength===d&&N.hemiLength===h&&N.numDirectionalShadows===A&&N.numPointShadows===p&&N.numSpotShadows===m||(r.directional.length=c,r.spot.length=C,r.rectArea.length=d,r.point.length=I,r.hemi.length=h,r.directionalShadow.length=A,r.directionalShadowMap.length=A,r.pointShadow.length=p,r.pointShadowMap.length=p,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=A,r.pointShadowMatrix.length=p,r.spotShadowMatrix.length=m,N.directionalLength=c,N.pointLength=I,N.spotLength=C,N.rectAreaLength=d,N.hemiLength=h,N.numDirectionalShadows=A,N.numPointShadows=p,N.numSpotShadows=m,r.version=fR++)},setupView:function(e,t){for(var n=0,i=0,a=0,l=0,u=0,c=t.matrixWorldInverse,I=0,C=e.length;I<C;I++){var d=e[I];if(d.isDirectionalLight){var h=r.directional[n];h.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),h.direction.sub(o),h.direction.transformDirection(c),n++}else if(d.isSpotLight){var A=r.spot[a];A.position.setFromMatrixPosition(d.matrixWorld),A.position.applyMatrix4(c),A.direction.setFromMatrixPosition(d.matrixWorld),o.setFromMatrixPosition(d.target.matrixWorld),A.direction.sub(o),A.direction.transformDirection(c),a++}else if(d.isRectAreaLight){var p=r.rectArea[l];p.position.setFromMatrixPosition(d.matrixWorld),p.position.applyMatrix4(c),g.identity(),s.copy(d.matrixWorld),s.premultiply(c),g.extractRotation(s),p.halfWidth.set(.5*d.width,0,0),p.halfHeight.set(0,.5*d.height,0),p.halfWidth.applyMatrix4(g),p.halfHeight.applyMatrix4(g),l++}else if(d.isPointLight){var m=r.point[i];m.position.setFromMatrixPosition(d.matrixWorld),m.position.applyMatrix4(c),i++}else if(d.isHemisphereLight){var f=r.hemi[u];f.direction.setFromMatrixPosition(d.matrixWorld),f.direction.transformDirection(c),u++}}},state:r}}function yR(e,t){var n=new bR(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function GR(e,t){var n=new WeakMap;return{get:function(i){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(i)?(r=new yR(e,t),n.set(i,[r])):a>=n.get(i).length?(r=new yR(e,t),n.get(i).push(r)):r=n.get(i)[a],r},dispose:function(){n=new WeakMap}}}var BR=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshDepthMaterial=!0,i.type="MeshDepthMaterial",i.depthPacking=CB,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}($w),ZR=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshDistanceMaterial=!0,i.type="MeshDistanceMaterial",i.referencePosition=new KZ,i.nearDistance=1,i.farDistance=1e3,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}($w);function wR(e,t,n){var i=new rW,r=new sZ,a=new sZ,o=new RZ,s=new BR({depthPacking:dB}),g=new ZR,l={},u=n.maxTextureSize,c={0:Pb,1:Ub,2:Qb},I=new JS({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new sZ},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),C=I.clone();C.defines.HORIZONTAL_PASS=1;var d=new bS;d.setAttribute("position",new iS(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var h=new NS(d,I),A=this;function p(n,i){var a=t.update(h);I.defines.VSM_SAMPLES!==n.blurSamples&&(I.defines.VSM_SAMPLES=n.blurSamples,C.defines.VSM_SAMPLES=n.blurSamples,I.needsUpdate=!0,C.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new VZ(r.x,r.y)),I.uniforms.shadow_pass.value=n.map.texture,I.uniforms.resolution.value=n.mapSize,I.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,a,I,h,null),C.uniforms.shadow_pass.value=n.mapPass.texture,C.uniforms.resolution.value=n.mapSize,C.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,a,C,h,null)}function m(t,n,i,r,a,o){var u=null,I=!0===i.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(u=void 0!==I?I:!0===i.isPointLight?g:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){var C=u.uuid,d=n.uuid,h=l[C];void 0===h&&(h={},l[C]=h);var A=h[d];void 0===A&&(A=u.clone(),h[d]=A),u=A}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=o===Db?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:c[n.side],u.alphaMap=n.alphaMap,u.alphaTest=n.alphaTest,u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.displacementMap=n.displacementMap,u.displacementScale=n.displacementScale,u.displacementBias=n.displacementBias,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===i.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(i.matrixWorld),u.nearDistance=r,u.farDistance=a),u}function f(n,r,a,o,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===Db)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var g=t.update(n),l=n.material;if(Array.isArray(l))for(var u=g.groups,c=0,I=u.length;c<I;c++){var C=u[c],d=l[C.materialIndex];if(d&&d.visible){var h=m(n,d,o,a.near,a.far,s);e.renderBufferDirect(a,null,g,h,n,C)}}else if(l.visible){var A=m(n,l,o,a.near,a.far,s);e.renderBufferDirect(a,null,g,A,n,null)}}for(var p=n.children,v=0,b=p.length;v<b;v++)f(p[v],r,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Eb,this.render=function(t,n,s){if(!1!==A.enabled&&(!1!==A.autoUpdate||!1!==A.needsUpdate)&&0!==t.length){var g=e.getRenderTarget(),l=e.getActiveCubeFace(),c=e.getActiveMipmapLevel(),I=e.state;I.setBlending(qb),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);for(var C=0,d=t.length;C<d;C++){var h=t[C],m=h.shadow;if(void 0!==m){if(!1!==m.autoUpdate||!1!==m.needsUpdate){r.copy(m.mapSize);var v=m.getFrameExtents();if(r.multiply(v),a.copy(m.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(a.x=Math.floor(u/v.x),r.x=a.x*v.x,m.mapSize.x=a.x),r.y>u&&(a.y=Math.floor(u/v.y),r.y=a.y*v.y,m.mapSize.y=a.y)),null===m.map){var b=this.type!==Db?{minFilter:Dy,magFilter:Dy}:{};m.map=new VZ(r.x,r.y,b),m.map.texture.name=h.name+".shadowMap",m.camera.updateProjectionMatrix()}e.setRenderTarget(m.map),e.clear();for(var y=m.getViewportCount(),G=0;G<y;G++){var B=m.getViewport(G);o.set(a.x*B.x,a.y*B.y,a.x*B.z,a.y*B.w),I.viewport(o),m.updateMatrices(h,G),i=m.getFrustum(),f(n,s,m.camera,h,this.type)}!0!==m.isPointLightShadow&&this.type===Db&&p(m,s),m.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",h,"has no shadow.")}A.needsUpdate=!1,e.setRenderTarget(g,l,c)}}}function SR(e,t,n){var i,r,a=n.isWebGL2;var o=new function(){var t=!1,n=new RZ,i=null,r=new RZ(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?z(2929):L(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case vy:e.depthFunc(512);break;case by:e.depthFunc(519);break;case yy:e.depthFunc(513);break;case Gy:e.depthFunc(515);break;case By:e.depthFunc(514);break;case Zy:e.depthFunc(518);break;case wy:e.depthFunc(516);break;case Sy:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},g=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,g=null,l=null;return{setTest:function(e){t||(e?z(2960):L(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&g===i||(e.stencilOp(t,n,i),o=t,s=n,g=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,g=null,l=null}}},l={},u={},c=new WeakMap,I=[],C=null,d=!1,h=null,A=null,p=null,m=null,f=null,v=null,b=null,y=!1,G=null,B=null,Z=null,w=null,S=null,W=e.getParameter(35661),x=!1,R=0,V=e.getParameter(7938);-1!==V.indexOf("WebGL")?(R=parseFloat(/^WebGL (\d)/.exec(V)[1]),x=R>=1):-1!==V.indexOf("OpenGL ES")&&(R=parseFloat(/^OpenGL ES (\d)/.exec(V)[1]),x=R>=2);var k=null,X={},Y=e.getParameter(3088),H=e.getParameter(2978),F=(new RZ).fromArray(Y),M=(new RZ).fromArray(H);function K(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<i;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return a}var N={};function z(t){!0!==l[t]&&(e.enable(t),l[t]=!0)}function L(t){!1!==l[t]&&(e.disable(t),l[t]=!1)}N[3553]=K(3553,3553,1),N[34067]=K(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),g.setClear(0),z(2929),s.setFunc(Gy),D(!1),U(zb),z(2884),J(qb);var _=(Eo(i={},ry,32774),Eo(i,ay,32778),Eo(i,oy,32779),i);if(a)_[sy]=32775,_[gy]=32776;else{var T=t.get("EXT_blend_minmax");null!==T&&(_[sy]=T.MIN_EXT,_[gy]=T.MAX_EXT)}var E=(Eo(r={},ly,0),Eo(r,uy,1),Eo(r,cy,768),Eo(r,Cy,770),Eo(r,fy,776),Eo(r,py,774),Eo(r,hy,772),Eo(r,Iy,769),Eo(r,dy,771),Eo(r,my,775),Eo(r,Ay,773),r);function J(t,n,i,r,a,o,s,g){if(t!==qb){if(!1===d&&(z(3042),d=!0),t===iy)a=a||n,o=o||i,s=s||r,n===A&&a===f||(e.blendEquationSeparate(_[n],_[a]),A=n,f=a),i===p&&r===m&&o===v&&s===b||(e.blendFuncSeparate(E[i],E[r],E[o],E[s]),p=i,m=r,v=o,b=s),h=t,y=null;else if(t!==h||g!==y){if(A===ry&&f===ry||(e.blendEquation(32774),A=ry,f=ry),g)switch(t){case $b:e.blendFuncSeparate(1,771,1,771);break;case ey:e.blendFunc(1,1);break;case ty:e.blendFuncSeparate(0,769,0,1);break;case ny:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case $b:e.blendFuncSeparate(770,771,1,771);break;case ey:e.blendFunc(770,1);break;case ty:e.blendFuncSeparate(0,769,0,1);break;case ny:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}p=null,m=null,v=null,b=null,h=t,y=g}}else!0===d&&(L(3042),d=!1)}function D(t){G!==t&&(t?e.frontFace(2304):e.frontFace(2305),G=t)}function U(t){t!==Nb?(z(2884),t!==B&&(t===zb?e.cullFace(1029):t===Lb?e.cullFace(1028):e.cullFace(1032))):L(2884),B=t}function P(t,n,i){t?(z(32823),w===n&&S===i||(e.polygonOffset(n,i),w=n,S=i)):L(32823)}function Q(t){void 0===t&&(t=33984+W-1),k!==t&&(e.activeTexture(t),k=t)}return{buffers:{color:o,depth:s,stencil:g},enable:z,disable:L,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,a&&(36009===t&&(u[36160]=n),36160===t&&(u[36009]=n)),!0)},drawBuffers:function(i,r){var a=I,o=!1;if(i)if(void 0===(a=c.get(r))&&(a=[],c.set(r,a)),i.isWebGLMultipleRenderTargets){var s=i.texture;if(a.length!==s.length||36064!==a[0]){for(var g=0,l=s.length;g<l;g++)a[g]=36064+g;a.length=s.length,o=!0}}else 36064!==a[0]&&(a[0]=36064,o=!0);else 1029!==a[0]&&(a[0]=1029,o=!0);o&&(n.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return C!==t&&(e.useProgram(t),C=t,!0)},setBlending:J,setMaterial:function(e,t){e.side===Qb?L(2884):z(2884);var n=e.side===Pb;t&&(n=!n),D(n),e.blending===$b&&!1===e.transparent?J(qb):J(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var i=e.stencilWrite;g.setTest(i),i&&(g.setMask(e.stencilWriteMask),g.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),g.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),P(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?z(32926):L(32926)},setFlipSided:D,setCullFace:U,setLineWidth:function(t){t!==Z&&(x&&e.lineWidth(t),Z=t)},setPolygonOffset:P,setScissorTest:function(e){e?z(3089):L(3089)},activeTexture:Q,bindTexture:function(t,n){null===k&&Q();var i=X[k];void 0===i&&(i={type:void 0,texture:void 0},X[k]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||N[t]),i.type=t,i.texture=n)},unbindTexture:function(){var t=X[k];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===F.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),F.copy(t))},viewport:function(t){!1===M.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),M.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===a&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),l={},k=null,X={},u={},c=new WeakMap,I=[],C=null,d=!1,h=null,A=null,p=null,m=null,f=null,v=null,b=null,y=!1,G=null,B=null,Z=null,w=null,S=null,F.set(0,0,e.canvas.width,e.canvas.height),M.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),g.reset()}}}function WR(e,t,n,i,r,a,o){var s,g,l,u=r.isWebGL2,c=r.maxTextures,I=r.maxCubemapSize,C=r.maxTextureSize,d=r.maxSamples,h=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,A=/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap,m=new WeakMap,f=!1;try{f="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(E){}function v(e,t){return f?new OffscreenCanvas(e,t):IZ("canvas")}function b(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?aZ:Math.floor,o=a(r*e.width),s=a(r*e.height);void 0===l&&(l=v(o,s));var g=n?v(o,s):l;return g.width=o,g.height=s,g.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),g}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function y(e){return iZ(e.width)&&iZ(e.height)}function G(e,t){return e.generateMipmaps&&t&&e.minFilter!==Dy&&e.minFilter!==jy}function B(t){e.generateMipmap(t)}function Z(n,i,r,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===u)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=i;return 6403===i&&(5126===r&&(s=33326),5131===r&&(s=33325),5121===r&&(s=33321)),33319===i&&(5126===r&&(s=33328),5131===r&&(s=33327),5121===r&&(s=33323)),6408===i&&(5126===r&&(s=34836),5131===r&&(s=34842),5121===r&&(s=a===IB&&!1===o?35907:32856),32819===r&&(s=32854),32820===r&&(s=32855)),33325!==s&&33326!==s&&33327!==s&&33328!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function w(e,t,n){return!0===G(e,n)||e.isFramebufferTexture&&e.minFilter!==Dy&&e.minFilter!==jy?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){return e===Dy||e===Uy||e===Qy?9728:9729}function W(e){var t=e.target;t.removeEventListener("dispose",W),function(e){var t=i.get(e);if(void 0===t.__webglInit)return;var n=e.source,r=m.get(n);if(r){var a=r[t.__cacheKey];a.usedTimes--,0===a.usedTimes&&R(e),0===Object.keys(r).length&&m.delete(n)}i.remove(e)}(t),t.isVideoTexture&&p.delete(t)}function x(t){var n=t.target;n.removeEventListener("dispose",x),function(t){var n=t.texture,r=i.get(t),a=i.get(n);void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(r.__webglFramebuffer[s]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[s]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(var g=0;g<r.__webglColorRenderbuffer.length;g++)r.__webglColorRenderbuffer[g]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[g]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(var l=0,u=n.length;l<u;l++){var c=i.get(n[l]);c.__webglTexture&&(e.deleteTexture(c.__webglTexture),o.memory.textures--),i.remove(n[l])}i.remove(n),i.remove(t)}(n)}function R(t){var n=i.get(t);e.deleteTexture(n.__webglTexture);var r=t.source;delete m.get(r)[n.__cacheKey],o.memory.textures--}var V=0;function k(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){var a=e.image;if(null===a)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==a.complete)return void M(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}var X=(Eo(s={},Ty,10497),Eo(s,Ey,33071),Eo(s,Jy,33648),s),Y=(Eo(g={},Dy,9728),Eo(g,Uy,9984),Eo(g,Qy,9986),Eo(g,jy,9729),Eo(g,qy,9985),Eo(g,eG,9987),g);function H(n,a,o){if(o?(e.texParameteri(n,10242,X[a.wrapS]),e.texParameteri(n,10243,X[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,X[a.wrapR]),e.texParameteri(n,10240,Y[a.magFilter]),e.texParameteri(n,10241,Y[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===Ey&&a.wrapT===Ey||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,S(a.magFilter)),e.texParameteri(n,10241,S(a.minFilter)),a.minFilter!==Dy&&a.minFilter!==jy&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(a.type===gG&&!1===t.has("OES_texture_float_linear"))return;if(!1===u&&a.type===lG&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function F(t,n){var i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",W));var r=n.source,a=m.get(r);void 0===a&&(a={},m.set(r,a));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,i=!0),a[s].usedTimes++;var g=a[t.__cacheKey];void 0!==g&&(a[t.__cacheKey].usedTimes--,0===g.usedTimes&&R(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return i}function M(t,i,r){var o=3553;i.isDataArrayTexture&&(o=35866),i.isData3DTexture&&(o=32879);var s=F(t,i),g=i.source;if(n.activeTexture(33984+r),n.bindTexture(o,t.__webglTexture),g.version!==g.__currentVersion||!0===s){e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);var l,c=function(e){return!u&&(e.wrapS!==Ey||e.wrapT!==Ey||e.minFilter!==Dy&&e.minFilter!==jy)}(i)&&!1===y(i.image),I=b(i.image,c,!1,C),d=y(I=T(i,I))||u,h=a.convert(i.format,i.encoding),A=a.convert(i.type),p=Z(i.internalFormat,h,A,i.encoding,i.isVideoTexture);H(o,i,d);var m=i.mipmaps,f=u&&!0!==i.isVideoTexture,v=void 0===g.__currentVersion||!0===s,S=w(i,I,d);if(i.isDepthTexture)p=6402,u?p=i.type===gG?36012:i.type===sG?33190:i.type===IG?35056:33189:i.type===gG&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===mG&&6402===p&&i.type!==aG&&i.type!==sG&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=sG,A=a.convert(i.type)),i.format===fG&&6402===p&&(p=34041,i.type!==IG&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=IG,A=a.convert(i.type))),v&&(f?n.texStorage2D(3553,1,p,I.width,I.height):n.texImage2D(3553,0,p,I.width,I.height,0,h,A,null));else if(i.isDataTexture)if(m.length>0&&d){f&&v&&n.texStorage2D(3553,S,p,m[0].width,m[0].height);for(var W=0,x=m.length;W<x;W++)l=m[W],f?n.texSubImage2D(3553,W,0,0,l.width,l.height,h,A,l.data):n.texImage2D(3553,W,p,l.width,l.height,0,h,A,l.data);i.generateMipmaps=!1}else f?(v&&n.texStorage2D(3553,S,p,I.width,I.height),n.texSubImage2D(3553,0,0,0,I.width,I.height,h,A,I.data)):n.texImage2D(3553,0,p,I.width,I.height,0,h,A,I.data);else if(i.isCompressedTexture){f&&v&&n.texStorage2D(3553,S,p,m[0].width,m[0].height);for(var R=0,V=m.length;R<V;R++)l=m[R],i.format!==hG?null!==h?f?n.compressedTexSubImage2D(3553,R,0,0,l.width,l.height,h,l.data):n.compressedTexImage2D(3553,R,p,l.width,l.height,0,l.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):f?n.texSubImage2D(3553,R,0,0,l.width,l.height,h,A,l.data):n.texImage2D(3553,R,p,l.width,l.height,0,h,A,l.data)}else if(i.isDataArrayTexture)f?(v&&n.texStorage3D(35866,S,p,I.width,I.height,I.depth),n.texSubImage3D(35866,0,0,0,0,I.width,I.height,I.depth,h,A,I.data)):n.texImage3D(35866,0,p,I.width,I.height,I.depth,0,h,A,I.data);else if(i.isData3DTexture)f?(v&&n.texStorage3D(32879,S,p,I.width,I.height,I.depth),n.texSubImage3D(32879,0,0,0,0,I.width,I.height,I.depth,h,A,I.data)):n.texImage3D(32879,0,p,I.width,I.height,I.depth,0,h,A,I.data);else if(i.isFramebufferTexture){if(v)if(f)n.texStorage2D(3553,S,p,I.width,I.height);else for(var k=I.width,X=I.height,Y=0;Y<S;Y++)n.texImage2D(3553,Y,p,k,X,0,h,A,null),k>>=1,X>>=1}else if(m.length>0&&d){f&&v&&n.texStorage2D(3553,S,p,m[0].width,m[0].height);for(var M=0,K=m.length;M<K;M++)l=m[M],f?n.texSubImage2D(3553,M,0,0,h,A,l):n.texImage2D(3553,M,p,h,A,l);i.generateMipmaps=!1}else f?(v&&n.texStorage2D(3553,S,p,I.width,I.height),n.texSubImage2D(3553,0,0,0,h,A,I)):n.texImage2D(3553,0,p,h,A,I);G(i,d)&&B(o),g.__currentVersion=g.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function K(t,r,o,s,g){var l=a.convert(o.format,o.encoding),u=a.convert(o.type),c=Z(o.internalFormat,l,u,o.encoding);i.get(r).__hasExternalTextures||(32879===g||35866===g?n.texImage3D(g,0,c,r.width,r.height,r.depth,0,l,u,null):n.texImage2D(g,0,c,r.width,r.height,0,l,u,null)),n.bindFramebuffer(36160,t),_(r)?h.framebufferTexture2DMultisampleEXT(36160,s,g,i.get(o).__webglTexture,0,L(r)):e.framebufferTexture2D(36160,s,g,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function N(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var r=33189;if(i||_(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===gG?r=36012:o.type===sG&&(r=33190));var s=L(n);_(n)?h.renderbufferStorageMultisampleEXT(36161,s,r,n.width,n.height):e.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){var g=L(n);i&&!1===_(n)?e.renderbufferStorageMultisample(36161,g,35056,n.width,n.height):_(n)?h.renderbufferStorageMultisampleEXT(36161,g,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else for(var l=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture],u=0;u<l.length;u++){var c=l[u],I=a.convert(c.format,c.encoding),C=a.convert(c.type),d=Z(c.internalFormat,I,C,c.encoding),A=L(n);i&&!1===_(n)?e.renderbufferStorageMultisample(36161,A,d,n.width,n.height):_(n)?h.renderbufferStorageMultisampleEXT(36161,A,d,n.width,n.height):e.renderbufferStorage(36161,d,n.width,n.height)}e.bindRenderbuffer(36161,null)}function z(t){var r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),k(r.depthTexture,0);var a=i.get(r.depthTexture).__webglTexture,o=L(r);if(r.depthTexture.format===mG)_(r)?h.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,o):e.framebufferTexture2D(36160,36096,3553,a,0);else{if(r.depthTexture.format!==fG)throw new Error("Unknown depthTexture format");_(r)?h.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,o):e.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),N(r.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),N(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function L(e){return Math.min(d,e.samples)}function _(e){var n=i.get(e);return u&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function T(e,n){var i=e.encoding,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===UB||i!==cB&&(i===IB?!1===u?!0===t.has("EXT_sRGB")&&r===hG?(e.format=UB,e.minFilter=jy,e.generateMipmaps=!1):n=ZZ.sRGBToLinear(n):r===hG&&a===nG||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=function(){var e=V;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),V+=1,e},this.resetTextureUnits=function(){V=0},this.setTexture2D=k,this.setTexture2DArray=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?M(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?M(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(t,r){var o=i.get(t);t.version>0&&o.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;var o=F(t,i),s=i.source;if(n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),s.version!==s.__currentVersion||!0===o){e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);for(var g=i.isCompressedTexture||i.image[0].isCompressedTexture,l=i.image[0]&&i.image[0].isDataTexture,c=[],C=0;C<6;C++)c[C]=g||l?l?i.image[C].image:i.image[C]:b(i.image[C],!1,!0,I),c[C]=T(i,c[C]);var d,h=c[0],A=y(h)||u,p=a.convert(i.format,i.encoding),m=a.convert(i.type),f=Z(i.internalFormat,p,m,i.encoding),v=u&&!0!==i.isVideoTexture,S=void 0===s.__currentVersion||!0===o,W=w(i,h,A);if(H(34067,i,A),g){v&&S&&n.texStorage2D(34067,W,f,h.width,h.height);for(var x=0;x<6;x++){d=c[x].mipmaps;for(var R=0;R<d.length;R++){var V=d[R];i.format!==hG?null!==p?v?n.compressedTexSubImage2D(34069+x,R,0,0,V.width,V.height,p,V.data):n.compressedTexImage2D(34069+x,R,f,V.width,V.height,0,V.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):v?n.texSubImage2D(34069+x,R,0,0,V.width,V.height,p,m,V.data):n.texImage2D(34069+x,R,f,V.width,V.height,0,p,m,V.data)}}}else{d=i.mipmaps,v&&S&&(d.length>0&&W++,n.texStorage2D(34067,W,f,c[0].width,c[0].height));for(var k=0;k<6;k++)if(l){v?n.texSubImage2D(34069+k,0,0,0,c[k].width,c[k].height,p,m,c[k].data):n.texImage2D(34069+k,0,f,c[k].width,c[k].height,0,p,m,c[k].data);for(var X=0;X<d.length;X++){var Y=d[X].image[k].image;v?n.texSubImage2D(34069+k,X+1,0,0,Y.width,Y.height,p,m,Y.data):n.texImage2D(34069+k,X+1,f,Y.width,Y.height,0,p,m,Y.data)}}else{v?n.texSubImage2D(34069+k,0,0,0,p,m,c[k]):n.texImage2D(34069+k,0,f,p,m,c[k]);for(var M=0;M<d.length;M++){var K=d[M];v?n.texSubImage2D(34069+k,M+1,0,0,p,m,K.image[k]):n.texImage2D(34069+k,M+1,f,p,m,K.image[k])}}}G(i,A)&&B(34067),s.__currentVersion=s.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(o,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(e,t,n){var r=i.get(e);void 0!==t&&K(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&z(e)},this.setupRenderTarget=function(t){var s=t.texture,g=i.get(t),l=i.get(s);t.addEventListener("dispose",x),!0!==t.isWebGLMultipleRenderTargets&&(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=s.version,o.memory.textures++);var c=!0===t.isWebGLCubeRenderTarget,I=!0===t.isWebGLMultipleRenderTargets,C=y(t)||u;if(c){g.__webglFramebuffer=[];for(var d=0;d<6;d++)g.__webglFramebuffer[d]=e.createFramebuffer()}else{if(g.__webglFramebuffer=e.createFramebuffer(),I)if(r.drawBuffers)for(var h=t.texture,A=0,p=h.length;A<p;A++){var m=i.get(h[A]);void 0===m.__webglTexture&&(m.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(u&&t.samples>0&&!1===_(t)){var f=I?s:[s];g.__webglMultisampledFramebuffer=e.createFramebuffer(),g.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,g.__webglMultisampledFramebuffer);for(var v=0;v<f.length;v++){var b=f[v];g.__webglColorRenderbuffer[v]=e.createRenderbuffer(),e.bindRenderbuffer(36161,g.__webglColorRenderbuffer[v]);var w=a.convert(b.format,b.encoding),S=a.convert(b.type),W=Z(b.internalFormat,w,S,b.encoding),R=L(t);e.renderbufferStorageMultisample(36161,R,W,t.width,t.height),e.framebufferRenderbuffer(36160,36064+v,36161,g.__webglColorRenderbuffer[v])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(g.__webglDepthRenderbuffer=e.createRenderbuffer(),N(g.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(c){n.bindTexture(34067,l.__webglTexture),H(34067,s,C);for(var V=0;V<6;V++)K(g.__webglFramebuffer[V],t,s,36064,34069+V);G(s,C)&&B(34067),n.unbindTexture()}else if(I){for(var k=t.texture,X=0,Y=k.length;X<Y;X++){var F=k[X],M=i.get(F);n.bindTexture(3553,M.__webglTexture),H(3553,F,C),K(g.__webglFramebuffer,t,F,36064+X,3553),G(F,C)&&B(3553)}n.unbindTexture()}else{var T=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(u?T=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(T,l.__webglTexture),H(T,s,C),K(g.__webglFramebuffer,t,s,36064,T),G(s,C)&&B(T),n.unbindTexture()}t.depthBuffer&&z(t)},this.updateRenderTargetMipmap=function(e){for(var t=y(e)||u,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,o=r.length;a<o;a++){var s=r[a];if(G(s,t)){var g=e.isWebGLCubeRenderTarget?34067:3553,l=i.get(s).__webglTexture;n.bindTexture(g,l),B(g),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(u&&t.samples>0&&!1===_(t)){var r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,o=t.height,s=16384,g=[],l=t.stencilBuffer?33306:36096,c=i.get(t),I=!0===t.isWebGLMultipleRenderTargets;if(I)for(var C=0;C<r.length;C++)n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+C,36161,null),n.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+C,3553,null,0);n.bindFramebuffer(36008,c.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,c.__webglFramebuffer);for(var d=0;d<r.length;d++){g.push(36064+d),t.depthBuffer&&g.push(l);var h=void 0!==c.__ignoreDepthValues&&c.__ignoreDepthValues;if(!1===h&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),I&&e.framebufferRenderbuffer(36008,36064,36161,c.__webglColorRenderbuffer[d]),!0===h&&(e.invalidateFramebuffer(36008,[l]),e.invalidateFramebuffer(36009,[l])),I){var p=i.get(r[d]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,p,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728),A&&e.invalidateFramebuffer(36008,g)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),I)for(var m=0;m<r.length;m++){n.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+m,36161,c.__webglColorRenderbuffer[m]);var f=i.get(r[m]).__webglTexture;n.bindFramebuffer(36160,c.__webglFramebuffer),e.framebufferTexture2D(36009,36064+m,3553,f,0)}n.bindFramebuffer(36009,c.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=z,this.setupFrameBufferTexture=K,this.useMultisampledRTT=_}function xR(e,t,n){var i=n.isWebGL2;return{convert:function(n){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n===nG)return 5121;if(n===uG)return 32819;if(n===cG)return 32820;if(n===iG)return 5120;if(n===rG)return 5122;if(n===aG)return 5123;if(n===oG)return 5124;if(n===sG)return 5125;if(n===gG)return 5126;if(n===lG)return i?5131:null!==(r=t.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(n===CG)return 6406;if(n===hG)return 6408;if(n===AG)return 6409;if(n===pG)return 6410;if(n===mG)return 6402;if(n===fG)return 34041;if(n===vG)return 6403;if(n===dG)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(n===UB)return null!==(r=t.get("EXT_sRGB"))?r.SRGB_ALPHA_EXT:null;if(n===bG)return 36244;if(n===yG)return 33319;if(n===GG)return 33320;if(n===BG)return 36249;if(n===ZG||n===wG||n===SG||n===WG)if(a===IB){if(null===(r=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===ZG)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===wG)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===SG)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===WG)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(r=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===ZG)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===wG)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===SG)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===WG)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===xG||n===RG||n===VG||n===kG){if(null===(r=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===xG)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===RG)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===VG)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===kG)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===XG)return null!==(r=t.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===YG||n===HG){if(null===(r=t.get("WEBGL_compressed_texture_etc")))return null;if(n===YG)return a===IB?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(n===HG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(n===FG||n===MG||n===KG||n===NG||n===zG||n===LG||n===_G||n===TG||n===EG||n===JG||n===DG||n===UG||n===PG||n===QG){if(null===(r=t.get("WEBGL_compressed_texture_astc")))return null;if(n===FG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===MG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===KG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===NG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===zG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===LG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===_G)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===TG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===EG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===JG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===DG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===UG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===PG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===QG)return a===IB?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===OG){if(null===(r=t.get("EXT_texture_compression_bptc")))return null;if(n===OG)return a===IB?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===IG?i?34042:null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[n]?e[n]:null}}}var RR=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return di(this,n),(e=t.call(this)).isArrayCamera=!0,e.cameras=i,e}return Ai(n)}(US),VR=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).isGroup=!0,e.type="Group",e}return Ai(n)}(zw),kR={type:"move"},XR=function(){function e(){di(this,e),this._targetRay=null,this._grip=null,this._hand=null}return Ai(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new VR,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new VR,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new KZ,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new KZ),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new VR,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new KZ,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new KZ),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var i=null,r=null,a=null,o=this._targetRay,s=this._grip,g=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(g&&e.hand){a=!0;var l,u=Cr(e.hand.values());try{for(u.s();!(l=u.n()).done;){var c=l.value,I=t.getJointPose(c,n);if(void 0===g.joints[c.jointName]){var C=new VR;C.matrixAutoUpdate=!1,C.visible=!1,g.joints[c.jointName]=C,g.add(C)}var d=g.joints[c.jointName];null!==I&&(d.matrix.fromArray(I.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.jointRadius=I.radius),d.visible=null!==I}}catch(m){u.e(m)}finally{u.f()}var h=g.joints["index-finger-tip"],A=g.joints["thumb-tip"],p=h.position.distanceTo(A.position);g.inputState.pinching&&p>.025?(g.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!g.inputState.pinching&&p<=.015&&(g.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(r=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&(null===(i=t.getPose(e.targetRaySpace,n))&&null!==r&&(i=r),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(kR)))}return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==g&&(g.visible=null!==a),this}}]),e}(),YR=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a,o,s,g,l,u,c){var I;if(di(this,n),(c=void 0!==c?c:mG)!==mG&&c!==fG)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&c===mG&&(r=sG),void 0===r&&c===fG&&(r=IG),(I=t.call(this,null,a,o,s,g,l,c,r,u)).isDepthTexture=!0,I.image={width:e,height:i},I.magFilter=void 0!==g?g:Dy,I.minFilter=void 0!==l?l:Dy,I.flipY=!1,I.generateMipmaps=!1,I}return Ai(n)}(xZ),HR=function(e){Li(n,e);var t=Di(n);function n(e,i){var r;di(this,n);var a=Ni(r=t.call(this)),o=null,s=1,g=null,l="local-floor",u=null,c=null,I=null,C=null,d=null,h=null,A=i.getContextAttributes(),p=null,m=null,f=[],v=[],b=new US;b.layers.enable(1),b.viewport=new RZ;var y=new US;y.layers.enable(2),y.viewport=new RZ;var G=[b,y],B=new RR;B.layers.enable(1),B.layers.enable(2);var Z=null,w=null;function S(e){var t=v.indexOf(e.inputSource);if(-1!==t){var n=f[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}}function W(){o.removeEventListener("select",S),o.removeEventListener("selectstart",S),o.removeEventListener("selectend",S),o.removeEventListener("squeeze",S),o.removeEventListener("squeezestart",S),o.removeEventListener("squeezeend",S),o.removeEventListener("end",W),o.removeEventListener("inputsourceschange",x);for(var t=0;t<f.length;t++){var n=v[t];null!==n&&(v[t]=null,f[t].disconnect(n))}Z=null,w=null,e.setRenderTarget(p),d=null,C=null,I=null,o=null,m=null,Y.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function x(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],i=v.indexOf(n);i>=0&&(v[i]=null,f[i].dispatchEvent({type:"disconnected",data:n}))}for(var r=0;r<e.added.length;r++){var a=e.added[r],o=v.indexOf(a);if(-1===o){for(var s=0;s<f.length;s++){if(s>=v.length){v.push(a),o=s;break}if(null===v[s]){v[s]=a,o=s;break}}if(-1===o)break}var g=f[o];g&&g.dispatchEvent({type:"connected",data:a})}}r.cameraAutoUpdate=!0,r.enabled=!1,r.isPresenting=!1,r.getController=function(e){var t=f[e];return void 0===t&&(t=new XR,f[e]=t),t.getTargetRaySpace()},r.getControllerGrip=function(e){var t=f[e];return void 0===t&&(t=new XR,f[e]=t),t.getGripSpace()},r.getHand=function(e){var t=f[e];return void 0===t&&(t=new XR,f[e]=t),t.getHandSpace()},r.setFramebufferScaleFactor=function(e){s=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},r.setReferenceSpaceType=function(e){l=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},r.getReferenceSpace=function(){return u||g},r.setReferenceSpace=function(e){u=e},r.getBaseLayer=function(){return null!==C?C:d},r.getBinding=function(){return I},r.getFrame=function(){return h},r.getSession=function(){return o},r.setSession=function(){var t=Yb(Hb().mark((function t(n){var r,c,h,f,v;return Hb().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(o=n)){t.next=25;break}if(p=e.getRenderTarget(),o.addEventListener("select",S),o.addEventListener("selectstart",S),o.addEventListener("selectend",S),o.addEventListener("squeeze",S),o.addEventListener("squeezestart",S),o.addEventListener("squeezeend",S),o.addEventListener("end",W),o.addEventListener("inputsourceschange",x),!0===A.xrCompatible){t.next=14;break}return t.next=14,i.makeXRCompatible();case 14:return void 0===o.renderState.layers||!1===e.capabilities.isWebGL2?(r={antialias:void 0!==o.renderState.layers||A.antialias,alpha:A.alpha,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:s},d=new XRWebGLLayer(o,i,r),o.updateRenderState({baseLayer:d}),m=new VZ(d.framebufferWidth,d.framebufferHeight,{format:hG,type:nG,encoding:e.outputEncoding})):(c=null,h=null,f=null,A.depth&&(f=A.stencil?35056:33190,c=A.stencil?fG:mG,h=A.stencil?IG:sG),v={colorFormat:32856,depthFormat:f,scaleFactor:s},I=new XRWebGLBinding(o,i),C=I.createProjectionLayer(v),o.updateRenderState({layers:[C]}),m=new VZ(C.textureWidth,C.textureHeight,{format:hG,type:nG,depthTexture:new YR(C.textureWidth,C.textureHeight,h,void 0,void 0,void 0,void 0,void 0,void 0,c),stencilBuffer:A.stencil,encoding:e.outputEncoding,samples:A.antialias?4:0}),e.properties.get(m).__ignoreDepthValues=C.ignoreDepthValues),m.isXRRenderTarget=!0,this.setFoveation(1),u=null,t.next=20,o.requestReferenceSpace(l);case 20:g=t.sent,Y.setContext(o),Y.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"});case 25:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}();var R=new KZ,V=new KZ;function k(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}r.updateCamera=function(e){if(null!==o){B.near=y.near=b.near=e.near,B.far=y.far=b.far=e.far,Z===B.near&&w===B.far||(o.updateRenderState({depthNear:B.near,depthFar:B.far}),Z=B.near,w=B.far);var t=e.parent,n=B.cameras;k(B,t);for(var i=0;i<n.length;i++)k(n[i],t);B.matrixWorld.decompose(B.position,B.quaternion,B.scale),e.position.copy(B.position),e.quaternion.copy(B.quaternion),e.scale.copy(B.scale),e.matrix.copy(B.matrix),e.matrixWorld.copy(B.matrixWorld);for(var r=e.children,a=0,s=r.length;a<s;a++)r[a].updateMatrixWorld(!0);2===n.length?function(e,t,n){R.setFromMatrixPosition(t.matrixWorld),V.setFromMatrixPosition(n.matrixWorld);var i=R.distanceTo(V),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),g=(r[9]+1)/r[5],l=(r[9]-1)/r[5],u=(r[8]-1)/r[0],c=(a[8]+1)/a[0],I=o*u,C=o*c,d=i/(-u+c),h=d*-u;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(h),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var A=o+d,p=s+d,m=I-h,f=C+(i-h),v=g*s/p*A,b=l*s/p*A;e.projectionMatrix.makePerspective(m,f,v,b,A,p)}(B,b,y):B.projectionMatrix.copy(b.projectionMatrix)}},r.getCamera=function(){return B},r.getFoveation=function(){return null!==C?C.fixedFoveation:null!==d?d.fixedFoveation:void 0},r.setFoveation=function(e){null!==C&&(C.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};var X=null;var Y=new aW;return Y.setAnimationLoop((function(t,n){if(c=n.getViewerPose(u||g),h=n,null!==c){var i=c.views;null!==d&&(e.setRenderTargetFramebuffer(m,d.framebuffer),e.setRenderTarget(m));var r=!1;i.length!==B.cameras.length&&(B.cameras.length=0,r=!0);for(var a=0;a<i.length;a++){var o=i[a],s=null;if(null!==d)s=d.getViewport(o);else{var l=I.getViewSubImage(C,o);s=l.viewport,0===a&&(e.setRenderTargetTextures(m,l.colorTexture,C.ignoreDepthValues?void 0:l.depthStencilTexture),e.setRenderTarget(m))}var A=G[a];void 0===A&&((A=new US).layers.enable(a),A.viewport=new RZ,G[a]=A),A.matrix.fromArray(o.transform.matrix),A.projectionMatrix.fromArray(o.projectionMatrix),A.viewport.set(s.x,s.y,s.width,s.height),0===a&&B.matrix.copy(A.matrix),!0===r&&B.cameras.push(A)}}for(var p=0;p<f.length;p++){var b=v[p],y=f[p];null!==b&&void 0!==y&&y.update(b,n,u||g)}X&&X(t,n),h=null})),r.setAnimationLoop=function(e){X=e},r.dispose=function(){},r}return Ai(n)}(PB);function FR(e,t){function n(n,i){n.opacity.value=i.opacity,i.color&&n.diffuse.value.copy(i.color),i.emissive&&n.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(n.map.value=i.map),i.alphaMap&&(n.alphaMap.value=i.alphaMap),i.bumpMap&&(n.bumpMap.value=i.bumpMap,n.bumpScale.value=i.bumpScale,i.side===Pb&&(n.bumpScale.value*=-1)),i.displacementMap&&(n.displacementMap.value=i.displacementMap,n.displacementScale.value=i.displacementScale,n.displacementBias.value=i.displacementBias),i.emissiveMap&&(n.emissiveMap.value=i.emissiveMap),i.normalMap&&(n.normalMap.value=i.normalMap,n.normalScale.value.copy(i.normalScale),i.side===Pb&&n.normalScale.value.negate()),i.specularMap&&(n.specularMap.value=i.specularMap),i.alphaTest>0&&(n.alphaTest.value=i.alphaTest);var r,a,o=t.get(i).envMap;if(o&&(n.envMap.value=o,n.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,n.reflectivity.value=i.reflectivity,n.ior.value=i.ior,n.refractionRatio.value=i.refractionRatio),i.lightMap){n.lightMap.value=i.lightMap;var s=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=i.lightMapIntensity*s}i.aoMap&&(n.aoMap.value=i.aoMap,n.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap?r=i.clearcoatRoughnessMap:i.iridescenceMap?r=i.iridescenceMap:i.iridescenceThicknessMap?r=i.iridescenceThicknessMap:i.specularIntensityMap?r=i.specularIntensityMap:i.specularColorMap?r=i.specularColorMap:i.transmissionMap?r=i.transmissionMap:i.thicknessMap?r=i.thicknessMap:i.sheenColorMap?r=i.sheenColorMap:i.sheenRoughnessMap&&(r=i.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),n.uvTransform.value.copy(r.matrix)),i.aoMap?a=i.aoMap:i.lightMap&&(a=i.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,a,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?n(e,i):i.isMeshToonMaterial?(n(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(n(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(n(e,i),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===Pb&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,o)):i.isMeshMatcapMaterial?(n(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?n(e,i):i.isMeshDistanceMaterial?(n(e,i),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?n(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var r;t.map?r=t.map:t.alphaMap&&(r=t.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,a):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function MR(){var e=IZ("canvas");return e.style.display="block",e}function KR(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;var t,n=void 0!==e.canvas?e.canvas:MR(),i=void 0!==e.context?e.context:null,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,g=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==i?i.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;var c=null,I=null,C=[],d=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=cB,this.physicallyCorrectLights=!1,this.toneMapping=Vy,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});var h=this,A=!1,p=0,m=0,f=null,v=-1,b=null,y=new RZ,G=new RZ,B=null,Z=n.width,w=n.height,S=1,W=null,x=null,R=new RZ(0,0,Z,w),V=new RZ(0,0,Z,w),k=!1,X=new rW,Y=!1,H=!1,F=null,M=new hw,K=new sZ,N=new KZ,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function L(){return null===f?S:1}var _,T,E,J,D,U,P,Q,O,j,q,$,ee,te,ne,ie,re,ae,oe,se,ge,le,ue,ce=i;function Ie(e,t){for(var i=0;i<e.length;i++){var r=e[i],a=n.getContext(r,t);if(null!==a)return a}return null}try{var Ce={alpha:!0,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:g,powerPreference:l,failIfMajorPerformanceCaveat:u};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r".concat(Fb)),n.addEventListener("webglcontextlost",pe,!1),n.addEventListener("webglcontextrestored",me,!1),n.addEventListener("webglcontextcreationerror",fe,!1),null===ce){var de=["webgl2","webgl","experimental-webgl"];if(!0===h.isWebGL1Renderer&&de.shift(),null===(ce=Ie(de,Ce)))throw Ie(de)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ce.getShaderPrecisionFormat&&(ce.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ke){throw console.error("THREE.WebGLRenderer: "+Ke.message),Ke}function he(){_=new kW(ce),T=new dW(ce,_,e),_.init(T),le=new xR(ce,_,T),E=new SR(ce,_,T),J=new HW,D=new CR,U=new WR(ce,_,E,D,T,le,J),P=new AW(h),Q=new VW(h),O=new oW(ce,T),ue=new IW(ce,_,O,T),j=new XW(ce,O,J,ue),q=new zW(ce,j,O,J),oe=new NW(ce,T,U),ie=new hW(D),$=new IR(h,P,Q,_,T,ue,ie),ee=new FR(h,D),te=new pR,ne=new GR(_,T),ae=new cW(h,P,E,q,t,s),re=new wR(h,q,T),se=new CW(ce,_,J,T),ge=new YW(ce,_,J,T),J.programs=$.programs,h.capabilities=T,h.extensions=_,h.properties=D,h.renderLists=te,h.shadowMap=re,h.state=E,h.info=J}he();var Ae=new HR(h,ce);function pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function me(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;var e=J.autoReset,t=re.enabled,n=re.autoUpdate,i=re.needsUpdate,r=re.type;he(),J.autoReset=e,re.enabled=t,re.autoUpdate=n,re.needsUpdate=i,re.type=r}function fe(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function ve(e){var t=e.target;t.removeEventListener("dispose",ve),be(t)}function be(e){ye(e),D.remove(e)}function ye(e){var t=D.get(e).programs;void 0!==t&&(t.forEach((function(e){$.releaseProgram(e)})),e.isShaderMaterial&&$.releaseShaderCache(e))}this.xr=Ae,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){var e=_.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=_.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return S},this.setPixelRatio=function(e){void 0!==e&&(S=e,this.setSize(Z,w,!1))},this.getSize=function(e){return e.set(Z,w)},this.setSize=function(e,t,i){Ae.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(Z=e,w=t,n.width=Math.floor(e*S),n.height=Math.floor(t*S),!1!==i&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(Z*S,w*S).floor()},this.setDrawingBufferSize=function(e,t,i){Z=e,w=t,S=i,n.width=Math.floor(e*i),n.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(y)},this.getViewport=function(e){return e.copy(R)},this.setViewport=function(e,t,n,i){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,i),E.viewport(y.copy(R).multiplyScalar(S).floor())},this.getScissor=function(e){return e.copy(V)},this.setScissor=function(e,t,n,i){e.isVector4?V.set(e.x,e.y,e.z,e.w):V.set(e,t,n,i),E.scissor(G.copy(V).multiplyScalar(S).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(e){E.setScissorTest(k=e)},this.setOpaqueSort=function(e){W=e},this.setTransparentSort=function(e){x=e},this.getClearColor=function(e){return e.copy(ae.getClearColor())},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=0;e&&(i|=16384),t&&(i|=256),n&&(i|=1024),ce.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",pe,!1),n.removeEventListener("webglcontextrestored",me,!1),n.removeEventListener("webglcontextcreationerror",fe,!1),te.dispose(),ne.dispose(),D.dispose(),P.dispose(),Q.dispose(),q.dispose(),ue.dispose(),$.dispose(),Ae.dispose(),Ae.removeEventListener("sessionstart",Ze),Ae.removeEventListener("sessionend",we),F&&(F.dispose(),F=null),Se.stop()},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=z);var o=r.isMesh&&r.matrixWorld.determinant()<0,s=He(e,t,n,i,r);E.setMaterial(i,o);var g=n.index,l=n.attributes.position;if(null===g){if(void 0===l||0===l.count)return}else if(0===g.count)return;var u,c=1;!0===i.wireframe&&(g=j.getWireframeAttribute(n),c=2),ue.setup(r,i,s,n,g);var I=se;null!==g&&(u=O.get(g),(I=ge).setIndex(u));var C=null!==g?g.count:l.count,d=n.drawRange.start*c,h=n.drawRange.count*c,A=null!==a?a.start*c:0,p=null!==a?a.count*c:1/0,m=Math.max(d,A),f=Math.min(C,d+h,A+p)-1,v=Math.max(0,f-m+1);if(0!==v){if(r.isMesh)!0===i.wireframe?(E.setLineWidth(i.wireframeLinewidth*L()),I.setMode(1)):I.setMode(4);else if(r.isLine){var b=i.linewidth;void 0===b&&(b=1),E.setLineWidth(b*L()),r.isLineSegments?I.setMode(1):r.isLineLoop?I.setMode(2):I.setMode(3)}else r.isPoints?I.setMode(0):r.isSprite&&I.setMode(4);if(r.isInstancedMesh)I.renderInstances(m,v,r.count);else if(n.isInstancedBufferGeometry){var y=Math.min(n.instanceCount,n._maxInstanceCount);I.renderInstances(m,v,y)}else I.render(m,v)}},this.compile=function(e,t){(I=ne.get(e)).init(),d.push(I),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(I.pushLight(e),e.castShadow&&I.pushShadow(e))})),I.setupLights(h.physicallyCorrectLights),e.traverse((function(t){var n=t.material;if(n)if(Array.isArray(n))for(var i=0;i<n.length;i++){Xe(n[i],e,t)}else Xe(n,e,t)})),d.pop(),I=null};var Ge=null;function Be(e){Ge&&Ge(e)}function Ze(){Se.stop()}function we(){Se.start()}var Se=new aW;function We(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)I.pushLight(e),e.castShadow&&I.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||X.intersectsSprite(e)){i&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(M);var r=q.update(e),a=e.material;a.visible&&c.push(e,r,a,n,N.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==J.render.frame&&(e.skeleton.update(),e.skeleton.frame=J.render.frame),!e.frustumCulled||X.intersectsObject(e))){i&&N.setFromMatrixPosition(e.matrixWorld).applyMatrix4(M);var o=q.update(e),s=e.material;if(Array.isArray(s))for(var g=o.groups,l=0,u=g.length;l<u;l++){var C=g[l],d=s[C.materialIndex];d&&d.visible&&c.push(e,o,d,n,N.z,C)}else s.visible&&c.push(e,o,s,n,N.z,null)}for(var h=e.children,A=0,p=h.length;A<p;A++)We(h[A],t,n,i)}}function xe(e,t,n,i){var r=e.opaque,a=e.transmissive,o=e.transparent;I.setupLightsView(n),a.length>0&&Re(r,t,n),i&&E.viewport(y.copy(i)),r.length>0&&Ve(r,t,n),a.length>0&&Ve(a,t,n),o.length>0&&Ve(o,t,n),E.buffers.depth.setTest(!0),E.buffers.depth.setMask(!0),E.buffers.color.setMask(!0),E.setPolygonOffset(!1)}function Re(e,t,n){var i=T.isWebGL2;null===F&&(F=new VZ(1,1,{generateMipmaps:!0,type:_.has("EXT_color_buffer_half_float")?lG:nG,minFilter:eG,samples:i&&!0===o?4:0})),h.getDrawingBufferSize(K),i?F.setSize(K.x,K.y):F.setSize(aZ(K.x),aZ(K.y));var r=h.getRenderTarget();h.setRenderTarget(F),h.clear();var a=h.toneMapping;h.toneMapping=Vy,Ve(e,t,n),h.toneMapping=a,U.updateMultisampleRenderTarget(F),U.updateRenderTargetMipmap(F),h.setRenderTarget(r)}function Ve(e,t,n){for(var i=!0===t.isScene?t.overrideMaterial:null,r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,g=o.geometry,l=null===i?o.material:i,u=o.group;s.layers.test(n.layers)&&ke(s,t,n,g,l,u)}}function ke(e,t,n,i,r,a){e.onBeforeRender(h,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(h,t,n,i,e,a),!0===r.transparent&&r.side===Qb?(r.side=Pb,r.needsUpdate=!0,h.renderBufferDirect(n,t,i,r,e,a),r.side=Ub,r.needsUpdate=!0,h.renderBufferDirect(n,t,i,r,e,a),r.side=Qb):h.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(h,t,n,i,r,a)}function Xe(e,t,n){!0!==t.isScene&&(t=z);var i=D.get(e),r=I.state.lights,a=I.state.shadowsArray,o=r.state.version,s=$.getParameters(e,r.state,a,t,n),g=$.getProgramCacheKey(s),l=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?Q:P).get(e.envMap||i.environment),void 0===l&&(e.addEventListener("dispose",ve),l=new Map,i.programs=l);var u=l.get(g);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Ye(e,s),u}else s.uniforms=$.getUniforms(e),e.onBuild(n,s,h),e.onBeforeCompile(s,h),u=$.acquireProgram(s,g),l.set(g,u),i.uniforms=s.uniforms;var c=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(c.clippingPlanes=ie.uniform),Ye(e,s),i.needsLights=Me(e),i.lightsStateVersion=o,i.needsLights&&(c.ambientLightColor.value=r.state.ambient,c.lightProbe.value=r.state.probe,c.directionalLights.value=r.state.directional,c.directionalLightShadows.value=r.state.directionalShadow,c.spotLights.value=r.state.spot,c.spotLightShadows.value=r.state.spotShadow,c.rectAreaLights.value=r.state.rectArea,c.ltc_1.value=r.state.rectAreaLTC1,c.ltc_2.value=r.state.rectAreaLTC2,c.pointLights.value=r.state.point,c.pointLightShadows.value=r.state.pointShadow,c.hemisphereLights.value=r.state.hemi,c.directionalShadowMap.value=r.state.directionalShadowMap,c.directionalShadowMatrix.value=r.state.directionalShadowMatrix,c.spotShadowMap.value=r.state.spotShadowMap,c.spotShadowMatrix.value=r.state.spotShadowMatrix,c.pointShadowMap.value=r.state.pointShadowMap,c.pointShadowMatrix.value=r.state.pointShadowMatrix);var C=u.getUniforms(),d=Ex.seqWithValue(C.seq,c);return i.currentProgram=u,i.uniformsList=d,u}function Ye(e,t){var n=D.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}function He(e,t,n,i,r){!0!==t.isScene&&(t=z),U.resetTextureUnits();var a=t.fog,o=i.isMeshStandardMaterial?t.environment:null,s=null===f?h.outputEncoding:!0===f.isXRRenderTarget?f.texture.encoding:cB,g=(i.isMeshStandardMaterial?Q:P).get(i.envMap||o),l=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!i.normalMap&&!!n.attributes.tangent,c=!!n.morphAttributes.position,C=!!n.morphAttributes.normal,d=!!n.morphAttributes.color,A=i.toneMapped?h.toneMapping:Vy,p=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,m=void 0!==p?p.length:0,y=D.get(i),G=I.state.lights;if(!0===Y&&(!0===H||e!==b)){var B=e===b&&i.id===v;ie.setState(i,e,B)}var Z=!1;i.version===y.__version?y.needsLights&&y.lightsStateVersion!==G.state.version||y.outputEncoding!==s||r.isInstancedMesh&&!1===y.instancing?Z=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?Z=!0:r.isSkinnedMesh||!0!==y.skinning?y.envMap!==g||!0===i.fog&&y.fog!==a?Z=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===ie.numPlanes&&y.numIntersection===ie.numIntersection?(y.vertexAlphas!==l||y.vertexTangents!==u||y.morphTargets!==c||y.morphNormals!==C||y.morphColors!==d||y.toneMapping!==A||!0===T.isWebGL2&&y.morphTargetsCount!==m)&&(Z=!0):Z=!0:Z=!0:Z=!0:(Z=!0,y.__version=i.version);var W=y.currentProgram;!0===Z&&(W=Xe(i,t,r));var x=!1,R=!1,V=!1,k=W.getUniforms(),X=y.uniforms;if(E.useProgram(W.program)&&(x=!0,R=!0,V=!0),i.id!==v&&(v=i.id,R=!0),x||b!==e){if(k.setValue(ce,"projectionMatrix",e.projectionMatrix),T.logarithmicDepthBuffer&&k.setValue(ce,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),b!==e&&(b=e,R=!0,V=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){var M=k.map.cameraPosition;void 0!==M&&M.setValue(ce,N.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&k.setValue(ce,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&k.setValue(ce,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){k.setOptional(ce,r,"bindMatrix"),k.setOptional(ce,r,"bindMatrixInverse");var K=r.skeleton;K&&(T.floatVertexTextures?(null===K.boneTexture&&K.computeBoneTexture(),k.setValue(ce,"boneTexture",K.boneTexture,U),k.setValue(ce,"boneTextureSize",K.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}var L=n.morphAttributes;return(void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===T.isWebGL2)&&oe.update(r,n,i,W),(R||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,k.setValue(ce,"receiveShadow",r.receiveShadow)),R&&(k.setValue(ce,"toneMappingExposure",h.toneMappingExposure),y.needsLights&&Fe(X,V),a&&!0===i.fog&&ee.refreshFogUniforms(X,a),ee.refreshMaterialUniforms(X,i,S,w,F),Ex.upload(ce,y.uniformsList,X,U)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Ex.upload(ce,y.uniformsList,X,U),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&k.setValue(ce,"center",r.center),k.setValue(ce,"modelViewMatrix",r.modelViewMatrix),k.setValue(ce,"normalMatrix",r.normalMatrix),k.setValue(ce,"modelMatrix",r.matrixWorld),W}function Fe(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function Me(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Se.setAnimationLoop(Be),"undefined"!==typeof self&&Se.setContext(self),this.setAnimationLoop=function(e){Ge=e,Ae.setAnimationLoop(e),null===e?Se.stop():Se.start()},Ae.addEventListener("sessionstart",Ze),Ae.addEventListener("sessionend",we),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==A){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===Ae.enabled&&!0===Ae.isPresenting&&(!0===Ae.cameraAutoUpdate&&Ae.updateCamera(t),t=Ae.getCamera()),!0===e.isScene&&e.onBeforeRender(h,e,t,f),(I=ne.get(e,d.length)).init(),d.push(I),M.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),X.setFromProjectionMatrix(M),H=this.localClippingEnabled,Y=ie.init(this.clippingPlanes,H,t),(c=te.get(e,C.length)).init(),C.push(c),We(e,t,0,h.sortObjects),c.finish(),!0===h.sortObjects&&c.sort(W,x),!0===Y&&ie.beginShadows();var n=I.state.shadowsArray;if(re.render(n,e,t),!0===Y&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),ae.render(c,e),I.setupLights(h.physicallyCorrectLights),t.isArrayCamera)for(var i=t.cameras,r=0,a=i.length;r<a;r++){var o=i[r];xe(c,e,o,o.viewport)}else xe(c,e,t);null!==f&&(U.updateMultisampleRenderTarget(f),U.updateRenderTargetMipmap(f)),!0===e.isScene&&e.onAfterRender(h,e,t),ue.resetDefaultState(),v=-1,b=null,d.pop(),I=d.length>0?d[d.length-1]:null,C.pop(),c=C.length>0?C[C.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return p},this.getActiveMipmapLevel=function(){return m},this.getRenderTarget=function(){return f},this.setRenderTargetTextures=function(e,t,n){D.get(e.texture).__webglTexture=t,D.get(e.depthTexture).__webglTexture=n;var i=D.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===_.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=D.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f=e,p=t,m=n;var i=!0;if(e){var r=D.get(e);void 0!==r.__useDefaultFramebuffer?(E.bindFramebuffer(36160,null),i=!1):void 0===r.__webglFramebuffer?U.setupRenderTarget(e):r.__hasExternalTextures&&U.rebindTextures(e,D.get(e.texture).__webglTexture,D.get(e.depthTexture).__webglTexture)}var a=null,o=!1,s=!1;if(e){var g=e.texture;(g.isData3DTexture||g.isDataArrayTexture)&&(s=!0);var l=D.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=l[t],o=!0):a=T.isWebGL2&&e.samples>0&&!1===U.useMultisampledRTT(e)?D.get(e).__webglMultisampledFramebuffer:l,y.copy(e.viewport),G.copy(e.scissor),B=e.scissorTest}else y.copy(R).multiplyScalar(S).floor(),G.copy(V).multiplyScalar(S).floor(),B=k;var u=E.bindFramebuffer(36160,a);if(u&&T.drawBuffers&&i&&E.drawBuffers(e,a),E.viewport(y),E.scissor(G),E.setScissorTest(B),o){var c=D.get(e.texture);ce.framebufferTexture2D(36160,36064,34069+t,c.__webglTexture,n)}else if(s){var I=D.get(e.texture),C=t||0;ce.framebufferTextureLayer(36160,36064,I.__webglTexture,n||0,C)}v=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(e&&e.isWebGLRenderTarget){var s=D.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){E.bindFramebuffer(36160,s);try{var g=e.texture,l=g.format,u=g.type;if(l!==hG&&le.convert(l)!==ce.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var c=u===lG&&(_.has("EXT_color_buffer_half_float")||T.isWebGL2&&_.has("EXT_color_buffer_float"));if(u!==nG&&le.convert(u)!==ce.getParameter(35738)&&(u!==gG||!(T.isWebGL2||_.has("OES_texture_float")||_.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ce.readPixels(t,n,i,r,le.convert(l),le.convert(u),a)}finally{var I=null!==f?D.get(f).__webglFramebuffer:null;E.bindFramebuffer(36160,I)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i);U.setTexture2D(t,0),ce.copyTexSubImage2D(3553,n,0,0,e.x,e.y,r,a),E.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,a=t.image.height,o=le.convert(n.format),s=le.convert(n.type);U.setTexture2D(n,0),ce.pixelStorei(37440,n.flipY),ce.pixelStorei(37441,n.premultiplyAlpha),ce.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ce.texSubImage2D(3553,i,e.x,e.y,r,a,o,s,t.image.data):t.isCompressedTexture?ce.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ce.texSubImage2D(3553,i,e.x,e.y,o,s,t.image),0===i&&n.generateMipmaps&&ce.generateMipmap(3553),E.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(h.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,g=e.max.z-e.min.z+1,l=le.convert(i.format),u=le.convert(i.type);if(i.isData3DTexture)U.setTexture3D(i,0),a=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");U.setTexture2DArray(i,0),a=35866}ce.pixelStorei(37440,i.flipY),ce.pixelStorei(37441,i.premultiplyAlpha),ce.pixelStorei(3317,i.unpackAlignment);var c=ce.getParameter(3314),I=ce.getParameter(32878),C=ce.getParameter(3316),d=ce.getParameter(3315),A=ce.getParameter(32877),p=n.isCompressedTexture?n.mipmaps[0]:n.image;ce.pixelStorei(3314,p.width),ce.pixelStorei(32878,p.height),ce.pixelStorei(3316,e.min.x),ce.pixelStorei(3315,e.min.y),ce.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?ce.texSubImage3D(a,r,t.x,t.y,t.z,o,s,g,l,u,p.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ce.compressedTexSubImage3D(a,r,t.x,t.y,t.z,o,s,g,l,p.data)):ce.texSubImage3D(a,r,t.x,t.y,t.z,o,s,g,l,u,p),ce.pixelStorei(3314,c),ce.pixelStorei(32878,I),ce.pixelStorei(3316,C),ce.pixelStorei(3315,d),ce.pixelStorei(32877,A),0===r&&i.generateMipmaps&&ce.generateMipmap(a),E.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?U.setTextureCube(e,0):e.isData3DTexture?U.setTexture3D(e,0):e.isDataArrayTexture?U.setTexture2DArray(e,0):U.setTexture2D(e,0),E.unbindTexture()},this.resetState=function(){p=0,m=0,f=null,E.reset(),ue.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var NR=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.apply(this,arguments)}return Ai(n)}(KR);NR.prototype.isWebGL1Renderer=!0;var zR,LR=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;di(this,e),this.isFogExp2=!0,this.name="",this.color=new BZ(t),this.density=n}return Ai(e,[{key:"clone",value:function(){return new e(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]),e}(),_R=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;di(this,e),this.isFog=!0,this.name="",this.color=new BZ(t),this.near=n,this.far=i}return Ai(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}(),TR=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).isScene=!0,e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:Ni(e)})),e}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(zw),ER=function(){function e(t,n){di(this,e),this.isInterleavedBuffer=!0,this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=FB,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=$B()}return Ai(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$B()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=$B()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}(),JR=new KZ,DR=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];di(this,e),this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=n,this.offset=i,this.normalized=!0===r}return Ai(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)JR.fromBufferAttribute(this,t),JR.applyMatrix4(e),this.setXYZ(t,JR.x,JR.y,JR.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)JR.fromBufferAttribute(this,t),JR.applyNormalMatrix(e),this.setXYZ(t,JR.x,JR.y,JR.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)JR.fromBufferAttribute(this,t),JR.transformDirection(e),this.setXYZ(t,JR.x,JR.y,JR.z);return this}},{key:"setX",value:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");for(var n=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,a=0;a<this.itemSize;a++)n.push(this.data.array[r+a]);return new iS(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}(),UR=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isSpriteMaterial=!0,i.type="SpriteMaterial",i.color=new BZ(16777215),i.map=null,i.alphaMap=null,i.rotation=0,i.sizeAttenuation=!0,i.transparent=!0,i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}($w),PR=new KZ,QR=new KZ,OR=new KZ,jR=new sZ,qR=new sZ,$R=new hw,eV=new KZ,tV=new KZ,nV=new KZ,iV=new sZ,rV=new sZ,aV=new sZ,oV=function(e){Li(n,e);var t=Di(n);function n(e){var i;if(di(this,n),(i=t.call(this)).isSprite=!0,i.type="Sprite",void 0===zR){zR=new bS;var r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),a=new ER(r,5);zR.setIndex([0,1,2,0,2,3]),zR.setAttribute("position",new DR(a,3,0,!1)),zR.setAttribute("uv",new DR(a,2,3,!1))}return i.geometry=zR,i.material=void 0!==e?e:new UR,i.center=new sZ(.5,.5),i}return Ai(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),QR.setFromMatrixScale(this.matrixWorld),$R.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),OR.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&QR.multiplyScalar(-OR.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var a=this.center;sV(eV.set(-.5,-.5,0),OR,a,QR,n,i),sV(tV.set(.5,-.5,0),OR,a,QR,n,i),sV(nV.set(.5,.5,0),OR,a,QR,n,i),iV.set(0,0),rV.set(1,0),aV.set(1,1);var o=e.ray.intersectTriangle(eV,tV,nV,!1,PR);if(null!==o||(sV(tV.set(-.5,.5,0),OR,a,QR,n,i),rV.set(0,1),null!==(o=e.ray.intersectTriangle(eV,nV,tV,!1,PR)))){var s=e.ray.origin.distanceTo(PR);s<e.near||s>e.far||t.push({distance:s,point:PR.clone(),uv:jw.getUV(PR,eV,tV,nV,iV,rV,aV,new sZ),face:null,object:this})}}},{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(zw);function sV(e,t,n,i,r,a){jR.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(qR.x=a*jR.x-r*jR.y,qR.y=r*jR.x+a*jR.y):qR.copy(jR),e.copy(t),e.x+=qR.x,e.y+=qR.y,e.applyMatrix4($R)}var gV=new KZ,lV=new KZ,uV=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this))._currentLevel=0,e.type="LOD",Object.defineProperties(Ni(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),e.autoUpdate=!0,e}return Ai(n,[{key:"copy",value:function(e){Rr(_i(n.prototype),"copy",this).call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var a=t[i];this.addLevel(a.object.clone(),a.distance)}return this.autoUpdate=e.autoUpdate,this}},{key:"addLevel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.abs(t);var n,i=this.levels;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this}},{key:"getCurrentLevel",value:function(){return this._currentLevel}},{key:"getObjectForDistance",value:function(e){var t=this.levels;if(t.length>0){var n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}},{key:"raycast",value:function(e,t){if(this.levels.length>0){gV.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(gV);this.getObjectForDistance(n).raycast(e,t)}}},{key:"update",value:function(e){var t=this.levels;if(t.length>1){gV.setFromMatrixPosition(e.matrixWorld),lV.setFromMatrixPosition(this.matrixWorld);var n,i,r=gV.distanceTo(lV)/e.zoom;for(t[0].object.visible=!0,n=1,i=t.length;n<i&&r>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<i;n++)t[n].object.visible=!1}}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var i=this.levels,r=0,a=i.length;r<a;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}]),n}(zw),cV=new KZ,IV=new RZ,CV=new RZ,dV=new KZ,hV=new hw,AV=function(e){Li(n,e);var t=Di(n);function n(e,i){var r;return di(this,n),(r=t.call(this,e,i)).isSkinnedMesh=!0,r.type="SkinnedMesh",r.bindMode="attached",r.bindMatrix=new hw,r.bindMatrixInverse=new hw,r}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new RZ,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){Rr(_i(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,i=this.geometry;IV.fromBufferAttribute(i.attributes.skinIndex,e),CV.fromBufferAttribute(i.attributes.skinWeight,e),cV.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var r=0;r<4;r++){var a=CV.getComponent(r);if(0!==a){var o=IV.getComponent(r);hV.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(dV.copy(cV).applyMatrix4(hV),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),n}(NS),pV=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).isBone=!0,e.type="Bone",e}return Ai(n)}(zw),mV=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,u=arguments.length>7?arguments[7]:void 0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Dy,I=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Dy,C=arguments.length>10?arguments[10]:void 0,d=arguments.length>11?arguments[11]:void 0;return di(this,n),(e=t.call(this,null,g,l,u,c,I,o,s,C,d)).isDataTexture=!0,e.image={data:i,width:r,height:a},e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Ai(n)}(xZ),fV=new hw,vV=new hw,bV=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];di(this,e),this.uuid=$B(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}return Ai(e,[{key:"init",value:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new hw)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new hw;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var i=0,r=this.bones.length;i<r;i++){var a=this.bones[i];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}}},{key:"update",value:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,a=e.length;r<a;r++){var o=e[r]?e[r].matrixWorld:vV;fV.multiplyMatrices(o,t[r]),fV.toArray(n,16*r)}null!==i&&(i.needsUpdate=!0)}},{key:"clone",value:function(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var e=Math.sqrt(4*this.bones.length);e=rZ(e),e=Math.max(e,4);var t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new mV(t,e,e,hG,gG);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}},{key:"getBoneByName",value:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(e,t){this.uuid=e.uuid;for(var n=0,i=e.bones.length;n<i;n++){var r=e.bones[n],a=t[r];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new pV),this.bones.push(a),this.boneInverses.push((new hw).fromArray(e.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,i=0,r=t.length;i<r;i++){var a=t[i];e.bones.push(a.uuid);var o=n[i];e.boneInverses.push(o.toArray())}return e}}]),e}(),yV=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return di(this,n),"number"===typeof r&&(o=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(a=t.call(this,e,i,r)).isInstancedBufferAttribute=!0,a.meshPerAttribute=o,a}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(iS),GV=new hw,BV=new hw,ZV=[],wV=new NS,SV=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;return di(this,n),(a=t.call(this,e,i)).isInstancedMesh=!0,a.instanceMatrix=new yV(new Float32Array(16*r),16),a.instanceColor=null,a.count=r,a.frustumCulled=!1,a}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,i=this.count;if(wV.geometry=this.geometry,wV.material=this.material,void 0!==wV.material)for(var r=0;r<i;r++){this.getMatrixAt(r,GV),BV.multiplyMatrices(n,GV),wV.matrixWorld=BV,wV.raycast(e,ZV);for(var a=0,o=ZV.length;a<o;a++){var s=ZV[a];s.instanceId=r,s.object=this,t.push(s)}ZV.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new yV(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(NS),WV=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isLineBasicMaterial=!0,i.type="LineBasicMaterial",i.color=new BZ(16777215),i.linewidth=1,i.linecap="round",i.linejoin="round",i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}]),n}($w),xV=new KZ,RV=new KZ,VV=new hw,kV=new dw,XV=new ow,YV=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bS,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new WV;return di(this,n),(e=t.call(this)).isLine=!0,e.type="Line",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)xV.fromBufferAttribute(t,i-1),RV.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=xV.distanceTo(RV);e.setAttribute("lineDistance",new IS(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),XV.copy(n.boundingSphere),XV.applyMatrix4(i),XV.radius+=r,!1!==e.ray.intersectsSphere(XV)){VV.copy(i).invert(),kV.copy(e.ray).applyMatrix4(VV);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,g=new KZ,l=new KZ,u=new KZ,c=new KZ,I=this.isLineSegments?2:1,C=n.index,d=n.attributes.position;if(null!==C)for(var h=Math.max(0,a.start),A=Math.min(C.count,a.start+a.count)-1;h<A;h+=I){var p=C.getX(h),m=C.getX(h+1);if(g.fromBufferAttribute(d,p),l.fromBufferAttribute(d,m),!(kV.distanceSqToSegment(g,l,c,u)>s)){c.applyMatrix4(this.matrixWorld);var f=e.ray.origin.distanceTo(c);f<e.near||f>e.far||t.push({distance:f,point:u.clone().applyMatrix4(this.matrixWorld),index:h,face:null,faceIndex:null,object:this})}}else for(var v=Math.max(0,a.start),b=Math.min(d.count,a.start+a.count)-1;v<b;v+=I){if(g.fromBufferAttribute(d,v),l.fromBufferAttribute(d,v+1),!(kV.distanceSqToSegment(g,l,c,u)>s)){c.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(c);y<e.near||y>e.far||t.push({distance:y,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}}]),n}(zw),HV=new KZ,FV=new KZ,MV=function(e){Li(n,e);var t=Di(n);function n(e,i){var r;return di(this,n),(r=t.call(this,e,i)).isLineSegments=!0,r.type="LineSegments",r}return Ai(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[],i=0,r=t.count;i<r;i+=2)HV.fromBufferAttribute(t,i),FV.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+HV.distanceTo(FV);e.setAttribute("lineDistance",new IS(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}]),n}(YV),KV=function(e){Li(n,e);var t=Di(n);function n(e,i){var r;return di(this,n),(r=t.call(this,e,i)).isLineLoop=!0,r.type="LineLoop",r}return Ai(n)}(YV),NV=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isPointsMaterial=!0,i.type="PointsMaterial",i.color=new BZ(16777215),i.map=null,i.alphaMap=null,i.size=1,i.sizeAttenuation=!0,i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}($w),zV=new hw,LV=new dw,_V=new ow,TV=new KZ,EV=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bS,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new NV;return di(this,n),(e=t.call(this)).isPoints=!0,e.type="Points",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),_V.copy(n.boundingSphere),_V.applyMatrix4(i),_V.radius+=r,!1!==e.ray.intersectsSphere(_V)){zV.copy(i).invert(),LV.copy(e.ray).applyMatrix4(zV);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,g=n.index,l=n.attributes.position;if(null!==g)for(var u=Math.max(0,a.start),c=Math.min(g.count,a.start+a.count);u<c;u++){var I=g.getX(u);TV.fromBufferAttribute(l,I),JV(TV,I,s,i,e,t,this)}else for(var C=Math.max(0,a.start),d=Math.min(l.count,a.start+a.count);C<d;C++)TV.fromBufferAttribute(l,C),JV(TV,C,s,i,e,t,this)}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,r=n.length;i<r;i++){var a=n[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}}]),n}(zw);function JV(e,t,n,i,r,a,o){var s=LV.distanceSqToPoint(e);if(s<n){var g=new KZ;LV.closestPointToPoint(e,g),g.applyMatrix4(i);var l=r.ray.origin.distanceTo(g);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:g,index:t,face:null,object:o})}}var DV=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a,o,s,g,l,u){var c;di(this,n),(c=t.call(this,e,i,r,a,o,s,g,l,u)).isVideoTexture=!0,c.minFilter=void 0!==s?s:jy,c.magFilter=void 0!==o?o:jy,c.generateMipmaps=!1;var I=Ni(c);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){I.needsUpdate=!0,e.requestVideoFrameCallback(t)})),c}return Ai(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(xZ),UV=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;return di(this,n),(a=t.call(this,{width:e,height:i})).isFramebufferTexture=!0,a.format=r,a.magFilter=Dy,a.minFilter=Dy,a.generateMipmaps=!1,a.needsUpdate=!0,a}return Ai(n)}(xZ),PV=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a,o,s,g,l,u,c,I,C){var d;return di(this,n),(d=t.call(this,null,s,g,l,u,c,a,o,I,C)).isCompressedTexture=!0,d.image={width:i,height:r},d.mipmaps=e,d.flipY=!1,d.generateMipmaps=!1,d}return Ai(n)}(xZ),QV=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a,o,s,g,l,u){var c;return di(this,n),(c=t.call(this,e,i,r,a,o,s,g,l,u)).isCanvasTexture=!0,c.needsUpdate=!0,c}return Ai(n)}(xZ),OV=function(){function e(){di(this,e),this.type="Curve",this.arcLengthDivisions=200}return Ai(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],i=this.getPoint(0),r=0;n.push(0);for(var a=1;a<=e;a++)r+=(t=this.getPoint(a/e)).distanceTo(i),n.push(r),i=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t||e*i[a-1];for(var o,s=0,g=a-1;s<=g;)if((o=i[r=Math.floor(s+(g-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){g=r;break}g=r-1}if(i[r=g]===n)return r/(a-1);var l=i[r];return(r+(n-l)/(i[r+1]-l))/(a-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),o=this.getPoint(r),s=t||(a.isVector2?new sZ:new KZ);return s.copy(o).sub(a).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new KZ,i=[],r=[],a=[],o=new KZ,s=new hw,g=0;g<=e;g++){var l=g/e;i[g]=this.getTangentAt(l,new KZ)}r[0]=new KZ,a[0]=new KZ;var u=Number.MAX_VALUE,c=Math.abs(i[0].x),I=Math.abs(i[0].y),C=Math.abs(i[0].z);c<=u&&(u=c,n.set(1,0,0)),I<=u&&(u=I,n.set(0,1,0)),C<=u&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(var d=1;d<=e;d++){if(r[d]=r[d-1].clone(),a[d]=a[d-1].clone(),o.crossVectors(i[d-1],i[d]),o.length()>Number.EPSILON){o.normalize();var h=Math.acos(eZ(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(s.makeRotationAxis(o,h))}a[d].crossVectors(i[d],r[d])}if(!0===t){var A=Math.acos(eZ(r[0].dot(r[e]),-1,1));A/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(A=-A);for(var p=1;p<=e;p++)r[p].applyMatrix4(s.makeRotationAxis(i[p],A*p)),a[p].crossVectors(i[p],r[p])}return{tangents:i,normals:r,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),jV=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return di(this,n),(e=t.call(this)).isEllipseCurve=!0,e.type="EllipseCurve",e.aX=i,e.aY=r,e.xRadius=a,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=g,e.aClockwise=l,e.aRotation=u,e}return Ai(n,[{key:"getPoint",value:function(e,t){for(var n=t||new sZ,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);var o=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(o),g=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),u=Math.sin(this.aRotation),c=s-this.aX,I=g-this.aY;s=c*l-I*u+this.aX,g=c*u+I*l+this.aY}return n.set(s,g)}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(OV),qV=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a,o,s){var g;return di(this,n),(g=t.call(this,e,i,r,r,a,o,s)).isArcCurve=!0,g.type="ArcCurve",g}return Ai(n)}(jV);function $V(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var g=(t-e)/a-(n-e)/(a+o)+(n-t)/o,l=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,g*=o,l*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+i*(a*r)}}}var ek=new KZ,tk=new $V,nk=new $V,ik=new $V,rk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return di(this,n),(e=t.call(this)).isCatmullRomCurve3=!0,e.type="CatmullRomCurve3",e.points=i,e.closed=r,e.curveType=a,e.tension=o,e}return Ai(n,[{key:"getPoint",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ,r=i,a=this.points,o=a.length,s=(o-(this.closed?0:1))*e,g=Math.floor(s),l=s-g;this.closed?g+=g>0?0:(Math.floor(Math.abs(g)/o)+1)*o:0===l&&g===o-1&&(g=o-2,l=1),this.closed||g>0?t=a[(g-1)%o]:(ek.subVectors(a[0],a[1]).add(a[0]),t=ek);var u=a[g%o],c=a[(g+1)%o];if(this.closed||g+2<o?n=a[(g+2)%o]:(ek.subVectors(a[o-1],a[o-2]).add(a[o-1]),n=ek),"centripetal"===this.curveType||"chordal"===this.curveType){var I="chordal"===this.curveType?.5:.25,C=Math.pow(t.distanceToSquared(u),I),d=Math.pow(u.distanceToSquared(c),I),h=Math.pow(c.distanceToSquared(n),I);d<1e-4&&(d=1),C<1e-4&&(C=d),h<1e-4&&(h=d),tk.initNonuniformCatmullRom(t.x,u.x,c.x,n.x,C,d,h),nk.initNonuniformCatmullRom(t.y,u.y,c.y,n.y,C,d,h),ik.initNonuniformCatmullRom(t.z,u.z,c.z,n.z,C,d,h)}else"catmullrom"===this.curveType&&(tk.initCatmullRom(t.x,u.x,c.x,n.x,this.tension),nk.initCatmullRom(t.y,u.y,c.y,n.y,this.tension),ik.initCatmullRom(t.z,u.z,c.z,n.z,this.tension));return r.set(tk.calc(l),nk.calc(l),ik.calc(l)),r}},{key:"copy",value:function(e){Rr(_i(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new KZ).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(OV);function ak(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function ok(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function sk(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}var gk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sZ,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sZ,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new sZ,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new sZ;return di(this,n),(e=t.call(this)).isCubicBezierCurve=!0,e.type="CubicBezierCurve",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return Ai(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sZ,n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(sk(e,i.x,r.x,a.x,o.x),sk(e,i.y,r.y,a.y,o.y)),n}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(OV),lk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new KZ,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new KZ;return di(this,n),(e=t.call(this)).isCubicBezierCurve3=!0,e.type="CubicBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return Ai(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ,n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(sk(e,i.x,r.x,a.x,o.x),sk(e,i.y,r.y,a.y,o.y),sk(e,i.z,r.z,a.z,o.z)),n}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(OV),uk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sZ,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sZ;return di(this,n),(e=t.call(this)).isLineCurve=!0,e.type="LineCurve",e.v1=i,e.v2=r,e}return Ai(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sZ,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new sZ;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(OV),ck=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ;return di(this,n),(e=t.call(this)).isLineCurve3=!0,e.type="LineCurve3",e.v1=i,e.v2=r,e}return Ai(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(OV),Ik=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sZ,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sZ,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new sZ;return di(this,n),(e=t.call(this)).isQuadraticBezierCurve=!0,e.type="QuadraticBezierCurve",e.v0=i,e.v1=r,e.v2=a,e}return Ai(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sZ,n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(ok(e,i.x,r.x,a.x),ok(e,i.y,r.y,a.y)),n}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(OV),Ck=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new KZ;return di(this,n),(e=t.call(this)).isQuadraticBezierCurve3=!0,e.type="QuadraticBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e}return Ai(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ,n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(ok(e,i.x,r.x,a.x),ok(e,i.y,r.y,a.y),ok(e,i.z,r.z,a.z)),n}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(OV),dk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return di(this,n),(e=t.call(this)).isSplineCurve=!0,e.type="SplineCurve",e.points=i,e}return Ai(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sZ,n=t,i=this.points,r=(i.length-1)*e,a=Math.floor(r),o=r-a,s=i[0===a?a:a-1],g=i[a],l=i[a>i.length-2?i.length-1:a+1],u=i[a>i.length-3?i.length-1:a+2];return n.set(ak(o,s.x,g.x,l.x,u.x),ak(o,s.y,g.y,l.y,u.y)),n}},{key:"copy",value:function(e){Rr(_i(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e}},{key:"fromJSON",value:function(e){Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new sZ).fromArray(r))}return this}}]),n}(OV),hk=Object.freeze({__proto__:null,ArcCurve:qV,CatmullRomCurve3:rk,CubicBezierCurve:gk,CubicBezierCurve3:lk,EllipseCurve:jV,LineCurve:uk,LineCurve3:ck,QuadraticBezierCurve:Ik,QuadraticBezierCurve3:Ck,SplineCurve:dk}),Ak=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return Ai(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new uk(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=n){var a=i[r]-n,o=this.curves[r],s=o.getLength(),g=0===s?0:1-a/s;return o.getPointAt(g,t)}r++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),g=0;g<s.length;g++){var l=s[g];e&&e.equals(l)||(n.push(l),e=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){Rr(_i(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new hk[r.type]).fromJSON(r))}return this}}]),n}(OV),pk=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).type="Path",i.currentPoint=new sZ,e&&i.setFromPoints(e),i}return Ai(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new uk(this.currentPoint.clone(),new sZ(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){var r=new Ik(this.currentPoint.clone(),new sZ(e,t),new sZ(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){var o=new gk(this.currentPoint.clone(),new sZ(e,t),new sZ(n,i),new sZ(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new dk(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this}},{key:"absarc",value:function(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}},{key:"ellipse",value:function(e,t,n,i,r,a,o,s){var g=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+g,t+l,n,i,r,a,o,s),this}},{key:"absellipse",value:function(e,t,n,i,r,a,o,s){var g=new jV(e,t,n,i,r,a,o,s);if(this.curves.length>0){var l=g.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(g);var u=g.getPoint(1);return this.currentPoint.copy(u),this}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(Ak),mk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new sZ(0,.5),new sZ(.5,0),new sZ(0,-.5)],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;di(this,n),(e=t.call(this)).type="LatheGeometry",e.parameters={points:i,segments:r,phiStart:a,phiLength:o},r=Math.floor(r),o=eZ(o,0,2*Math.PI);for(var s=[],g=[],l=[],u=[],c=[],I=1/r,C=new KZ,d=new sZ,h=new KZ,A=new KZ,p=new KZ,m=0,f=0,v=0;v<=i.length-1;v++)switch(v){case 0:m=i[v+1].x-i[v].x,f=i[v+1].y-i[v].y,h.x=1*f,h.y=-m,h.z=0*f,p.copy(h),h.normalize(),u.push(h.x,h.y,h.z);break;case i.length-1:u.push(p.x,p.y,p.z);break;default:m=i[v+1].x-i[v].x,f=i[v+1].y-i[v].y,h.x=1*f,h.y=-m,h.z=0*f,A.copy(h),h.x+=p.x,h.y+=p.y,h.z+=p.z,h.normalize(),u.push(h.x,h.y,h.z),p.copy(A)}for(var b=0;b<=r;b++)for(var y=a+b*I*o,G=Math.sin(y),B=Math.cos(y),Z=0;Z<=i.length-1;Z++){C.x=i[Z].x*G,C.y=i[Z].y,C.z=i[Z].x*B,g.push(C.x,C.y,C.z),d.x=b/r,d.y=Z/(i.length-1),l.push(d.x,d.y);var w=u[3*Z+0]*G,S=u[3*Z+1],W=u[3*Z+0]*B;c.push(w,S,W)}for(var x=0;x<r;x++)for(var R=0;R<i.length-1;R++){var V=R+x*i.length,k=V,X=V+i.length,Y=V+i.length+1,H=V+1;s.push(k,X,H),s.push(Y,H,X)}return e.setIndex(s),e.setAttribute("position",new IS(g,3)),e.setAttribute("uv",new IS(l,2)),e.setAttribute("normal",new IS(c,3)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.points,e.segments,e.phiStart,e.phiLength)}}]),n}(bS),fk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;di(this,n);var s=new pk;return s.absarc(0,-r/2,i,1.5*Math.PI,0),s.absarc(0,r/2,i,0,.5*Math.PI),(e=t.call(this,s.getPoints(a),o)).type="CapsuleGeometry",e.parameters={radius:i,height:r,capSegments:a,radialSegments:o},e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.length,e.capSegments,e.radialSegments)}}]),n}(mk),vk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;di(this,n),(e=t.call(this)).type="CircleGeometry",e.parameters={radius:i,segments:r,thetaStart:a,thetaLength:o},r=Math.max(3,r);var s=[],g=[],l=[],u=[],c=new KZ,I=new sZ;g.push(0,0,0),l.push(0,0,1),u.push(.5,.5);for(var C=0,d=3;C<=r;C++,d+=3){var h=a+C/r*o;c.x=i*Math.cos(h),c.y=i*Math.sin(h),g.push(c.x,c.y,c.z),l.push(0,0,1),I.x=(g[d]/i+1)/2,I.y=(g[d+1]/i+1)/2,u.push(I.x,I.y)}for(var A=1;A<=r;A++)s.push(A,A+1,0);return e.setIndex(s),e.setAttribute("position",new IS(g,3)),e.setAttribute("normal",new IS(l,3)),e.setAttribute("uv",new IS(u,2)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.segments,e.thetaStart,e.thetaLength)}}]),n}(bS),bk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;di(this,n),(e=t.call(this)).type="CylinderGeometry",e.parameters={radiusTop:i,radiusBottom:r,height:a,radialSegments:o,heightSegments:s,openEnded:g,thetaStart:l,thetaLength:u};var c=Ni(e);o=Math.floor(o),s=Math.floor(s);var I=[],C=[],d=[],h=[],A=0,p=[],m=a/2,f=0;function v(){for(var e=new KZ,t=new KZ,n=0,g=(r-i)/a,v=0;v<=s;v++){for(var b=[],y=v/s,G=y*(r-i)+i,B=0;B<=o;B++){var Z=B/o,w=Z*u+l,S=Math.sin(w),W=Math.cos(w);t.x=G*S,t.y=-y*a+m,t.z=G*W,C.push(t.x,t.y,t.z),e.set(S,g,W).normalize(),d.push(e.x,e.y,e.z),h.push(Z,1-y),b.push(A++)}p.push(b)}for(var x=0;x<o;x++)for(var R=0;R<s;R++){var V=p[R][x],k=p[R+1][x],X=p[R+1][x+1],Y=p[R][x+1];I.push(V,k,Y),I.push(k,X,Y),n+=6}c.addGroup(f,n,0),f+=n}function b(e){for(var t=A,n=new sZ,a=new KZ,s=0,g=!0===e?i:r,p=!0===e?1:-1,v=1;v<=o;v++)C.push(0,m*p,0),d.push(0,p,0),h.push(.5,.5),A++;for(var b=A,y=0;y<=o;y++){var G=y/o*u+l,B=Math.cos(G),Z=Math.sin(G);a.x=g*Z,a.y=m*p,a.z=g*B,C.push(a.x,a.y,a.z),d.push(0,p,0),n.x=.5*B+.5,n.y=.5*Z*p+.5,h.push(n.x,n.y),A++}for(var w=0;w<o;w++){var S=t+w,W=b+w;!0===e?I.push(W,W+1,S):I.push(W+1,W,S),s+=3}c.addGroup(f,s,!0===e?1:2),f+=s}return v(),!1===g&&(i>0&&b(!0),r>0&&b(!1)),e.setIndex(I),e.setAttribute("position",new IS(C,3)),e.setAttribute("normal",new IS(d,3)),e.setAttribute("uv",new IS(h,2)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(bS),yk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return di(this,n),(e=t.call(this,0,i,r,a,o,s,g,l)).type="ConeGeometry",e.parameters={radius:i,height:r,radialSegments:a,heightSegments:o,openEnded:s,thetaStart:g,thetaLength:l},e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(bk),Gk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;di(this,n),(e=t.call(this)).type="PolyhedronGeometry",e.parameters={vertices:i,indices:r,radius:a,detail:o};var s=[],g=[];function l(e){for(var t=new KZ,n=new KZ,i=new KZ,a=0;a<r.length;a+=3)h(r[a+0],t),h(r[a+1],n),h(r[a+2],i),u(t,n,i,e)}function u(e,t,n,i){for(var r=i+1,a=[],o=0;o<=r;o++){a[o]=[];for(var s=e.clone().lerp(n,o/r),g=t.clone().lerp(n,o/r),l=r-o,u=0;u<=l;u++)a[o][u]=0===u&&o===r?s:s.clone().lerp(g,u/l)}for(var c=0;c<r;c++)for(var I=0;I<2*(r-c)-1;I++){var C=Math.floor(I/2);I%2===0?(d(a[c][C+1]),d(a[c+1][C]),d(a[c][C])):(d(a[c][C+1]),d(a[c+1][C+1]),d(a[c+1][C]))}}function c(e){for(var t=new KZ,n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}function I(){for(var e=new KZ,t=0;t<s.length;t+=3){e.x=s[t+0],e.y=s[t+1],e.z=s[t+2];var n=m(e)/2/Math.PI+.5,i=f(e)/Math.PI+.5;g.push(n,1-i)}A(),C()}function C(){for(var e=0;e<g.length;e+=6){var t=g[e+0],n=g[e+2],i=g[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(g[e+0]+=1),n<.2&&(g[e+2]+=1),i<.2&&(g[e+4]+=1))}}function d(e){s.push(e.x,e.y,e.z)}function h(e,t){var n=3*e;t.x=i[n+0],t.y=i[n+1],t.z=i[n+2]}function A(){for(var e=new KZ,t=new KZ,n=new KZ,i=new KZ,r=new sZ,a=new sZ,o=new sZ,l=0,u=0;l<s.length;l+=9,u+=6){e.set(s[l+0],s[l+1],s[l+2]),t.set(s[l+3],s[l+4],s[l+5]),n.set(s[l+6],s[l+7],s[l+8]),r.set(g[u+0],g[u+1]),a.set(g[u+2],g[u+3]),o.set(g[u+4],g[u+5]),i.copy(e).add(t).add(n).divideScalar(3);var c=m(i);p(r,u+0,e,c),p(a,u+2,t,c),p(o,u+4,n,c)}}function p(e,t,n,i){i<0&&1===e.x&&(g[t]=e.x-1),0===n.x&&0===n.z&&(g[t]=i/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}function f(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}return l(o),c(a),I(),e.setAttribute("position",new IS(s,3)),e.setAttribute("normal",new IS(s.slice(),3)),e.setAttribute("uv",new IS(g,2)),0===o?e.computeVertexNormals():e.normalizeNormals(),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.vertices,e.indices,e.radius,e.details)}}]),n}(bS),Bk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;di(this,n);var a=(1+Math.sqrt(5))/2,o=1/a,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-a,0,-o,a,0,o,-a,0,o,a,-o,-a,0,-o,a,0,o,-a,0,o,a,0,-a,0,-o,a,0,-o,-a,0,o,a,0,o],g=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];return(e=t.call(this,s,g,i,r)).type="DodecahedronGeometry",e.parameters={radius:i,detail:r},e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Gk),Zk=new KZ,wk=new KZ,Sk=new KZ,Wk=new jw,xk=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(di(this,n),(e=t.call(this)).type="EdgesGeometry",e.parameters={geometry:i,thresholdAngle:r},null!==i){for(var a=4,o=Math.pow(10,a),s=Math.cos(jB*r),g=i.getIndex(),l=i.getAttribute("position"),u=g?g.count:l.count,c=[0,0,0],I=["a","b","c"],C=new Array(3),d={},h=[],A=0;A<u;A+=3){g?(c[0]=g.getX(A),c[1]=g.getX(A+1),c[2]=g.getX(A+2)):(c[0]=A,c[1]=A+1,c[2]=A+2);var p=Wk.a,m=Wk.b,f=Wk.c;if(p.fromBufferAttribute(l,c[0]),m.fromBufferAttribute(l,c[1]),f.fromBufferAttribute(l,c[2]),Wk.getNormal(Sk),C[0]="".concat(Math.round(p.x*o),",").concat(Math.round(p.y*o),",").concat(Math.round(p.z*o)),C[1]="".concat(Math.round(m.x*o),",").concat(Math.round(m.y*o),",").concat(Math.round(m.z*o)),C[2]="".concat(Math.round(f.x*o),",").concat(Math.round(f.y*o),",").concat(Math.round(f.z*o)),C[0]!==C[1]&&C[1]!==C[2]&&C[2]!==C[0])for(var v=0;v<3;v++){var b=(v+1)%3,y=C[v],G=C[b],B=Wk[I[v]],Z=Wk[I[b]],w="".concat(y,"_").concat(G),S="".concat(G,"_").concat(y);S in d&&d[S]?(Sk.dot(d[S].normal)<=s&&(h.push(B.x,B.y,B.z),h.push(Z.x,Z.y,Z.z)),d[S]=null):w in d||(d[w]={index0:c[v],index1:c[b],normal:Sk.clone()})}}for(var W in d)if(d[W]){var x=d[W],R=x.index0,V=x.index1;Zk.fromBufferAttribute(l,R),wk.fromBufferAttribute(l,V),h.push(Zk.x,Zk.y,Zk.z),h.push(wk.x,wk.y,wk.z)}e.setAttribute("position",new IS(h,3))}return e}return Ai(n)}(bS),Rk=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,e)).uuid=$B(),i.type="Shape",i.holes=[],i}return Ai(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){Rr(_i(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e}},{key:"fromJSON",value:function(e){Rr(_i(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new pk).fromJSON(r))}return this}}]),n}(pk),Vk=function(e,t){var n,i,r,a,o,s,g,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,u=t&&t.length,c=u?t[0]*l:e.length,I=kk(e,0,c,l,!0),C=[];if(!I||I.next===I.prev)return C;if(u&&(I=Nk(e,t,I,l)),e.length>80*l){n=r=e[0],i=a=e[1];for(var d=l;d<c;d+=l)(o=e[d])<n&&(n=o),(s=e[d+1])<i&&(i=s),o>r&&(r=o),s>a&&(a=s);g=0!==(g=Math.max(r-n,a-i))?1/g:0}return Yk(I,C,l,n,i,g),C};function kk(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=eX(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=eX(a,e[a],e[a+1],o);return o&&Pk(o,o.next)&&(tX(o),o=o.next),o}function Xk(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Pk(i,i.next)&&0!==Uk(i.prev,i,i.next))i=i.next;else{if(tX(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function Yk(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=Tk(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,g,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(g=l;s>0||g>0&&i;)0!==s&&(0===g||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,g--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(e,i,r,a);for(var s,g,l=e;e.prev!==e.next;)if(s=e.prev,g=e.next,a?Fk(e,i,r,a):Hk(e))t.push(s.i/n),t.push(e.i/n),t.push(g.i/n),tX(e),e=g.next,l=g.next;else if((e=g)===l){o?1===o?Yk(e=Mk(Xk(e),t,n),t,n,i,r,a,2):2===o&&Kk(e,t,n,i,r,a):Yk(Xk(e),t,n,i,r,a,1);break}}}function Hk(e){var t=e.prev,n=e,i=e.next;if(Uk(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(Jk(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Uk(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Fk(e,t,n,i){var r=e.prev,a=e,o=e.next;if(Uk(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,g=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,c=Tk(s,g,t,n,i),I=Tk(l,u,t,n,i),C=e.prevZ,d=e.nextZ;C&&C.z>=c&&d&&d.z<=I;){if(C!==e.prev&&C!==e.next&&Jk(r.x,r.y,a.x,a.y,o.x,o.y,C.x,C.y)&&Uk(C.prev,C,C.next)>=0)return!1;if(C=C.prevZ,d!==e.prev&&d!==e.next&&Jk(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Uk(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;C&&C.z>=c;){if(C!==e.prev&&C!==e.next&&Jk(r.x,r.y,a.x,a.y,o.x,o.y,C.x,C.y)&&Uk(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;d&&d.z<=I;){if(d!==e.prev&&d!==e.next&&Jk(r.x,r.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Uk(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Mk(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!Pk(r,a)&&Qk(r,i,i.next,a)&&qk(r,a)&&qk(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),tX(i),tX(i.next),i=e=a),i=i.next}while(i!==e);return Xk(i)}function Kk(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Dk(o,s)){var g=$k(o,s);return o=Xk(o,o.next),g=Xk(g,g.next),Yk(o,t,n,i,r,a),void Yk(g,t,n,i,r,a)}s=s.next}o=o.next}while(o!==e)}function Nk(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=kk(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(Ek(o));for(s.sort(zk),r=0;r<s.length;r++)Lk(s[r],n),n=Xk(n,n.next);return n}function zk(e,t){return e.x-t.x}function Lk(e,t){if(t=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var g,l=n,u=n.x,c=n.y,I=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&Jk(a<c?r:o,a,u,c,a<c?o:r,a,i.x,i.y)&&(g=Math.abs(a-i.y)/(r-i.x),qk(i,e)&&(g<I||g===I&&(i.x>n.x||i.x===n.x&&_k(n,i)))&&(n=i,I=g)),i=i.next}while(i!==l);return n}(e,t),t){var n=$k(t,e);Xk(t,t.next),Xk(n,n.next)}}function _k(e,t){return Uk(e.prev,e,t.prev)<0&&Uk(t.next,e,e.next)<0}function Tk(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ek(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Jk(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function Dk(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Qk(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(qk(e,t)&&qk(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Uk(e.prev,e,t.prev)||Uk(e,t.prev,t))||Pk(e,t)&&Uk(e.prev,e,e.next)>0&&Uk(t.prev,t,t.next)>0)}function Uk(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Pk(e,t){return e.x===t.x&&e.y===t.y}function Qk(e,t,n,i){var r=jk(Uk(e,t,n)),a=jk(Uk(e,t,i)),o=jk(Uk(n,i,e)),s=jk(Uk(n,i,t));return r!==a&&o!==s||(!(0!==r||!Ok(e,n,t))||(!(0!==a||!Ok(e,i,t))||(!(0!==o||!Ok(n,e,i))||!(0!==s||!Ok(n,t,i)))))}function Ok(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function jk(e){return e>0?1:e<0?-1:0}function qk(e,t){return Uk(e.prev,e,e.next)<0?Uk(e,t,e.next)>=0&&Uk(e,e.prev,t)>=0:Uk(e,t,e.prev)<0||Uk(e,e.next,t)<0}function $k(e,t){var n=new nX(e.i,e.x,e.y),i=new nX(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function eX(e,t,n,i){var r=new nX(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function tX(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function nX(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var iX=function(){function e(){di(this,e)}return Ai(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],i=[],r=[];rX(e),aX(n,e);var a=e.length;t.forEach(rX);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,aX(n,t[o]);for(var s=Vk(n,i),g=0;g<s.length;g+=3)r.push(s.slice(g,g+3));return r}}]),e}();function rX(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function aX(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var oX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rk([new sZ(.5,.5),new sZ(-.5,.5),new sZ(-.5,-.5),new sZ(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};di(this,n),(e=t.call(this)).type="ExtrudeGeometry",e.parameters={shapes:i,options:r},i=Array.isArray(i)?i:[i];for(var a=Ni(e),o=[],s=[],g=0,l=i.length;g<l;g++){var u=i[g];c(u)}function c(e){var t=[],n=void 0!==r.curveSegments?r.curveSegments:12,i=void 0!==r.steps?r.steps:1,g=void 0!==r.depth?r.depth:1,l=void 0===r.bevelEnabled||r.bevelEnabled,u=void 0!==r.bevelThickness?r.bevelThickness:.2,c=void 0!==r.bevelSize?r.bevelSize:u-.1,I=void 0!==r.bevelOffset?r.bevelOffset:0,C=void 0!==r.bevelSegments?r.bevelSegments:3,d=r.extrudePath,h=void 0!==r.UVGenerator?r.UVGenerator:sX;void 0!==r.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),g=r.amount);var A,p,m,f,v,b=!1;d&&(A=d.getSpacedPoints(i),b=!0,l=!1,p=d.computeFrenetFrames(i,!1),m=new KZ,f=new KZ,v=new KZ),l||(C=0,u=0,c=0,I=0);var y=e.extractPoints(n),G=y.shape,B=y.holes;if(!iX.isClockWise(G)){G=G.reverse();for(var Z=0,w=B.length;Z<w;Z++){var S=B[Z];iX.isClockWise(S)&&(B[Z]=S.reverse())}}for(var W=iX.triangulateShape(G,B),x=G,R=0,V=B.length;R<V;R++){var k=B[R];G=G.concat(k)}function X(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var Y=G.length,H=W.length;function F(e,t,n){var i,r,a,o=e.x-t.x,s=e.y-t.y,g=n.x-e.x,l=n.y-e.y,u=o*o+s*s,c=o*l-s*g;if(Math.abs(c)>Number.EPSILON){var I=Math.sqrt(u),C=Math.sqrt(g*g+l*l),d=t.x-s/I,h=t.y+o/I,A=((n.x-l/C-d)*l-(n.y+g/C-h)*g)/(o*l-s*g),p=(i=d+o*A-e.x)*i+(r=h+s*A-e.y)*r;if(p<=2)return new sZ(i,r);a=Math.sqrt(p/2)}else{var m=!1;o>Number.EPSILON?g>Number.EPSILON&&(m=!0):o<-Number.EPSILON?g<-Number.EPSILON&&(m=!0):Math.sign(s)===Math.sign(l)&&(m=!0),m?(i=-s,r=o,a=Math.sqrt(u)):(i=o,r=s,a=Math.sqrt(u/2))}return new sZ(i/a,r/a)}for(var M=[],K=0,N=x.length,z=N-1,L=K+1;K<N;K++,z++,L++)z===N&&(z=0),L===N&&(L=0),M[K]=F(x[K],x[z],x[L]);for(var _,T=[],E=M.concat(),J=0,D=B.length;J<D;J++){var U=B[J];_=[];for(var P=0,Q=U.length,O=Q-1,j=P+1;P<Q;P++,O++,j++)O===Q&&(O=0),j===Q&&(j=0),_[P]=F(U[P],U[O],U[j]);T.push(_),E=E.concat(_)}for(var q=0;q<C;q++){for(var $=q/C,ee=u*Math.cos($*Math.PI/2),te=c*Math.sin($*Math.PI/2)+I,ne=0,ie=x.length;ne<ie;ne++){var re=X(x[ne],M[ne],te);Ve(re.x,re.y,-ee)}for(var ae=0,oe=B.length;ae<oe;ae++){var se=B[ae];_=T[ae];for(var ge=0,le=se.length;ge<le;ge++){var ue=X(se[ge],_[ge],te);Ve(ue.x,ue.y,-ee)}}}for(var ce=c+I,Ie=0;Ie<Y;Ie++){var Ce=l?X(G[Ie],E[Ie],ce):G[Ie];b?(f.copy(p.normals[0]).multiplyScalar(Ce.x),m.copy(p.binormals[0]).multiplyScalar(Ce.y),v.copy(A[0]).add(f).add(m),Ve(v.x,v.y,v.z)):Ve(Ce.x,Ce.y,0)}for(var de=1;de<=i;de++)for(var he=0;he<Y;he++){var Ae=l?X(G[he],E[he],ce):G[he];b?(f.copy(p.normals[de]).multiplyScalar(Ae.x),m.copy(p.binormals[de]).multiplyScalar(Ae.y),v.copy(A[de]).add(f).add(m),Ve(v.x,v.y,v.z)):Ve(Ae.x,Ae.y,g/i*de)}for(var pe=C-1;pe>=0;pe--){for(var me=pe/C,fe=u*Math.cos(me*Math.PI/2),ve=c*Math.sin(me*Math.PI/2)+I,be=0,ye=x.length;be<ye;be++){var Ge=X(x[be],M[be],ve);Ve(Ge.x,Ge.y,g+fe)}for(var Be=0,Ze=B.length;Be<Ze;Be++){var we=B[Be];_=T[Be];for(var Se=0,We=we.length;Se<We;Se++){var xe=X(we[Se],_[Se],ve);b?Ve(xe.x,xe.y+A[i-1].y,A[i-1].x+fe):Ve(xe.x,xe.y,g+fe)}}}function Re(e,t){for(var n=e.length;--n>=0;){var r=n,a=n-1;a<0&&(a=e.length-1);for(var o=0,s=i+2*C;o<s;o++){var g=Y*o,l=Y*(o+1);Xe(t+r+g,t+a+g,t+a+l,t+r+l)}}}function Ve(e,n,i){t.push(e),t.push(n),t.push(i)}function ke(e,t,n){Ye(e),Ye(t),Ye(n);var i=o.length/3,r=h.generateTopUV(a,o,i-3,i-2,i-1);He(r[0]),He(r[1]),He(r[2])}function Xe(e,t,n,i){Ye(e),Ye(t),Ye(i),Ye(t),Ye(n),Ye(i);var r=o.length/3,s=h.generateSideWallUV(a,o,r-6,r-3,r-2,r-1);He(s[0]),He(s[1]),He(s[3]),He(s[1]),He(s[2]),He(s[3])}function Ye(e){o.push(t[3*e+0]),o.push(t[3*e+1]),o.push(t[3*e+2])}function He(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(l){for(var t=0,n=Y*t,r=0;r<H;r++){var s=W[r];ke(s[2]+n,s[1]+n,s[0]+n)}n=Y*(t=i+2*C);for(var g=0;g<H;g++){var u=W[g];ke(u[0]+n,u[1]+n,u[2]+n)}}else{for(var c=0;c<H;c++){var I=W[c];ke(I[2],I[1],I[0])}for(var d=0;d<H;d++){var h=W[d];ke(h[0]+Y*i,h[1]+Y*i,h[2]+Y*i)}}a.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Re(x,t),t+=x.length;for(var n=0,i=B.length;n<i;n++){var r=B[n];Re(r,t),t+=r.length}a.addGroup(e,o.length/3-e,1)}()}return e.setAttribute("position",new IS(o,3)),e.setAttribute("uv",new IS(s,2)),e.computeVertexNormals(),e}return Ai(n,[{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var a=e[i];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++){var o=t[e.shapes[r]];i.push(o)}var s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new hk[s.type]).fromJSON(s)),new n(i,e.options)}}]),n}(bS),sX={generateTopUV:function(e,t,n,i,r){var a=t[3*n],o=t[3*n+1],s=t[3*i],g=t[3*i+1],l=t[3*r],u=t[3*r+1];return[new sZ(a,o),new sZ(s,g),new sZ(l,u)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],g=t[3*n+2],l=t[3*i],u=t[3*i+1],c=t[3*i+2],I=t[3*r],C=t[3*r+1],d=t[3*r+2],h=t[3*a],A=t[3*a+1],p=t[3*a+2];return Math.abs(s-u)<Math.abs(o-l)?[new sZ(o,1-g),new sZ(l,1-c),new sZ(I,1-d),new sZ(h,1-p)]:[new sZ(s,1-g),new sZ(u,1-c),new sZ(C,1-d),new sZ(A,1-p)]}};var gX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;di(this,n);var a=(1+Math.sqrt(5))/2,o=[-1,a,0,1,a,0,-1,-a,0,1,-a,0,0,-1,a,0,1,a,0,-1,-a,0,1,-a,a,0,-1,a,0,1,-a,0,-1,-a,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];return(e=t.call(this,o,s,i,r)).type="IcosahedronGeometry",e.parameters={radius:i,detail:r},e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Gk),lX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;di(this,n);var a=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];return(e=t.call(this,a,o,i,r)).type="OctahedronGeometry",e.parameters={radius:i,detail:r},e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Gk),uX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;di(this,n),(e=t.call(this)).type="RingGeometry",e.parameters={innerRadius:i,outerRadius:r,thetaSegments:a,phiSegments:o,thetaStart:s,thetaLength:g},a=Math.max(3,a);for(var l=[],u=[],c=[],I=[],C=i,d=(r-i)/(o=Math.max(1,o)),h=new KZ,A=new sZ,p=0;p<=o;p++){for(var m=0;m<=a;m++){var f=s+m/a*g;h.x=C*Math.cos(f),h.y=C*Math.sin(f),u.push(h.x,h.y,h.z),c.push(0,0,1),A.x=(h.x/r+1)/2,A.y=(h.y/r+1)/2,I.push(A.x,A.y)}C+=d}for(var v=0;v<o;v++)for(var b=v*(a+1),y=0;y<a;y++){var G=y+b,B=G,Z=G+a+1,w=G+a+2,S=G+1;l.push(B,Z,S),l.push(Z,w,S)}return e.setIndex(l),e.setAttribute("position",new IS(u,3)),e.setAttribute("normal",new IS(c,3)),e.setAttribute("uv",new IS(I,2)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}]),n}(bS),cX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rk([new sZ(0,.5),new sZ(-.5,-.5),new sZ(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;di(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:i,curveSegments:r};var a=[],o=[],s=[],g=[],l=0,u=0;if(!1===Array.isArray(i))I(i);else for(var c=0;c<i.length;c++)I(i[c]),e.addGroup(l,u,c),l+=u,u=0;function I(e){var t=o.length/3,n=e.extractPoints(r),i=n.shape,l=n.holes;!1===iX.isClockWise(i)&&(i=i.reverse());for(var c=0,I=l.length;c<I;c++){var C=l[c];!0===iX.isClockWise(C)&&(l[c]=C.reverse())}for(var d=iX.triangulateShape(i,l),h=0,A=l.length;h<A;h++){var p=l[h];i=i.concat(p)}for(var m=0,f=i.length;m<f;m++){var v=i[m];o.push(v.x,v.y,0),s.push(0,0,1),g.push(v.x,v.y)}for(var b=0,y=d.length;b<y;b++){var G=d[b],B=G[0]+t,Z=G[1]+t,w=G[2]+t;a.push(B,Z,w),u+=3}}return e.setIndex(a),e.setAttribute("position",new IS(o,3)),e.setAttribute("normal",new IS(s,3)),e.setAttribute("uv",new IS(g,2)),e}return Ai(n,[{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++){var o=t[e.shapes[r]];i.push(o)}return new n(i,e.curveSegments)}}]),n}(bS);var IX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;di(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:i,widthSegments:r,heightSegments:a,phiStart:o,phiLength:s,thetaStart:g,thetaLength:l},r=Math.max(3,Math.floor(r)),a=Math.max(2,Math.floor(a));for(var u=Math.min(g+l,Math.PI),c=0,I=[],C=new KZ,d=new KZ,h=[],A=[],p=[],m=[],f=0;f<=a;f++){var v=[],b=f/a,y=0;0==f&&0==g?y=.5/r:f==a&&u==Math.PI&&(y=-.5/r);for(var G=0;G<=r;G++){var B=G/r;C.x=-i*Math.cos(o+B*s)*Math.sin(g+b*l),C.y=i*Math.cos(g+b*l),C.z=i*Math.sin(o+B*s)*Math.sin(g+b*l),A.push(C.x,C.y,C.z),d.copy(C).normalize(),p.push(d.x,d.y,d.z),m.push(B+y,1-b),v.push(c++)}I.push(v)}for(var Z=0;Z<a;Z++)for(var w=0;w<r;w++){var S=I[Z][w+1],W=I[Z][w],x=I[Z+1][w],R=I[Z+1][w+1];(0!==Z||g>0)&&h.push(S,W,R),(Z!==a-1||u<Math.PI)&&h.push(W,x,R)}return e.setIndex(h),e.setAttribute("position",new IS(A,3)),e.setAttribute("normal",new IS(p,3)),e.setAttribute("uv",new IS(m,2)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(bS),CX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;di(this,n);var a=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],o=[2,1,0,0,3,2,1,3,0,2,3,1];return(e=t.call(this,a,o,i,r)).type="TetrahedronGeometry",e.parameters={radius:i,detail:r},e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(Gk),dX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;di(this,n),(e=t.call(this)).type="TorusGeometry",e.parameters={radius:i,tube:r,radialSegments:a,tubularSegments:o,arc:s},a=Math.floor(a),o=Math.floor(o);for(var g=[],l=[],u=[],c=[],I=new KZ,C=new KZ,d=new KZ,h=0;h<=a;h++)for(var A=0;A<=o;A++){var p=A/o*s,m=h/a*Math.PI*2;C.x=(i+r*Math.cos(m))*Math.cos(p),C.y=(i+r*Math.cos(m))*Math.sin(p),C.z=r*Math.sin(m),l.push(C.x,C.y,C.z),I.x=i*Math.cos(p),I.y=i*Math.sin(p),d.subVectors(C,I).normalize(),u.push(d.x,d.y,d.z),c.push(A/o),c.push(h/a)}for(var f=1;f<=a;f++)for(var v=1;v<=o;v++){var b=(o+1)*f+v-1,y=(o+1)*(f-1)+v-1,G=(o+1)*(f-1)+v,B=(o+1)*f+v;g.push(b,y,B),g.push(y,G,B)}return e.setIndex(g),e.setAttribute("position",new IS(l,3)),e.setAttribute("normal",new IS(u,3)),e.setAttribute("uv",new IS(c,2)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}]),n}(bS),hX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;di(this,n),(e=t.call(this)).type="TorusKnotGeometry",e.parameters={radius:i,tube:r,tubularSegments:a,radialSegments:o,p:s,q:g},a=Math.floor(a),o=Math.floor(o);for(var l=[],u=[],c=[],I=[],C=new KZ,d=new KZ,h=new KZ,A=new KZ,p=new KZ,m=new KZ,f=new KZ,v=0;v<=a;++v){var b=v/a*s*Math.PI*2;k(b,s,g,i,h),k(b+.01,s,g,i,A),m.subVectors(A,h),f.addVectors(A,h),p.crossVectors(m,f),f.crossVectors(p,m),p.normalize(),f.normalize();for(var y=0;y<=o;++y){var G=y/o*Math.PI*2,B=-r*Math.cos(G),Z=r*Math.sin(G);C.x=h.x+(B*f.x+Z*p.x),C.y=h.y+(B*f.y+Z*p.y),C.z=h.z+(B*f.z+Z*p.z),u.push(C.x,C.y,C.z),d.subVectors(C,h).normalize(),c.push(d.x,d.y,d.z),I.push(v/a),I.push(y/o)}}for(var w=1;w<=a;w++)for(var S=1;S<=o;S++){var W=(o+1)*(w-1)+(S-1),x=(o+1)*w+(S-1),R=(o+1)*w+S,V=(o+1)*(w-1)+S;l.push(W,x,V),l.push(x,R,V)}function k(e,t,n,i,r){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,g=Math.cos(s);r.x=i*(2+g)*.5*a,r.y=i*(2+g)*o*.5,r.z=i*Math.sin(s)*.5}return e.setIndex(l),e.setAttribute("position",new IS(u,3)),e.setAttribute("normal",new IS(c,3)),e.setAttribute("uv",new IS(I,2)),e}return Ai(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}]),n}(bS),AX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ck(new KZ(-1,-1,0),new KZ(-1,1,0),new KZ(1,1,0)),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];di(this,n),(e=t.call(this)).type="TubeGeometry",e.parameters={path:i,tubularSegments:r,radius:a,radialSegments:o,closed:s};var g=i.computeFrenetFrames(r,s);e.tangents=g.tangents,e.normals=g.normals,e.binormals=g.binormals;var l=new KZ,u=new KZ,c=new sZ,I=new KZ,C=[],d=[],h=[],A=[];function p(){for(var e=0;e<r;e++)m(e);m(!1===s?r:0),v(),f()}function m(e){I=i.getPointAt(e/r,I);for(var t=g.normals[e],n=g.binormals[e],s=0;s<=o;s++){var c=s/o*Math.PI*2,h=Math.sin(c),A=-Math.cos(c);u.x=A*t.x+h*n.x,u.y=A*t.y+h*n.y,u.z=A*t.z+h*n.z,u.normalize(),d.push(u.x,u.y,u.z),l.x=I.x+a*u.x,l.y=I.y+a*u.y,l.z=I.z+a*u.z,C.push(l.x,l.y,l.z)}}function f(){for(var e=1;e<=r;e++)for(var t=1;t<=o;t++){var n=(o+1)*(e-1)+(t-1),i=(o+1)*e+(t-1),a=(o+1)*e+t,s=(o+1)*(e-1)+t;A.push(n,i,s),A.push(i,a,s)}}function v(){for(var e=0;e<=r;e++)for(var t=0;t<=o;t++)c.x=e/r,c.y=t/o,h.push(c.x,c.y)}return p(),e.setIndex(A),e.setAttribute("position",new IS(C,3)),e.setAttribute("normal",new IS(d,3)),e.setAttribute("uv",new IS(h,2)),e}return Ai(n,[{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this);return e.path=this.parameters.path.toJSON(),e}}],[{key:"fromJSON",value:function(e){return new n((new hk[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}]),n}(bS),pX=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(di(this,n),(e=t.call(this)).type="WireframeGeometry",e.parameters={geometry:i},null!==i){var r=[],a=new Set,o=new KZ,s=new KZ;if(null!==i.index){var g=i.attributes.position,l=i.index,u=i.groups;0===u.length&&(u=[{start:0,count:l.count,materialIndex:0}]);for(var c=0,I=u.length;c<I;++c)for(var C=u[c],d=C.start,h=C.count,A=d,p=d+h;A<p;A+=3)for(var m=0;m<3;m++){var f=l.getX(A+m),v=l.getX(A+(m+1)%3);o.fromBufferAttribute(g,f),s.fromBufferAttribute(g,v),!0===mX(o,s,a)&&(r.push(o.x,o.y,o.z),r.push(s.x,s.y,s.z))}}else for(var b=i.attributes.position,y=0,G=b.count/3;y<G;y++)for(var B=0;B<3;B++){var Z=3*y+B,w=3*y+(B+1)%3;o.fromBufferAttribute(b,Z),s.fromBufferAttribute(b,w),!0===mX(o,s,a)&&(r.push(o.x,o.y,o.z),r.push(s.x,s.y,s.z))}e.setAttribute("position",new IS(r,3))}return e}return Ai(n)}(bS);function mX(e,t,n){var i="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),r="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var fX=Object.freeze({__proto__:null,BoxGeometry:LS,BoxBufferGeometry:LS,CapsuleGeometry:fk,CapsuleBufferGeometry:fk,CircleGeometry:vk,CircleBufferGeometry:vk,ConeGeometry:yk,ConeBufferGeometry:yk,CylinderGeometry:bk,CylinderBufferGeometry:bk,DodecahedronGeometry:Bk,DodecahedronBufferGeometry:Bk,EdgesGeometry:xk,ExtrudeGeometry:oX,ExtrudeBufferGeometry:oX,IcosahedronGeometry:gX,IcosahedronBufferGeometry:gX,LatheGeometry:mk,LatheBufferGeometry:mk,OctahedronGeometry:lX,OctahedronBufferGeometry:lX,PlaneGeometry:sW,PlaneBufferGeometry:sW,PolyhedronGeometry:Gk,PolyhedronBufferGeometry:Gk,RingGeometry:uX,RingBufferGeometry:uX,ShapeGeometry:cX,ShapeBufferGeometry:cX,SphereGeometry:IX,SphereBufferGeometry:IX,TetrahedronGeometry:CX,TetrahedronBufferGeometry:CX,TorusGeometry:dX,TorusBufferGeometry:dX,TorusKnotGeometry:hX,TorusKnotBufferGeometry:hX,TubeGeometry:AX,TubeBufferGeometry:AX,WireframeGeometry:pX}),vX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isShadowMaterial=!0,i.type="ShadowMaterial",i.color=new BZ(0),i.transparent=!0,i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.fog=e.fog,this}}]),n}($w),bX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,e)).isRawShaderMaterial=!0,i.type="RawShaderMaterial",i}return Ai(n)}(JS),yX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshStandardMaterial=!0,i.defines={STANDARD:""},i.type="MeshStandardMaterial",i.color=new BZ(16777215),i.roughness=1,i.metalness=0,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new BZ(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=hB,i.normalScale=new sZ(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.roughnessMap=null,i.metalnessMap=null,i.alphaMap=null,i.envMap=null,i.envMapIntensity=1,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}($w),GX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshPhysicalMaterial=!0,i.defines={STANDARD:"",PHYSICAL:""},i.type="MeshPhysicalMaterial",i.clearcoatMap=null,i.clearcoatRoughness=0,i.clearcoatRoughnessMap=null,i.clearcoatNormalScale=new sZ(1,1),i.clearcoatNormalMap=null,i.ior=1.5,Object.defineProperty(Ni(i),"reflectivity",{get:function(){return eZ(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),i.iridescenceMap=null,i.iridescenceIOR=1.3,i.iridescenceThicknessRange=[100,400],i.iridescenceThicknessMap=null,i.sheenColor=new BZ(0),i.sheenColorMap=null,i.sheenRoughness=1,i.sheenRoughnessMap=null,i.transmissionMap=null,i.thickness=0,i.thicknessMap=null,i.attenuationDistance=0,i.attenuationColor=new BZ(1,1,1),i.specularIntensity=1,i.specularIntensityMap=null,i.specularColor=new BZ(1,1,1),i.specularColorMap=null,i._sheen=0,i._clearcoat=0,i._iridescence=0,i._transmission=0,i.setValues(e),i}return Ai(n,[{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}},{key:"iridescence",get:function(){return this._iridescence},set:function(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=Ci(e.iridescenceThicknessRange),this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}]),n}(yX),BX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshPhongMaterial=!0,i.type="MeshPhongMaterial",i.color=new BZ(16777215),i.specular=new BZ(1118481),i.shininess=30,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new BZ(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=hB,i.normalScale=new sZ(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=Wy,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}($w),ZX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshToonMaterial=!0,i.defines={TOON:""},i.type="MeshToonMaterial",i.color=new BZ(16777215),i.map=null,i.gradientMap=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new BZ(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=hB,i.normalScale=new sZ(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}($w),wX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshNormalMaterial=!0,i.type="MeshNormalMaterial",i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=hB,i.normalScale=new sZ(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.flatShading=!1,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}]),n}($w),SX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshLambertMaterial=!0,i.type="MeshLambertMaterial",i.color=new BZ(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new BZ(0),i.emissiveIntensity=1,i.emissiveMap=null,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=Wy,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}($w),WX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isMeshMatcapMaterial=!0,i.defines={MATCAP:""},i.type="MeshMatcapMaterial",i.color=new BZ(16777215),i.matcap=null,i.map=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=hB,i.normalScale=new sZ(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.flatShading=!1,i.fog=!0,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}($w),xX=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).isLineDashedMaterial=!0,i.type="LineDashedMaterial",i.scale=1,i.dashSize=3,i.gapSize=1,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(WV),RX={arraySlice:function(e,t,n){return RX.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,g=0;g!==t;++g)r[o++]=e[s+g];return r},flattenJSON:function(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}},subclip:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var g=a.tracks[s],l=g.getValueSize(),u=[],c=[],I=0;I<g.times.length;++I){var C=g.times[I]*r;if(!(C<n||C>=i)){u.push(g.times[I]);for(var d=0;d<l;++d)c.push(g.values[I*l+d])}}0!==u.length&&(g.times=RX.convertArray(u,g.times.constructor),g.values=RX.convertArray(c,g.values.constructor),o.push(g))}a.tracks=o;for(var h=1/0,A=0;A<a.tracks.length;++A)h>a.tracks[A].times[0]&&(h=a.tracks[A].times[0]);for(var p=0;p<a.tracks.length;++p)a.tracks[p].shift(-1*h);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);for(var r=n.tracks.length,a=t/i,o=function(t){var i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)return"continue";var o=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===o)return"continue";var s=0,g=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=g/3);var l=0,u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);var c=i.times.length-1,I=void 0;if(a<=i.times[0]){var C=s,d=g-s;I=RX.arraySlice(i.values,C,d)}else if(a>=i.times[c]){var h=c*g+s,A=h+g-s;I=RX.arraySlice(i.values,h,A)}else{var p=i.createInterpolant(),m=s,f=g-s;p.evaluate(a),I=RX.arraySlice(p.resultBuffer,m,f)}"quaternion"===r&&(new MZ).fromArray(I).normalize().conjugate().toArray(I);for(var v=o.times.length,b=0;b<v;++b){var y=b*u+l;if("quaternion"===r)MZ.multiplyQuaternionsFlat(o.values,y,I,0,o.values,y);else for(var G=u-2*l,B=0;B<G;++B)o.values[y+B]-=I[B]}},s=0;s<r;++s)o(s);return e.blendMode=sB,e}},VX=function(){function e(t,n,i,r){di(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}return Ai(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(r=i,e<(i=t[++n]))break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var g=n-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(n===g)break;if(i=r,e>=(r=t[--n-1]))break t}a=n,n=0}for(;n<a;){var l=n+a>>>1;e<t[l]?a=l:n=l+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),kX=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a){var o;return di(this,n),(o=t.call(this,e,i,r,a))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:iB,endingEnd:iB},o}return Ai(n,[{key:"intervalChanged_",value:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case rB:r=e,o=2*t-n;break;case aB:o=t+i[r=i.length-2]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case rB:a=e,s=2*n-t;break;case aB:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var g=.5*(n-t),l=this.valueSize;this._weightPrev=g/(t-o),this._weightNext=g/(s-n),this._offsetPrev=r*l,this._offsetNext=a*l}},{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,g=s-o,l=this._offsetPrev,u=this._offsetNext,c=this._weightPrev,I=this._weightNext,C=(n-t)/(i-t),d=C*C,h=d*C,A=-c*h+2*c*d-c*C,p=(1+c)*h+(-1.5-2*c)*d+(-.5+c)*C+1,m=(-1-I)*h+(1.5+I)*d+.5*C,f=I*h-I*d,v=0;v!==o;++v)r[v]=A*a[l+v]+p*a[g+v]+m*a[s+v]+f*a[u+v];return r}}]),n}(VX),XX=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a){return di(this,n),t.call(this,e,i,r,a)}return Ai(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,g=s-o,l=(n-t)/(i-t),u=1-l,c=0;c!==o;++c)r[c]=a[g+c]*u+a[s+c]*l;return r}}]),n}(VX),YX=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a){return di(this,n),t.call(this,e,i,r,a)}return Ai(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(VX),HX=function(){function e(t,n,i,r){if(di(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=RX.convertArray(n,this.TimeBufferType),this.values=RX.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}return Ai(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new YX(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new XX(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new kX(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case eB:t=this.InterpolantFactoryMethodDiscrete;break;case tB:t=this.InterpolantFactoryMethodLinear;break;case nB:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return eB;case this.InterpolantFactoryMethodLinear:return tB;case this.InterpolantFactoryMethodSmooth:return nB}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=RX.arraySlice(n,r,a),this.values=RX.arraySlice(this.values,r*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&RX.isTypedArray(i))for(var g=0,l=i.length;g!==l;++g){var u=i[g];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,g,u),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=RX.arraySlice(this.times),t=RX.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===nB,r=e.length-1,a=1,o=1;o<r;++o){var s=!1,g=e[o];if(g!==e[o+1]&&(1!==o||g!==e[0]))if(i)s=!0;else for(var l=o*n,u=l-n,c=l+n,I=0;I!==n;++I){var C=t[l+I];if(C!==t[u+I]||C!==t[c+I]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var d=o*n,h=a*n,A=0;A!==n;++A)t[h+A]=t[d+A]}++a}}if(r>0){e[a]=e[r];for(var p=r*n,m=a*n,f=0;f!==n;++f)t[m+f]=t[p+f];++a}return a!==e.length?(this.times=RX.arraySlice(e,0,a),this.values=RX.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=RX.arraySlice(this.times,0),t=RX.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:RX.convertArray(e.times,Array),values:RX.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}]),e}();HX.prototype.TimeBufferType=Float32Array,HX.prototype.ValueBufferType=Float32Array,HX.prototype.DefaultInterpolation=tB;var FX=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.apply(this,arguments)}return Ai(n)}(HX);FX.prototype.ValueTypeName="bool",FX.prototype.ValueBufferType=Array,FX.prototype.DefaultInterpolation=eB,FX.prototype.InterpolantFactoryMethodLinear=void 0,FX.prototype.InterpolantFactoryMethodSmooth=void 0;var MX=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.apply(this,arguments)}return Ai(n)}(HX);MX.prototype.ValueTypeName="color";var KX=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.apply(this,arguments)}return Ai(n)}(HX);KX.prototype.ValueTypeName="number";var NX=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a){return di(this,n),t.call(this,e,i,r,a)}return Ai(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t),g=e*o,l=g+o;g!==l;g+=4)MZ.slerpFlat(r,0,a,g-o,a,g,s);return r}}]),n}(VX),zX=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.apply(this,arguments)}return Ai(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new NX(this.times,this.values,this.getValueSize(),e)}}]),n}(HX);zX.prototype.ValueTypeName="quaternion",zX.prototype.DefaultInterpolation=tB,zX.prototype.InterpolantFactoryMethodSmooth=void 0;var LX=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.apply(this,arguments)}return Ai(n)}(HX);LX.prototype.ValueTypeName="string",LX.prototype.ValueBufferType=Array,LX.prototype.DefaultInterpolation=eB,LX.prototype.InterpolantFactoryMethodLinear=void 0,LX.prototype.InterpolantFactoryMethodSmooth=void 0;var _X=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.apply(this,arguments)}return Ai(n)}(HX);_X.prototype.ValueTypeName="vector";var TX=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:oB;di(this,e),this.name=t,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=$B(),this.duration<0&&this.resetDuration()}return Ai(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(EX(n[r]).scale(i));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},r=0,a=n.length;r!==a;++r)t.push(HX.toJSON(n[r]));return i}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],g=[];s.push((o+r-1)%r,o,(o+1)%r),g.push(0,1,0);var l=RX.getKeyframeOrder(s);s=RX.sortedArray(s,1,l),g=RX.sortedArray(g,1,l),i||0!==s[0]||(s.push(r),g.push(g[0])),a.push(new KX(".morphTargetInfluences["+t[o].name+"]",s,g).scale(1/n))}return new this(e,-1,a)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],g=s.name.match(r);if(g&&g.length>1){var l=g[1],u=i[l];u||(i[l]=u=[]),u.push(s)}}var c=[];for(var I in i)c.push(this.CreateFromMorphTargetSequence(I,i[I],t,n));return c}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];RX.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,g=e.hierarchy||[],l=0;l<g.length;l++){var u=g[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){var c={},I=void 0;for(I=0;I<u.length;I++)if(u[I].morphTargets)for(var C=0;C<u[I].morphTargets.length;C++)c[u[I].morphTargets[C]]=-1;for(var d in c){for(var h=[],A=[],p=0;p!==u[I].morphTargets.length;++p){var m=u[I];h.push(m.time),A.push(m.morphTarget===d?1:0)}i.push(new KX(".morphTargetInfluence["+d+"]",h,A))}s=c.length*a}else{var f=".bones["+t[l].name+"]";n(_X,f+".position",u,"pos",i),n(zX,f+".quaternion",u,"rot",i),n(_X,f+".scale",u,"scl",i)}}return 0===i.length?null:new this(r,s,i,o)}}]),e}();function EX(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return KX;case"vector":case"vector2":case"vector3":case"vector4":return _X;case"color":return MX;case"quaternion":return zX;case"bool":case"boolean":return FX;case"string":return LX}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];RX.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var JX,DX={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},UX=Ai((function e(t,n,i){di(this,e);var r=this,a=!1,o=0,s=0,g=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=i,this.itemStart=function(e){s++,!1===a&&void 0!==r.onStart&&r.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return g?g(e):e},this.setURLModifier=function(e){return g=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var i=l[t],r=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}})),PX=new UX,QX=function(){function e(t){di(this,e),this.manager=void 0!==t?t:PX,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return Ai(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),OX={},jX=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=DX.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;if(void 0===OX[e]){OX[e]=[],OX[e].push({onLoad:t,onProgress:n,onError:i});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,g=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;var n=OX[e],i=t.body.getReader(),r=t.headers.get("Content-Length"),a=r?parseInt(r):0,o=0!==a,s=0,g=new ReadableStream({start:function(e){!function t(){i.read().then((function(i){var r=i.done,g=i.value;if(r)e.close();else{s+=g.byteLength;for(var l=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a}),u=0,c=n.length;u<c;u++){var I=n[u];I.onProgress&&I.onProgress(l)}e.enqueue(g),t()}}))}()}});return new Response(g)}throw Error('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText))})).then((function(e){switch(g){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,s)}));case"json":return e.json();default:if(void 0===s)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((function(e){return i.decode(e)}))}})).then((function(t){DX.add(e,t);var n=OX[e];delete OX[e];for(var i=0,r=n.length;i<r;i++){var a=n[i];a.onLoad&&a.onLoad(t)}})).catch((function(t){var n=OX[e];if(void 0===n)throw r.manager.itemError(e),t;delete OX[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e)})).finally((function(){r.manager.itemEnd(e)})),this.manager.itemStart(e)}else OX[e].push({onLoad:t,onProgress:n,onError:i})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(QX),qX=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new jX(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(CL){i?i(CL):console.error(CL),r.manager.itemError(e)}}),n,i)}},{key:"parse",value:function(e){for(var t=[],n=0;n<e.length;n++){var i=TX.parse(e[n]);t.push(i)}return t}}]),n}(QX),$X=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=this,a=[],o=new PV,s=new jX(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials);var g=0;function l(l){s.load(e[l],(function(e){var n=r.parse(e,!0);a[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(g+=1)&&(1===n.mipmapCount&&(o.minFilter=jy),o.image=a,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,i)}if(Array.isArray(e))for(var u=0,c=e.length;u<c;++u)l(u);else s.load(e,(function(e){var n=r.parse(e,!0);if(n.isCubemap){for(var i=n.mipmaps.length/n.mipmapCount,s=0;s<i;s++){a[s]={mipmaps:[]};for(var g=0;g<n.mipmapCount;g++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+g]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=jy),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,i);return o}}]),n}(QX),eY=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=DX.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o=IZ("img");function s(){l(),DX.add(e,this),t&&t(this),r.manager.itemEnd(e)}function g(t){l(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function l(){o.removeEventListener("load",s,!1),o.removeEventListener("error",g,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",g,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}]),n}(QX),tY=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=new OS,a=new eY(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){r.images[n]=e,6===++o&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(var g=0;g<e.length;++g)s(g);return r}}]),n}(QX),nY=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new mV,o=new jX(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,(function(e){var n=r.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:Ey,a.wrapT=void 0!==n.wrapT?n.wrapT:Ey,a.magFilter=void 0!==n.magFilter?n.magFilter:jy,a.minFilter=void 0!==n.minFilter?n.minFilter:jy,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=eG),1===n.mipmapCount&&(a.minFilter=jy),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n))}),n,i),a}}]),n}(QX),iY=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=new xZ,a=new eY(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}]),n}(QX),rY=function(e){Li(n,e);var t=Di(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return di(this,n),(i=t.call(this)).isLight=!0,i.type="Light",i.color=new BZ(e),i.intensity=r,i}return Ai(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(zw),aY=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;return di(this,n),(a=t.call(this,e,r)).isHemisphereLight=!0,a.type="HemisphereLight",a.position.copy(zw.DefaultUp),a.updateMatrix(),a.groundColor=new BZ(i),a}return Ai(n,[{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.groundColor.copy(e.groundColor),this}}]),n}(rY),oY=new hw,sY=new KZ,gY=new KZ,lY=function(){function e(t){di(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new sZ(512,512),this.map=null,this.mapPass=null,this.matrix=new hw,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new rW,this._frameExtents=new sZ(1,1),this._viewportCount=1,this._viewports=[new RZ(0,0,1,1)]}return Ai(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;sY.setFromMatrixPosition(e.matrixWorld),t.position.copy(sY),gY.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(gY),t.updateMatrixWorld(),oY.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(oY),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),uY=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this,new US(50,1,.5,500))).isSpotLightShadow=!0,e.focus=1,e}return Ai(n,[{key:"updateMatrices",value:function(e){var t=this.camera,i=2*qB*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;i===t.fov&&r===t.aspect&&a===t.far||(t.fov=i,t.aspect=r,t.far=a,t.updateProjectionMatrix()),Rr(_i(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(lY),cY=function(e){Li(n,e);var t=Di(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return di(this,n),(r=t.call(this,e,i)).isSpotLight=!0,r.type="SpotLight",r.position.copy(zw.DefaultUp),r.updateMatrix(),r.target=new zw,r.distance=a,r.angle=o,r.penumbra=s,r.decay=g,r.shadow=new uY,r}return Ai(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(rY),IY=new hw,CY=new KZ,dY=new KZ,hY=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this,new US(90,1,.5,500))).isPointLightShadow=!0,e._frameExtents=new sZ(4,2),e._viewportCount=6,e._viewports=[new RZ(2,1,1,1),new RZ(0,1,1,1),new RZ(3,1,1,1),new RZ(1,1,1,1),new RZ(3,0,1,1),new RZ(1,0,1,1)],e._cubeDirections=[new KZ(1,0,0),new KZ(-1,0,0),new KZ(0,0,1),new KZ(0,0,-1),new KZ(0,1,0),new KZ(0,-1,0)],e._cubeUps=[new KZ(0,1,0),new KZ(0,1,0),new KZ(0,1,0),new KZ(0,1,0),new KZ(0,0,1),new KZ(0,0,-1)],e}return Ai(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),CY.setFromMatrixPosition(e.matrixWorld),n.position.copy(CY),dY.copy(n.position),dY.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(dY),n.updateMatrixWorld(),i.makeTranslation(-CY.x,-CY.y,-CY.z),IY.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(IY)}}]),n}(lY),AY=function(e){Li(n,e);var t=Di(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return di(this,n),(r=t.call(this,e,i)).isPointLight=!0,r.type="PointLight",r.distance=a,r.decay=o,r.shadow=new hY,r}return Ai(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(rY),pY=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this,new pW(-5,5,5,-5,.5,500))).isDirectionalLightShadow=!0,e}return Ai(n)}(lY),mY=function(e){Li(n,e);var t=Di(n);function n(e,i){var r;return di(this,n),(r=t.call(this,e,i)).isDirectionalLight=!0,r.type="DirectionalLight",r.position.copy(zw.DefaultUp),r.updateMatrix(),r.target=new zw,r.shadow=new pY,r}return Ai(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(rY),fY=function(e){Li(n,e);var t=Di(n);function n(e,i){var r;return di(this,n),(r=t.call(this,e,i)).isAmbientLight=!0,r.type="AmbientLight",r}return Ai(n)}(rY),vY=function(e){Li(n,e);var t=Di(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return di(this,n),(r=t.call(this,e,i)).isRectAreaLight=!0,r.type="RectAreaLight",r.width=a,r.height=o,r}return Ai(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(rY),bY=function(){function e(){di(this,e),this.isSphericalHarmonics3=!0,this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new KZ)}return Ai(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*i*1.092548),t.addScaledVector(a[5],i*r*1.092548),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],n*r*1.092548),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*r),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*i),t.addScaledVector(a[5],.858086*i*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],.858086*n*r),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}]),e}(),yY=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new bY,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return di(this,n),(e=t.call(this,void 0,r)).isLightProbe=!0,e.sh=i,e}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(rY),GY=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,e)).textures={},i}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new jX(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(CL){i?i(CL):console.error(CL),r.manager.itemError(e)}}),n,i)}},{key:"parse",value:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=n.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new BZ).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var a in e.uniforms){var o=e.uniforms[a];switch(r.uniforms[a]={},o.type){case"t":r.uniforms[a].value=i(o.value);break;case"c":r.uniforms[a].value=(new BZ).setHex(o.value);break;case"v2":r.uniforms[a].value=(new sZ).fromArray(o.value);break;case"v3":r.uniforms[a].value=(new KZ).fromArray(o.value);break;case"v4":r.uniforms[a].value=(new RZ).fromArray(o.value);break;case"m3":r.uniforms[a].value=(new gZ).fromArray(o.value);break;case"m4":r.uniforms[a].value=(new hw).fromArray(o.value);break;default:r.uniforms[a].value=o.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var s in e.extensions)r.extensions[s]=e.extensions[s];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.matcap&&(r.matcap=i(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var g=e.normalScale;!1===Array.isArray(g)&&(g=[g,g]),r.normalScale=(new sZ).fromArray(g)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=i(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=i(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new sZ).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=i(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=i(e.thicknessMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=i(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}},{key:"setTextures",value:function(e){return this.textures=e,this}}],[{key:"createMaterialFromType",value:function(e){return new{ShadowMaterial:vX,SpriteMaterial:UR,RawShaderMaterial:bX,ShaderMaterial:JS,PointsMaterial:NV,MeshPhysicalMaterial:GX,MeshStandardMaterial:yX,MeshPhongMaterial:BX,MeshToonMaterial:ZX,MeshNormalMaterial:wX,MeshLambertMaterial:SX,MeshDepthMaterial:BR,MeshDistanceMaterial:ZR,MeshBasicMaterial:eS,MeshMatcapMaterial:WX,LineDashedMaterial:xX,LineBasicMaterial:WV,Material:$w}[e]}}]),n}(QX),BY=function(){function e(){di(this,e)}return Ai(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(CL){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}(),ZY=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).isInstancedBufferGeometry=!0,e.type="InstancedBufferGeometry",e.instanceCount=1/0,e}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e=Rr(_i(n.prototype),"toJSON",this).call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(bS),wY=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new jX(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(CL){i?i(CL):console.error(CL),r.manager.itemError(e)}}),n,i)}},{key:"parse",value:function(e){var t={},n={};function i(e,i){if(void 0!==t[i])return t[i];var r=e.interleavedBuffers[i],a=function(e,t){if(void 0!==n[t])return n[t];var i=e.arrayBuffers[t],r=new Uint32Array(i).buffer;return n[t]=r,r}(e,r.buffer),o=cZ(r.type,a),s=new ER(o,r.stride);return s.uuid=r.uuid,t[i]=s,s}var r=e.isInstancedBufferGeometry?new ZY:new bS,a=e.data.index;if(void 0!==a){var o=cZ(a.type,a.array);r.setIndex(new iS(o,1))}var s=e.data.attributes;for(var g in s){var l=s[g],u=void 0;if(l.isInterleavedBufferAttribute){var c=i(e.data,l.data);u=new DR(c,l.itemSize,l.offset,l.normalized)}else{var I=cZ(l.type,l.array);u=new(l.isInstancedBufferAttribute?yV:iS)(I,l.itemSize,l.normalized)}void 0!==l.name&&(u.name=l.name),void 0!==l.usage&&u.setUsage(l.usage),void 0!==l.updateRange&&(u.updateRange.offset=l.updateRange.offset,u.updateRange.count=l.updateRange.count),r.setAttribute(g,u)}var C=e.data.morphAttributes;if(C)for(var d in C){for(var h=C[d],A=[],p=0,m=h.length;p<m;p++){var f=h[p],v=void 0;if(f.isInterleavedBufferAttribute){var b=i(e.data,f.data);v=new DR(b,f.itemSize,f.offset,f.normalized)}else{var y=cZ(f.type,f.array);v=new iS(y,f.itemSize,f.normalized)}void 0!==f.name&&(v.name=f.name),A.push(v)}r.morphAttributes[d]=A}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);var G=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==G)for(var B=0,Z=G.length;B!==Z;++B){var w=G[B];r.addGroup(w.start,w.count,w.materialIndex)}var S=e.data.boundingSphere;if(void 0!==S){var W=new KZ;void 0!==S.center&&W.fromArray(S.center),r.boundingSphere=new ow(W,S.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}]),n}(QX),SY=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=this,a=""===this.path?BY.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new jX(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){var a=null;try{a=JSON.parse(n)}catch(s){return void 0!==i&&i(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,i)}},{key:"loadAsync",value:function(){var e=Yb(Hb().mark((function e(t,n){var i,r,a,o,s,g;return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this,r=""===this.path?BY.extractUrlBase(t):this.path,this.resourcePath=this.resourcePath||r,(a=new jX(this.manager)).setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),e.next=9,a.loadAsync(t,n);case 9:if(o=e.sent,s=JSON.parse(o),void 0!==(g=s.metadata)&&void 0!==g.type&&"geometry"!==g.type.toLowerCase()){e.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+t);case 14:return e.next=16,i.parseAsync(s);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"parse",value:function(e,t){var n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,(function(){void 0!==t&&t(g)})),o=this.parseTextures(e.textures,a),s=this.parseMaterials(e.materials,o),g=this.parseObject(e.object,r,s,o,n),l=this.parseSkeletons(e.skeletons,g);if(this.bindSkeletons(g,l),void 0!==t){var u=!1;for(var c in a)if(a[c].data instanceof HTMLImageElement){u=!0;break}!1===u&&t(g)}return g}},{key:"parseAsync",value:function(){var e=Yb(Hb().mark((function e(t){var n,i,r,a,o,s,g,l;return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),e.next=5,this.parseImagesAsync(t.images);case 5:return a=e.sent,o=this.parseTextures(t.textures,a),s=this.parseMaterials(t.materials,o),g=this.parseObject(t.object,r,s,o,n),l=this.parseSkeletons(t.skeletons,g),this.bindSkeletons(g,l),e.abrupt("return",g);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseShapes",value:function(e){var t={};if(void 0!==e)for(var n=0,i=e.length;n<i;n++){var r=(new Rk).fromJSON(e[n]);t[r.uuid]=r}return t}},{key:"parseSkeletons",value:function(e,t){var n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(var r=0,a=e.length;r<a;r++){var o=(new bV).fromJSON(e[r],i);n[o.uuid]=o}return n}},{key:"parseGeometries",value:function(e,t){var n={};if(void 0!==e)for(var i=new wY,r=0,a=e.length;r<a;r++){var o=void 0,s=e[r];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=i.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:s.type in fX?o=fX[s.type].fromJSON(s,t):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(s.type,'"'))}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n}},{key:"parseMaterials",value:function(e,t){var n={},i={};if(void 0!==e){var r=new GY;r.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var g=[],l=0;l<s.materials.length;l++){var u=s.materials[l];void 0===n[u.uuid]&&(n[u.uuid]=r.parse(u)),g.push(n[u.uuid])}i[s.uuid]=g}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}},{key:"parseAnimations",value:function(e){var t={};if(void 0!==e)for(var n=0;n<e.length;n++){var i=e[n],r=TX.parse(i);t[r.uuid]=r}return t}},{key:"parseImages",value:function(e,t){var n,i=this,r={};function a(e){if("string"===typeof e){var t=e;return function(e){return i.manager.itemStart(e),n.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:cZ(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){var o=new UX(t);(n=new eY(o)).setCrossOrigin(this.crossOrigin);for(var s=0,g=e.length;s<g;s++){var l=e[s],u=l.url;if(Array.isArray(u)){for(var c=[],I=0,C=u.length;I<C;I++){var d=a(u[I]);null!==d&&(d instanceof HTMLImageElement?c.push(d):c.push(new mV(d.data,d.width,d.height)))}r[l.uuid]=new wZ(c)}else{var h=a(l.url);r[l.uuid]=new wZ(h)}}}return r}},{key:"parseImagesAsync",value:function(){var e=Yb(Hb().mark((function e(t){var n,i,r,a,o,s,g,l,u,c,I,C,d,h,A;return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(){return o=Yb(Hb().mark((function e(t){var i,a;return Hb().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=8;break}return a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i=t)?i:n.resourcePath+i,e.next=5,r.loadAsync(a);case 5:return e.abrupt("return",e.sent);case 8:if(!t.data){e.next=12;break}return e.abrupt("return",{data:cZ(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)},a=function(e){return o.apply(this,arguments)},n=this,i={},!(void 0!==t&&t.length>0)){e.next=33;break}(r=new eY(this.manager)).setCrossOrigin(this.crossOrigin),s=0,g=t.length;case 8:if(!(s<g)){e.next=33;break}if(l=t[s],u=l.url,!Array.isArray(u)){e.next=26;break}c=[],I=0,C=u.length;case 14:if(!(I<C)){e.next=23;break}return d=u[I],e.next=18,a(d);case 18:null!==(h=e.sent)&&(h instanceof HTMLImageElement?c.push(h):c.push(new mV(h.data,h.width,h.height)));case 20:I++,e.next=14;break;case 23:i[l.uuid]=new wZ(c),e.next=30;break;case 26:return e.next=28,a(l.url);case 28:A=e.sent,i[l.uuid]=new wZ(A);case 30:s++,e.next=8;break;case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseTextures",value:function(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var i={};if(void 0!==e)for(var r=0,a=e.length;r<a;r++){var o=e[r];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s=t[o.image],g=s.data,l=void 0;Array.isArray(g)?(l=new OS,6===g.length&&(l.needsUpdate=!0)):(l=g&&g.data?new mV:new xZ,g&&(l.needsUpdate=!0)),l.source=s,l.uuid=o.uuid,void 0!==o.name&&(l.name=o.name),void 0!==o.mapping&&(l.mapping=n(o.mapping,WY)),void 0!==o.offset&&l.offset.fromArray(o.offset),void 0!==o.repeat&&l.repeat.fromArray(o.repeat),void 0!==o.center&&l.center.fromArray(o.center),void 0!==o.rotation&&(l.rotation=o.rotation),void 0!==o.wrap&&(l.wrapS=n(o.wrap[0],xY),l.wrapT=n(o.wrap[1],xY)),void 0!==o.format&&(l.format=o.format),void 0!==o.type&&(l.type=o.type),void 0!==o.encoding&&(l.encoding=o.encoding),void 0!==o.minFilter&&(l.minFilter=n(o.minFilter,RY)),void 0!==o.magFilter&&(l.magFilter=n(o.magFilter,RY)),void 0!==o.anisotropy&&(l.anisotropy=o.anisotropy),void 0!==o.flipY&&(l.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(l.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(l.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(l.userData=o.userData),i[o.uuid]=l}return i}},{key:"parseObject",value:function(e,t,n,i,r){var a,o,s;function g(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,r=e.length;i<r;i++){var a=e[i];void 0===n[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(n[a])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function u(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":a=new TR,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new BZ(e.background):a.background=u(e.background)),void 0!==e.environment&&(a.environment=u(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new _R(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new LR(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":a=new US(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new pW(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new fY(e.color,e.intensity);break;case"DirectionalLight":a=new mY(e.color,e.intensity);break;case"PointLight":a=new AY(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new vY(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new cY(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new aY(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new yY).fromJSON(e);break;case"SkinnedMesh":o=g(e.geometry),s=l(e.material),a=new AV(o,s),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":o=g(e.geometry),s=l(e.material),a=new NS(o,s);break;case"InstancedMesh":o=g(e.geometry),s=l(e.material);var c=e.count,I=e.instanceMatrix,C=e.instanceColor;(a=new SV(o,s,c)).instanceMatrix=new yV(new Float32Array(I.array),16),void 0!==C&&(a.instanceColor=new yV(new Float32Array(C.array),C.itemSize));break;case"LOD":a=new uV;break;case"Line":a=new YV(g(e.geometry),l(e.material));break;case"LineLoop":a=new KV(g(e.geometry),l(e.material));break;case"LineSegments":a=new MV(g(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new EV(g(e.geometry),l(e.material));break;case"Sprite":a=new oV(l(e.material));break;case"Group":a=new VR;break;case"Bone":a=new pV;break;default:a=new zw}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children)for(var d=e.children,h=0;h<d.length;h++)a.add(this.parseObject(d[h],t,n,i,r));if(void 0!==e.animations)for(var A=e.animations,p=0;p<A.length;p++){var m=A[p];a.animations.push(r[m])}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);for(var f=e.levels,v=0;v<f.length;v++){var b=f[v],y=a.getObjectByProperty("uuid",b.object);void 0!==y&&a.addLevel(y,b.distance)}}return a}},{key:"bindSkeletons",value:function(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){var n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}},{key:"setTexturePath",value:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}]),n}(QX),WY={UVMapping:My,CubeReflectionMapping:Ky,CubeRefractionMapping:Ny,EquirectangularReflectionMapping:zy,EquirectangularRefractionMapping:Ly,CubeUVReflectionMapping:_y},xY={RepeatWrapping:Ty,ClampToEdgeWrapping:Ey,MirroredRepeatWrapping:Jy},RY={NearestFilter:Dy,NearestMipmapNearestFilter:Uy,NearestMipmapLinearFilter:Qy,LinearFilter:jy,LinearMipmapNearestFilter:qy,LinearMipmapLinearFilter:eG},VY=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,e)).isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),i.options={premultiplyAlpha:"none"},i}return Ai(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=DX.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){DX.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}]),n}(QX),kY={getContext:function(){return void 0===JX&&(JX=new(window.AudioContext||window.webkitAudioContext)),JX},setContext:function(e){JX=e}},XY=function(e){Li(n,e);var t=Di(n);function n(e){return di(this,n),t.call(this,e)}return Ai(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new jX(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{var a=n.slice(0);kY.getContext().decodeAudioData(a,(function(e){t(e)}))}catch(CL){i?i(CL):console.error(CL),r.manager.itemError(e)}}),n,i)}}]),n}(QX),YY=function(e){Li(n,e);var t=Di(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;di(this,n),(r=t.call(this,void 0,a)).isHemisphereLightProbe=!0;var o=(new BZ).set(e),s=(new BZ).set(i),g=new KZ(o.r,o.g,o.b),l=new KZ(s.r,s.g,s.b),u=Math.sqrt(Math.PI),c=u*Math.sqrt(.75);return r.sh.coefficients[0].copy(g).add(l).multiplyScalar(u),r.sh.coefficients[1].copy(g).sub(l).multiplyScalar(c),r}return Ai(n)}(yY),HY=function(e){Li(n,e);var t=Di(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;di(this,n),(i=t.call(this,void 0,r)).isAmbientLightProbe=!0;var a=(new BZ).set(e);return i.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI)),i}return Ai(n)}(yY),FY=new hw,MY=new hw,KY=new hw,NY=function(){function e(){di(this,e),this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new US,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new US,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}return Ai(e,[{key:"update",value:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,KY.copy(e.projectionMatrix);var n,i,r=t.eyeSep/2,a=r*t.near/t.focus,o=t.near*Math.tan(jB*t.fov*.5)/t.zoom;MY.elements[12]=-r,FY.elements[12]=r,n=-o*t.aspect+a,i=o*t.aspect+a,KY.elements[0]=2*t.near/(i-n),KY.elements[8]=(i+n)/(i-n),this.cameraL.projectionMatrix.copy(KY),n=-o*t.aspect-a,i=o*t.aspect-a,KY.elements[0]=2*t.near/(i-n),KY.elements[8]=(i+n)/(i-n),this.cameraR.projectionMatrix.copy(KY)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(MY),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(FY)}}]),e}(),zY=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];di(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return Ai(e,[{key:"start",value:function(){this.startTime=LY(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=LY();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function LY(){return("undefined"===typeof performance?Date:performance).now()}var _Y=new KZ,TY=new MZ,EY=new KZ,JY=new KZ,DY=function(e){Li(n,e);var t=Di(n);function n(){var e;return di(this,n),(e=t.call(this)).type="AudioListener",e.context=kY.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new zY,e}return Ai(n,[{key:"getInput",value:function(){return this.gain}},{key:"removeFilter",value:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}},{key:"getMasterVolume",value:function(){return this.gain.gain.value}},{key:"setMasterVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},{key:"updateMatrixWorld",value:function(e){Rr(_i(n.prototype),"updateMatrixWorld",this).call(this,e);var t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_Y,TY,EY),JY.set(0,0,-1).applyQuaternion(TY),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(_Y.x,r),t.positionY.linearRampToValueAtTime(_Y.y,r),t.positionZ.linearRampToValueAtTime(_Y.z,r),t.forwardX.linearRampToValueAtTime(JY.x,r),t.forwardY.linearRampToValueAtTime(JY.y,r),t.forwardZ.linearRampToValueAtTime(JY.z,r),t.upX.linearRampToValueAtTime(i.x,r),t.upY.linearRampToValueAtTime(i.y,r),t.upZ.linearRampToValueAtTime(i.z,r)}else t.setPosition(_Y.x,_Y.y,_Y.z),t.setOrientation(JY.x,JY.y,JY.z,i.x,i.y,i.z)}}]),n}(zw),UY=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this)).type="Audio",i.listener=e,i.context=e.context,i.gain=i.context.createGain(),i.gain.connect(e.getInput()),i.autoplay=!1,i.buffer=null,i.detune=0,i.loop=!1,i.loopStart=0,i.loopEnd=0,i.offset=0,i.duration=void 0,i.playbackRate=1,i.isPlaying=!1,i.hasPlaybackControl=!0,i.source=null,i.sourceType="empty",i._startedAt=0,i._progress=0,i._connected=!1,i.filters=[],i}return Ai(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(zw),PY=new KZ,QY=new MZ,OY=new KZ,jY=new KZ,qY=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,e)).panner=i.context.createPanner(),i.panner.panningModel="HRTF",i.panner.connect(i.gain),i}return Ai(n,[{key:"disconnect",value:function(){Rr(_i(n.prototype),"disconnect",this).call(this),this.panner.disconnect(this.gain)}},{key:"getOutput",value:function(){return this.panner}},{key:"getRefDistance",value:function(){return this.panner.refDistance}},{key:"setRefDistance",value:function(e){return this.panner.refDistance=e,this}},{key:"getRolloffFactor",value:function(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function(e){return this.panner.rolloffFactor=e,this}},{key:"getDistanceModel",value:function(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function(e){return this.panner.distanceModel=e,this}},{key:"getMaxDistance",value:function(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function(e){return this.panner.maxDistance=e,this}},{key:"setDirectionalCone",value:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}},{key:"updateMatrixWorld",value:function(e){if(Rr(_i(n.prototype),"updateMatrixWorld",this).call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(PY,QY,OY),jY.set(0,0,1).applyQuaternion(QY);var t=this.panner;if(t.positionX){var i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(PY.x,i),t.positionY.linearRampToValueAtTime(PY.y,i),t.positionZ.linearRampToValueAtTime(PY.z,i),t.orientationX.linearRampToValueAtTime(jY.x,i),t.orientationY.linearRampToValueAtTime(jY.y,i),t.orientationZ.linearRampToValueAtTime(jY.z,i)}else t.setPosition(PY.x,PY.y,PY.z),t.setOrientation(jY.x,jY.y,jY.z)}}}]),n}(UY),$Y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;di(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return Ai(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}]),e}(),eH=function(){function e(t,n,i){var r,a,o;switch(di(this,e),this.binding=t,this.valueSize=i,n){case"quaternion":r=this._slerp,a=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,a=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return Ai(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){var s=t*this._origIndex;this._mixBufferRegion(n,i,s,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(var g=t,l=t+t;g!==l;++g)if(n[g]!==n[g+t]){o.setValue(n,i);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(var r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]}},{key:"_slerp",value:function(e,t,n,i){MZ.slerpFlat(e,t,e,t,e,n,i)}},{key:"_slerpAdditive",value:function(e,t,n,i,r){var a=this._workIndex*r;MZ.multiplyQuaternionsFlat(e,a,e,t,e,n),MZ.slerpFlat(e,t,e,t,e,a,i)}},{key:"_lerp",value:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}},{key:"_lerpAdditive",value:function(e,t,n,i,r){for(var a=0;a!==r;++a){var o=t+a;e[o]=e[o]+e[n+a]*i}}}]),e}(),tH="\\[\\]\\.:\\/",nH=new RegExp("[\\[\\]\\.:\\/]","g"),iH="[^\\[\\]\\.:\\/]",rH="[^"+tH.replace("\\.","")+"]",aH=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",iH)+/(WCOD+)?/.source.replace("WCOD",rH)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",iH)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",iH)+"$"),oH=["material","materials","bones"],sH=function(){function e(t,n,i){di(this,e);var r=i||gH.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,r)}return Ai(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),gH=function(){function e(t,n,i){di(this,e),this.path=n,this.parsedPath=i||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return Ai(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,i=n.objectName,r=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var o=n.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var g=t[r];if(void 0!==g){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}u=this.BindingType.ArrayElement,this.resolvedProperty=g,this.propertyIndex=a}else void 0!==g.fromArray&&void 0!==g.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=g):Array.isArray(g)?(u=this.BindingType.EntireArray,this.resolvedProperty=g):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,i){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,i):new e(t,n,i)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(nH,"")}},{key:"parseTrackName",value:function(e){var t=aH.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==oH.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function e(n){for(var i=0;i<n.length;i++){var r=n[i];if(r.name===t||r.uuid===t)return r;var a=e(r.children);if(a)return a}return null}(e.children);if(i)return i}return null}}]),e}();gH.Composite=sH,gH.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},gH.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},gH.prototype.GetterByBindingType=[gH.prototype._getValue_direct,gH.prototype._getValue_array,gH.prototype._getValue_arrayElement,gH.prototype._getValue_toArray],gH.prototype.SetterByBindingTypeAndVersioning=[[gH.prototype._setValue_direct,gH.prototype._setValue_direct_setNeedsUpdate,gH.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[gH.prototype._setValue_array,gH.prototype._setValue_array_setNeedsUpdate,gH.prototype._setValue_array_setMatrixWorldNeedsUpdate],[gH.prototype._setValue_arrayElement,gH.prototype._setValue_arrayElement_setNeedsUpdate,gH.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[gH.prototype._setValue_fromArray,gH.prototype._setValue_fromArray_setNeedsUpdate,gH.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var lH=function(){function e(){di(this,e),this.isAnimationObjectGroup=!0,this.uuid=$B(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}return Ai(e,[{key:"add",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,a=r.length,o=void 0,s=e.length,g=this.nCachedObjects_,l=0,u=arguments.length;l!==u;++l){var c=arguments[l],I=c.uuid,C=t[I];if(void 0===C){C=s++,t[I]=C,e.push(c);for(var d=0,h=a;d!==h;++d)r[d].push(new gH(c,n[d],i[d]))}else if(C<g){o=e[C];var A=--g,p=e[A];t[p.uuid]=C,e[C]=p,t[I]=A,e[A]=c;for(var m=0,f=a;m!==f;++m){var v=r[m],b=v[A],y=v[C];v[C]=b,void 0===y&&(y=new gH(c,n[m],i[m])),v[A]=y}}else e[C]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=g}},{key:"remove",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],g=s.uuid,l=t[g];if(void 0!==l&&l>=r){var u=r++,c=e[u];t[c.uuid]=l,e[l]=c,t[g]=u,e[u]=s;for(var I=0,C=i;I!==C;++I){var d=n[I],h=d[u],A=d[l];d[l]=h,d[u]=A}}}this.nCachedObjects_=r}},{key:"uncache",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length,r=this.nCachedObjects_,a=e.length,o=0,s=arguments.length;o!==s;++o){var g=arguments[o],l=g.uuid,u=t[l];if(void 0!==u)if(delete t[l],u<r){var c=--r,I=e[c],C=--a,d=e[C];t[I.uuid]=u,e[u]=I,t[d.uuid]=c,e[c]=d,e.pop();for(var h=0,A=i;h!==A;++h){var p=n[h],m=p[c],f=p[C];p[u]=m,p[c]=f,p.pop()}}else{var v=--a,b=e[v];v>0&&(t[b.uuid]=u),e[u]=b,e.pop();for(var y=0,G=i;y!==G;++y){var B=n[y];B[u]=B[v],B.pop()}}}this.nCachedObjects_=r}},{key:"subscribe_",value:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];var a=this._paths,o=this._parsedPaths,s=this._objects,g=s.length,l=this.nCachedObjects_,u=new Array(g);i=r.length,n[e]=i,a.push(e),o.push(t),r.push(u);for(var c=l,I=s.length;c!==I;++c){var C=s[c];u[c]=new gH(C,e,t)}return u}},{key:"unsubscribe_",value:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}]),e}(),uH=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;di(this,e),this._mixer=t,this._clip=n,this._localRoot=i,this.blendMode=r;for(var a=n.tracks,o=a.length,s=new Array(o),g={endingStart:iB,endingEnd:iB},l=0;l!==o;++l){var u=a[l].createInterpolant(null);s[l]=u,u.settings=g}this._interpolantSettings=g,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=qG,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return Ai(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var i=this._mixer,r=i.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,g=o.sampleValues;return s[0]=r,s[1]=r+n,g[0]=e/a,g[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(e-r)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var g=this._interpolants,l=this._propertyBindings;if(this.blendMode===sB)for(var u=0,c=g.length;u!==c;++u)g[u].evaluate(o),l[u].accumulateAdditive(s);else for(var I=0,C=g.length;I!==C;++I)g[I].evaluate(o),l[I].accumulate(i,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,a=n===$G;if(0===e)return-1===r?i:a&&1===(1&r)?t-i:i;if(n===jG){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){var o=Math.floor(i/t);i-=t*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var g=e<0;this._setEndings(g,!g,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&1===(1&r))return t-i}return i}},{key:"_setEndings",value:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=rB,i.endingEnd=rB):(i.endingStart=e?this.zeroSlopeAtStart?rB:iB:aB,i.endingEnd=t?this.zeroSlopeAtEnd?rB:iB:aB)}},{key:"_scheduleFading",value:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}]),e}(),cH=new Float32Array(1),IH=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this))._root=e,i._initMemoryManager(),i._accuIndex=0,i.time=0,i.timeScale=1,i}return Ai(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,g=this._bindingsByRootAndName,l=g[s];void 0===l&&(l={},g[s]=l);for(var u=0;u!==r;++u){var c=i[u],I=c.name,C=l[I];if(void 0!==C)++C.referenceCount,a[u]=C;else{if(void 0!==(C=a[u])){null===C._cacheIndex&&(++C.referenceCount,this._addInactiveBinding(C,s,I));continue}var d=t&&t._propertyBindings[u].binding.parsedPath;++(C=new eH(gH.create(n,I,d),c.ValueTypeName,c.getValueSize())).referenceCount,this._addInactiveBinding(C,s,I),a[u]=C}o[u].resultBuffer=C.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,g=s[s.length-1],l=e._byClipCacheIndex;g._byClipCacheIndex=l,s[l]=g,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.referenceCount&&this._removeInactiveBinding(r)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_addInactiveBinding",value:function(e,t,n){var i=this._bindingsByRootAndName,r=this._bindings,a=i[t];void 0===a&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],g=e._cacheIndex;s._cacheIndex=g,t[g]=s,t.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new XX(new Float32Array(2),new Float32Array(2),1,cH)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}},{key:"clipAction",value:function(e,t,n){var i=t||this._root,r=i.uuid,a="string"===typeof e?TX.findByName(i,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],g=null;if(void 0===n&&(n=null!==a?a.blendMode:oB),void 0!==s){var l=s.actionByRoot[r];if(void 0!==l&&l.blendMode===n)return l;g=s.knownActions[0],null===a&&(a=g._clip)}if(null===a)return null;var u=new uH(this,a,t,n);return this._bindAction(u,g),this._addInactiveAction(u,o,r),u}},{key:"existingAction",value:function(e,t){var n=t||this._root,i=n.uuid,r="string"===typeof e?TX.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(i,e,r,a)}for(var s=this._bindings,g=this._nActiveBindings,l=0;l!==g;++l)s[l].apply(a);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var g=a[o];this._deactivateAction(g);var l=g._cacheIndex,u=t[t.length-1];g._cacheIndex=null,g._byClipCacheIndex=null,u._cacheIndex=l,t[l]=u,t.pop(),this._removeInactiveBindingsForAction(g)}delete i[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}(PB),CH=function(){function e(t){di(this,e),"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}return Ai(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}(),dH=function(e){Li(n,e);var t=Di(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return di(this,n),(r=t.call(this,e,i)).isInstancedInterleavedBuffer=!0,r.meshPerAttribute=a,r}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=Rr(_i(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=Rr(_i(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n}(ER),hH=function(){function e(t,n,i,r,a){di(this,e),this.isGLBufferAttribute=!0,this.buffer=t,this.type=n,this.itemSize=i,this.elementSize=r,this.count=a,this.version=0}return Ai(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setBuffer",value:function(e){return this.buffer=e,this}},{key:"setType",value:function(e,t){return this.type=e,this.elementSize=t,this}},{key:"setItemSize",value:function(e){return this.itemSize=e,this}},{key:"setCount",value:function(e){return this.count=e,this}}]),e}(),AH=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;di(this,e),this.ray=new dw(t,n),this.near=i,this.far=r,this.camera=null,this.layers=new ww,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return Ai(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return mH(e,this,n,t),n.sort(pH),n}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=0,r=e.length;i<r;i++)mH(e[i],this,n,t);return n.sort(pH),n}}]),e}();function pH(e,t){return e.distance-t.distance}function mH(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i)for(var r=e.children,a=0,o=r.length;a<o;a++)mH(r[a],t,n,!0)}var fH=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return di(this,e),this.radius=t,this.phi=n,this.theta=i,this}return Ai(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(eZ(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),vH=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return di(this,e),this.radius=t,this.theta=n,this.y=i,this}return Ai(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),bH=new sZ,yH=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sZ(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new sZ(-1/0,-1/0);di(this,e),this.isBox2=!0,this.min=t,this.max=n}return Ai(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=bH.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return bH.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),GH=new KZ,BH=new KZ,ZH=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ;di(this,e),this.start=t,this.end=n}return Ai(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){GH.subVectors(e,this.start),BH.subVectors(this.end,this.start);var n=BH.dot(BH),i=BH.dot(GH)/n;return t&&(i=eZ(i,0,1)),i}},{key:"closestPointToPoint",value:function(e,t,n){var i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),wH=new KZ,SH=function(e){Li(n,e);var t=Di(n);function n(e,i){var r;di(this,n),(r=t.call(this)).light=e,r.light.updateMatrixWorld(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.color=i;for(var a=new bS,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,g=1;s<32;s++,g++){var l=s/32*Math.PI*2,u=g/32*Math.PI*2;o.push(Math.cos(l),Math.sin(l),1,Math.cos(u),Math.sin(u),1)}a.setAttribute("position",new IS(o,3));var c=new WV({fog:!1,toneMapped:!1});return r.cone=new MV(a,c),r.add(r.cone),r.update(),r}return Ai(n,[{key:"dispose",value:function(){this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),wH.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(wH),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}]),n}(zw),WH=new KZ,xH=new hw,RH=new hw,VH=function(e){Li(n,e);var t=Di(n);function n(e){var i;di(this,n);for(var r=kH(e),a=new bS,o=[],s=[],g=new BZ(0,0,1),l=new BZ(0,1,0),u=0;u<r.length;u++){var c=r[u];c.parent&&c.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(g.r,g.g,g.b),s.push(l.r,l.g,l.b))}a.setAttribute("position",new IS(o,3)),a.setAttribute("color",new IS(s,3));var I=new WV({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(i=t.call(this,a,I)).isSkeletonHelper=!0,i.type="SkeletonHelper",i.root=e,i.bones=r,i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i}return Ai(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,i=this.geometry,r=i.getAttribute("position");RH.copy(this.root.matrixWorld).invert();for(var a=0,o=0;a<t.length;a++){var s=t[a];s.parent&&s.parent.isBone&&(xH.multiplyMatrices(RH,s.matrixWorld),WH.setFromMatrixPosition(xH),r.setXYZ(o,WH.x,WH.y,WH.z),xH.multiplyMatrices(RH,s.parent.matrixWorld),WH.setFromMatrixPosition(xH),r.setXYZ(o+1,WH.x,WH.y,WH.z),o+=2)}i.getAttribute("position").needsUpdate=!0,Rr(_i(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(MV);function kH(e){var t=[];!0===e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,kH(e.children[n]));return t}var XH=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;di(this,n);var o=new IX(i,4,2),s=new eS({wireframe:!0,fog:!1,toneMapped:!1});return(a=t.call(this,o,s)).light=e,a.light.updateMatrixWorld(),a.color=r,a.type="PointLightHelper",a.matrix=a.light.matrixWorld,a.matrixAutoUpdate=!1,a.update(),a}return Ai(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}]),n}(NS),YH=new KZ,HH=new BZ,FH=new BZ,MH=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;di(this,n),(a=t.call(this)).light=e,a.light.updateMatrixWorld(),a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=r;var o=new lX(i);o.rotateY(.5*Math.PI),a.material=new eS({wireframe:!0,fog:!1,toneMapped:!1}),void 0===a.color&&(a.material.vertexColors=!0);var s=o.getAttribute("position"),g=new Float32Array(3*s.count);return o.setAttribute("color",new iS(g,3)),a.add(new NS(o,a.material)),a.update(),a}return Ai(n,[{key:"dispose",value:function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}},{key:"update",value:function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");HH.copy(this.light.color),FH.copy(this.light.groundColor);for(var n=0,i=t.count;n<i;n++){var r=n<i/2?HH:FH;t.setXYZ(n,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(YH.setFromMatrixPosition(this.light.matrixWorld).negate())}}]),n}(zw),KH=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;di(this,n),a=new BZ(a),o=new BZ(o);for(var s=r/2,g=i/r,l=i/2,u=[],c=[],I=0,C=0,d=-l;I<=r;I++,d+=g){u.push(-l,0,d,l,0,d),u.push(d,0,-l,d,0,l);var h=I===s?a:o;h.toArray(c,C),C+=3,h.toArray(c,C),C+=3,h.toArray(c,C),C+=3,h.toArray(c,C),C+=3}var A=new bS;A.setAttribute("position",new IS(u,3)),A.setAttribute("color",new IS(c,3));var p=new WV({vertexColors:!0,toneMapped:!1});return(e=t.call(this,A,p)).type="GridHelper",e}return Ai(n)}(MV),NH=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;di(this,n),s=new BZ(s),g=new BZ(g);for(var l=[],u=[],c=0;c<=r;c++){var I=c/r*(2*Math.PI),C=Math.sin(I)*i,d=Math.cos(I)*i;l.push(0,0,0),l.push(C,0,d);var h=1&c?s:g;u.push(h.r,h.g,h.b),u.push(h.r,h.g,h.b)}for(var A=0;A<=a;A++)for(var p=1&A?s:g,m=i-i/a*A,f=0;f<o;f++){var v=f/o*(2*Math.PI),b=Math.sin(v)*m,y=Math.cos(v)*m;l.push(b,0,y),u.push(p.r,p.g,p.b),v=(f+1)/o*(2*Math.PI),b=Math.sin(v)*m,y=Math.cos(v)*m,l.push(b,0,y),u.push(p.r,p.g,p.b)}var G=new bS;G.setAttribute("position",new IS(l,3)),G.setAttribute("color",new IS(u,3));var B=new WV({vertexColors:!0,toneMapped:!1});return(e=t.call(this,G,B)).type="PolarGridHelper",e}return Ai(n)}(MV),zH=new KZ,LH=new KZ,_H=new KZ,TH=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;di(this,n),(a=t.call(this)).light=e,a.light.updateMatrixWorld(),a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=r,void 0===i&&(i=1);var o=new bS;o.setAttribute("position",new IS([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));var s=new WV({fog:!1,toneMapped:!1});return a.lightPlane=new YV(o,s),a.add(a.lightPlane),(o=new bS).setAttribute("position",new IS([0,0,0,0,0,1],3)),a.targetLine=new YV(o,s),a.add(a.targetLine),a.update(),a}return Ai(n,[{key:"dispose",value:function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}},{key:"update",value:function(){zH.setFromMatrixPosition(this.light.matrixWorld),LH.setFromMatrixPosition(this.light.target.matrixWorld),_H.subVectors(LH,zH),this.lightPlane.lookAt(LH),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(LH),this.targetLine.scale.z=_H.length()}}]),n}(zw),EH=new KZ,JH=new DS,DH=function(e){Li(n,e);var t=Di(n);function n(e){var i;di(this,n);var r=new bS,a=new WV({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],g={};function l(e,t){u(e),u(t)}function u(e){o.push(0,0,0),s.push(0,0,0),void 0===g[e]&&(g[e]=[]),g[e].push(o.length/3-1)}l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4"),r.setAttribute("position",new IS(o,3)),r.setAttribute("color",new IS(s,3)),(i=t.call(this,r,a)).type="CameraHelper",i.camera=e,i.camera.updateProjectionMatrix&&i.camera.updateProjectionMatrix(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.pointMap=g,i.update();var c=new BZ(16755200),I=new BZ(16711680),C=new BZ(43775),d=new BZ(16777215),h=new BZ(3355443);return i.setColors(c,I,C,d,h),i}return Ai(n,[{key:"setColors",value:function(e,t,n,i,r){var a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}},{key:"update",value:function(){var e=this.geometry,t=this.pointMap;JH.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),UH("c",t,e,JH,0,0,-1),UH("t",t,e,JH,0,0,1),UH("n1",t,e,JH,-1,-1,-1),UH("n2",t,e,JH,1,-1,-1),UH("n3",t,e,JH,-1,1,-1),UH("n4",t,e,JH,1,1,-1),UH("f1",t,e,JH,-1,-1,1),UH("f2",t,e,JH,1,-1,1),UH("f3",t,e,JH,-1,1,1),UH("f4",t,e,JH,1,1,1),UH("u1",t,e,JH,.7,1.1,-1),UH("u2",t,e,JH,-.7,1.1,-1),UH("u3",t,e,JH,0,2,-1),UH("cf1",t,e,JH,-1,0,1),UH("cf2",t,e,JH,1,0,1),UH("cf3",t,e,JH,0,-1,1),UH("cf4",t,e,JH,0,1,1),UH("cn1",t,e,JH,-1,0,-1),UH("cn2",t,e,JH,1,0,-1),UH("cn3",t,e,JH,0,-1,-1),UH("cn4",t,e,JH,0,1,-1),e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(MV);function UH(e,t,n,i,r,a,o){EH.set(r,a,o).unproject(i);var s=t[e];if(void 0!==s)for(var g=n.getAttribute("position"),l=0,u=s.length;l<u;l++)g.setXYZ(s[l],EH.x,EH.y,EH.z)}var PH,QH,OH=new LZ,jH=function(e){Li(n,e);var t=Di(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;di(this,n);var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),s=new bS;return s.setIndex(new iS(a,1)),s.setAttribute("position",new iS(o,3)),(i=t.call(this,s,new WV({color:r,toneMapped:!1}))).object=e,i.type="BoxHelper",i.matrixAutoUpdate=!1,i.update(),i}return Ai(n,[{key:"update",value:function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&OH.setFromObject(this.object),!OH.isEmpty()){var t=OH.min,n=OH.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}},{key:"setFromObject",value:function(e){return this.object=e,this.update(),this}},{key:"copy",value:function(e,t){return Rr(_i(n.prototype),"copy",this).call(this,e,t),this.object=e.object,this}}]),n}(MV),qH=function(e){Li(n,e);var t=Di(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;di(this,n);var a=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new bS;return s.setIndex(new iS(a,1)),s.setAttribute("position",new IS(o,3)),(i=t.call(this,s,new WV({color:r,toneMapped:!1}))).box=e,i.type="Box3Helper",i.geometry.computeBoundingSphere(),i}return Ai(n,[{key:"updateMatrixWorld",value:function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Rr(_i(n.prototype),"updateMatrixWorld",this).call(this,e))}}]),n}(MV),$H=function(e){Li(n,e);var t=Di(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960;di(this,n);var o=a,s=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],g=new bS;g.setAttribute("position",new IS(s,3)),g.computeBoundingSphere(),(i=t.call(this,g,new WV({color:o,toneMapped:!1}))).type="PlaneHelper",i.plane=e,i.size=r;var l=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],u=new bS;return u.setAttribute("position",new IS(l,3)),u.computeBoundingSphere(),i.add(new NS(u,new eS({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),i}return Ai(n,[{key:"updateMatrixWorld",value:function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?Pb:Ub,this.lookAt(this.plane.normal),Rr(_i(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(YV),eF=new KZ,tF=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new KZ(0,0,1),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new KZ(0,0,0),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*a,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*s;return di(this,n),(e=t.call(this)).type="ArrowHelper",void 0===PH&&((PH=new bS).setAttribute("position",new IS([0,0,0,0,1,0],3)),(QH=new bk(0,.5,1,5,1)).translate(0,-.5,0)),e.position.copy(r),e.line=new YV(PH,new WV({color:o,toneMapped:!1})),e.line.matrixAutoUpdate=!1,e.add(e.line),e.cone=new NS(QH,new eS({color:o,toneMapped:!1})),e.cone.matrixAutoUpdate=!1,e.add(e.cone),e.setDirection(i),e.setLength(a,s,g),e}return Ai(n,[{key:"setDirection",value:function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{eF.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(eF,t)}}},{key:"setLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}},{key:"setColor",value:function(e){this.line.material.color.set(e),this.cone.material.color.set(e)}},{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}]),n}(zw),nF=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;di(this,n);var r=[0,0,0,i,0,0,0,0,0,0,i,0,0,0,0,0,0,i],a=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],o=new bS;o.setAttribute("position",new IS(r,3)),o.setAttribute("color",new IS(a,3));var s=new WV({vertexColors:!0,toneMapped:!1});return(e=t.call(this,o,s)).type="AxesHelper",e}return Ai(n,[{key:"setColors",value:function(e,t,n){var i=new BZ,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(MV),iF=function(){function e(){di(this,e),this.type="ShapePath",this.color=new BZ,this.subPaths=[],this.currentPath=null}return Ai(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new pk,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){return this.currentPath.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){return this.currentPath.bezierCurveTo(e,t,n,i,r,a),this}},{key:"splineThru",value:function(e){return this.currentPath.splineThru(e),this}},{key:"toShapes",value:function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],a=new Rk;a.curves=r.curves,t.push(a)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,a=0;a<n;r=a++){var o=t[r],s=t[a],g=s.x-o.x,l=s.y-o.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(o=t[a],g=-g,s=t[r],l=-l),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var u=l*(e.x-o.x)-g*(e.y-o.y);if(0===u)return!0;if(u<0)continue;i=!i}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return i}var r,a,o,s=iX.isClockWise,g=this.subPaths;if(0===g.length)return[];if(!0===t)return n(g);var l=[];if(1===g.length)return a=g[0],(o=new Rk).curves=a.curves,l.push(o),l;var u=!s(g[0].getPoints());u=e?!u:u;var c,I,C=[],d=[],h=[],A=0;d[A]=void 0,h[A]=[];for(var p=0,m=g.length;p<m;p++)r=s(c=(a=g[p]).getPoints()),(r=e?!r:r)?(!u&&d[A]&&A++,d[A]={s:new Rk,p:c},d[A].s.curves=a.curves,u&&A++,h[A]=[]):h[A].push({h:a,p:c[0]});if(!d[0])return n(g);if(d.length>1){for(var f=!1,v=0,b=0,y=d.length;b<y;b++)C[b]=[];for(var G=0,B=d.length;G<B;G++)for(var Z=h[G],w=0;w<Z.length;w++){for(var S=Z[w],W=!0,x=0;x<d.length;x++)i(S.p,d[x].p)&&(G!==x&&v++,W?(W=!1,C[x].push(S)):f=!0);W&&C[G].push(S)}v>0&&!1===f&&(h=C)}for(var R=0,V=d.length;R<V;R++){o=d[R].s,l.push(o);for(var k=0,X=(I=h[R]).length;k<X;k++)o.holes.push(I[k].h)}return l}}]),e}(),rF=IF(),aF=rF.floatView,oF=rF.uint32View,sF=rF.baseTable,gF=rF.shiftTable,lF=rF.mantissaTable,uF=rF.exponentTable,cF=rF.offsetTable;function IF(){for(var e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),i=new Uint32Array(512),r=new Uint32Array(512),a=0;a<256;++a){var o=a-127;o<-27?(i[a]=0,i[256|a]=32768,r[a]=24,r[256|a]=24):o<-14?(i[a]=1024>>-o-14,i[256|a]=1024>>-o-14|32768,r[a]=-o-1,r[256|a]=-o-1):o<=15?(i[a]=o+15<<10,i[256|a]=o+15<<10|32768,r[a]=13,r[256|a]=13):o<128?(i[a]=31744,i[256|a]=64512,r[a]=24,r[256|a]=24):(i[a]=31744,i[256|a]=64512,r[a]=13,r[256|a]=13)}for(var s=new Uint32Array(2048),g=new Uint32Array(64),l=new Uint32Array(64),u=1;u<1024;++u){for(var c=u<<13,I=0;0===(8388608&c);)c<<=1,I-=8388608;c&=-8388609,I+=947912704,s[u]=c|I}for(var C=1024;C<2048;++C)s[C]=939524096+(C-1024<<13);for(var d=1;d<31;++d)g[d]=d<<23;g[31]=1199570944,g[32]=2147483648;for(var h=33;h<63;++h)g[h]=2147483648+(h-32<<23);g[63]=3347054592;for(var A=1;A<64;++A)32!==A&&(l[A]=1024);return{floatView:t,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:g,offsetTable:l}}var CF=Object.freeze({__proto__:null,toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=eZ(e,-65504,65504),aF[0]=e;var t=oF[0],n=t>>23&511;return sF[n]+((8388607&t)>>gF[n])},fromHalfFloat:function(e){var t=e>>10;return oF[0]=lF[cF[t]+(1023&e)]+uF[t],aF[0]}}),dF=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),t.call(this)}return Ai(n)}(bS),hF=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),t.call(this)}return Ai(n)}(bS);function AF(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function pF(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function mF(){console.error("THREE.ImmediateRenderObject has been removed.")}var fF=function(e){Li(n,e);var t=Di(n);function n(e,i,r){var a;return di(this,n),console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),(a=t.call(this,e,i,r)).samples=4,a}return Ai(n)}(VZ),vF=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a){return di(this,n),console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),t.call(this,e,i,r,a)}return Ai(n)}(kZ),bF=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a){return di(this,n),console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),t.call(this,e,i,r,a)}return Ai(n)}(YZ);"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Fb}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Fb);var yF=n(4585);function GF(e){var t,n=new Set,i=function(e,i){var r="function"===typeof e?e(t):e;if(r!==t){var a=t;t=i?r:Object.assign({},t,r),n.forEach((function(e){return e(t,a)}))}},r=function(){return t},a={setState:i,getState:r,subscribe:function(e,i,a){return i||a?function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var o=i(t);function s(){var n=i(t);if(!a(o,n)){var r=o;e(o=n,r)}}return n.add(s),function(){return n.delete(s)}}(e,i,a):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(i,r,a),a}var BF="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?t.useEffect:t.useLayoutEffect;var ZF=n(258),wF=n.n(ZF),SF=n(4545);function WF(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e===t)return!0;if(!e||!t)return!1;var i=e.length;if(t.length!==i)return!1;for(var r=0;r<i;r++)if(!n(e[r],t[r]))return!1;return!0}var xF=[];function RF(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=Cr(xF);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(WF(t,o.keys,o.equal)){if(i)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return o.response;if(!i)throw o.promise}}}catch(g){a.e(g)}finally{a.f()}var s={keys:t,equal:r.equal,promise:e.apply(void 0,Ci(t)).then((function(e){return s.response=e})).then((function(){r.lifespan&&r.lifespan>0&&setTimeout((function(){var e=xF.indexOf(s);-1!==e&&xF.splice(e,1)}),r.lifespan)})).catch((function(e){return s.error=e}))};if(xF.push(s),!i)throw s.promise}var VF=["children","key","ref"],kF=["children","key","ref"],XF=["args","attach"],YF=["args","children"],HF=["args","children"],FF=["params"],MF=function(e){return e&&e.isOrthographicCamera},KF="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?t.useEffect:t.useLayoutEffect;function NF(e){var n=t.useRef(e);return KF((function(){n.current=e}),[e]),n}function zF(e){var t=e.set;return KF((function(){return t(new Promise((function(){return null}))),function(){return t(!1)}}),[t]),null}var LF=function(e){Li(n,e);var t=Di(n);function n(){var e;di(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={error:!1},e}return Ai(n,[{key:"componentDidCatch",value:function(e){this.props.set(e)}},{key:"render",value:function(){return this.state.error?null:this.props.children}}]),n}(t.Component);LF.getDerivedStateFromError=function(){return{error:!0}};var _F="__default";function TF(e){return Array.isArray(e)?Math.min(Math.max(e[0],window.devicePixelRatio),e[1]):e}var EF=function(e){var t;return null==(t=e.__r3f)?void 0:t.root.getState()},JF={obj:function(e){return e===Object(e)&&!JF.arr(e)&&"function"!==typeof e},fun:function(e){return"function"===typeof e},str:function(e){return"string"===typeof e},num:function(e){return"number"===typeof e},boo:function(e){return"boolean"===typeof e},und:function(e){return void 0===e},arr:function(e){return Array.isArray(e)},equ:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.arrays,r=void 0===i?"shallow":i,a=n.objects,o=void 0===a?"reference":a,s=n.strict,g=void 0===s||s;if(typeof e!==typeof t||!!e!==!!t)return!1;if(JF.str(e)||JF.num(e))return e===t;var l=JF.obj(e);if(l&&"reference"===o)return e===t;var u,c=JF.arr(e);if(c&&"reference"===r)return e===t;if((c||l)&&e===t)return!0;for(u in e)if(!(u in t))return!1;for(u in g?t:e)if(e[u]!==t[u])return!1;if(JF.und(u)){if(c&&0===e.length&&0===t.length)return!0;if(l&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function DF(e){var t={nodes:{},materials:{}};return e&&e.traverse((function(e){e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}function UF(e,t){var n=e;return(null!=t&&t.primitive||!n.__r3f)&&(n.__r3f=Vb({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},t)),e}function PF(e,t){var n=e;if(t.includes("-")){var i=t.split("-"),r=i.pop();return n=i.reduce((function(e,t){return e[t]}),e),{target:n,key:r}}return{target:n,key:t}}var QF=/-\d+$/;function OF(e,t,n){if(JF.str(n)){if(QF.test(n)){var i=PF(e,n.replace(QF,"")),r=i.target,a=i.key;Array.isArray(r[a])||(r[a]=[])}var o=PF(e,n),s=o.target,g=o.key;t.__r3f.previousAttach=s[g],s[g]=t}else t.__r3f.previousAttach=n(e,t)}function jF(e,t,n){var i,r;if(JF.str(n)){var a=PF(e,n),o=a.target,s=a.key,g=t.__r3f.previousAttach;void 0===g?delete o[s]:o[s]=g}else null==(i=t.__r3f)||null==i.previousAttach||i.previousAttach(e,t);null==(r=t.__r3f)||delete r.previousAttach}function qF(e,t){t.children,t.key,t.ref;var n,i=kb(t,VF),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=(r.children,r.key,r.ref,kb(r,kF)),o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null!=(n=null==e?void 0:e.__r3f)?n:{},g=Object.entries(i),l=[];if(o)for(var u=Object.keys(a),c=0;c<u.length;c++)i.hasOwnProperty(u[c])||g.unshift([u[c],_F+"remove"]);g.forEach((function(t){var n,i=Ir(t,2),r=i[0],o=i[1];if((null==(n=e.__r3f)||!n.primitive||"object"!==r)&&!JF.equ(o,a[r])){if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(r))return l.push([r,o,!0,[]]);var s=[];r.includes("-")&&(s=r.split("-")),l.push([r,o,!1,s])}}));var I=Vb({},i);return s.memoizedProps&&s.memoizedProps.args&&(I.args=s.memoizedProps.args),s.memoizedProps&&s.memoizedProps.attach&&(I.attach=s.memoizedProps.attach),{memoized:I,changes:l}}function $F(e,t){var n,i,r,a=null!=(n=e.__r3f)?n:{},o=a.root,s=null!=(i=null==o||null==o.getState?void 0:o.getState())?i:{},g=(r=t)&&r.memoized&&r.changes?t:qF(e,t),l=g.memoized,u=g.changes,c=a.eventCount;if(e.__r3f&&(e.__r3f.memoizedProps=l),u.forEach((function(t){var n,i,r=Ir(t,4),o=r[0],g=r[1],u=r[2],c=r[3],I=e,C=I[o];if(c.length&&(C=c.reduce((function(e,t){return e[t]}),e),!C||!C.set)){var d=c.reverse(),h=ur(n=d)||ci(n)||Ii(n)||cr(),A=h[0];I=h.slice(1).reverse().reduce((function(e,t){return e[t]}),e),o=A}if(g===_F+"remove")if(C&&C.constructor)g=Ui(C.constructor,Ci(null!=(i=l.args)?i:[]));else if(I.constructor){var p,m=Ui(I.constructor,Ci(null!=(p=I.__r3f.memoizedProps.args)?p:[]));g=m[C],m.dispose&&m.dispose()}else g=0;if(u)g?a.handlers[o]=g:delete a.handlers[o],a.eventCount=Object.keys(a.handlers).length;else if(C&&C.set&&(C.copy||C instanceof ww)){var f;if(Array.isArray(g))C.fromArray?C.fromArray(g):(f=C).set.apply(f,Ci(g));else if(C.copy&&g&&g.constructor&&C.constructor.name===g.constructor.name)C.copy(g);else if(void 0!==g){var v=C instanceof BZ;!v&&C.setScalar?C.setScalar(g):C instanceof ww&&g instanceof ww?C.mask=g.mask:C.set(g);0}}else I[o]=g,!s.linear&&I[o]instanceof xZ&&(I[o].encoding=IB);eM(e)})),a.parent&&s.internal&&e.raycast&&c!==a.eventCount){var I=s.internal.interaction.indexOf(e);I>-1&&s.internal.interaction.splice(I,1),a.eventCount&&s.internal.interaction.push(e)}return u.length&&e.parent&&tM(e),e}function eM(e){var t,n,i=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();i&&0===i.internal.frames&&i.invalidate()}function tM(e){null==e.onUpdate||e.onUpdate(e)}function nM(e,t){e.manual||(MF(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function iM(e,t,n){var i=n.pop(),r=n.reduce((function(e,t){return e[t]}),e);return r[i]=t}function rM(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function aM(e,t,n,i){var r=n.get(t);r&&(n.delete(t),0===n.size&&(e.delete(i),r.target.releasePointerCapture(i)))}function oM(e){var t=new KZ;function n(e){return e.filter((function(e){return["Move","Over","Enter","Out","Leave"].some((function(t){var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}))}function i(t){var n=e.getState().internal;Array.from(n.hovered.values()).forEach((function(e){if(!t.length||!t.find((function(t){return t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId}))){var i=e.eventObject.__r3f,r=null==i?void 0:i.handlers;if(n.hovered.delete(rM(e)),null!=i&&i.eventCount){var a=Vb(Vb({},e),{},{intersections:t});null==r.onPointerOut||r.onPointerOut(a),null==r.onPointerLeave||r.onPointerLeave(a)}}}))}function r(e,t){t.forEach((function(t){var n;return null==(n=t.__r3f)||null==n.handlers.onPointerMissed?void 0:n.handlers.onPointerMissed(e)}))}return{handlePointer:function(a){switch(a){case"onPointerLeave":case"onPointerCancel":return function(){return i([])};case"onLostPointerCapture":return function(t){var n=e.getState().internal;"pointerId"in t&&!n.capturedMap.has(t.pointerId)&&(n.capturedMap.delete(t.pointerId),i([]))}}return function(o){var s=e.getState(),g=s.onPointerMissed,l=s.internal;l.lastEvent.current=o;var u="onPointerMove"===a,c="onClick"===a||"onContextMenu"===a||"onDoubleClick"===a,I=function(t,n){var i=e.getState(),r=new Set,a=[],o=n?n(i.internal.interaction):i.internal.interaction;o.forEach((function(e){var t=EF(e);t&&(t.raycaster.camera=void 0)})),i.previousRoot||null==i.events.compute||i.events.compute(t,i);var s=o.flatMap((function(e){var n,i=EF(e);return i&&i.events.enabled&&null!==i.raycaster.camera?(void 0===i.raycaster.camera&&(null==i.events.compute||i.events.compute(t,i,null==(n=i.previousRoot)?void 0:n.getState()),void 0===i.raycaster.camera&&(i.raycaster.camera=null)),i.raycaster.camera?i.raycaster.intersectObject(e,!0):[]):[]})).sort((function(e,t){var n=EF(e.object),i=EF(t.object);return n&&i?i.events.priority-n.events.priority||e.distance-t.distance:0})).filter((function(e){var t=rM(e);return!r.has(t)&&(r.add(t),!0)}));i.events.filter&&(s=i.events.filter(s,i));var g,l=Cr(s);try{for(l.s();!(g=l.n()).done;)for(var u=g.value,c=u.object;c;){var I;null!=(I=c.__r3f)&&I.eventCount&&a.push(Vb(Vb({},u),{},{eventObject:c})),c=c.parent}}catch(A){l.e(A)}finally{l.f()}if("pointerId"in t&&i.internal.capturedMap.has(t.pointerId)){var C,d=Cr(i.internal.capturedMap.get(t.pointerId).values());try{for(d.s();!(C=d.n()).done;){var h=C.value;a.push(h.intersection)}}catch(A){d.e(A)}finally{d.f()}}return a}(o,u?n:void 0),C=c?function(t){var n=e.getState().internal,i=t.offsetX-n.initialClick[0],r=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+r*r))}(o):0;"onPointerDown"===a&&(l.initialClick=[o.offsetX,o.offsetY],l.initialHits=I.map((function(e){return e.eventObject}))),c&&!I.length&&C<=2&&(r(o,l.interaction),g&&g(o)),u&&i(I),function(n,r,a,o){var s=e.getState(),g=s.raycaster,l=s.pointer,u=s.camera,c=s.internal;n.length&&function(){var e,s=t.set(l.x,l.y,0).unproject(u),I={stopped:!1},C=Cr(n);try{var d=function(){var t=e.value,C=function(e){var n,i;return null!=(n=null==(i=c.capturedMap.get(e))?void 0:i.has(t.eventObject))&&n},d=function(e){var n={intersection:t,target:r.target};c.capturedMap.has(e)?c.capturedMap.get(e).set(t.eventObject,n):c.capturedMap.set(e,new Map([[t.eventObject,n]])),r.target.setPointerCapture(e)},h=function(e){var n=c.capturedMap.get(e);n&&aM(c.capturedMap,t.eventObject,n,e)},A={};for(var p in r){var m=r[p];"function"!==typeof m&&(A[p]=m)}var f=Vb(Vb(Vb({},t),A),{},{pointer:l,intersections:n,stopped:I.stopped,delta:a,unprojectedPoint:s,ray:g.ray,camera:u,stopPropagation:function(){var e="pointerId"in r&&c.capturedMap.get(r.pointerId);if((!e||e.has(t.eventObject))&&(f.stopped=I.stopped=!0,c.hovered.size&&Array.from(c.hovered.values()).find((function(e){return e.eventObject===t.eventObject})))){var a=n.slice(0,n.indexOf(t));i([].concat(Ci(a),[t]))}},target:{hasPointerCapture:C,setPointerCapture:d,releasePointerCapture:h},currentTarget:{hasPointerCapture:C,setPointerCapture:d,releasePointerCapture:h},nativeEvent:r});if(o(f),!0===I.stopped)return"break"};for(C.s();!(e=C.n()).done&&"break"!==d(););}catch(h){C.e(h)}finally{C.f()}}()}(I,o,C,(function(e){var t=e.eventObject,n=t.__r3f,i=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(u){if(i.onPointerOver||i.onPointerEnter||i.onPointerOut||i.onPointerLeave){var s=rM(e),g=l.hovered.get(s);g?g.stopped&&e.stopPropagation():(l.hovered.set(s,e),null==i.onPointerOver||i.onPointerOver(e),null==i.onPointerEnter||i.onPointerEnter(e))}null==i.onPointerMove||i.onPointerMove(e)}else{var I=i[a];I?c&&!l.initialHits.includes(t)||(r(o,l.interaction.filter((function(e){return!l.initialHits.includes(e)}))),I(e)):c&&l.initialHits.includes(t)&&r(o,l.interaction.filter((function(e){return!l.initialHits.includes(e)})))}}))}}}}var sM={},gM=function(e){sM=Vb(Vb({},sM),e)};var lM,uM=function(e){return!(null==e||!e.render)},cM=t.createContext(null);var IM,CM,dM=new Set,hM=new Set,AM=new Set;function pM(e,t){e.forEach((function(e){return(0,e.callback)(t)}))}function mM(e,t,n){var i=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),IM=t.internal.subscribers,lM=0;lM<IM.length;lM++)(CM=IM[lM]).ref.current(CM.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function fM(){var e=t.useContext(cM);if(!e)throw"R3F hooks can only be used within the Canvas component!";return e}function vM(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=arguments.length>1?arguments[1]:void 0;return fM()(e,t)}function bM(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=fM(),i=n.getState().internal.subscribe,r=NF(e);return KF((function(){return i(r,t,n)}),[t,i,n]),null}function yM(e,t){return function(n){var i=new n;e&&e(i);for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return Promise.all(a.map((function(e){return new Promise((function(n,r){return i.load(e,(function(e){e.scene&&Object.assign(e,DF(e.scene)),n(e)}),t,(function(t){return r("Could not load ".concat(e,": ").concat(t.message))}))}))})))}}function GM(e,t,n,i){var r=Array.isArray(t)?t:[t],a=function(e,t,n){return RF(e,t,!1,n)}(yM(n,i),[e].concat(Ci(r)),{equal:JF.equ});return Array.isArray(t)?a:a[0]}GM.preload=function(e,t,n){var i=Array.isArray(t)?t:[t];return function(e,t,n){RF(e,t,!0,n)}(yM(n),[e].concat(Ci(i)))},GM.clear=function(e,t){var n=Array.isArray(t)?t:[t];return function(e){if(void 0===e||0===e.length)xF.splice(0,xF.length);else{var t=xF.find((function(t){return WF(e,t.keys,t.equal)}));if(t){var n=xF.indexOf(t);-1!==n&&xF.splice(n,1)}}}([e].concat(Ci(n)))};var BM=new Map,ZM=function(e){var t,n,i,r=!1;function a(o){if(n=requestAnimationFrame(a),r=!0,t=0,dM.size&&pM(dM,o),e.forEach((function(e){var n;!(i=e.store.getState()).internal.active||!("always"===i.frameloop||i.internal.frames>0)||null!=(n=i.gl.xr)&&n.isPresenting||(t+=mM(o,i))})),hM.size&&pM(hM,o),0===t)return AM.size&&pM(AM,o),r=!1,cancelAnimationFrame(n)}return{loop:a,invalidate:function t(n){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!n)return e.forEach((function(e){return t(e.store.getState())}),o);null!=(i=n.gl.xr)&&i.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=Math.min(60,n.internal.frames+o),r||(r=!0,requestAnimationFrame(a)))},advance:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n&&pM(dM,t),i?mM(t,i,r):e.forEach((function(e){return mM(t,e.store.getState())})),n&&pM(hM,t)}}}(BM),wM=ZM.invalidate,SM=ZM.advance,WM=function(e,t){function n(e,t,n){var i,r=t.args,a=void 0===r?[]:r,o=t.attach,s=kb(t,XF),g="".concat(e[0].toUpperCase()).concat(e.slice(1));if(void 0===o&&(g.endsWith("Geometry")?o="geometry":g.endsWith("Material")&&(o="material")),"primitive"===e){if(void 0===s.object)throw"Primitives without 'object' are invalid!";i=UF(s.object,{type:e,root:n,attach:o,primitive:!0})}else{var l=sM[g];if(!l)throw"".concat(g," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively");if(!Array.isArray(a))throw"The args prop must be an array!";i=UF(Ui(l,Ci(a)),{type:e,root:n,attach:o,memoizedProps:{args:a}})}return"inject"!==g&&$F(i,s),i}function i(e,t){var n,i,r=!1;t&&(null!=(n=t.__r3f)&&n.attach?OF(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),r=!0),r||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||UF(t,{}),t.__r3f.parent=e,tM(t),eM(t))}function r(e,t,n){var i=!1;if(t){var r,a;if(null!=(r=t.__r3f)&&r.attach)OF(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});var o=e.children.filter((function(e){return e!==t})),s=o.indexOf(n);e.children=[].concat(Ci(o.slice(0,s)),[t],Ci(o.slice(s))),i=!0}i||null==(a=e.__r3f)||a.objects.push(t),t.__r3f||UF(t,{}),t.__r3f.parent=e,tM(t),eM(t)}}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&Ci(e).forEach((function(e){return o(t,e,n)}))}function o(e,t,n){if(t){var i,r,o;if(t.__r3f&&(t.__r3f.parent=null),null!=(i=e.__r3f)&&i.objects&&(e.__r3f.objects=e.__r3f.objects.filter((function(e){return e!==t}))),null!=(r=t.__r3f)&&r.attach)jF(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){var n=e.getState().internal;n.interaction=n.interaction.filter((function(e){return e!==t})),n.initialHits=n.initialHits.filter((function(e){return e!==t})),n.hovered.forEach((function(e,i){e.eventObject!==t&&e.object!==t||n.hovered.delete(i)})),n.capturedMap.forEach((function(e,i){aM(n.capturedMap,t,e,i)}))}(t.__r3f.root,t)}var g,l=null==(o=t.__r3f)?void 0:o.primitive,u=void 0===n?null!==t.dispose&&!l:n;if(!l)a(null==(g=t.__r3f)?void 0:g.objects,t,u),a(t.children,t,u);t.__r3f&&(delete t.__r3f.root,delete t.__r3f.objects,delete t.__r3f.handlers,delete t.__r3f.memoizedProps,l||delete t.__r3f),u&&t.dispose&&"Scene"!==t.type&&(0,SF.unstable_scheduleCallback)(SF.unstable_IdlePriority,(function(){try{t.dispose()}catch(CL){}})),eM(e)}}return{reconciler:wF()({createInstance:n,removeChild:o,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:function(e,t){var n=e.getState().scene;n.__r3f.root=e,i(n,t)},removeChildFromContainer:function(e,t){return o(e.getState().scene,t)},insertInContainerBefore:function(e,t,n){return r(e.getState().scene,t,n)},getRootHostContext:function(){return null},getChildHostContext:function(e){return e},finalizeInitialChildren:function(e){var t,n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate:function(e,t,n,i){if(e.__r3f.primitive&&i.object&&i.object!==e)return[!0];var r=i.args,a=void 0===r?[]:r,o=(i.children,kb(i,YF)),s=n.args,g=void 0===s?[]:s,l=(n.children,kb(n,HF));if(!Array.isArray(a))throw"The args prop must be an array!";if(a.some((function(e,t){return e!==g[t]})))return[!0];var u=qF(e,o,l,!0);return u.changes.length?[!1,u]:null},commitUpdate:function(e,t,r,a,s,g){var l=Ir(t,2),u=l[0],c=l[1];u?function(e,t,r,a){var s,g=null==(s=e.__r3f)?void 0:s.parent;if(g){var l=n(t,r,e.__r3f.root);"primitive"!==t&&e.children&&(e.children.forEach((function(e){return i(l,e)})),e.children=[]),e.__r3f.objects.forEach((function(e){return i(l,e)})),e.__r3f.objects=[],o(g,e),i(g,l),l.raycast&&l.__r3f.eventCount&&l.__r3f.root.getState().internal.interaction.push(l),[a,a.alternate].forEach((function(e){null!==e&&(e.stateNode=l,e.ref&&("function"===typeof e.ref?e.ref(l):e.ref.current=l))}))}}(e,r,s,g):$F(e,c)},commitMount:function(e,t,n,i){var r,a=null!=(r=e.__r3f)?r:{};e.raycast&&a.handlers&&a.eventCount&&e.__r3f.root.getState().internal.interaction.push(e)},getPublicInstance:function(e){return e},prepareForCommit:function(){return null},preparePortalMount:function(e){return UF(e.getState().scene)},resetAfterCommit:function(){},shouldSetTextContent:function(){return!1},clearContainer:function(){return!1},hideInstance:function(e){var t,n=null!=(t=null==e?void 0:e.__r3f)?t:{},i=n.attach,r=n.parent;i&&r&&jF(r,e,i),e.isObject3D&&(e.visible=!1),eM(e)},unhideInstance:function(e,t){var n,i=null!=(n=null==e?void 0:e.__r3f)?n:{},r=i.attach,a=i.parent;r&&a&&OF(a,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),eM(e)},createTextInstance:function(){throw new Error("Text is not allowed in the R3F tree.")},hideTextInstance:function(){throw new Error("Text is not allowed in the R3F tree.")},unhideTextInstance:function(){},getCurrentEventPriority:function(){return t?t():yF.DefaultEventPriority},beforeActiveInstanceBlur:function(){},afterActiveInstanceBlur:function(){},detachDeletedInstance:function(){},now:"undefined"!==typeof performance&&JF.fun(performance.now)?performance.now:JF.fun(Date.now)?Date.now:function(){return 0},scheduleTimeout:JF.fun(setTimeout)?setTimeout:void 0,cancelTimeout:JF.fun(clearTimeout)?clearTimeout:void 0}),applyProps:$F}}(0,(function(){var e,t;switch(null==(e=window)||null==(t=e.event)?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return yF.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return yF.ContinuousEventPriority;default:return yF.DefaultEventPriority}})),xM=WM.reconciler,RM=WM.applyProps,VM={objects:"shallow",strict:!1},kM=function(e,t){var n="function"===typeof e?e(t):e;return uM(n)?n:new KR(Vb({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0},e))};function XM(n){var i=BM.get(n),r=null==i?void 0:i.fiber,a=null==i?void 0:i.store;i&&console.warn("R3F.createRoot should only be called once!");var o,s="function"===typeof reportError?reportError:console.error,g=a||function(e,n){var i=function(e){var n="function"===typeof e?GF(e):e,i=function(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.getState,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is,a=(0,t.useReducer)((function(e){return e+1}),0),o=Ir(a,2)[1],s=n.getState(),g=(0,t.useRef)(s),l=(0,t.useRef)(i),u=(0,t.useRef)(r),c=(0,t.useRef)(!1),I=(0,t.useRef)();void 0===I.current&&(I.current=i(s));var C=!1;(g.current!==s||l.current!==i||u.current!==r||c.current)&&(e=i(s),C=!r(I.current,e)),BF((function(){C&&(I.current=e),g.current=s,l.current=i,u.current=r,c.current=!1}));var d=(0,t.useRef)(s);BF((function(){var e=function(){try{var e=n.getState(),t=l.current(e);u.current(I.current,t)||(g.current=e,I.current=t,o())}catch(i){c.current=!0,o()}},t=n.subscribe(e);return n.getState()!==d.current&&e(),t}),[]);var h=C?e:I.current;return(0,t.useDebugValue)(h),h};return Object.assign(i,n),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[i,n];return{next:function(){var t=e.length<=0;return{value:e.shift(),done:t}}}},i}((function(i,r){var a=new KZ,o=new KZ,s=new KZ;function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size,i=n.width,g=n.height,l=n.top,u=n.left,c=i/g;t instanceof KZ?s.copy(t):s.set.apply(s,Ci(t));var I=e.getWorldPosition(a).distanceTo(s);if(MF(e))return{width:i/e.zoom,height:g/e.zoom,top:l,left:u,factor:1,distance:I,aspect:c};var C=e.fov*Math.PI/180,d=2*Math.tan(C/2)*I,h=d*(i/g);return{width:h,height:d,top:l,left:u,factor:i/h,distance:I,aspect:c}}var l=void 0,u=function(e){return i((function(t){return{performance:Vb(Vb({},t.performance),{},{current:e})}}))},c=new sZ,I={set:i,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,invalidate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:function(e,t){return n(e,t,r())},legacy:!1,linear:!1,flat:!1,scene:UF(new TR),controls:null,clock:new zY,pointer:c,mouse:c,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:function(){var e=r();l&&clearTimeout(l),e.performance.current!==e.performance.min&&u(e.performance.min),l=setTimeout((function(){return u(r().performance.max)}),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:g},setEvents:function(e){return i((function(t){return Vb(Vb({},t),{},{events:Vb(Vb({},t.events),e)})}))},setSize:function(e,t,n,a,s){var l=r().camera,u={width:e,height:t,top:a||0,left:s||0,updateStyle:n};i((function(e){return{size:u,viewport:Vb(Vb({},e.viewport),g(l,o,u))}}))},setDpr:function(e){return i((function(t){var n=TF(e);return{viewport:Vb(Vb({},t.viewport),{},{dpr:n,initialDpr:t.viewport.initialDpr||n})}}))},setFrameloop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always",t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),i((function(){return{frameloop:e}}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:t.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:function(e,t,n){var i=r().internal;return i.priority=i.priority+(t>0?1:0),i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort((function(e,t){return e.priority-t.priority})),function(){var n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((function(t){return t.ref!==e})))}}}};return I})),r=i.getState(),a=r.size,o=r.viewport.dpr,s=r.camera;return i.subscribe((function(){var e=i.getState(),t=e.camera,n=e.size,r=e.viewport,g=e.gl,l=e.set;n===a&&r.dpr===o||(a=n,o=r.dpr,nM(t,n),g.setPixelRatio(r.dpr),g.setSize(n.width,n.height,n.updateStyle)),t!==s&&(s=t,l((function(e){return{viewport:Vb(Vb({},e.viewport),e.viewport.getCurrentViewport(t))}})))})),i.subscribe((function(t){return e(t)})),i}(wM,SM),l=r||xM.createContainer(g,yF.ConcurrentRoot,null,!1,null,"",s,null);i||BM.set(n,{fiber:l,store:g});var u=!1;return{configure:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.gl,r=t.size,a=t.events,s=t.onCreated,l=t.shadows,c=void 0!==l&&l,I=t.linear,C=void 0!==I&&I,d=t.flat,h=void 0!==d&&d,A=t.legacy,p=void 0!==A&&A,m=t.orthographic,f=void 0!==m&&m,v=t.frameloop,b=void 0===v?"always":v,y=t.dpr,G=void 0===y?[1,2]:y,B=t.performance,Z=t.raycaster,w=t.camera,S=t.onPointerMissed,W=g.getState(),x=W.gl;W.gl||W.set({gl:x=kM(i,n)});var R=W.raycaster;R||W.set({raycaster:R=new AH});var V=Z||{},k=V.params,X=kb(V,FF);if(JF.equ(X,R,VM)||RM(R,Vb({},X)),JF.equ(k,R.params,VM)||RM(R,{params:Vb(Vb({},R.params),k)}),!W.camera){var Y=w instanceof DS,H=Y?w:f?new pW(0,0,0,0,.1,1e3):new US(75,0,.1,1e3);Y||(H.position.z=5,w&&RM(H,w),null!=w&&w.rotation||H.lookAt(0,0,0)),W.set({camera:H})}if(!W.xr){var F=function(e,t){var n=g.getState();"never"!==n.frameloop&&SM(e,!0,n,t)},M=function(){var e=g.getState();e.gl.xr.enabled=e.gl.xr.isPresenting,e.gl.xr.setAnimationLoop(e.gl.xr.isPresenting?F:null),e.gl.xr.isPresenting||wM(e)},K={connect:function(){var e=g.getState().gl;e.xr.addEventListener("sessionstart",M),e.xr.addEventListener("sessionend",M)},disconnect:function(){var e=g.getState().gl;e.xr.removeEventListener("sessionstart",M),e.xr.removeEventListener("sessionend",M)}};x.xr&&K.connect(),W.set({xr:K})}if(x.shadowMap){var N=JF.boo(c);if(N&&x.shadowMap.enabled!==c||!JF.equ(c,x.shadowMap,VM)){var z=x.shadowMap.enabled;x.shadowMap.enabled=!!c,N?x.shadowMap.type=Jb:Object.assign(x.shadowMap,c),z!==x.shadowMap.enabled&&(x.shadowMap.needsUpdate=!0)}}iM(e,p,["ColorManagement","legacyMode"]);var L=C?cB:IB,_=h?Vy:Hy;return x.outputEncoding!==L&&(x.outputEncoding=L),x.toneMapping!==_&&(x.toneMapping=_),W.legacy!==p&&W.set((function(){return{legacy:p}})),W.linear!==C&&W.set((function(){return{linear:C}})),W.flat!==h&&W.set((function(){return{flat:h}})),!i||JF.fun(i)||uM(i)||JF.equ(i,x,VM)||RM(x,i),a&&!W.events.handlers&&W.set({events:a(g)}),G&&W.viewport.dpr!==TF(G)&&W.setDpr(G),r=r||(n.parentElement?{width:n.parentElement.clientWidth,height:n.parentElement.clientHeight,top:n.parentElement.clientTop,left:n.parentElement.clientLeft}:{width:0,height:0,top:0,left:0}),JF.equ(r,W.size,VM)||W.setSize(r.width,r.height,r.updateStyle,r.top,r.left),W.frameloop!==b&&W.setFrameloop(b),W.onPointerMissed||W.set({onPointerMissed:S}),B&&!JF.equ(B,W.performance,VM)&&W.set((function(e){return{performance:Vb(Vb({},e.performance),B)}})),o=s,u=!0,this},render:function(e){return u||this.configure(),xM.updateContainer(t.createElement(YM,{store:g,children:e,onCreated:o,rootElement:n}),l,null,(function(){})),g},unmount:function(){HM(n)}}}function YM(e){var n=e.store,i=e.children,r=e.onCreated,a=e.rootElement;return KF((function(){var e=n.getState();e.set((function(e){return{internal:Vb(Vb({},e.internal),{},{active:!0})}})),r&&r(e),n.getState().events.connected||null==e.events.connect||e.events.connect(a)}),[]),t.createElement(cM.Provider,{value:n},i)}function HM(e,t){var n=BM.get(e),i=null==n?void 0:n.fiber;if(i){var r=null==n?void 0:n.store.getState();r&&(r.internal.active=!1),xM.updateContainer(null,i,null,(function(){r&&setTimeout((function(){try{var n,i,a,o;null==r.events.disconnect||r.events.disconnect(),null==(n=r.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(a=r.gl)||null==a.forceContextLoss||a.forceContextLoss(),null!=(o=r.gl)&&o.xr&&r.xr.disconnect(),function(e){for(var t in e.dispose&&"Scene"!==e.type&&e.dispose(),e)null==t.dispose||t.dispose(),delete e[t]}(r),BM.delete(e),t&&t(e)}catch(CL){}}),500)}))}}xM.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:t.version});t.unstable_act;var FM=n(7494),MM=n.n(FM);function KM(e){var n=void 0===e?{debounce:0,scroll:!1,offsetSize:!1}:e,i=n.debounce,r=n.scroll,a=n.polyfill,o=n.offsetSize,s=a||("undefined"===typeof window?Ai((function e(){di(this,e)})):window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");var g=Ir((0,t.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),2),l=g[0],u=g[1],c=(0,t.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:l}),I=i?"number"===typeof i?i:i.scroll:null,C=i?"number"===typeof i?i:i.resize:null,d=(0,t.useRef)(!1);(0,t.useEffect)((function(){return d.current=!0,function(){d.current=!1}}));var h=Ir((0,t.useMemo)((function(){var e=function(){if(c.current.element){var e=c.current.element.getBoundingClientRect(),t={left:e.left,top:e.top,width:e.width,height:e.height,bottom:e.bottom,right:e.right,x:e.x,y:e.y};c.current.element instanceof HTMLElement&&o&&(t.height=c.current.element.offsetHeight,t.width=c.current.element.offsetWidth),Object.freeze(t),d.current&&!LM(c.current.lastBounds,t)&&u(c.current.lastBounds=t)}};return[e,C?MM()(e,C):e,I?MM()(e,I):e]}),[u,o,I,C]),3),A=h[0],p=h[1],m=h[2];function f(){c.current.scrollContainers&&(c.current.scrollContainers.forEach((function(e){return e.removeEventListener("scroll",m,!0)})),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null)}function v(){c.current.element&&(c.current.resizeObserver=new s(m),c.current.resizeObserver.observe(c.current.element),r&&c.current.scrollContainers&&c.current.scrollContainers.forEach((function(e){return e.addEventListener("scroll",m,{capture:!0,passive:!0})})))}var b,y,G;return b=m,y=Boolean(r),(0,t.useEffect)((function(){if(y){var e=b;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),function(){window.removeEventListener("scroll",e,!0)}}}),[b,y]),G=p,(0,t.useEffect)((function(){var e=G;return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[G]),(0,t.useEffect)((function(){f(),v()}),[r,m,p]),(0,t.useEffect)((function(){return f}),[]),[function(e){e&&e!==c.current.element&&(f(),c.current.element=e,c.current.scrollContainers=NM(e),v())},l,A]}function NM(e){var t=[];if(!e||e===document.body)return t;var n=window.getComputedStyle(e);return[n.overflow,n.overflowX,n.overflowY].some((function(e){return"auto"===e||"scroll"===e}))&&t.push(e),[].concat(t,Ci(NM(e.parentElement)))}var zM=["x","y","top","bottom","left","right","width","height"],LM=function(e,t){return zM.every((function(n){return e[n]===t[n]}))},_M=["children","fallback","resize","style","gl","events","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","onPointerMissed","onCreated"],TM={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function EM(e){var t=oM(e).handlePointer;return{priority:1,enabled:!0,compute:function(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(TM).reduce((function(e,n){return Vb(Vb({},e),{},Eo({},n,t(n)))}),{}),connect:function(t){var n,i=e.getState(),r=i.set,a=i.events;null==a.disconnect||a.disconnect(),r((function(e){return{events:Vb(Vb({},e.events),{},{connected:t})}})),Object.entries(null!=(n=a.handlers)?n:[]).forEach((function(e){var n=Ir(e,2),i=n[0],r=n[1],a=Ir(TM[i],2),o=a[0],s=a[1];t.addEventListener(o,r,{passive:s})}))},disconnect:function(){var t,n=e.getState(),i=n.set,r=n.events;r.connected&&(Object.entries(null!=(t=r.handlers)?t:[]).forEach((function(e){var t=Ir(e,2),n=t[0],i=t[1];if(r&&r.connected instanceof HTMLElement){var a=Ir(TM[n],1)[0];r.connected.removeEventListener(a,i)}})),i((function(e){return{events:Vb(Vb({},e.events),{},{connected:void 0})}})))}}}var JM=t.forwardRef((function(n,i){var r=n.children,a=n.fallback,o=n.resize,s=n.style,g=n.gl,l=n.events,u=void 0===l?EM:l,c=n.shadows,I=n.linear,C=n.flat,d=n.legacy,h=n.orthographic,A=n.frameloop,p=n.dpr,m=n.performance,f=n.raycaster,v=n.camera,b=n.onPointerMissed,y=n.onCreated,G=kb(n,_M);t.useMemo((function(){return gM(e)}),[]);var B=Ir(KM(Vb({scroll:!0,debounce:{scroll:50,resize:0}},o)),2),Z=B[0],w=B[1],S=t.useRef(null),W=t.useRef(null),x=Ir(t.useState(null),2),R=x[0],V=x[1];t.useImperativeHandle(i,(function(){return S.current}));var k=NF(b),X=Ir(t.useState(!1),2),Y=X[0],H=X[1],F=Ir(t.useState(!1),2),M=F[0],K=F[1];if(Y)throw Y;if(M)throw M;var N=t.useRef(null);return w.width>0&&w.height>0&&R&&(N.current||(N.current=XM(R)),N.current.configure({gl:g,events:u,shadows:c,linear:I,flat:C,legacy:d,orthographic:h,frameloop:A,dpr:p,performance:m,raycaster:f,camera:v,size:w,onPointerMissed:function(){return null==k.current?void 0:k.current.apply(k,arguments)},onCreated:function(e){null==e.events.connect||e.events.connect(W.current),null==y||y(e)}}),N.current.render(t.createElement(LF,{set:K},t.createElement(t.Suspense,{fallback:t.createElement(zF,{set:H})},r)))),KF((function(){V(S.current)}),[]),t.useEffect((function(){if(R)return function(){return HM(R)}}),[R]),t.createElement("div",oa({ref:W,style:Vb({position:"relative",width:"100%",height:"100%",overflow:"hidden"},s)},G),t.createElement("div",{ref:Z,style:{width:"100%",height:"100%"}},t.createElement("canvas",{ref:S,style:{display:"block"}},a)))}));var DM=function(e){return function(t){e.forEach((function(e){"function"===typeof e?e(t):null!=e&&(e.current=t)}))}},UM=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sZ;return di(this,n),(e=t.call(this,{uniforms:{inputBuffer:new CH(null),depthBuffer:new CH(null),resolution:new CH(new sZ),texelSize:new CH(new sZ),halfTexelSize:new CH(new sZ),kernel:new CH(0),scale:new CH(1),cameraNear:new CH(0),cameraFar:new CH(1),minDepthThreshold:new CH(0),maxDepthThreshold:new CH(1),depthScale:new CH(0),depthToBlurRatioBias:new CH(.25)},fragmentShader:"#include <common>\n        #include <dithering_pars_fragment>      \n        uniform sampler2D inputBuffer;\n        uniform sampler2D depthBuffer;\n        uniform float cameraNear;\n        uniform float cameraFar;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          float depthFactor = 0.0;\n          \n          #ifdef USE_DEPTH\n            vec4 depth = texture2D(depthBuffer, vUv);\n            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n            depthFactor *= depthScale;\n            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));\n          #endif\n          \n          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));\n          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));\n          gl_FragColor = sum * 0.25 ;\n\n          #include <dithering_fragment>\n          #include <tonemapping_fragment>\n          #include <encodings_fragment>\n        }",vertexShader:"uniform vec2 texelSize;\n        uniform vec2 halfTexelSize;\n        uniform float kernel;\n        uniform float scale;\n        varying vec2 vUv;\n        varying vec2 vUv0;\n        varying vec2 vUv1;\n        varying vec2 vUv2;\n        varying vec2 vUv3;\n\n        void main() {\n          vec2 uv = position.xy * 0.5 + 0.5;\n          vUv = uv;\n\n          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;\n          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);\n          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);\n          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);\n          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);\n\n          gl_Position = vec4(position.xy, 1.0, 1.0);\n        }",blending:qb,depthWrite:!1,depthTest:!1})).toneMapped=!1,e.setTexelSize(i.x,i.y),e.kernel=new Float32Array([0,1,2,2,3]),e}return Ai(n,[{key:"setTexelSize",value:function(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}},{key:"setResolution",value:function(e){this.uniforms.resolution.value.copy(e)}}]),n}(JS),PM=function(){function e(t){var n=t.gl,i=t.resolution,r=t.width,a=void 0===r?500:r,o=t.height,s=void 0===o?500:o,g=t.minDepthThreshold,l=void 0===g?0:g,u=t.maxDepthThreshold,c=void 0===u?1:u,I=t.depthScale,C=void 0===I?0:I,d=t.depthToBlurRatioBias,h=void 0===d?.25:d;di(this,e),this.renderToScreen=!1,this.renderTargetA=new VZ(i,i,{minFilter:jy,magFilter:jy,stencilBuffer:!1,depthBuffer:!1,encoding:n.outputEncoding}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new UM,this.convolutionMaterial.setTexelSize(1/a,1/s),this.convolutionMaterial.setResolution(new sZ(a,s)),this.scene=new TR,this.camera=new DS,this.convolutionMaterial.uniforms.minDepthThreshold.value=l,this.convolutionMaterial.uniforms.maxDepthThreshold.value=c,this.convolutionMaterial.uniforms.depthScale.value=C,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=h,this.convolutionMaterial.defines.USE_DEPTH=C>0;var A=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),p=new Float32Array([0,0,2,0,0,2]),m=new bS;m.setAttribute("position",new iS(A,3)),m.setAttribute("uv",new iS(p,2)),this.screen=new NS(m,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}return Ai(e,[{key:"render",value:function(e,t,n){var i=this.scene,r=this.camera,a=this.renderTargetA,o=this.renderTargetB,s=this.convolutionMaterial,g=s.uniforms;g.depthBuffer.value=t.depthTexture;var l,u,c,I=s.kernel,C=t;for(u=0,c=I.length-1;u<c;++u)l=0===(1&u)?a:o,g.kernel.value=I[u],g.inputBuffer.value=C.texture,e.setRenderTarget(l),e.render(i,r),C=l;g.kernel.value=I[u],g.inputBuffer.value=C.texture,e.setRenderTarget(this.renderToScreen?null:n),e.render(i,r)}}]),e}(),QM=function(e){Li(n,e);var t=Di(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return di(this,n),(e=t.call(this,i))._tDepth={value:null},e._distortionMap={value:null},e._tDiffuse={value:null},e._tDiffuseBlur={value:null},e._textureMatrix={value:null},e._hasBlur={value:!1},e._mirror={value:0},e._mixBlur={value:0},e._blurStrength={value:.5},e._minDepthThreshold={value:.9},e._maxDepthThreshold={value:1},e._depthScale={value:0},e._depthToBlurRatioBias={value:.25},e._distortion={value:1},e._mixContrast={value:1},e.setValues(i),e}return Ai(n,[{key:"onBeforeCompile",value:function(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader="\n        uniform mat4 textureMatrix;\n        varying vec4 my_vUv;\n      ".concat(e.vertexShader),e.vertexShader=e.vertexShader.replace("#include <project_vertex>","#include <project_vertex>\n        my_vUv = textureMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"),e.fragmentShader="\n        uniform sampler2D tDiffuse;\n        uniform sampler2D tDiffuseBlur;\n        uniform sampler2D tDepth;\n        uniform sampler2D distortionMap;\n        uniform float distortion;\n        uniform float cameraNear;\n\t\t\t  uniform float cameraFar;\n        uniform bool hasBlur;\n        uniform float mixBlur;\n        uniform float mirror;\n        uniform float mixStrength;\n        uniform float minDepthThreshold;\n        uniform float maxDepthThreshold;\n        uniform float mixContrast;\n        uniform float depthScale;\n        uniform float depthToBlurRatioBias;\n        varying vec4 my_vUv;\n        ".concat(e.fragmentShader),e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","#include <emissivemap_fragment>\n\n      float distortionFactor = 0.0;\n      #ifdef USE_DISTORTION\n        distortionFactor = texture2D(distortionMap, vUv).r * distortion;\n      #endif\n\n      vec4 new_vUv = my_vUv;\n      new_vUv.x += distortionFactor;\n      new_vUv.y += distortionFactor;\n\n      vec4 base = texture2DProj(tDiffuse, new_vUv);\n      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);\n\n      vec4 merge = base;\n\n      #ifdef USE_NORMALMAP\n        vec2 normal_uv = vec2(0.0);\n        vec4 normalColor = texture2D(normalMap, vUv * normalScale);\n        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );\n        vec3 coord = new_vUv.xyz / new_vUv.w;\n        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;\n        vec4 base_normal = texture2D(tDiffuse, normal_uv);\n        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);\n        merge = base_normal;\n        blur = blur_normal;\n      #endif\n\n      float depthFactor = 0.0001;\n      float blurFactor = 0.0;\n\n      #ifdef USE_DEPTH\n        vec4 depth = texture2DProj(tDepth, new_vUv);\n        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));\n        depthFactor *= depthScale;\n        depthFactor = max(0.0001, min(1.0, depthFactor));\n\n        #ifdef USE_BLUR\n          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);\n          merge = merge * min(1.0, depthFactor + 0.5);\n        #else\n          merge = merge * depthFactor;\n        #endif\n\n      #endif\n\n      float reflectorRoughnessFactor = roughness;\n      #ifdef USE_ROUGHNESSMAP\n        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );\n        reflectorRoughnessFactor *= reflectorTexelRoughness.g;\n      #endif\n\n      #ifdef USE_BLUR\n        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);\n        merge = mix(merge, blur, blurFactor);\n      #endif\n\n      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);\n      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;\n      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;\n      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;\n\n      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);\n      ")}},{key:"tDiffuse",get:function(){return this._tDiffuse.value},set:function(e){this._tDiffuse.value=e}},{key:"tDepth",get:function(){return this._tDepth.value},set:function(e){this._tDepth.value=e}},{key:"distortionMap",get:function(){return this._distortionMap.value},set:function(e){this._distortionMap.value=e}},{key:"tDiffuseBlur",get:function(){return this._tDiffuseBlur.value},set:function(e){this._tDiffuseBlur.value=e}},{key:"textureMatrix",get:function(){return this._textureMatrix.value},set:function(e){this._textureMatrix.value=e}},{key:"hasBlur",get:function(){return this._hasBlur.value},set:function(e){this._hasBlur.value=e}},{key:"mirror",get:function(){return this._mirror.value},set:function(e){this._mirror.value=e}},{key:"mixBlur",get:function(){return this._mixBlur.value},set:function(e){this._mixBlur.value=e}},{key:"mixStrength",get:function(){return this._blurStrength.value},set:function(e){this._blurStrength.value=e}},{key:"minDepthThreshold",get:function(){return this._minDepthThreshold.value},set:function(e){this._minDepthThreshold.value=e}},{key:"maxDepthThreshold",get:function(){return this._maxDepthThreshold.value},set:function(e){this._maxDepthThreshold.value=e}},{key:"depthScale",get:function(){return this._depthScale.value},set:function(e){this._depthScale.value=e}},{key:"depthToBlurRatioBias",get:function(){return this._depthToBlurRatioBias.value},set:function(e){this._depthToBlurRatioBias.value=e}},{key:"distortion",get:function(){return this._distortion.value},set:function(e){this._distortion.value=e}},{key:"mixContrast",get:function(){return this._mixContrast.value},set:function(e){this._mixContrast.value=e}}]),n}(yX),OM=["mixBlur","mixStrength","resolution","blur","minDepthThreshold","maxDepthThreshold","depthScale","depthToBlurRatioBias","mirror","distortion","mixContrast","distortionMap","reflectorOffset"];gM({MeshReflectorMaterialImpl:QM});var jM=t.forwardRef((function(e,n){var i=e.mixBlur,r=void 0===i?0:i,a=e.mixStrength,o=void 0===a?1:a,s=e.resolution,g=void 0===s?256:s,l=e.blur,u=void 0===l?[0,0]:l,c=e.minDepthThreshold,I=void 0===c?.9:c,C=e.maxDepthThreshold,d=void 0===C?1:C,h=e.depthScale,A=void 0===h?0:h,p=e.depthToBlurRatioBias,m=void 0===p?.25:p,f=e.mirror,v=void 0===f?0:f,b=e.distortion,y=void 0===b?1:b,G=e.mixContrast,B=void 0===G?1:G,Z=e.distortionMap,w=e.reflectorOffset,S=void 0===w?0:w,W=kb(e,OM),x=vM((function(e){return e.gl})),R=vM((function(e){return e.camera})),V=vM((function(e){return e.scene})),k=(u=Array.isArray(u)?u:[u,u])[0]+u[1]>0,X=t.useRef(null),Y=Ir(t.useState((function(){return new tW})),1)[0],H=Ir(t.useState((function(){return new KZ})),1)[0],F=Ir(t.useState((function(){return new KZ})),1)[0],M=Ir(t.useState((function(){return new KZ})),1)[0],K=Ir(t.useState((function(){return new hw})),1)[0],N=Ir(t.useState((function(){return new KZ(0,0,-1)})),1)[0],z=Ir(t.useState((function(){return new RZ})),1)[0],L=Ir(t.useState((function(){return new KZ})),1)[0],_=Ir(t.useState((function(){return new KZ})),1)[0],T=Ir(t.useState((function(){return new RZ})),1)[0],E=Ir(t.useState((function(){return new hw})),1)[0],J=Ir(t.useState((function(){return new US})),1)[0],D=t.useCallback((function(){var e,t=X.current.parent||(null==(e=X.current)?void 0:e.__r3f.parent);if(t&&(F.setFromMatrixPosition(t.matrixWorld),M.setFromMatrixPosition(R.matrixWorld),K.extractRotation(t.matrixWorld),H.set(0,0,1),H.applyMatrix4(K),F.addScaledVector(H,S),L.subVectors(F,M),!(L.dot(H)>0))){L.reflect(H).negate(),L.add(F),K.extractRotation(R.matrixWorld),N.set(0,0,-1),N.applyMatrix4(K),N.add(M),_.subVectors(F,N),_.reflect(H).negate(),_.add(F),J.position.copy(L),J.up.set(0,1,0),J.up.applyMatrix4(K),J.up.reflect(H),J.lookAt(_),J.far=R.far,J.updateMatrixWorld(),J.projectionMatrix.copy(R.projectionMatrix),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(J.projectionMatrix),E.multiply(J.matrixWorldInverse),E.multiply(t.matrixWorld),Y.setFromNormalAndCoplanarPoint(H,F),Y.applyMatrix4(J.matrixWorldInverse),z.set(Y.normal.x,Y.normal.y,Y.normal.z,Y.constant);var n=J.projectionMatrix;T.x=(Math.sign(z.x)+n.elements[8])/n.elements[0],T.y=(Math.sign(z.y)+n.elements[9])/n.elements[5],T.z=-1,T.w=(1+n.elements[10])/n.elements[14],z.multiplyScalar(2/z.dot(T)),n.elements[2]=z.x,n.elements[6]=z.y,n.elements[10]=z.z+1,n.elements[14]=z.w}}),[R,S]),U=t.useMemo((function(){var e={minFilter:jy,magFilter:jy,encoding:x.outputEncoding,type:lG},t=new VZ(g,g,e);t.depthBuffer=!0,t.depthTexture=new YR(g,g),t.depthTexture.format=mG,t.depthTexture.type=aG;var n=new VZ(g,g,e);return[t,n,new PM({gl:x,resolution:g,width:u[0],height:u[1],minDepthThreshold:I,maxDepthThreshold:d,depthScale:A,depthToBlurRatioBias:m}),{mirror:v,textureMatrix:E,mixBlur:r,tDiffuse:t.texture,tDepth:t.depthTexture,tDiffuseBlur:n.texture,hasBlur:k,mixStrength:o,minDepthThreshold:I,maxDepthThreshold:d,depthScale:A,depthToBlurRatioBias:m,distortion:y,distortionMap:Z,mixContrast:B,"defines-USE_BLUR":k?"":void 0,"defines-USE_DEPTH":A>0?"":void 0,"defines-USE_DISTORTION":Z?"":void 0}]}),[x,u,E,g,v,k,r,o,I,d,A,m,y,Z,B]),P=Ir(U,4),Q=P[0],O=P[1],j=P[2],q=P[3];return bM((function(){var e,t=X.current.parent||(null==(e=X.current)?void 0:e.__r3f.parent);if(t){t.visible=!1;var n=x.xr.enabled,i=x.shadowMap.autoUpdate;D(),x.xr.enabled=!1,x.shadowMap.autoUpdate=!1,x.setRenderTarget(Q),x.state.buffers.depth.setMask(!0),x.autoClear||x.clear(),x.render(V,J),k&&j.render(x,Q,O),x.xr.enabled=n,x.shadowMap.autoUpdate=i,t.visible=!0,x.setRenderTarget(null)}})),t.createElement("meshReflectorMaterialImpl",oa({attach:"material",key:"key"+q["defines-USE_BLUR"]+q["defines-USE_DEPTH"]+q["defines-USE_DISTORTION"],ref:DM([X,n])},q,W))})),qM=["samples"];function $M(e,n,i){var r=vM(),a=r.gl,o=r.size,s=r.viewport,g="number"===typeof e?e:o.width*s.dpr,l="number"===typeof n?n:o.height*s.dpr,u=("number"===typeof e?i:e)||{},c=u.samples,I=kb(u,qM),C=t.useMemo((function(){var e;return(e=new VZ(g,l,Vb({minFilter:jy,magFilter:jy,encoding:a.outputEncoding,type:lG},I))).samples=c,e}),[]);return t.useLayoutEffect((function(){C.setSize(g,l),c&&(C.samples=c)}),[c,C,g,l]),t.useEffect((function(){return function(){return C.dispose()}}),[]),C}var eK,tK=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.call(this,{uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new KZ(0,0,0)},lightColor:{value:new BZ("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new sZ(0,0)}},transparent:!0,depthWrite:!1,vertexShader:"\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform vec3 spotPosition;\n      uniform float attenuation;      \n\n      void main() {\n        // compute intensity\n        vNormal = normalize( normalMatrix * normal );\n        vec4 worldPosition\t= modelMatrix * vec4( position, 1.0 );\n        vWorldPosition = worldPosition.xyz;\n        vec4 viewPosition = viewMatrix * worldPosition;\n        vViewZ = viewPosition.z;\n        float intensity\t= distance(worldPosition.xyz, spotPosition) / attenuation;\n        intensity\t= 1.0 - clamp(intensity, 0.0, 1.0);\n        vIntensity = intensity;        \n        // set gl_Position\n        gl_Position\t= projectionMatrix * viewPosition;\n\n      }",fragmentShader:"\n      #include <packing>\n\n      varying vec3 vNormal;\n      varying vec3 vWorldPosition;\n      uniform vec3 lightColor;\n      uniform vec3 spotPosition;\n      uniform float attenuation;\n      uniform float anglePower;\n      uniform sampler2D depth;\n      uniform vec2 resolution;\n      uniform float cameraNear;\n      uniform float cameraFar;\n      varying float vViewZ;\n      varying float vIntensity;\n      uniform float opacity;\n\n      float readDepth( sampler2D depthSampler, vec2 coord ) {\n        float fragCoordZ = texture2D( depthSampler, coord ).x;\n        float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);\n        return viewZ;\n      }\n\n      void main() {\n        float d = 1.0;\n        bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;\n        if (isSoft) {\n          vec2 sUv = gl_FragCoord.xy / resolution;\n          d = readDepth(depth, sUv);\n        }\n        float intensity = vIntensity;\n        vec3 normal\t= vec3(vNormal.x, vNormal.y, abs(vNormal.z));\n        float angleIntensity\t= pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );\n        intensity\t*= angleIntensity;\n        // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry\n        if (isSoft) {\n          intensity\t*= smoothstep(0., 1., vViewZ - d);\n        }\n        gl_FragColor = vec4(lightColor, intensity * opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <encodings_fragment>\n      }"})}return Ai(n)}(JS),nK=["opacity","radiusTop","radiusBottom","depthBuffer","color","distance","angle","attenuation","anglePower"],iK=new KZ,rK=t.forwardRef((function(e,n){var i=e.opacity,r=void 0===i?1:i,a=e.radiusTop,o=e.radiusBottom,s=e.depthBuffer,g=e.color,l=void 0===g?"white":g,u=e.distance,c=void 0===u?5:u,I=e.angle,C=void 0===I?.15:I,d=e.attenuation,h=void 0===d?5:d,A=e.anglePower,p=void 0===A?5:A,m=kb(e,nK),f=t.useRef(null),v=vM((function(e){return e.size})),b=vM((function(e){return e.camera})),y=vM((function(e){return e.viewport.dpr})),G=Ir(t.useState((function(){return new tK})),1)[0];a=void 0===a?.1:a,o=void 0===o?7*C:o,bM((function(){G.uniforms.spotPosition.value.copy(f.current.getWorldPosition(iK)),f.current.lookAt(f.current.parent.target.getWorldPosition(iK))}));var B=t.useMemo((function(){var e=new bk(a,o,c,128,64,!0);return e.applyMatrix4((new hw).makeTranslation(0,-c/2,0)),e.applyMatrix4((new hw).makeRotationX(-Math.PI/2)),e}),[C,c,a,o]);return t.createElement("spotLight",oa({ref:n,angle:C,color:l,distance:c},m),t.createElement("mesh",{ref:f,geometry:B,raycast:function(){return null}},t.createElement("primitive",{object:G,attach:"material","uniforms-opacity-value":r,"uniforms-lightColor-value":l,"uniforms-attenuation-value":h,"uniforms-anglePower-value":p,"uniforms-depth-value":s,"uniforms-cameraNear-value":b.near,"uniforms-cameraFar-value":b.far,"uniforms-resolution-value":s?[v.width*y,v.height*y]:[0,0]})))})),aK=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.call(this,{uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(mvPosition.x + 2.0 * time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:"\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <encodings_fragment>\n      }"})}return Ai(n)}(JS),oK=function(e){return(new KZ).setFromSpherical(new fH(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI))},sK=t.forwardRef((function(e,n){var i=e.radius,r=void 0===i?100:i,a=e.depth,o=void 0===a?50:a,s=e.count,g=void 0===s?5e3:s,l=e.saturation,u=void 0===l?0:l,c=e.factor,I=void 0===c?4:c,C=e.fade,d=void 0!==C&&C,h=e.speed,A=void 0===h?1:h,p=t.useRef(),m=t.useMemo((function(){for(var e=[],t=[],n=Array.from({length:g},(function(){return(.5+.5*Math.random())*I})),i=new BZ,a=r+o,s=o/g,l=0;l<g;l++)a-=s*Math.random(),e.push.apply(e,Ci(oK(a).toArray())),i.setHSL(l/g,u,.9),t.push(i.r,i.g,i.b);return[new Float32Array(e),new Float32Array(t),new Float32Array(n)]}),[g,o,I,r,u]),f=Ir(m,3),v=f[0],b=f[1],y=f[2];bM((function(e){return p.current&&(p.current.uniforms.time.value=e.clock.getElapsedTime()*A)}));var G=Ir(t.useState((function(){return new aK})),1)[0];return t.createElement("points",{ref:n},t.createElement("bufferGeometry",null,t.createElement("bufferAttribute",{attach:"attributes-position",args:[v,3]}),t.createElement("bufferAttribute",{attach:"attributes-color",args:[b,3]}),t.createElement("bufferAttribute",{attach:"attributes-size",args:[y,1]})),t.createElement("primitive",{ref:p,object:G,attach:"material",blending:ey,"uniforms-fade-value":d,transparent:!0,vertexColors:!0}))})),gK=["makeDefault"],lK=t.forwardRef((function(e,n){var i=e.makeDefault,r=kb(e,gK),a=vM((function(e){return e.set})),o=vM((function(e){return e.camera})),s=vM((function(e){return e.size})),g=t.useRef();return t.useLayoutEffect((function(){var e=g.current;e&&!r.manual&&(e.aspect=s.width/s.height,e.updateProjectionMatrix())}),[s,r]),t.useLayoutEffect((function(){if(i&&g.current){var e=o;return a((function(){return{camera:g.current}})),function(){return a((function(){return{camera:e}}))}}}),[g,i,a]),t.createElement("perspectiveCamera",oa({ref:DM([g,n])},r))})),uK=function(e,t){return(e%t+t)%t},cK=function(e){Li(n,e);var t=Di(n);function n(e,i){var r;di(this,n),Eo(Ni(r=t.call(this)),"object",void 0),Eo(Ni(r),"domElement",void 0),Eo(Ni(r),"enabled",!0),Eo(Ni(r),"target",new KZ),Eo(Ni(r),"minDistance",0),Eo(Ni(r),"maxDistance",1/0),Eo(Ni(r),"minZoom",0),Eo(Ni(r),"maxZoom",1/0),Eo(Ni(r),"minPolarAngle",0),Eo(Ni(r),"maxPolarAngle",Math.PI),Eo(Ni(r),"minAzimuthAngle",-1/0),Eo(Ni(r),"maxAzimuthAngle",1/0),Eo(Ni(r),"enableDamping",!1),Eo(Ni(r),"dampingFactor",.05),Eo(Ni(r),"enableZoom",!0),Eo(Ni(r),"zoomSpeed",1),Eo(Ni(r),"enableRotate",!0),Eo(Ni(r),"rotateSpeed",1),Eo(Ni(r),"enablePan",!0),Eo(Ni(r),"panSpeed",1),Eo(Ni(r),"screenSpacePanning",!0),Eo(Ni(r),"keyPanSpeed",7),Eo(Ni(r),"autoRotate",!1),Eo(Ni(r),"autoRotateSpeed",2),Eo(Ni(r),"reverseOrbit",!1),Eo(Ni(r),"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Eo(Ni(r),"mouseButtons",{LEFT:Mb.ROTATE,MIDDLE:Mb.DOLLY,RIGHT:Mb.PAN}),Eo(Ni(r),"touches",{ONE:Kb.ROTATE,TWO:Kb.DOLLY_PAN}),Eo(Ni(r),"target0",void 0),Eo(Ni(r),"position0",void 0),Eo(Ni(r),"zoom0",void 0),Eo(Ni(r),"_domElementKeyEvents",null),Eo(Ni(r),"getPolarAngle",void 0),Eo(Ni(r),"getAzimuthalAngle",void 0),Eo(Ni(r),"setPolarAngle",void 0),Eo(Ni(r),"setAzimuthalAngle",void 0),Eo(Ni(r),"getDistance",void 0),Eo(Ni(r),"listenToKeyEvents",void 0),Eo(Ni(r),"saveState",void 0),Eo(Ni(r),"reset",void 0),Eo(Ni(r),"update",void 0),Eo(Ni(r),"connect",void 0),Eo(Ni(r),"dispose",void 0),r.object=e,r.domElement=i,r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object instanceof US?r.object.zoom:1,r.getPolarAngle=function(){return I.phi},r.getAzimuthalAngle=function(){return I.theta},r.setPolarAngle=function(e){var t=uK(e,2*Math.PI),n=I.phi;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);var i=Math.abs(t-n);2*Math.PI-i<i&&(t<n?t+=2*Math.PI:n+=2*Math.PI),C.phi=t-n,a.update()},r.setAzimuthalAngle=function(e){var t=uK(e,2*Math.PI),n=I.theta;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);var i=Math.abs(t-n);2*Math.PI-i<i&&(t<n?t+=2*Math.PI:n+=2*Math.PI),C.theta=t-n,a.update()},r.getDistance=function(){return a.object.position.distanceTo(a.target)},r.listenToKeyEvents=function(e){e.addEventListener("keydown",Q),r._domElementKeyEvents=e},r.saveState=function(){a.target0.copy(a.target),a.position0.copy(a.object.position),a.zoom0=a.object instanceof US?a.object.zoom:1},r.reset=function(){a.target.copy(a.target0),a.object.position.copy(a.position0),a.object instanceof US&&(a.object.zoom=a.zoom0,a.object.updateProjectionMatrix()),a.dispatchEvent(o),a.update(),u=l.NONE},r.update=function(){var t=new KZ,n=(new MZ).setFromUnitVectors(e.up,new KZ(0,1,0)),i=n.clone().invert(),r=new KZ,s=new MZ,g=2*Math.PI;return function(){var e=a.object.position;t.copy(e).sub(a.target),t.applyQuaternion(n),I.setFromVector3(t),a.autoRotate&&u===l.NONE&&x(2*Math.PI/60/60*a.autoRotateSpeed),a.enableDamping?(I.theta+=C.theta*a.dampingFactor,I.phi+=C.phi*a.dampingFactor):(I.theta+=C.theta,I.phi+=C.phi);var p=a.minAzimuthAngle,m=a.maxAzimuthAngle;return isFinite(p)&&isFinite(m)&&(p<-Math.PI?p+=g:p>Math.PI&&(p-=g),m<-Math.PI?m+=g:m>Math.PI&&(m-=g),I.theta=p<=m?Math.max(p,Math.min(m,I.theta)):I.theta>(p+m)/2?Math.max(p,I.theta):Math.min(m,I.theta)),I.phi=Math.max(a.minPolarAngle,Math.min(a.maxPolarAngle,I.phi)),I.makeSafe(),I.radius*=d,I.radius=Math.max(a.minDistance,Math.min(a.maxDistance,I.radius)),!0===a.enableDamping?a.target.addScaledVector(h,a.dampingFactor):a.target.add(h),t.setFromSpherical(I),t.applyQuaternion(i),e.copy(a.target).add(t),a.object.lookAt(a.target),!0===a.enableDamping?(C.theta*=1-a.dampingFactor,C.phi*=1-a.dampingFactor,h.multiplyScalar(1-a.dampingFactor)):(C.set(0,0,0),h.set(0,0,0)),d=1,!!(A||r.distanceToSquared(a.object.position)>c||8*(1-s.dot(a.object.quaternion))>c)&&(a.dispatchEvent(o),r.copy(a.object.position),s.copy(a.object.quaternion),A=!1,!0)}}(),r.connect=function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),a.domElement=e,a.domElement.style.touchAction="none",a.domElement.addEventListener("contextmenu",O),a.domElement.addEventListener("pointerdown",E),a.domElement.addEventListener("pointercancel",U),a.domElement.addEventListener("wheel",P)},r.dispose=function(){var e,t,n,i,r,o;null===(e=a.domElement)||void 0===e||e.removeEventListener("contextmenu",O),null===(t=a.domElement)||void 0===t||t.removeEventListener("pointerdown",E),null===(n=a.domElement)||void 0===n||n.removeEventListener("pointercancel",U),null===(i=a.domElement)||void 0===i||i.removeEventListener("wheel",P),null===(r=a.domElement)||void 0===r||r.ownerDocument.removeEventListener("pointermove",J),null===(o=a.domElement)||void 0===o||o.ownerDocument.removeEventListener("pointerup",D),null!==a._domElementKeyEvents&&a._domElementKeyEvents.removeEventListener("keydown",Q)};var a=Ni(r),o={type:"change"},s={type:"start"},g={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},u=l.NONE,c=1e-6,I=new fH,C=new fH,d=1,h=new KZ,A=!1,p=new sZ,m=new sZ,f=new sZ,v=new sZ,b=new sZ,y=new sZ,G=new sZ,B=new sZ,Z=new sZ,w=[],S={};function W(){return Math.pow(.95,a.zoomSpeed)}function x(e){a.reverseOrbit?C.theta+=e:C.theta-=e}function R(e){a.reverseOrbit?C.phi+=e:C.phi-=e}var V=function(){var e=new KZ;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),h.add(e)}}(),k=function(){var e=new KZ;return function(t,n){!0===a.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(a.object.up,e)),e.multiplyScalar(t),h.add(e)}}(),X=function(){var e=new KZ;return function(t,n){var i=a.domElement;if(i&&a.object instanceof US&&a.object.isPerspectiveCamera){var r=a.object.position;e.copy(r).sub(a.target);var o=e.length();o*=Math.tan(a.object.fov/2*Math.PI/180),V(2*t*o/i.clientHeight,a.object.matrix),k(2*n*o/i.clientHeight,a.object.matrix)}else i&&a.object instanceof pW&&a.object.isOrthographicCamera?(V(t*(a.object.right-a.object.left)/a.object.zoom/i.clientWidth,a.object.matrix),k(n*(a.object.top-a.object.bottom)/a.object.zoom/i.clientHeight,a.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),a.enablePan=!1)}}();function Y(e){a.object instanceof US&&a.object.isPerspectiveCamera?d/=e:a.object instanceof pW&&a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom*e)),a.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function H(e){a.object instanceof US&&a.object.isPerspectiveCamera?d*=e:a.object instanceof pW&&a.object.isOrthographicCamera?(a.object.zoom=Math.max(a.minZoom,Math.min(a.maxZoom,a.object.zoom/e)),a.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),a.enableZoom=!1)}function F(e){p.set(e.clientX,e.clientY)}function M(e){v.set(e.clientX,e.clientY)}function K(){if(1==w.length)p.set(w[0].pageX,w[0].pageY);else{var e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);p.set(e,t)}}function N(){if(1==w.length)v.set(w[0].pageX,w[0].pageY);else{var e=.5*(w[0].pageX+w[1].pageX),t=.5*(w[0].pageY+w[1].pageY);v.set(e,t)}}function z(){var e=w[0].pageX-w[1].pageX,t=w[0].pageY-w[1].pageY,n=Math.sqrt(e*e+t*t);G.set(0,n)}function L(e){if(1==w.length)m.set(e.pageX,e.pageY);else{var t=$(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);m.set(n,i)}f.subVectors(m,p).multiplyScalar(a.rotateSpeed);var r=a.domElement;r&&(x(2*Math.PI*f.x/r.clientHeight),R(2*Math.PI*f.y/r.clientHeight)),p.copy(m)}function _(e){if(1==w.length)b.set(e.pageX,e.pageY);else{var t=$(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);b.set(n,i)}y.subVectors(b,v).multiplyScalar(a.panSpeed),X(y.x,y.y),v.copy(b)}function T(e){var t=$(e),n=e.pageX-t.x,i=e.pageY-t.y,r=Math.sqrt(n*n+i*i);B.set(0,r),Z.set(0,Math.pow(B.y/G.y,a.zoomSpeed)),Y(Z.y),G.copy(B)}function E(e){if(!1!==a.enabled){var t,n;if(0===w.length)null===(t=a.domElement)||void 0===t||t.ownerDocument.addEventListener("pointermove",J),null===(n=a.domElement)||void 0===n||n.ownerDocument.addEventListener("pointerup",D);!function(e){w.push(e)}(e),"touch"===e.pointerType?function(e){switch(q(e),w.length){case 1:switch(a.touches.ONE){case Kb.ROTATE:if(!1===a.enableRotate)return;K(),u=l.TOUCH_ROTATE;break;case Kb.PAN:if(!1===a.enablePan)return;N(),u=l.TOUCH_PAN;break;default:u=l.NONE}break;case 2:switch(a.touches.TWO){case Kb.DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;a.enableZoom&&z(),a.enablePan&&N(),u=l.TOUCH_DOLLY_PAN;break;case Kb.DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;a.enableZoom&&z(),a.enableRotate&&K(),u=l.TOUCH_DOLLY_ROTATE;break;default:u=l.NONE}break;default:u=l.NONE}u!==l.NONE&&a.dispatchEvent(s)}(e):function(e){var t;switch(e.button){case 0:t=a.mouseButtons.LEFT;break;case 1:t=a.mouseButtons.MIDDLE;break;case 2:t=a.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Mb.DOLLY:if(!1===a.enableZoom)return;!function(e){G.set(e.clientX,e.clientY)}(e),u=l.DOLLY;break;case Mb.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enablePan)return;M(e),u=l.PAN}else{if(!1===a.enableRotate)return;F(e),u=l.ROTATE}break;case Mb.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===a.enableRotate)return;F(e),u=l.ROTATE}else{if(!1===a.enablePan)return;M(e),u=l.PAN}break;default:u=l.NONE}u!==l.NONE&&a.dispatchEvent(s)}(e)}}function J(e){!1!==a.enabled&&("touch"===e.pointerType?function(e){switch(q(e),u){case l.TOUCH_ROTATE:if(!1===a.enableRotate)return;L(e),a.update();break;case l.TOUCH_PAN:if(!1===a.enablePan)return;_(e),a.update();break;case l.TOUCH_DOLLY_PAN:if(!1===a.enableZoom&&!1===a.enablePan)return;!function(e){a.enableZoom&&T(e),a.enablePan&&_(e)}(e),a.update();break;case l.TOUCH_DOLLY_ROTATE:if(!1===a.enableZoom&&!1===a.enableRotate)return;!function(e){a.enableZoom&&T(e),a.enableRotate&&L(e)}(e),a.update();break;default:u=l.NONE}}(e):function(e){if(!1===a.enabled)return;switch(u){case l.ROTATE:if(!1===a.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),f.subVectors(m,p).multiplyScalar(a.rotateSpeed);var t=a.domElement;t&&(x(2*Math.PI*f.x/t.clientHeight),R(2*Math.PI*f.y/t.clientHeight)),p.copy(m),a.update()}(e);break;case l.DOLLY:if(!1===a.enableZoom)return;!function(e){B.set(e.clientX,e.clientY),Z.subVectors(B,G),Z.y>0?Y(W()):Z.y<0&&H(W()),G.copy(B),a.update()}(e);break;case l.PAN:if(!1===a.enablePan)return;!function(e){b.set(e.clientX,e.clientY),y.subVectors(b,v).multiplyScalar(a.panSpeed),X(y.x,y.y),v.copy(b),a.update()}(e)}}(e))}function D(e){var t,n,i;(j(e),0===w.length)&&(null===(t=a.domElement)||void 0===t||t.releasePointerCapture(e.pointerId),null===(n=a.domElement)||void 0===n||n.ownerDocument.removeEventListener("pointermove",J),null===(i=a.domElement)||void 0===i||i.ownerDocument.removeEventListener("pointerup",D));a.dispatchEvent(g),u=l.NONE}function U(e){j(e)}function P(e){!1===a.enabled||!1===a.enableZoom||u!==l.NONE&&u!==l.ROTATE||(e.preventDefault(),a.dispatchEvent(s),function(e){e.deltaY<0?H(W()):e.deltaY>0&&Y(W()),a.update()}(e),a.dispatchEvent(g))}function Q(e){!1!==a.enabled&&!1!==a.enablePan&&function(e){var t=!1;switch(e.code){case a.keys.UP:X(0,a.keyPanSpeed),t=!0;break;case a.keys.BOTTOM:X(0,-a.keyPanSpeed),t=!0;break;case a.keys.LEFT:X(a.keyPanSpeed,0),t=!0;break;case a.keys.RIGHT:X(-a.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),a.update())}(e)}function O(e){!1!==a.enabled&&e.preventDefault()}function j(e){delete S[e.pointerId];for(var t=0;t<w.length;t++)if(w[t].pointerId==e.pointerId)return void w.splice(t,1)}function q(e){var t=S[e.pointerId];void 0===t&&(t=new sZ,S[e.pointerId]=t),t.set(e.pageX,e.pageY)}function $(e){var t=e.pointerId===w[0].pointerId?w[1]:w[0];return S[t.pointerId]}return void 0!==i&&r.connect(i),r.update(),r}return Ai(n)}(PB),IK=["makeDefault","camera","regress","domElement","enableDamping","onChange","onStart","onEnd"],CK=t.forwardRef((function(e,n){var i=e.makeDefault,r=e.camera,a=e.regress,o=e.domElement,s=e.enableDamping,g=void 0===s||s,l=e.onChange,u=e.onStart,c=e.onEnd,I=kb(e,IK),C=vM((function(e){return e.invalidate})),d=vM((function(e){return e.camera})),h=vM((function(e){return e.gl})),A=vM((function(e){return e.events})),p=vM((function(e){return e.set})),m=vM((function(e){return e.get})),f=vM((function(e){return e.performance})),v=r||d,b=o||A.connected||h.domElement,y=t.useMemo((function(){return new cK(v)}),[v]);return bM((function(){y.enabled&&y.update()}),-1),t.useEffect((function(){return y.connect(b),function(){y.dispose()}}),[b,a,y,C]),t.useEffect((function(){var e=function(e){C(),a&&f.regress(),l&&l(e)};return y.addEventListener("change",e),u&&y.addEventListener("start",u),c&&y.addEventListener("end",c),function(){u&&y.removeEventListener("start",u),c&&y.removeEventListener("end",c),y.removeEventListener("change",e)}}),[l,u,c,y,C]),t.useEffect((function(){if(i){var e=m().controls;return p({controls:y}),function(){return p({controls:e})}}}),[i,y]),t.createElement("primitive",oa({ref:n,object:y,enableDamping:g},I))})),dK=["onCollide","onCollideBegin","onCollideEnd"],hK=["bi","bj"],AK=["body","contact","target"],pK=["uuid"],mK=["body","ray"],fK={exports:{}},vK="object"===typeof Reflect?Reflect:null,bK=vK&&"function"===typeof vK.apply?vK.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};eK=vK&&"function"===typeof vK.ownKeys?vK.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var yK=Number.isNaN||function(e){return e!==e};function GK(){GK.init.call(this)}fK.exports=GK,fK.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,a),i(n)}function a(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}XK(e,t,a,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&XK(e,"error",t,n)}(e,r,{once:!0})}))},GK.EventEmitter=GK,GK.prototype._events=void 0,GK.prototype._eventsCount=0,GK.prototype._maxListeners=void 0;var BK=10;function ZK(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function wK(e){return void 0===e._maxListeners?GK.defaultMaxListeners:e._maxListeners}function SK(e,t,n,i){var r,a,o;if(ZK(n),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]),void 0===o)o=a[t]=n,++e._eventsCount;else if("function"===typeof o?o=a[t]=i?[n,o]:[o,n]:i?o.unshift(n):o.push(n),(r=wK(e))>0&&o.length>r&&!o.warned){o.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=o.length,function(e){console&&console.warn&&console.warn(e)}(s)}return e}function WK(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function xK(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=WK.bind(i);return r.listener=n,i.wrapFn=r,r}function RK(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):kK(r,r.length)}function VK(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function kK(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function XK(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(a){i.once&&e.removeEventListener(t,r),n(a)}))}}Object.defineProperty(GK,"defaultMaxListeners",{enumerable:!0,get:function(){return BK},set:function(e){if("number"!==typeof e||e<0||yK(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");BK=e}}),GK.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},GK.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||yK(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},GK.prototype.getMaxListeners=function(){return wK(this)},GK.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var s=r[e];if(void 0===s)return!1;if("function"===typeof s)bK(s,this,t);else{var g=s.length,l=kK(s,g);for(n=0;n<g;++n)bK(l[n],this,t)}return!0},GK.prototype.addListener=function(e,t){return SK(this,e,t,!1)},GK.prototype.on=GK.prototype.addListener,GK.prototype.prependListener=function(e,t){return SK(this,e,t,!0)},GK.prototype.once=function(e,t){return ZK(t),this.on(e,xK(this,e,t)),this},GK.prototype.prependOnceListener=function(e,t){return ZK(t),this.prependListener(e,xK(this,e,t)),this},GK.prototype.removeListener=function(e,t){var n,i,r,a,o;if(ZK(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,a=n.length-1;a>=0;a--)if(n[a]===t||n[a].listener===t){o=n[a].listener,r=a;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,o||t)}return this},GK.prototype.off=GK.prototype.removeListener,GK.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,a=Object.keys(n);for(i=0;i<a.length;++i)"removeListener"!==(r=a[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},GK.prototype.listeners=function(e){return RK(this,e,!0)},GK.prototype.rawListeners=function(e){return RK(this,e,!1)},GK.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):VK.call(e,t)},GK.prototype.listenerCount=VK,GK.prototype.eventNames=function(){return this._eventsCount>0?eK(this._events):[]};var YK=fK.exports;function HK(e,t,n){var i=void 0===t?null:t,r=function(e,t){var n=atob(e);if(t){for(var i=new Uint8Array(n.length),r=0,a=n.length;r<a;++r)i[r]=n.charCodeAt(r);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}(e,void 0!==n&&n),a=r.indexOf("\n",10)+1,o=r.substring(a)+(i?"//# sourceMappingURL="+i:""),s=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(s)}var FK=function(e,t,n){var i;return function(r){return i=i||HK(e,t,n),new Worker(i,r)}}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuZ2V0QXZlcmFnZVBvaW50TG9jYWwocG9pbnRJbnNpZGUpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IG4gPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tmYWNlc1tpXVswXV07IC8vIFdlIG9ubHkgbmVlZCBvbmUgcG9pbnQgaW4gdGhlIGZhY2UKICAgICAgICAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgICAgY29uc3QgdlRvUCA9IG5ldyBWZWMzKCk7CiAgICAgICAgcC52c3ViKHYsIHZUb1ApOwogICAgICAgIGNvbnN0IHIxID0gbi5kb3QodlRvUCk7CiAgICAgICAgY29uc3QgdlRvUG9pbnRJbnNpZGUgPSBuZXcgVmVjMygpOwogICAgICAgIHBvaW50SW5zaWRlLnZzdWIodiwgdlRvUG9pbnRJbnNpZGUpOwogICAgICAgIGNvbnN0IHIyID0gbi5kb3QodlRvUG9pbnRJbnNpZGUpOwoKICAgICAgICBpZiAocjEgPCAwICYmIHIyID4gMCB8fCByMSA+IDAgJiYgcjIgPCAwKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgICB9CiAgICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG1heCBhbmQgbWluIGRvdCBwcm9kdWN0IG9mIGEgY29udmV4IGh1bGwgYXQgcG9zaXRpb24gKHBvcyxxdWF0KSBwcm9qZWN0ZWQgb250byBhbiBheGlzLgogICAgICogUmVzdWx0cyBhcmUgc2F2ZWQgaW4gdGhlIGFycmF5IG1heG1pbi4KICAgICAqIEBwYXJhbSByZXN1bHQgcmVzdWx0WzBdIGFuZCByZXN1bHRbMV0gd2lsbCBiZSBzZXQgdG8gbWF4aW11bSBhbmQgbWluaW11bSwgcmVzcGVjdGl2ZWx5LgogICAgICovCgoKICAgIHN0YXRpYyBwcm9qZWN0KHNoYXBlLCBheGlzLCBwb3MsIHF1YXQsIHJlc3VsdCkgewogICAgICBjb25zdCBuID0gc2hhcGUudmVydGljZXMubGVuZ3RoOwogICAgICBjb25zdCBsb2NhbEF4aXMgPSBwcm9qZWN0X2xvY2FsQXhpczsKICAgICAgbGV0IG1heCA9IDA7CiAgICAgIGxldCBtaW4gPSAwOwogICAgICBjb25zdCBsb2NhbE9yaWdpbiA9IHByb2plY3RfbG9jYWxPcmlnaW47CiAgICAgIGNvbnN0IHZzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGxvY2FsT3JpZ2luLnNldFplcm8oKTsgLy8gVHJhbnNmb3JtIHRoZSBheGlzIHRvIGxvY2FsCgogICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgYXhpcywgbG9jYWxBeGlzKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgbG9jYWxPcmlnaW4sIGxvY2FsT3JpZ2luKTsKICAgICAgY29uc3QgYWRkID0gbG9jYWxPcmlnaW4uZG90KGxvY2FsQXhpcyk7CiAgICAgIG1pbiA9IG1heCA9IHZzWzBdLmRvdChsb2NhbEF4aXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBuOyBpKyspIHsKICAgICAgICBjb25zdCB2YWwgPSB2c1tpXS5kb3QobG9jYWxBeGlzKTsKCiAgICAgICAgaWYgKHZhbCA+IG1heCkgewogICAgICAgICAgbWF4ID0gdmFsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbCA8IG1pbikgewogICAgICAgICAgbWluID0gdmFsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgbWluIC09IGFkZDsKICAgICAgbWF4IC09IGFkZDsKCiAgICAgIGlmIChtaW4gPiBtYXgpIHsKICAgICAgICAvLyBJbmNvbnNpc3RlbnQgLSBzd2FwCiAgICAgICAgY29uc3QgdGVtcCA9IG1pbjsKICAgICAgICBtaW4gPSBtYXg7CiAgICAgICAgbWF4ID0gdGVtcDsKICAgICAgfSAvLyBPdXRwdXQKCgogICAgICByZXN1bHRbMF0gPSBtYXg7CiAgICAgIHJlc3VsdFsxXSA9IG1pbjsKICAgIH0KCiAgfQogIGNvbnN0IG1heG1pbkEgPSBbXTsKICBjb25zdCBtYXhtaW5CID0gW107CiAgbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcHJvamVjdF9sb2NhbE9yaWdpbiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEEgM2QgYm94IHNoYXBlLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNpemUgPSAxCiAgICogICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gbmV3IENBTk5PTi5WZWMzKHNpemUsIHNpemUsIHNpemUpCiAgICogICAgIGNvbnN0IGJveFNoYXBlID0gbmV3IENBTk5PTi5Cb3goaGFsZkV4dGVudHMpCiAgICogICAgIGNvbnN0IGJveEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogYm94U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShib3hCb2R5KQogICAqLwogIGNsYXNzIEJveCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogVGhlIGhhbGYgZXh0ZW50cyBvZiB0aGUgYm94LgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIGJ5IHRoZSBjb250YWN0IGdlbmVyYXRvciB0byBtYWtlIGNvbnRhY3RzIHdpdGggb3RoZXIgY29udmV4IHBvbHloZWRyYSBmb3IgZXhhbXBsZS4KICAgICAqLwogICAgY29uc3RydWN0b3IoaGFsZkV4dGVudHMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkJPWAogICAgICB9KTsKICAgICAgdGhpcy5oYWxmRXh0ZW50cyA9IGhhbGZFeHRlbnRzOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IG51bGw7CiAgICAgIHRoaXMudXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgbG9jYWwgY29udmV4IHBvbHloZWRyb24gcmVwcmVzZW50YXRpb24gdXNlZCBmb3Igc29tZSBjb2xsaXNpb25zLgogICAgICovCgoKICAgIHVwZGF0ZUNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbigpIHsKICAgICAgY29uc3Qgc3ggPSB0aGlzLmhhbGZFeHRlbnRzLng7CiAgICAgIGNvbnN0IHN5ID0gdGhpcy5oYWxmRXh0ZW50cy55OwogICAgICBjb25zdCBzeiA9IHRoaXMuaGFsZkV4dGVudHMuejsKICAgICAgY29uc3QgViA9IFZlYzM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW25ldyBWKC1zeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgLXN5LCBzeiksIG5ldyBWKHN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIHN5LCBzeiksIG5ldyBWKC1zeCwgc3ksIHN6KV07CiAgICAgIGNvbnN0IGZhY2VzID0gW1szLCAyLCAxLCAwXSwgLy8gLXoKICAgICAgWzQsIDUsIDYsIDddLCAvLyAregogICAgICBbNSwgNCwgMCwgMV0sIC8vIC15CiAgICAgIFsyLCAzLCA3LCA2XSwgLy8gK3kKICAgICAgWzAsIDQsIDcsIDNdLCAvLyAteAogICAgICBbMSwgMiwgNiwgNV0gLy8gK3gKICAgICAgXTsKICAgICAgY29uc3QgYXhlcyA9IFtuZXcgVigwLCAwLCAxKSwgbmV3IFYoMCwgMSwgMCksIG5ldyBWKDEsIDAsIDApXTsKICAgICAgY29uc3QgaCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKHsKICAgICAgICB2ZXJ0aWNlcywKICAgICAgICBmYWNlcywKICAgICAgICBheGVzCiAgICAgIH0pOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IGg7CiAgICAgIGgubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdGhlIGluZXJ0aWEgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKHRoaXMuaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgc3RhdGljIGNhbGN1bGF0ZUluZXJ0aWEoaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCkgewogICAgICBjb25zdCBlID0gaGFsZkV4dGVudHM7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueCAqIDIgKiBlLnggKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC56ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS54ICogMiAqIGUueCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYm94IDYgc2lkZSBub3JtYWxzCiAgICAgKiBAcGFyYW0gc2l4VGFyZ2V0VmVjdG9ycyBBbiBhcnJheSBvZiA2IHZlY3RvcnMsIHRvIHN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBub3JtYWxzIGluLgogICAgICogQHBhcmFtIHF1YXQgT3JpZW50YXRpb24gdG8gYXBwbHkgdG8gdGhlIG5vcm1hbCB2ZWN0b3JzLiBJZiBub3QgcHJvdmlkZWQsIHRoZSB2ZWN0b3JzIHdpbGwgYmUgaW4gcmVzcGVjdCB0byB0aGUgbG9jYWwgZnJhbWUuCiAgICAgKi8KCgogICAgZ2V0U2lkZU5vcm1hbHMoc2l4VGFyZ2V0VmVjdG9ycywgcXVhdCkgewogICAgICBjb25zdCBzaWRlcyA9IHNpeFRhcmdldFZlY3RvcnM7CiAgICAgIGNvbnN0IGV4ID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgc2lkZXNbMF0uc2V0KGV4LngsIDAsIDApOwogICAgICBzaWRlc1sxXS5zZXQoMCwgZXgueSwgMCk7CiAgICAgIHNpZGVzWzJdLnNldCgwLCAwLCBleC56KTsKICAgICAgc2lkZXNbM10uc2V0KC1leC54LCAwLCAwKTsKICAgICAgc2lkZXNbNF0uc2V0KDAsIC1leC55LCAwKTsKICAgICAgc2lkZXNbNV0uc2V0KDAsIDAsIC1leC56KTsKCiAgICAgIGlmIChxdWF0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gc2lkZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHF1YXQudm11bHQoc2lkZXNbaV0sIHNpZGVzW2ldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaWRlczsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdm9sdW1lIG9mIHRoZSBib3guCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gOC4wICogdGhpcy5oYWxmRXh0ZW50cy54ICogdGhpcy5oYWxmRXh0ZW50cy55ICogdGhpcy5oYWxmRXh0ZW50cy56OwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cwogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5oYWxmRXh0ZW50cy5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogZm9yRWFjaFdvcmxkQ29ybmVyCiAgICAgKi8KCgogICAgZm9yRWFjaFdvcmxkQ29ybmVyKHBvcywgcXVhdCwgY2FsbGJhY2spIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSBbW2UueCwgZS55LCBlLnpdLCBbLWUueCwgZS55LCBlLnpdLCBbLWUueCwgLWUueSwgZS56XSwgWy1lLngsIC1lLnksIC1lLnpdLCBbZS54LCAtZS55LCAtZS56XSwgW2UueCwgZS55LCAtZS56XSwgWy1lLngsIGUueSwgLWUuel0sIFtlLngsIC1lLnksIGUuel1dOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3JuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgd29ybGRDb3JuZXJUZW1wUG9zLnNldChjb3JuZXJzW2ldWzBdLCBjb3JuZXJzW2ldWzFdLCBjb3JuZXJzW2ldWzJdKTsKICAgICAgICBxdWF0LnZtdWx0KHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBwb3MudmFkZCh3b3JsZENvcm5lclRlbXBQb3MsIHdvcmxkQ29ybmVyVGVtcFBvcyk7CiAgICAgICAgY2FsbGJhY2sod29ybGRDb3JuZXJUZW1wUG9zLngsIHdvcmxkQ29ybmVyVGVtcFBvcy55LCB3b3JsZENvcm5lclRlbXBQb3Mueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMF0uc2V0KGUueCwgZS55LCBlLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzFdLnNldCgtZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMl0uc2V0KC1lLngsIC1lLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbM10uc2V0KC1lLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzRdLnNldChlLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzVdLnNldChlLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNl0uc2V0KC1lLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbN10uc2V0KGUueCwgLWUueSwgZS56KTsKICAgICAgY29uc3Qgd2MgPSB3b3JsZENvcm5lcnNUZW1wWzBdOwogICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgIG1heC5jb3B5KHdjKTsKICAgICAgbWluLmNvcHkod2MpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCA4OyBpKyspIHsKICAgICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbaV07CiAgICAgICAgcXVhdC52bXVsdCh3Yywgd2MpOwogICAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgICAgY29uc3QgeCA9IHdjLng7CiAgICAgICAgY29uc3QgeSA9IHdjLnk7CiAgICAgICAgY29uc3QgeiA9IHdjLno7CgogICAgICAgIGlmICh4ID4gbWF4LngpIHsKICAgICAgICAgIG1heC54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5ID4gbWF4LnkpIHsKICAgICAgICAgIG1heC55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6ID4gbWF4LnopIHsKICAgICAgICAgIG1heC56ID0gejsKICAgICAgICB9CgogICAgICAgIGlmICh4IDwgbWluLngpIHsKICAgICAgICAgIG1pbi54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5IDwgbWluLnkpIHsKICAgICAgICAgIG1pbi55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6IDwgbWluLnopIHsKICAgICAgICAgIG1pbi56ID0gejsKICAgICAgICB9CiAgICAgIH0gLy8gR2V0IGVhY2ggYXhpcyBtYXgKICAgICAgLy8gbWluLnNldChJbmZpbml0eSxJbmZpbml0eSxJbmZpbml0eSk7CiAgICAgIC8vIG1heC5zZXQoLUluZmluaXR5LC1JbmZpbml0eSwtSW5maW5pdHkpOwogICAgICAvLyB0aGlzLmZvckVhY2hXb3JsZENvcm5lcihwb3MscXVhdCxmdW5jdGlvbih4LHkseil7CiAgICAgIC8vICAgICBpZih4ID4gbWF4LngpewogICAgICAvLyAgICAgICAgIG1heC54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPiBtYXgueSl7CiAgICAgIC8vICAgICAgICAgbWF4LnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA+IG1heC56KXsKICAgICAgLy8gICAgICAgICBtYXgueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih4IDwgbWluLngpewogICAgICAvLyAgICAgICAgIG1pbi54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPCBtaW4ueSl7CiAgICAgIC8vICAgICAgICAgbWluLnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA8IG1pbi56KXsKICAgICAgLy8gICAgICAgICBtaW4ueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vIH0pOwoKICAgIH0KCiAgfQogIGNvbnN0IHdvcmxkQ29ybmVyVGVtcFBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgd29ybGRDb3JuZXJzVGVtcCA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKCiAgLyoqCiAgICogQk9EWV9UWVBFUwogICAqLwogIGNvbnN0IEJPRFlfVFlQRVMgPSB7CiAgICAvKiogRFlOQU1JQyAqLwogICAgRFlOQU1JQzogMSwKCiAgICAvKiogU1RBVElDICovCiAgICBTVEFUSUM6IDIsCgogICAgLyoqIEtJTkVNQVRJQyAqLwogICAgS0lORU1BVElDOiA0CiAgfTsKICAvKioKICAgKiBCb2R5VHlwZQogICAqLwoKICAvKioKICAgKiBCT0RZX1NMRUVQX1NUQVRFUwogICAqLwogIGNvbnN0IEJPRFlfU0xFRVBfU1RBVEVTID0gewogICAgLyoqIEFXQUtFICovCiAgICBBV0FLRTogMCwKCiAgICAvKiogU0xFRVBZICovCiAgICBTTEVFUFk6IDEsCgogICAgLyoqIFNMRUVQSU5HICovCiAgICBTTEVFUElORzogMgogIH07CiAgLyoqCiAgICogQm9keVNsZWVwU3RhdGUKICAgKi8KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3IgYWxsIGJvZHkgdHlwZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2hhcGUgPSBuZXcgQ0FOTk9OLlNwaGVyZSgxKQogICAqICAgICBjb25zdCBib2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsKICAgKiAgICAgICBtYXNzOiAxLAogICAqICAgICAgIHNoYXBlLAogICAqICAgICB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHkpCiAgICovCiAgY2xhc3MgQm9keSBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciB0d28gYm9kaWVzIGNvbGxpZGUuIFRoaXMgZXZlbnQgaXMgZGlzcGF0Y2hlZCBvbiBlYWNoCiAgICAgKiBvZiB0aGUgdHdvIGJvZGllcyBpbnZvbHZlZCBpbiB0aGUgY29sbGlzaW9uLgogICAgICogQGV2ZW50IGNvbGxpZGUKICAgICAqIEBwYXJhbSBib2R5IFRoZSBib2R5IHRoYXQgd2FzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAcGFyYW0gY29udGFjdCBUaGUgZGV0YWlscyBvZiB0aGUgY29sbGlzaW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGR5bmFtaWMgYm9keSBpcyBmdWxseSBzaW11bGF0ZWQuIENhbiBiZSBtb3ZlZCBtYW51YWxseSBieSB0aGUgdXNlciwgYnV0IG5vcm1hbGx5IHRoZXkgbW92ZSBhY2NvcmRpbmcgdG8gZm9yY2VzLiBBIGR5bmFtaWMgYm9keSBjYW4gY29sbGlkZSB3aXRoIGFsbCBib2R5IHR5cGVzLiBBIGR5bmFtaWMgYm9keSBhbHdheXMgaGFzIGZpbml0ZSwgbm9uLXplcm8gbWFzcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBzdGF0aWMgYm9keSBkb2VzIG5vdCBtb3ZlIGR1cmluZyBzaW11bGF0aW9uIGFuZCBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBTdGF0aWMgYm9kaWVzIGNhbiBiZSBtb3ZlZCBtYW51YWxseSBieSBzZXR0aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgYm9keS4gVGhlIHZlbG9jaXR5IG9mIGEgc3RhdGljIGJvZHkgaXMgYWx3YXlzIHplcm8uIFN0YXRpYyBib2RpZXMgZG8gbm90IGNvbGxpZGUgd2l0aCBvdGhlciBzdGF0aWMgb3Iga2luZW1hdGljIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBraW5lbWF0aWMgYm9keSBtb3ZlcyB1bmRlciBzaW11bGF0aW9uIGFjY29yZGluZyB0byBpdHMgdmVsb2NpdHkuIFRoZXkgZG8gbm90IHJlc3BvbmQgdG8gZm9yY2VzLiBUaGV5IGNhbiBiZSBtb3ZlZCBtYW51YWxseSwgYnV0IG5vcm1hbGx5IGEga2luZW1hdGljIGJvZHkgaXMgbW92ZWQgYnkgc2V0dGluZyBpdHMgdmVsb2NpdHkuIEEga2luZW1hdGljIGJvZHkgYmVoYXZlcyBhcyBpZiBpdCBoYXMgaW5maW5pdGUgbWFzcy4gS2luZW1hdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBV0FLRQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUFkKICAgICAqLwoKICAgIC8qKgogICAgICogU0xFRVBJTkcKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIHNsZWVwaW5nIGJvZHkgaGFzIHdva2VuIHVwLgogICAgICogQGV2ZW50IHdha2V1cAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZ29uZSBpbiB0byB0aGUgc2xlZXB5IHN0YXRlLgogICAgICogQGV2ZW50IHNsZWVweQogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZmFsbGVuIGFzbGVlcC4KICAgICAqIEBldmVudCBzbGVlcAogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaWQgPSBCb2R5LmlkQ291bnRlcisrOwogICAgICB0aGlzLmluZGV4ID0gLTE7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnZsYW1iZGEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPT09ICdudW1iZXInID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA6IDE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgPT09ICdudW1iZXInID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbml0UG9zaXRpb24gPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRQb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgIHRoaXMuaW5pdFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMudmVsb2NpdHkpIHsKICAgICAgICB0aGlzLnZlbG9jaXR5LmNvcHkob3B0aW9ucy52ZWxvY2l0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdFZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5mb3JjZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG1hc3MgPSB0eXBlb2Ygb3B0aW9ucy5tYXNzID09PSAnbnVtYmVyJyA/IG9wdGlvbnMubWFzcyA6IDA7CiAgICAgIHRoaXMubWFzcyA9IG1hc3M7CiAgICAgIHRoaXMuaW52TWFzcyA9IG1hc3MgPiAwID8gMS4wIC8gbWFzcyA6IDA7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSBvcHRpb25zLm1hdGVyaWFsIHx8IG51bGw7CiAgICAgIHRoaXMubGluZWFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmxpbmVhckRhbXBpbmcgPT09ICdudW1iZXInID8gb3B0aW9ucy5saW5lYXJEYW1waW5nIDogMC4wMTsKICAgICAgdGhpcy50eXBlID0gbWFzcyA8PSAwLjAgPyBCb2R5LlNUQVRJQyA6IEJvZHkuRFlOQU1JQzsKCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50eXBlID09PSB0eXBlb2YgQm9keS5TVEFUSUMpIHsKICAgICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGU7CiAgICAgIH0KCiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHR5cGVvZiBvcHRpb25zLmFsbG93U2xlZXAgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbGxvd1NsZWVwIDogdHJ1ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy5zbGVlcFNwZWVkTGltaXQgPSB0eXBlb2Ygb3B0aW9ucy5zbGVlcFNwZWVkTGltaXQgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5zbGVlcFNwZWVkTGltaXQgOiAwLjE7CiAgICAgIHRoaXMuc2xlZXBUaW1lTGltaXQgPSB0eXBlb2Ygb3B0aW9ucy5zbGVlcFRpbWVMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwVGltZUxpbWl0IDogMTsKICAgICAgdGhpcy50aW1lTGFzdFNsZWVweSA9IDA7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgICB0aGlzLnRvcnF1ZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAob3B0aW9ucy5xdWF0ZXJuaW9uKSB7CiAgICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmluaXRRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KSB7CiAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY29weShvcHRpb25zLmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdEFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuc2hhcGVzID0gW107CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzID0gW107CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5pbmVydGlhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQgPSBuZXcgTWF0MygpOwogICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZSA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuZml4ZWRSb3RhdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZpeGVkUm90YXRpb24gIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5maXhlZFJvdGF0aW9uIDogZmFsc2U7CiAgICAgIHRoaXMuYW5ndWxhckRhbXBpbmcgPSB0eXBlb2Ygb3B0aW9ucy5hbmd1bGFyRGFtcGluZyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ3VsYXJEYW1waW5nIDogMC4wMTsKICAgICAgdGhpcy5saW5lYXJGYWN0b3IgPSBuZXcgVmVjMygxLCAxLCAxKTsKCiAgICAgIGlmIChvcHRpb25zLmxpbmVhckZhY3RvcikgewogICAgICAgIHRoaXMubGluZWFyRmFjdG9yLmNvcHkob3B0aW9ucy5saW5lYXJGYWN0b3IpOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IgPSBuZXcgVmVjMygxLCAxLCAxKTsKCiAgICAgIGlmIChvcHRpb25zLmFuZ3VsYXJGYWN0b3IpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IuY29weShvcHRpb25zLmFuZ3VsYXJGYWN0b3IpOwogICAgICB9CgogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdSYWRpdXMgPSAwOwogICAgICB0aGlzLndsYW1iZGEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmlzVHJpZ2dlciA9IEJvb2xlYW4ob3B0aW9ucy5pc1RyaWdnZXIpOwoKICAgICAgaWYgKG9wdGlvbnMuc2hhcGUpIHsKICAgICAgICB0aGlzLmFkZFNoYXBlKG9wdGlvbnMuc2hhcGUpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICB9CiAgICAvKioKICAgICAqIFdha2UgdGhlIGJvZHkgdXAuCiAgICAgKi8KCgogICAgd2FrZVVwKCkgewogICAgICBjb25zdCBwcmV2U3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuQVdBS0U7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwoKICAgICAgaWYgKHByZXZTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5Lndha2V1cEV2ZW50KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBGb3JjZSBib2R5IHNsZWVwCiAgICAgKi8KCgogICAgc2xlZXAoKSB7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuU0xFRVBJTkc7CiAgICAgIHRoaXMudmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsZWQgZXZlcnkgdGltZXN0ZXAgdG8gdXBkYXRlIGludGVybmFsIHNsZWVwIHRpbWVyIGFuZCBjaGFuZ2Ugc2xlZXAgc3RhdGUgaWYgbmVlZGVkLgogICAgICogQHBhcmFtIHRpbWUgVGhlIHdvcmxkIHRpbWUgaW4gc2Vjb25kcwogICAgICovCgoKICAgIHNsZWVwVGljayh0aW1lKSB7CiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBjb25zdCBzbGVlcFN0YXRlID0gdGhpcy5zbGVlcFN0YXRlOwogICAgICAgIGNvbnN0IHNwZWVkU3F1YXJlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgdGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpOwogICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkID0gdGhpcy5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuQVdBS0UgJiYgc3BlZWRTcXVhcmVkIDwgc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuU0xFRVBZOyAvLyBTbGVlcHkKCiAgICAgICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gdGltZTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVweUV2ZW50KTsKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHNwZWVkU3F1YXJlZCA+IHNwZWVkTGltaXRTcXVhcmVkKSB7CiAgICAgICAgICB0aGlzLndha2VVcCgpOyAvLyBXYWtlIHVwCiAgICAgICAgfSBlbHNlIGlmIChzbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQWSAmJiB0aW1lIC0gdGhpcy50aW1lTGFzdFNsZWVweSA+IHRoaXMuc2xlZXBUaW1lTGltaXQpIHsKICAgICAgICAgIHRoaXMuc2xlZXAoKTsgLy8gU2xlZXBpbmcKCiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoQm9keS5zbGVlcEV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogSWYgdGhlIGJvZHkgaXMgc2xlZXBpbmcsIGl0IHNob3VsZCBiZSBpbW1vdmFibGUgLyBoYXZlIGluZmluaXRlIG1hc3MgZHVyaW5nIHNvbHZlLiBXZSBzb2x2ZSBpdCBieSBoYXZpbmcgYSBzZXBhcmF0ZSAic29sdmUgbWFzcyIuCiAgICAgKi8KCgogICAgdXBkYXRlU29sdmVNYXNzUHJvcGVydGllcygpIHsKICAgICAgaWYgKHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB7CiAgICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSAwOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLnNldFplcm8oKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLnNldFplcm8oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IHRoaXMuaW52TWFzczsKICAgICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZS5jb3B5KHRoaXMuaW52SW5lcnRpYSk7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZS5jb3B5KHRoaXMuaW52SW5lcnRpYVdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgd29ybGQgcG9pbnQgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICBwb2ludFRvTG9jYWxGcmFtZSh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHRoaXMucG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCB2ZWN0b3IgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb0xvY2FsRnJhbWUod29ybGRWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24uY29uanVnYXRlKCkudm11bHQod29ybGRWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSBsb2NhbCBib2R5IHBvaW50IHRvIHdvcmxkIGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgdmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsVmVjdG9yLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBzaGFwZSB0byB0aGUgYm9keSB3aXRoIGEgbG9jYWwgb2Zmc2V0IGFuZCBvcmllbnRhdGlvbi4KICAgICAqIEByZXR1cm4gVGhlIGJvZHkgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGFkZFNoYXBlKHNoYXBlLCBfb2Zmc2V0LCBfb3JpZW50YXRpb24pIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKF9vZmZzZXQpIHsKICAgICAgICBvZmZzZXQuY29weShfb2Zmc2V0KTsKICAgICAgfQoKICAgICAgaWYgKF9vcmllbnRhdGlvbikgewogICAgICAgIG9yaWVudGF0aW9uLmNvcHkoX29yaWVudGF0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5zaGFwZXMucHVzaChzaGFwZSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnB1c2gob2Zmc2V0KTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucy5wdXNoKG9yaWVudGF0aW9uKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzaGFwZSBmcm9tIHRoZSBib2R5LgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlU2hhcGUoc2hhcGUpIHsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNoYXBlcy5pbmRleE9mKHNoYXBlKTsKCiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1NoYXBlIGRvZXMgbm90IGJlbG9uZyB0byB0aGUgYm9keScpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1JhZGl1cygpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHNoYXBlLmJvZHkgPSBudWxsOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBib3VuZGluZyByYWRpdXMgb2YgdGhlIGJvZHkuIFNob3VsZCBiZSBkb25lIGlmIGFueSBvZiB0aGUgc2hhcGVzIGFyZSBjaGFuZ2VkLgogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nUmFkaXVzKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IE4gPSBzaGFwZXMubGVuZ3RoOwogICAgICBsZXQgcmFkaXVzID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsKICAgICAgICBzaGFwZS51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICAgIGNvbnN0IG9mZnNldCA9IHNoYXBlT2Zmc2V0c1tpXS5sZW5ndGgoKTsKICAgICAgICBjb25zdCByID0gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CgogICAgICAgIGlmIChvZmZzZXQgKyByID4gcmFkaXVzKSB7CiAgICAgICAgICByYWRpdXMgPSBvZmZzZXQgKyByOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IHJhZGl1czsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgLmFhYmIKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IHNoYXBlT3JpZW50YXRpb25zID0gdGhpcy5zaGFwZU9yaWVudGF0aW9uczsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGNvbnN0IG9mZnNldCA9IHRtcFZlYzsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSB0bXBRdWF0OwogICAgICBjb25zdCBib2R5UXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3Qgc2hhcGVBQUJCID0gdXBkYXRlQUFCQl9zaGFwZUFBQkI7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07IC8vIEdldCBzaGFwZSB3b3JsZCBwb3NpdGlvbgoKICAgICAgICBib2R5UXVhdC52bXVsdChzaGFwZU9mZnNldHNbaV0sIG9mZnNldCk7CiAgICAgICAgb2Zmc2V0LnZhZGQodGhpcy5wb3NpdGlvbiwgb2Zmc2V0KTsgLy8gR2V0IHNoYXBlIHdvcmxkIHF1YXRlcm5pb24KCiAgICAgICAgYm9keVF1YXQubXVsdChzaGFwZU9yaWVudGF0aW9uc1tpXSwgb3JpZW50YXRpb24pOyAvLyBHZXQgc2hhcGUgQUFCQgoKICAgICAgICBzaGFwZS5jYWxjdWxhdGVXb3JsZEFBQkIob2Zmc2V0LCBvcmllbnRhdGlvbiwgc2hhcGVBQUJCLmxvd2VyQm91bmQsIHNoYXBlQUFCQi51cHBlckJvdW5kKTsKCiAgICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICAgIGFhYmIuY29weShzaGFwZUFBQkIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhYWJiLmV4dGVuZChzaGFwZUFBQkIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIGAuaW5lcnRpYVdvcmxkYCBhbmQgYC5pbnZJbmVydGlhV29ybGRgCiAgICAgKi8KCgogICAgdXBkYXRlSW5lcnRpYVdvcmxkKGZvcmNlKSB7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmludkluZXJ0aWE7CgogICAgICBpZiAoSS54ID09PSBJLnkgJiYgSS55ID09PSBJLnogJiYgIWZvcmNlKSA7IGVsc2UgewogICAgICAgIGNvbnN0IG0xID0gdWl3X20xOwogICAgICAgIGNvbnN0IG0yID0gdWl3X20yOwogICAgICAgIG0xLnNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24odGhpcy5xdWF0ZXJuaW9uKTsKICAgICAgICBtMS50cmFuc3Bvc2UobTIpOwogICAgICAgIG0xLnNjYWxlKEksIG0xKTsKICAgICAgICBtMS5tbXVsdChtMiwgdGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgcG9pbnQgb2YgdGhlIGJvZHkuIFRoaXMgY291bGQgZm9yIGV4YW1wbGUgYmUgYSBwb2ludCBvbiB0aGUgQm9keSBzdXJmYWNlLgogICAgICogQXBwbHlpbmcgZm9yY2UgdGhpcyB3YXkgd2lsbCBhZGQgdG8gQm9keS5mb3JjZSBhbmQgQm9keS50b3JxdWUuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGFtb3VudCBvZiBmb3JjZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZShmb3JjZSwgcmVsYXRpdmVQb2ludCkgewogICAgICBpZiAocmVsYXRpdmVQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIE5lZWRlZD8KICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgZm9yY2UKCgogICAgICBjb25zdCByb3RGb3JjZSA9IEJvZHlfYXBwbHlGb3JjZV9yb3RGb3JjZTsKICAgICAgcmVsYXRpdmVQb2ludC5jcm9zcyhmb3JjZSwgcm90Rm9yY2UpOyAvLyBBZGQgbGluZWFyIGZvcmNlCgogICAgICB0aGlzLmZvcmNlLnZhZGQoZm9yY2UsIHRoaXMuZm9yY2UpOyAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKICAgICAgdGhpcy50b3JxdWUudmFkZChyb3RGb3JjZSwgdGhpcy50b3JxdWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBmb3JjZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxGb3JjZShsb2NhbEZvcmNlLCBsb2NhbFBvaW50KSB7CiAgICAgIGlmIChsb2NhbFBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICBsb2NhbFBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB3b3JsZEZvcmNlID0gQm9keV9hcHBseUxvY2FsRm9yY2Vfd29ybGRGb3JjZTsKICAgICAgY29uc3QgcmVsYXRpdmVQb2ludFdvcmxkID0gQm9keV9hcHBseUxvY2FsRm9yY2VfcmVsYXRpdmVQb2ludFdvcmxkOyAvLyBUcmFuc2Zvcm0gdGhlIGZvcmNlIHZlY3RvciB0byB3b3JsZCBzcGFjZQoKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxGb3JjZSwgd29ybGRGb3JjZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlGb3JjZSh3b3JsZEZvcmNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0b3JxdWUgdG8gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gdG9ycXVlIFRoZSBhbW91bnQgb2YgdG9ycXVlIHRvIGFkZC4KICAgICAqLwoKCiAgICBhcHBseVRvcnF1ZSh0b3JxdWUpIHsKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIHRoaXMudG9ycXVlLnZhZGQodG9ycXVlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGltcHVsc2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBbiBpbXB1bHNlIGlzIGEgZm9yY2UgYWRkZWQgdG8gYSBib2R5IGR1cmluZyBhIHNob3J0IHBlcmlvZCBvZiB0aW1lIChpbXB1bHNlID0gZm9yY2UgKiB0aW1lKS4KICAgICAqIEltcHVsc2VzIHdpbGwgYmUgYWRkZWQgdG8gQm9keS52ZWxvY2l0eSBhbmQgQm9keS5hbmd1bGFyVmVsb2NpdHkuCiAgICAgKiBAcGFyYW0gaW1wdWxzZSBUaGUgYW1vdW50IG9mIGltcHVsc2UgdG8gYWRkLgogICAgICogQHBhcmFtIHJlbGF0aXZlUG9pbnQgQSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3MgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHBvaW50IHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBib2R5IGNlbnRlcgoKCiAgICAgIGNvbnN0IHIgPSByZWxhdGl2ZVBvaW50OyAvLyBDb21wdXRlIHByb2R1Y2VkIGNlbnRyYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3QgdmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3ZlbG87CiAgICAgIHZlbG8uY29weShpbXB1bHNlKTsKICAgICAgdmVsby5zY2FsZSh0aGlzLmludk1hc3MsIHZlbG8pOyAvLyBBZGQgbGluZWFyIGltcHVsc2UKCiAgICAgIHRoaXMudmVsb2NpdHkudmFkZCh2ZWxvLCB0aGlzLnZlbG9jaXR5KTsgLy8gQ29tcHV0ZSBwcm9kdWNlZCByb3RhdGlvbmFsIGltcHVsc2UgdmVsb2NpdHkKCiAgICAgIGNvbnN0IHJvdFZlbG8gPSBCb2R5X2FwcGx5SW1wdWxzZV9yb3RWZWxvOwogICAgICByLmNyb3NzKGltcHVsc2UsIHJvdFZlbG8pOwogICAgICAvKgogICAgICAgcm90VmVsby54ICo9IHRoaXMuaW52SW5lcnRpYS54OwogICAgICAgcm90VmVsby55ICo9IHRoaXMuaW52SW5lcnRpYS55OwogICAgICAgcm90VmVsby56ICo9IHRoaXMuaW52SW5lcnRpYS56OwogICAgICAgKi8KCiAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkLnZtdWx0KHJvdFZlbG8sIHJvdFZlbG8pOyAvLyBBZGQgcm90YXRpb25hbCBJbXB1bHNlCgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS52YWRkKHJvdFZlbG8sIHRoaXMuYW5ndWxhclZlbG9jaXR5KTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgbG9jYWxseS1kZWZpbmVkIGltcHVsc2UgdG8gYSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgZm9yY2UgdmVjdG9yIHRvIGFwcGx5LCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIGJvZHkgZnJhbWUuCiAgICAgKiBAcGFyYW0gbG9jYWxQb2ludCBBIGxvY2FsIHBvaW50IGluIHRoZSBib2R5IHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUxvY2FsSW1wdWxzZShsb2NhbEltcHVsc2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkSW1wdWxzZSA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEltcHVsc2UsIHdvcmxkSW1wdWxzZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlJbXB1bHNlKHdvcmxkSW1wdWxzZSwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogU2hvdWxkIGJlIGNhbGxlZCB3aGVuZXZlciB5b3UgY2hhbmdlIHRoZSBib2R5IHNoYXBlIG9yIG1hc3MuCiAgICAgKi8KCgogICAgdXBkYXRlTWFzc1Byb3BlcnRpZXMoKSB7CiAgICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50czsKICAgICAgdGhpcy5pbnZNYXNzID0gdGhpcy5tYXNzID4gMCA/IDEuMCAvIHRoaXMubWFzcyA6IDA7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmluZXJ0aWE7CiAgICAgIGNvbnN0IGZpeGVkID0gdGhpcy5maXhlZFJvdGF0aW9uOyAvLyBBcHByb3hpbWF0ZSB3aXRoIEFBQkIgYm94CgogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgaGFsZkV4dGVudHMuc2V0KCh0aGlzLmFhYmIudXBwZXJCb3VuZC54IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueCkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueSAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnkpIC8gMiwgKHRoaXMuYWFiYi51cHBlckJvdW5kLnogLSB0aGlzLmFhYmIubG93ZXJCb3VuZC56KSAvIDIpOwogICAgICBCb3guY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgdGhpcy5tYXNzLCBJKTsKICAgICAgdGhpcy5pbnZJbmVydGlhLnNldChJLnggPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueCA6IDAsIEkueSA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS55IDogMCwgSS56ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnogOiAwKTsKICAgICAgdGhpcy51cGRhdGVJbmVydGlhV29ybGQodHJ1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB3b3JsZCB2ZWxvY2l0eSBvZiBhIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIHdvcmxkUG9pbnQKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCB2ZWN0b3IuCiAgICAgKi8KCgogICAgZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod29ybGRQb2ludCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IHIgPSBuZXcgVmVjMygpOwogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcik7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHIsIHJlc3VsdCk7CiAgICAgIHRoaXMudmVsb2NpdHkudmFkZChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIE1vdmUgdGhlIGJvZHkgZm9yd2FyZCBpbiB0aW1lLgogICAgICogQHBhcmFtIGR0IFRpbWUgc3RlcAogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemUgU2V0IHRvIHRydWUgdG8gbm9ybWFsaXplIHRoZSBib2R5IHF1YXRlcm5pb24KICAgICAqIEBwYXJhbSBxdWF0Tm9ybWFsaXplRmFzdCBJZiB0aGUgcXVhdGVybmlvbiBzaG91bGQgYmUgbm9ybWFsaXplZCB1c2luZyAiZmFzdCIgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uCiAgICAgKi8KCgogICAgaW50ZWdyYXRlKGR0LCBxdWF0Tm9ybWFsaXplLCBxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAvLyBTYXZlIHByZXZpb3VzIHBvc2l0aW9uCiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbi5jb3B5KHRoaXMucG9zaXRpb24pOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KHRoaXMucXVhdGVybmlvbik7CgogICAgICBpZiAoISh0aGlzLnR5cGUgPT09IEJvZHkuRFlOQU1JQyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB8fCB0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB2ZWxvID0gdGhpcy52ZWxvY2l0eTsKICAgICAgY29uc3QgYW5ndWxhclZlbG8gPSB0aGlzLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgY29uc3QgcG9zID0gdGhpcy5wb3NpdGlvbjsKICAgICAgY29uc3QgZm9yY2UgPSB0aGlzLmZvcmNlOwogICAgICBjb25zdCB0b3JxdWUgPSB0aGlzLnRvcnF1ZTsKICAgICAgY29uc3QgcXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgaW52TWFzcyA9IHRoaXMuaW52TWFzczsKICAgICAgY29uc3QgaW52SW5lcnRpYSA9IHRoaXMuaW52SW5lcnRpYVdvcmxkOwogICAgICBjb25zdCBsaW5lYXJGYWN0b3IgPSB0aGlzLmxpbmVhckZhY3RvcjsKICAgICAgY29uc3QgaU1kdCA9IGludk1hc3MgKiBkdDsKICAgICAgdmVsby54ICs9IGZvcmNlLnggKiBpTWR0ICogbGluZWFyRmFjdG9yLng7CiAgICAgIHZlbG8ueSArPSBmb3JjZS55ICogaU1kdCAqIGxpbmVhckZhY3Rvci55OwogICAgICB2ZWxvLnogKz0gZm9yY2UueiAqIGlNZHQgKiBsaW5lYXJGYWN0b3IuejsKICAgICAgY29uc3QgZSA9IGludkluZXJ0aWEuZWxlbWVudHM7CiAgICAgIGNvbnN0IGFuZ3VsYXJGYWN0b3IgPSB0aGlzLmFuZ3VsYXJGYWN0b3I7CiAgICAgIGNvbnN0IHR4ID0gdG9ycXVlLnggKiBhbmd1bGFyRmFjdG9yLng7CiAgICAgIGNvbnN0IHR5ID0gdG9ycXVlLnkgKiBhbmd1bGFyRmFjdG9yLnk7CiAgICAgIGNvbnN0IHR6ID0gdG9ycXVlLnogKiBhbmd1bGFyRmFjdG9yLno7CiAgICAgIGFuZ3VsYXJWZWxvLnggKz0gZHQgKiAoZVswXSAqIHR4ICsgZVsxXSAqIHR5ICsgZVsyXSAqIHR6KTsKICAgICAgYW5ndWxhclZlbG8ueSArPSBkdCAqIChlWzNdICogdHggKyBlWzRdICogdHkgKyBlWzVdICogdHopOwogICAgICBhbmd1bGFyVmVsby56ICs9IGR0ICogKGVbNl0gKiB0eCArIGVbN10gKiB0eSArIGVbOF0gKiB0eik7IC8vIFVzZSBuZXcgdmVsb2NpdHkgIC0gbGVhcCBmcm9nCgogICAgICBwb3MueCArPSB2ZWxvLnggKiBkdDsKICAgICAgcG9zLnkgKz0gdmVsby55ICogZHQ7CiAgICAgIHBvcy56ICs9IHZlbG8ueiAqIGR0OwogICAgICBxdWF0LmludGVncmF0ZSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSwgZHQsIHRoaXMuYW5ndWxhckZhY3RvciwgcXVhdCk7CgogICAgICBpZiAocXVhdE5vcm1hbGl6ZSkgewogICAgICAgIGlmIChxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAgICAgcXVhdC5ub3JtYWxpemVGYXN0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHF1YXQubm9ybWFsaXplKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7IC8vIFVwZGF0ZSB3b3JsZCBpbmVydGlhCgogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCgpOwogICAgfQoKICB9CiAgQm9keS5pZENvdW50ZXIgPSAwOwogIEJvZHkuQ09MTElERV9FVkVOVF9OQU1FID0gJ2NvbGxpZGUnOwogIEJvZHkuRFlOQU1JQyA9IEJPRFlfVFlQRVMuRFlOQU1JQzsKICBCb2R5LlNUQVRJQyA9IEJPRFlfVFlQRVMuU1RBVElDOwogIEJvZHkuS0lORU1BVElDID0gQk9EWV9UWVBFUy5LSU5FTUFUSUM7CiAgQm9keS5BV0FLRSA9IEJPRFlfU0xFRVBfU1RBVEVTLkFXQUtFOwogIEJvZHkuU0xFRVBZID0gQk9EWV9TTEVFUF9TVEFURVMuU0xFRVBZOwogIEJvZHkuU0xFRVBJTkcgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUElORzsKICBCb2R5Lndha2V1cEV2ZW50ID0gewogICAgdHlwZTogJ3dha2V1cCcKICB9OwogIEJvZHkuc2xlZXB5RXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXB5JwogIH07CiAgQm9keS5zbGVlcEV2ZW50ID0gewogICAgdHlwZTogJ3NsZWVwJwogIH07CiAgY29uc3QgdG1wVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB1cGRhdGVBQUJCX3NoYXBlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgdWl3X20xID0gbmV3IE1hdDMoKTsKICBjb25zdCB1aXdfbTIgPSBuZXcgTWF0MygpOwogIG5ldyBNYXQzKCk7CiAgY29uc3QgQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlJbXB1bHNlX3ZlbG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfdXBkYXRlTWFzc1Byb3BlcnRpZXNfaGFsZkV4dGVudHMgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBicm9hZHBoYXNlIGltcGxlbWVudGF0aW9ucwogICAqIEBhdXRob3Igc2NodGVwcGUKICAgKi8KICBjbGFzcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBmb3IgY29sbGlzaW9ucyBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIHRydWUsIHRoZSBicm9hZHBoYXNlIHVzZXMgYm91bmRpbmcgYm94ZXMgZm9yIGludGVyc2VjdGlvbiB0ZXN0cywgZWxzZSBpdCB1c2VzIGJvdW5kaW5nIHNwaGVyZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIGlmIHRoZSBvYmplY3RzIGluIHRoZSB3b3JsZCBtb3ZlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnVzZUJvdW5kaW5nQm94ZXMgPSBmYWxzZTsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY29sbGlzaW9uIHBhaXJzIGZyb20gdGhlIHdvcmxkCiAgICAgKiBAcGFyYW0gd29ybGQgVGhlIHdvcmxkIHRvIHNlYXJjaCBpbgogICAgICogQHBhcmFtIHAxIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICogQHBhcmFtIHAyIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb2xsaXNpb25QYWlycyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgQnJvYWRQaGFzZSBjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBib2R5IHBhaXIgbmVlZHMgdG8gYmUgaW50ZXJzZWN0aW9uIHRlc3RlZCBhdCBhbGwuCiAgICAgKi8KCgogICAgbmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYm9keUEsIGJvZHlCKSB7CiAgICAgIC8vIENoZWNrIGNvbGxpc2lvbiBmaWx0ZXIgbWFza3MKICAgICAgaWYgKChib2R5QS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlCLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5Qi5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlBLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIENoZWNrIHR5cGVzCgoKICAgICAgaWYgKCgoYm9keUEudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5QS5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSAmJiAoKGJvZHlCLnR5cGUgJiBCb2R5LlNUQVRJQykgIT09IDAgfHwgYm9keUIuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykpIHsKICAgICAgICAvLyBCb3RoIGJvZGllcyBhcmUgc3RhdGljIG9yIHNsZWVwaW5nLiBTa2lwLgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyB2b2x1bWVzIG9mIHR3byBib2RpZXMgaW50ZXJzZWN0LgogICAgICovCgoKICAgIGludGVyc2VjdGlvblRlc3QoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBpZiAodGhpcy51c2VCb3VuZGluZ0JveGVzKSB7CiAgICAgICAgdGhpcy5kb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqIEBwYXJhbSBwYWlyczEgYm9keUEgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqIEBwYXJhbSBwYWlyczIgYm9keUIgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nU3BoZXJlQnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHIgPSBCcm9hZHBoYXNlX2NvbGxpc2lvblBhaXJzX3I7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIHIpOwogICAgICBjb25zdCBib3VuZGluZ1JhZGl1c1N1bTIgPSAoYm9keUEuYm91bmRpbmdSYWRpdXMgKyBib2R5Qi5ib3VuZGluZ1JhZGl1cykgKiogMjsKICAgICAgY29uc3Qgbm9ybTIgPSByLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChub3JtMiA8IGJvdW5kaW5nUmFkaXVzU3VtMikgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIGJveGVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmIChib2R5QS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5QS51cGRhdGVBQUJCKCk7CiAgICAgIH0KCiAgICAgIGlmIChib2R5Qi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5Qi51cGRhdGVBQUJCKCk7CiAgICAgIH0gLy8gQ2hlY2sgQUFCQiAvIEFBQkIKCgogICAgICBpZiAoYm9keUEuYWFiYi5vdmVybGFwcyhib2R5Qi5hYWJiKSkgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBkdXBsaWNhdGUgcGFpcnMgZnJvbSB0aGUgcGFpciBhcnJheXMuCiAgICAgKi8KCgogICAgbWFrZVBhaXJzVW5pcXVlKHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHQgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wOwogICAgICBjb25zdCBwMSA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxOwogICAgICBjb25zdCBwMiA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyOwogICAgICBjb25zdCBOID0gcGFpcnMxLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBwMVtpXSA9IHBhaXJzMVtpXTsKICAgICAgICBwMltpXSA9IHBhaXJzMltpXTsKICAgICAgfQoKICAgICAgcGFpcnMxLmxlbmd0aCA9IDA7CiAgICAgIHBhaXJzMi5sZW5ndGggPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGlkMSA9IHAxW2ldLmlkOwogICAgICAgIGNvbnN0IGlkMiA9IHAyW2ldLmlkOwogICAgICAgIGNvbnN0IGtleSA9IGlkMSA8IGlkMiA/IGAke2lkMX0sJHtpZDJ9YCA6IGAke2lkMn0sJHtpZDF9YDsKICAgICAgICB0W2tleV0gPSBpOwogICAgICAgIHQua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0LmtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBrZXkgPSB0LmtleXMucG9wKCk7CiAgICAgICAgY29uc3QgcGFpckluZGV4ID0gdFtrZXldOwogICAgICAgIHBhaXJzMS5wdXNoKHAxW3BhaXJJbmRleF0pOwogICAgICAgIHBhaXJzMi5wdXNoKHAyW3BhaXJJbmRleF0pOwogICAgICAgIGRlbGV0ZSB0W2tleV07CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVG8gYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2Fzc2VzCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHt9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgb3ZlcmxhcC4KICAgICAqLwoKCiAgICBzdGF0aWMgYm91bmRpbmdTcGhlcmVDaGVjayhib2R5QSwgYm9keUIpIHsKICAgICAgY29uc3QgZGlzdCA9IG5ldyBWZWMzKCk7IC8vIGJzY19kaXN0OwoKICAgICAgYm9keUEucG9zaXRpb24udnN1Yihib2R5Qi5wb3NpdGlvbiwgZGlzdCk7CiAgICAgIGNvbnN0IHNhID0gYm9keUEuc2hhcGVzWzBdOwogICAgICBjb25zdCBzYiA9IGJvZHlCLnNoYXBlc1swXTsKICAgICAgcmV0dXJuIE1hdGgucG93KHNhLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2IuYm91bmRpbmdTcGhlcmVSYWRpdXMsIDIpID4gZGlzdC5sZW5ndGhTcXVhcmVkKCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIHRoZSBBQUJCLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGNvbnNvbGUud2FybignLmFhYmJRdWVyeSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBCcm9hZHBoYXNlIHN1YmNsYXNzLicpOwogICAgICByZXR1cm4gW107CiAgICB9CgogIH0gLy8gVGVtcCBvYmplY3RzCgogIGNvbnN0IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfciA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUXVhdGVybmlvbigpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfdGVtcCA9IHsKICAgIGtleXM6IFtdCiAgfTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMSA9IFtdOwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyID0gW107CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIE5haXZlIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb24sIHVzZWQgaW4gbGFjayBvZiBiZXR0ZXIgb25lcy4KICAgKgogICAqIFRoZSBuYWl2ZSBicm9hZHBoYXNlIGxvb2tzIGF0IGFsbCBwb3NzaWJsZSBwYWlycyB3aXRob3V0IHJlc3RyaWN0aW9uLCB0aGVyZWZvcmUgaXQgaGFzIGNvbXBsZXhpdHkgTl4yIF8od2hpY2ggaXMgYmFkKV8KICAgKi8KICBjbGFzcyBOYWl2ZUJyb2FkcGhhc2UgZXh0ZW5kcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgdGhlIGNvbGxpc2lvbiBwYWlycyBpbiB0aGUgcGh5c2ljcyB3b3JsZAogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwYWlyczEsIHBhaXJzMikgewogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IG4gPSBib2RpZXMubGVuZ3RoOwogICAgICBsZXQgYmk7CiAgICAgIGxldCBiajsgLy8gTmFpdmUgTl4yIGZ0dyEKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gaTsgaisrKSB7CiAgICAgICAgICBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGVzdChiaSwgYmosIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gYW4gQUFCQi4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGJvZGllcyBpbi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gd29ybGQuYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0gLy8gVWdseSBoYWNrIHVudGlsIEJvZHkgZ2V0cyBhYWJiCgoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgLyoqCiAgICogU3RvcmFnZSBmb3IgUmF5IGNhc3RpbmcgZGF0YQogICAqLwogIGNsYXNzIFJheWNhc3RSZXN1bHQgewogICAgLyoqCiAgICAgKiByYXlGcm9tV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogcmF5VG9Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoaXROb3JtYWxXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoaXRQb2ludFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhhc0hpdAogICAgICovCgogICAgLyoqCiAgICAgKiBzaGFwZQogICAgICovCgogICAgLyoqCiAgICAgKiBib2R5CiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleCBvZiB0aGUgaGl0IHRyaWFuZ2xlLCBpZiB0aGUgaGl0IHNoYXBlIHdhcyBhIHRyaW1lc2gKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzdGFuY2UgdG8gdGhlIGhpdC4gV2lsbCBiZSBzZXQgdG8gLTEgaWYgdGhlcmUgd2FzIG5vIGhpdAogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgcmF5IHNob3VsZCBzdG9wIHRyYXZlcnNpbmcgdGhlIGJvZGllcwogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJheVRvV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFJlc2V0IGFsbCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLnJheVRvV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIGFib3J0CiAgICAgKi8KCgogICAgYWJvcnQoKSB7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICBzZXQocmF5RnJvbVdvcmxkLCByYXlUb1dvcmxkLCBoaXROb3JtYWxXb3JsZCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkLmNvcHkocmF5RnJvbVdvcmxkKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkLmNvcHkocmF5VG9Xb3JsZCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuY29weShoaXROb3JtYWxXb3JsZCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZC5jb3B5KGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnNoYXBlID0gc2hhcGU7CiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgIH0KCiAgfQoKICBsZXQgX1NoYXBlJHR5cGVzJFNQSEVSRSwgX1NoYXBlJHR5cGVzJFBMQU5FLCBfU2hhcGUkdHlwZXMkQk9YLCBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIsIF9TaGFwZSR0eXBlcyRDT05WRVhQTywgX1NoYXBlJHR5cGVzJEhFSUdIVEZJLCBfU2hhcGUkdHlwZXMkVFJJTUVTSDsKCiAgLyoqCiAgICogUkFZX01PREVTCiAgICovCiAgY29uc3QgUkFZX01PREVTID0gewogICAgLyoqIENMT1NFU1QgKi8KICAgIENMT1NFU1Q6IDEsCgogICAgLyoqIEFOWSAqLwogICAgQU5ZOiAyLAoKICAgIC8qKiBBTEwgKi8KICAgIEFMTDogNAogIH07CiAgLyoqCiAgICogUmF5TW9kZQogICAqLwoKICBfU2hhcGUkdHlwZXMkU1BIRVJFID0gU2hhcGUudHlwZXMuU1BIRVJFOwogIF9TaGFwZSR0eXBlcyRQTEFORSA9IFNoYXBlLnR5cGVzLlBMQU5FOwogIF9TaGFwZSR0eXBlcyRCT1ggPSBTaGFwZS50eXBlcy5CT1g7CiAgX1NoYXBlJHR5cGVzJENZTElOREVSID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgX1NoYXBlJHR5cGVzJENPTlZFWFBPID0gU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTjsKICBfU2hhcGUkdHlwZXMkSEVJR0hURkkgPSBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRDsKICBfU2hhcGUkdHlwZXMkVFJJTUVTSCA9IFNoYXBlLnR5cGVzLlRSSU1FU0g7CgogIC8qKgogICAqIEEgbGluZSBpbiAzRCBzcGFjZSB0aGF0IGludGVyc2VjdHMgYm9kaWVzIGFuZCByZXR1cm4gcG9pbnRzLgogICAqLwogIGNsYXNzIFJheSB7CiAgICAvKioKICAgICAqIGZyb20KICAgICAqLwoKICAgIC8qKgogICAgICogdG8KICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBwcmVjaXNpb24gb2YgdGhlIHJheS4gVXNlZCB3aGVuIGNoZWNraW5nIHBhcmFsbGVsaXR5IGV0Yy4KICAgICAqIEBkZWZhdWx0IDAuMDAwMQogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gYGZhbHNlYCBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgUmF5IHRvIHRha2UgYGNvbGxpc2lvblJlc3BvbnNlYCBmbGFncyBpbnRvIGFjY291bnQgb24gYm9kaWVzIGFuZCBzaGFwZXMuCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSByYXkgc2tpcHMgYW55IGhpdHMgd2l0aCBub3JtYWwuZG90KHJheURpcmVjdGlvbikgPCAwLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uRmlsdGVyTWFzawogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uRmlsdGVyR3JvdXAKICAgICAqIEBkZWZhdWx0IC0xCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbnRlcnNlY3Rpb24gbW9kZS4gU2hvdWxkIGJlIFJheS5BTlksIFJheS5BTEwgb3IgUmF5LkNMT1NFU1QuCiAgICAgKiBAZGVmYXVsdCBSQVkuQU5ZCiAgICAgKi8KCiAgICAvKioKICAgICAqIEN1cnJlbnQgcmVzdWx0IG9iamVjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogV2lsbCBiZSBzZXQgdG8gYHRydWVgIGR1cmluZyBpbnRlcnNlY3RXb3JsZCgpIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VyLXByb3ZpZGVkIHJlc3VsdCBjYWxsYmFjay4gV2lsbCBiZSB1c2VkIGlmIG1vZGUgaXMgUmF5LkFMTC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ0xPU0VTVAogICAgICovCgogICAgLyoqCiAgICAgKiBBTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQUxMCiAgICAgKi8KICAgIGdldCBbX1NoYXBlJHR5cGVzJFNQSEVSRV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkUExBTkVdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0UGxhbmU7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQk9YXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdEJveDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDWUxJTkRFUl0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQ09OVkVYUE9dKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Q29udmV4OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJEhFSUdIVEZJXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJFRSSU1FU0hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0VHJpbWVzaDsKICAgIH0KCiAgICBjb25zdHJ1Y3Rvcihmcm9tLCB0bykgewogICAgICBpZiAoZnJvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgZnJvbSA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0byA9PT0gdm9pZCAwKSB7CiAgICAgICAgdG8gPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLmZyb20gPSBmcm9tLmNsb25lKCk7CiAgICAgIHRoaXMudG8gPSB0by5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJlY2lzaW9uID0gMC4wMDAxOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0cnVlOwogICAgICB0aGlzLnNraXBCYWNrZmFjZXMgPSBmYWxzZTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSAtMTsKICAgICAgdGhpcy5tb2RlID0gUmF5LkFOWTsKICAgICAgdGhpcy5yZXN1bHQgPSBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwoKICAgICAgdGhpcy5jYWxsYmFjayA9IHJlc3VsdCA9PiB7fTsKICAgIH0KICAgIC8qKgogICAgICogRG8gaXRlcnNlY3Rpb24gYWdhaW5zdCBhbGwgYm9kaWVzIGluIHRoZSBnaXZlbiBXb3JsZC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgcmF5IGhpdCBhbnl0aGluZywgb3RoZXJ3aXNlIGZhbHNlLgogICAgICovCgoKICAgIGludGVyc2VjdFdvcmxkKHdvcmxkLCBvcHRpb25zKSB7CiAgICAgIHRoaXMubW9kZSA9IG9wdGlvbnMubW9kZSB8fCBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG9wdGlvbnMucmVzdWx0IHx8IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9ICEhb3B0aW9ucy5za2lwQmFja2ZhY2VzOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA6IC0xOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA6IC0xOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0eXBlb2Ygb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CgogICAgICBpZiAob3B0aW9ucy5mcm9tKSB7CiAgICAgICAgdGhpcy5mcm9tLmNvcHkob3B0aW9ucy5mcm9tKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudG8pIHsKICAgICAgICB0aGlzLnRvLmNvcHkob3B0aW9ucy50byk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIHx8ICgoKSA9PiB7fSk7CgogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnJlc3VsdC5yZXNldCgpOwogICAgICB0aGlzLnVwZGF0ZURpcmVjdGlvbigpOwogICAgICB0aGlzLmdldEFBQkIodG1wQUFCQiQxKTsKICAgICAgdG1wQXJyYXkubGVuZ3RoID0gMDsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5hYWJiUXVlcnkod29ybGQsIHRtcEFBQkIkMSwgdG1wQXJyYXkpOwogICAgICB0aGlzLmludGVyc2VjdEJvZGllcyh0bXBBcnJheSk7CiAgICAgIHJldHVybiB0aGlzLmhhc0hpdDsKICAgIH0KICAgIC8qKgogICAgICogU2hvb3QgYSByYXkgYXQgYSBib2R5LCBnZXQgYmFjayBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGl0LgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0Qm9keShib2R5LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2U7CgogICAgICBpZiAoY2hlY2tDb2xsaXNpb25SZXNwb25zZSAmJiAhYm9keS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCh0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCB8fCAoYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHhpID0gaW50ZXJzZWN0Qm9keV94aTsKICAgICAgY29uc3QgcWkgPSBpbnRlcnNlY3RCb2R5X3FpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSBib2R5LnNoYXBlcy5sZW5ndGg7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IGJvZHkuc2hhcGVzW2ldOwoKICAgICAgICBpZiAoY2hlY2tDb2xsaXNpb25SZXNwb25zZSAmJiAhc2hhcGUuY29sbGlzaW9uUmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnRpbnVlOyAvLyBTa2lwCiAgICAgICAgfQoKICAgICAgICBib2R5LnF1YXRlcm5pb24ubXVsdChib2R5LnNoYXBlT3JpZW50YXRpb25zW2ldLCBxaSk7CiAgICAgICAgYm9keS5xdWF0ZXJuaW9uLnZtdWx0KGJvZHkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgeGkudmFkZChib2R5LnBvc2l0aW9uLCB4aSk7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RTaGFwZShzaGFwZSwgcWksIHhpLCBib2R5KTsKCiAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhbiBhcnJheSBib2RpZXMsIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAcGFyYW0gYm9kaWVzIEFuIGFycmF5IG9mIEJvZHkgb2JqZWN0cy4KICAgICAqIEBkZXByZWNhdGVkIEBwYXJhbSByZXN1bHQgc2V0IHRoZSByZXN1bHQgcHJvcGVydHkgb2YgdGhlIFJheSBpbnN0ZWFkLgogICAgICoKICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2RpZXMoYm9kaWVzLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYm9kaWVzLmxlbmd0aDsgIXRoaXMucmVzdWx0LnNob3VsZFN0b3AgJiYgaSA8IGw7IGkrKykgewogICAgICAgIHRoaXMuaW50ZXJzZWN0Qm9keShib2RpZXNbaV0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIGRpcmVjdGlvbiB2ZWN0b3IuCiAgICAgKi8KCgogICAgdXBkYXRlRGlyZWN0aW9uKCkgewogICAgICB0aGlzLnRvLnZzdWIodGhpcy5mcm9tLCB0aGlzLmRpcmVjdGlvbik7CiAgICAgIHRoaXMuZGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgfQoKICAgIGludGVyc2VjdFNoYXBlKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOyAvLyBDaGVja2luZyBib3VuZGluZ1NwaGVyZQoKICAgICAgY29uc3QgZGlzdGFuY2UgPSBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgdGhpcy5kaXJlY3Rpb24sIHBvc2l0aW9uKTsKCiAgICAgIGlmIChkaXN0YW5jZSA+IHNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBpbnRlcnNlY3RNZXRob2QgPSB0aGlzW3NoYXBlLnR5cGVdOwoKICAgICAgaWYgKGludGVyc2VjdE1ldGhvZCkgewogICAgICAgIGludGVyc2VjdE1ldGhvZC5jYWxsKHRoaXMsIHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgc2hhcGUpOwogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdEJveChib3gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXgoYm94LmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpOwogICAgfQoKICAgIF9pbnRlcnNlY3RQbGFuZShzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsgLy8gR2V0IHBsYW5lIG5vcm1hbAoKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBuZXcgVmVjMygwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOwogICAgICBjb25zdCBsZW4gPSBuZXcgVmVjMygpOwogICAgICBmcm9tLnZzdWIocG9zaXRpb24sIGxlbik7CiAgICAgIGNvbnN0IHBsYW5lVG9Gcm9tID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgIHRvLnZzdWIocG9zaXRpb24sIGxlbik7CiAgICAgIGNvbnN0IHBsYW5lVG9UbyA9IGxlbi5kb3Qod29ybGROb3JtYWwpOwoKICAgICAgaWYgKHBsYW5lVG9Gcm9tICogcGxhbmVUb1RvID4gMCkgewogICAgICAgIC8vICJmcm9tIiBhbmQgInRvIiBhcmUgb24gdGhlIHNhbWUgc2lkZSBvZiB0aGUgcGxhbmUuLi4gYmFpbCBvdXQKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChmcm9tLmRpc3RhbmNlVG8odG8pIDwgcGxhbmVUb0Zyb20pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IG5fZG90X2RpciA9IHdvcmxkTm9ybWFsLmRvdChkaXJlY3Rpb24pOwoKICAgICAgaWYgKE1hdGguYWJzKG5fZG90X2RpcikgPCB0aGlzLnByZWNpc2lvbikgewogICAgICAgIC8vIE5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcGxhbmVQb2ludFRvRnJvbSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGRpcl9zY2FsZWRfd2l0aF90ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGl0UG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgcGxhbmVQb2ludFRvRnJvbSk7CiAgICAgIGNvbnN0IHQgPSAtd29ybGROb3JtYWwuZG90KHBsYW5lUG9pbnRUb0Zyb20pIC8gbl9kb3RfZGlyOwogICAgICBkaXJlY3Rpb24uc2NhbGUodCwgZGlyX3NjYWxlZF93aXRoX3QpOwogICAgICBmcm9tLnZhZGQoZGlyX3NjYWxlZF93aXRoX3QsIGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHdvcmxkIEFBQkIgb2YgdGhlIHJheS4KICAgICAqLwoKCiAgICBnZXRBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgewogICAgICAgIGxvd2VyQm91bmQsCiAgICAgICAgdXBwZXJCb3VuZAogICAgICB9ID0gYWFiYjsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBsb3dlckJvdW5kLnggPSBNYXRoLm1pbih0by54LCBmcm9tLngpOwogICAgICBsb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0by55LCBmcm9tLnkpOwogICAgICBsb3dlckJvdW5kLnogPSBNYXRoLm1pbih0by56LCBmcm9tLnopOwogICAgICB1cHBlckJvdW5kLnggPSBNYXRoLm1heCh0by54LCBmcm9tLngpOwogICAgICB1cHBlckJvdW5kLnkgPSBNYXRoLm1heCh0by55LCBmcm9tLnkpOwogICAgICB1cHBlckJvdW5kLnogPSBNYXRoLm1heCh0by56LCBmcm9tLnopOwogICAgfQoKICAgIF9pbnRlcnNlY3RIZWlnaHRmaWVsZChzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgc2hhcGUuZGF0YTsKICAgICAgc2hhcGUuZWxlbWVudFNpemU7IC8vIENvbnZlcnQgdGhlIHJheSB0byBsb2NhbCBoZWlnaHRmaWVsZCBjb29yZGluYXRlcwoKICAgICAgY29uc3QgbG9jYWxSYXkgPSBpbnRlcnNlY3RIZWlnaHRmaWVsZF9sb2NhbFJheTsgLy9uZXcgUmF5KHRoaXMuZnJvbSwgdGhpcy50byk7CgogICAgICBsb2NhbFJheS5mcm9tLmNvcHkodGhpcy5mcm9tKTsKICAgICAgbG9jYWxSYXkudG8uY29weSh0aGlzLnRvKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBsb2NhbFJheS5mcm9tLCBsb2NhbFJheS5mcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBsb2NhbFJheS50bywgbG9jYWxSYXkudG8pOwogICAgICBsb2NhbFJheS51cGRhdGVEaXJlY3Rpb24oKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBjb25zdCBpbmRleCA9IGludGVyc2VjdEhlaWdodGZpZWxkX2luZGV4OwogICAgICBsZXQgaU1pblg7CiAgICAgIGxldCBpTWluWTsKICAgICAgbGV0IGlNYXhYOwogICAgICBsZXQgaU1heFk7IC8vIFNldCB0byBtYXgKCiAgICAgIGlNaW5YID0gaU1pblkgPSAwOwogICAgICBpTWF4WCA9IGlNYXhZID0gc2hhcGUuZGF0YS5sZW5ndGggLSAxOwogICAgICBjb25zdCBhYWJiID0gbmV3IEFBQkIoKTsKICAgICAgbG9jYWxSYXkuZ2V0QUFCQihhYWJiKTsKICAgICAgc2hhcGUuZ2V0SW5kZXhPZlBvc2l0aW9uKGFhYmIubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueSwgaW5kZXgsIHRydWUpOwogICAgICBpTWluWCA9IE1hdGgubWF4KGlNaW5YLCBpbmRleFswXSk7CiAgICAgIGlNaW5ZID0gTWF0aC5tYXgoaU1pblksIGluZGV4WzFdKTsKICAgICAgc2hhcGUuZ2V0SW5kZXhPZlBvc2l0aW9uKGFhYmIudXBwZXJCb3VuZC54LCBhYWJiLnVwcGVyQm91bmQueSwgaW5kZXgsIHRydWUpOwogICAgICBpTWF4WCA9IE1hdGgubWluKGlNYXhYLCBpbmRleFswXSArIDEpOwogICAgICBpTWF4WSA9IE1hdGgubWluKGlNYXhZLCBpbmRleFsxXSArIDEpOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBzaGFwZS5nZXRBYWJiQXRJbmRleChpLCBqLCBhYWJiKTsKCiAgICAgICAgICBpZiAoIWFhYmIub3ZlcmxhcHNSYXkobG9jYWxSYXkpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSAvLyBMb3dlciB0cmlhbmdsZQoKCiAgICAgICAgICBzaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKCiAgICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBzaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICB0aGlzLl9pbnRlcnNlY3RDb252ZXgoc2hhcGUucGlsbGFyQ29udmV4LCBxdWF0LCB3b3JsZFBpbGxhck9mZnNldCwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgaW50ZXJzZWN0Q29udmV4T3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdFNwaGVyZShzcGhlcmUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgciA9IHNwaGVyZS5yYWRpdXM7CiAgICAgIGNvbnN0IGEgPSAodG8ueCAtIGZyb20ueCkgKiogMiArICh0by55IC0gZnJvbS55KSAqKiAyICsgKHRvLnogLSBmcm9tLnopICoqIDI7CiAgICAgIGNvbnN0IGIgPSAyICogKCh0by54IC0gZnJvbS54KSAqIChmcm9tLnggLSBwb3NpdGlvbi54KSArICh0by55IC0gZnJvbS55KSAqIChmcm9tLnkgLSBwb3NpdGlvbi55KSArICh0by56IC0gZnJvbS56KSAqIChmcm9tLnogLSBwb3NpdGlvbi56KSk7CiAgICAgIGNvbnN0IGMgPSAoZnJvbS54IC0gcG9zaXRpb24ueCkgKiogMiArIChmcm9tLnkgLSBwb3NpdGlvbi55KSAqKiAyICsgKGZyb20ueiAtIHBvc2l0aW9uLnopICoqIDIgLSByICoqIDI7CiAgICAgIGNvbnN0IGRlbHRhID0gYiAqKiAyIC0gNCAqIGEgKiBjOwogICAgICBjb25zdCBpbnRlcnNlY3Rpb25Qb2ludCA9IFJheV9pbnRlcnNlY3RTcGhlcmVfaW50ZXJzZWN0aW9uUG9pbnQ7CiAgICAgIGNvbnN0IG5vcm1hbCA9IFJheV9pbnRlcnNlY3RTcGhlcmVfbm9ybWFsOwoKICAgICAgaWYgKGRlbHRhIDwgMCkgewogICAgICAgIC8vIE5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmIChkZWx0YSA9PT0gMCkgewogICAgICAgIC8vIHNpbmdsZSBpbnRlcnNlY3Rpb24gcG9pbnQKICAgICAgICBmcm9tLmxlcnAodG8sIGRlbHRhLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGQxID0gKC1iIC0gTWF0aC5zcXJ0KGRlbHRhKSkgLyAoMiAqIGEpOwogICAgICAgIGNvbnN0IGQyID0gKC1iICsgTWF0aC5zcXJ0KGRlbHRhKSkgLyAoMiAqIGEpOwoKICAgICAgICBpZiAoZDEgPj0gMCAmJiBkMSA8PSAxKSB7CiAgICAgICAgICBmcm9tLmxlcnAodG8sIGQxLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChkMiA+PSAwICYmIGQyIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDIsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdENvbnZleChzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUsIG9wdGlvbnMpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gaW50ZXJzZWN0Q29udmV4X25vcm1hbDsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBvcHRpb25zICYmIG9wdGlvbnMuZmFjZUxpc3QgfHwgbnVsbDsgLy8gQ2hlY2tpbmcgZmFjZXMKCiAgICAgIGNvbnN0IGZhY2VzID0gc2hhcGUuZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBzaGFwZS5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZnJvbVRvRGlzdGFuY2UgPSBmcm9tLmRpc3RhbmNlVG8odG8pOwogICAgICBjb25zdCBOZmFjZXMgPSBmYWNlTGlzdCA/IGZhY2VMaXN0Lmxlbmd0aCA6IGZhY2VzLmxlbmd0aDsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7CgogICAgICBmb3IgKGxldCBqID0gMDsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGogPCBOZmFjZXM7IGorKykgewogICAgICAgIGNvbnN0IGZpID0gZmFjZUxpc3QgPyBmYWNlTGlzdFtqXSA6IGo7CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ZpXTsKICAgICAgICBjb25zdCBmYWNlTm9ybWFsID0gbm9ybWFsc1tmaV07CiAgICAgICAgY29uc3QgcSA9IHF1YXQ7CiAgICAgICAgY29uc3QgeCA9IHBvc2l0aW9uOyAvLyBkZXRlcm1pbmUgaWYgcmF5IGludGVyc2VjdHMgdGhlIHBsYW5lIG9mIHRoZSBmYWNlCiAgICAgICAgLy8gbm90ZTogdGhpcyB3b3JrcyByZWdhcmRsZXNzIG9mIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGZhY2Ugbm9ybWFsCiAgICAgICAgLy8gR2V0IHBsYW5lIHBvaW50IGluIHdvcmxkIGNvb3JkaW5hdGVzLi4uCgogICAgICAgIHZlY3Rvci5jb3B5KHZlcnRpY2VzW2ZhY2VbMF1dKTsKICAgICAgICBxLnZtdWx0KHZlY3RvciwgdmVjdG9yKTsKICAgICAgICB2ZWN0b3IudmFkZCh4LCB2ZWN0b3IpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICB2ZWN0b3IudnN1Yihmcm9tLCB2ZWN0b3IpOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICAgIHEudm11bHQoZmFjZU5vcm1hbCwgbm9ybWFsKTsgLy8gSWYgdGhpcyBkb3QgcHJvZHVjdCBpcyBuZWdhdGl2ZSwgd2UgaGF2ZSBzb21ldGhpbmcgaW50ZXJlc3RpbmcKCiAgICAgICAgY29uc3QgZG90ID0gZGlyZWN0aW9uLmRvdChub3JtYWwpOyAvLyBCYWlsIG91dCBpZiByYXkgYW5kIHBsYW5lIGFyZSBwYXJhbGxlbAoKICAgICAgICBpZiAoTWF0aC5hYnMoZG90KSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGNhbGMgZGlzdGFuY2UgdG8gcGxhbmUKCgogICAgICAgIGNvbnN0IHNjYWxhciA9IG5vcm1hbC5kb3QodmVjdG9yKSAvIGRvdDsgLy8gaWYgbmVnYXRpdmUgZGlzdGFuY2UsIHRoZW4gcGxhbmUgaXMgYmVoaW5kIHJheQoKICAgICAgICBpZiAoc2NhbGFyIDwgMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyBpZiAoZG90IDwgMCkgewogICAgICAgIC8vIEludGVyc2VjdGlvbiBwb2ludCBpcyBmcm9tICsgZGlyZWN0aW9uICogc2NhbGFyCgoKICAgICAgICBkaXJlY3Rpb24uc2NhbGUoc2NhbGFyLCBpbnRlcnNlY3RQb2ludCk7CiAgICAgICAgaW50ZXJzZWN0UG9pbnQudmFkZChmcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIGEgaXMgdGhlIHBvaW50IHdlIGNvbXBhcmUgcG9pbnRzIGIgYW5kIGMgd2l0aC4KCiAgICAgICAgYS5jb3B5KHZlcnRpY2VzW2ZhY2VbMF1dKTsKICAgICAgICBxLnZtdWx0KGEsIGEpOwogICAgICAgIHgudmFkZChhLCBhKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDE7ICFyZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgZmFjZS5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgIC8vIFRyYW5zZm9ybSAzIHZlcnRpY2VzIHRvIHdvcmxkIGNvb3JkcwogICAgICAgICAgYi5jb3B5KHZlcnRpY2VzW2ZhY2VbaV1dKTsKICAgICAgICAgIGMuY29weSh2ZXJ0aWNlc1tmYWNlW2kgKyAxXV0pOwogICAgICAgICAgcS52bXVsdChiLCBiKTsKICAgICAgICAgIHEudm11bHQoYywgYyk7CiAgICAgICAgICB4LnZhZGQoYiwgYik7CiAgICAgICAgICB4LnZhZGQoYywgYyk7CiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGludGVyc2VjdFBvaW50LmRpc3RhbmNlVG8oZnJvbSk7CgogICAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykpIHx8IGRpc3RhbmNlID4gZnJvbVRvRGlzdGFuY2UpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgZmkpOwogICAgICAgIH0gLy8gfQoKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBPcHRpbWl6ZSBieSB0cmFuc2Zvcm1pbmcgdGhlIHdvcmxkIHRvIGxvY2FsIHNwYWNlIGZpcnN0LgogICAgICogQHRvZG8gVXNlIE9jdHJlZSBsb29rdXAKICAgICAqLwoKCiAgICBfaW50ZXJzZWN0VHJpbWVzaChtZXNoLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX25vcm1hbDsKICAgICAgY29uc3QgdHJpYW5nbGVzID0gaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXM7CiAgICAgIGNvbnN0IHRyZWVUcmFuc2Zvcm0gPSBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm07CiAgICAgIGNvbnN0IHZlY3RvciA9IGludGVyc2VjdENvbnZleF92ZWN0b3I7CiAgICAgIGNvbnN0IGxvY2FsRGlyZWN0aW9uID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbjsKICAgICAgY29uc3QgbG9jYWxGcm9tID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb207CiAgICAgIGNvbnN0IGxvY2FsVG8gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsVG87CiAgICAgIGNvbnN0IHdvcmxkSW50ZXJzZWN0UG9pbnQgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQ7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbDsgLy8gQ2hlY2tpbmcgZmFjZXMKCiAgICAgIGNvbnN0IGluZGljZXMgPSBtZXNoLmluZGljZXM7CiAgICAgIG1lc2gudmVydGljZXM7IC8vIGNvbnN0IG5vcm1hbHMgPSBtZXNoLmZhY2VOb3JtYWxzCgogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOwogICAgICB0cmVlVHJhbnNmb3JtLnBvc2l0aW9uLmNvcHkocG9zaXRpb24pOwogICAgICB0cmVlVHJhbnNmb3JtLnF1YXRlcm5pb24uY29weShxdWF0KTsgLy8gVHJhbnNmb3JtIHJheSB0byBsb2NhbCBzcGFjZSEKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGRpcmVjdGlvbiwgbG9jYWxEaXJlY3Rpb24pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGZyb20sIGxvY2FsRnJvbSk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgdG8sIGxvY2FsVG8pOwogICAgICBsb2NhbFRvLnggKj0gbWVzaC5zY2FsZS54OwogICAgICBsb2NhbFRvLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbFRvLnogKj0gbWVzaC5zY2FsZS56OwogICAgICBsb2NhbEZyb20ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsRnJvbS55ICo9IG1lc2guc2NhbGUueTsKICAgICAgbG9jYWxGcm9tLnogKj0gbWVzaC5zY2FsZS56OwogICAgICBsb2NhbFRvLnZzdWIobG9jYWxGcm9tLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIGxvY2FsRGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZVNxdWFyZWQgPSBsb2NhbEZyb20uZGlzdGFuY2VTcXVhcmVkKGxvY2FsVG8pOwogICAgICBtZXNoLnRyZWUucmF5UXVlcnkodGhpcywgdHJlZVRyYW5zZm9ybSwgdHJpYW5nbGVzKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdHJpYW5nbGVzLmxlbmd0aDsgIXRoaXMucmVzdWx0LnNob3VsZFN0b3AgJiYgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgdHJpYW5nbGVzSW5kZXggPSB0cmlhbmdsZXNbaV07CiAgICAgICAgbWVzaC5nZXROb3JtYWwodHJpYW5nbGVzSW5kZXgsIG5vcm1hbCk7IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDNdLCBhKTsgLy8gLi4uYnV0IG1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIHJheSBmcm9tLiBXZSdsbCBmaXggdGhpcyBsYXRlci4KCiAgICAgICAgYS52c3ViKGxvY2FsRnJvbSwgdmVjdG9yKTsgLy8gSWYgdGhpcyBkb3QgcHJvZHVjdCBpcyBuZWdhdGl2ZSwgd2UgaGF2ZSBzb21ldGhpbmcgaW50ZXJlc3RpbmcKCiAgICAgICAgY29uc3QgZG90ID0gbG9jYWxEaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCiAgICAgICAgLy8gaWYgKE1hdGguYWJzKCBkb3QgKSA8IHRoaXMucHJlY2lzaW9uKXsKICAgICAgICAvLyAgICAgY29udGludWU7CiAgICAgICAgLy8gfQogICAgICAgIC8vIGNhbGMgZGlzdGFuY2UgdG8gcGxhbmUKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIEludGVyc2VjdGlvbiBwb2ludCBpcyBmcm9tICsgZGlyZWN0aW9uICogc2NhbGFyCgoKICAgICAgICBsb2NhbERpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGxvY2FsRnJvbSwgaW50ZXJzZWN0UG9pbnQpOyAvLyBHZXQgdHJpYW5nbGUgdmVydGljZXMKCiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDMgKyAxXSwgYik7CiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDMgKyAyXSwgYyk7CiAgICAgICAgY29uc3Qgc3F1YXJlZERpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VTcXVhcmVkKGxvY2FsRnJvbSk7CgogICAgICAgIGlmICghKFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGIsIGEsIGMpIHx8IFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGEsIGIsIGMpKSB8fCBzcXVhcmVkRGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZVNxdWFyZWQpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gdHJhbnNmb3JtIGludGVyc2VjdHBvaW50IGFuZCBub3JtYWwgdG8gd29ybGQKCgogICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUocXVhdCwgbm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBpbnRlcnNlY3RQb2ludCwgd29ybGRJbnRlcnNlY3RQb2ludCk7CiAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24od29ybGROb3JtYWwsIHdvcmxkSW50ZXJzZWN0UG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIHRyaWFuZ2xlc0luZGV4KTsKICAgICAgfQoKICAgICAgdHJpYW5nbGVzLmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgaW50ZXJzZWN0aW9ucyBzaG91bGQgY29udGludWUKICAgICAqLwoKCiAgICByZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgaGl0RmFjZUluZGV4KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlzdGFuY2UgPSBmcm9tLmRpc3RhbmNlVG8oaGl0UG9pbnRXb3JsZCk7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OyAvLyBTa2lwIGJhY2sgZmFjZXM/CgogICAgICBpZiAodGhpcy5za2lwQmFja2ZhY2VzICYmIG5vcm1hbC5kb3QodGhpcy5kaXJlY3Rpb24pID4gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmVzdWx0LmhpdEZhY2VJbmRleCA9IHR5cGVvZiBoaXRGYWNlSW5kZXggIT09ICd1bmRlZmluZWQnID8gaGl0RmFjZUluZGV4IDogLTE7CgogICAgICBzd2l0Y2ggKHRoaXMubW9kZSkgewogICAgICAgIGNhc2UgUmF5LkFMTDoKICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgdGhpcy5jYWxsYmFjayhyZXN1bHQpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgUmF5LkNMT1NFU1Q6CiAgICAgICAgICAvLyBTdG9yZSBpZiBjbG9zZXIgdGhhbiBjdXJyZW50IGNsb3Nlc3QKICAgICAgICAgIGlmIChkaXN0YW5jZSA8IHJlc3VsdC5kaXN0YW5jZSB8fCAhcmVzdWx0Lmhhc0hpdCkgewogICAgICAgICAgICB0aGlzLmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgUmF5LkFOWToKICAgICAgICAgIC8vIFJlcG9ydCBhbmQgc3RvcC4KICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0LnNob3VsZFN0b3AgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXMgcGVyICJCYXJ5Y2VudHJpYyBUZWNobmlxdWUiIGFzIG5hbWVkCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly93d3cuYmxhY2twYXduLmNvbS90ZXh0cy9wb2ludGlucG9seS9kZWZhdWx0Lmh0bWwgaGVyZX0gYnV0IHdpdGhvdXQgdGhlIGRpdmlzaW9uCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50SW5UcmlhbmdsZShwLCBhLCBiLCBjKSB7CiAgICAgIGMudnN1YihhLCB2MCk7CiAgICAgIGIudnN1YihhLCB2MSk7CiAgICAgIHAudnN1YihhLCB2Mik7CiAgICAgIGNvbnN0IGRvdDAwID0gdjAuZG90KHYwKTsKICAgICAgY29uc3QgZG90MDEgPSB2MC5kb3QodjEpOwogICAgICBjb25zdCBkb3QwMiA9IHYwLmRvdCh2Mik7CiAgICAgIGNvbnN0IGRvdDExID0gdjEuZG90KHYxKTsKICAgICAgY29uc3QgZG90MTIgPSB2MS5kb3QodjIpOwogICAgICBsZXQgdTsKICAgICAgbGV0IHY7CiAgICAgIHJldHVybiAodSA9IGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyKSA+PSAwICYmICh2ID0gZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIpID49IDAgJiYgdSArIHYgPCBkb3QwMCAqIGRvdDExIC0gZG90MDEgKiBkb3QwMTsKICAgIH0KCiAgfQogIFJheS5DTE9TRVNUID0gUkFZX01PREVTLkNMT1NFU1Q7CiAgUmF5LkFOWSA9IFJBWV9NT0RFUy5BTlk7CiAgUmF5LkFMTCA9IFJBWV9NT0RFUy5BTEw7CiAgY29uc3QgdG1wQUFCQiQxID0gbmV3IEFBQkIoKTsKICBjb25zdCB0bXBBcnJheSA9IFtdOwogIGNvbnN0IHYxID0gbmV3IFZlYzMoKTsKICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV9xaSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgaW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGMgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFJheWNhc3RSZXN1bHQoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhPcHRpb25zID0gewogICAgZmFjZUxpc3Q6IFswXQogIH07CiAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5ID0gbmV3IFJheSgpOwogIGNvbnN0IGludGVyc2VjdEhlaWdodGZpZWxkX2luZGV4ID0gW107CiAgY29uc3QgUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhfdmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb20gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZEludGVyc2VjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBuZXcgQUFCQigpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmVlVHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpOwogIGNvbnN0IHYwID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3QgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgZGlyZWN0aW9uLCBwb3NpdGlvbikgewogICAgLy8gdjAgaXMgdmVjdG9yIGZyb20gZnJvbSB0byBwb3NpdGlvbgogICAgcG9zaXRpb24udnN1Yihmcm9tLCB2MCk7CiAgICBjb25zdCBkb3QgPSB2MC5kb3QoZGlyZWN0aW9uKTsgLy8gaW50ZXJzZWN0ID0gZGlyZWN0aW9uKmRvdCArIGZyb20KCiAgICBkaXJlY3Rpb24uc2NhbGUoZG90LCBpbnRlcnNlY3QpOwogICAgaW50ZXJzZWN0LnZhZGQoZnJvbSwgaW50ZXJzZWN0KTsKICAgIGNvbnN0IGRpc3RhbmNlID0gcG9zaXRpb24uZGlzdGFuY2VUbyhpbnRlcnNlY3QpOwogICAgcmV0dXJuIGRpc3RhbmNlOwogIH0KCiAgLyoqCiAgICogU3dlZXAgYW5kIHBydW5lIGJyb2FkcGhhc2UgYWxvbmcgb25lIGF4aXMuCiAgICovCiAgY2xhc3MgU0FQQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBMaXN0IG9mIGJvZGllcyBjdXJyZW50bHkgaW4gdGhlIGJyb2FkcGhhc2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3b3JsZCB0byBzZWFyY2ggaW4uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEF4aXMgdG8gc29ydCB0aGUgYm9kaWVzIGFsb25nLgogICAgICogU2V0IHRvIDAgZm9yIHggYXhpcywgYW5kIDEgZm9yIHkgYXhpcy4KICAgICAqIEZvciBiZXN0IHBlcmZvcm1hbmNlLCBwaWNrIHRoZSBheGlzIHdoZXJlIGJvZGllcyBhcmUgbW9zdCBkaXN0cmlidXRlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kcyBvZiB0d28gYm9kaWVzIG92ZXJsYXAsIGFsb25nIHRoZSBnaXZlbiBTQVAgYXhpcy4KICAgICAqLwogICAgc3RhdGljIGNoZWNrQm91bmRzKGJpLCBiaiwgYXhpc0luZGV4KSB7CiAgICAgIGxldCBiaVBvczsKICAgICAgbGV0IGJqUG9zOwoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24ueDsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLng7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi55OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLno7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi56OwogICAgICB9CgogICAgICBjb25zdCByaSA9IGJpLmJvdW5kaW5nUmFkaXVzLAogICAgICAgICAgICByaiA9IGJqLmJvdW5kaW5nUmFkaXVzLAogICAgICAgICAgICBib3VuZEEyID0gYmlQb3MgKyByaSwKICAgICAgICAgICAgYm91bmRCMSA9IGJqUG9zIC0gcmo7CiAgICAgIHJldHVybiBib3VuZEIxIDwgYm91bmRBMjsKICAgIH0gLy8gTm90ZTogdGhlc2UgYXJlIGlkZW50aWNhbCwgc2F2ZSBmb3IgeC95L3ogbG93ZXJib3VuZAoKICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFgKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFgoYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnggPD0gdi5hYWJiLmxvd2VyQm91bmQueCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WQogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WShhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueSA8PSB2LmFhYmIubG93ZXJCb3VuZC55KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRaCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRaKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC56IDw9IHYuYWFiYi5sb3dlckJvdW5kLnopIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KCiAgICBjb25zdHJ1Y3Rvcih3b3JsZCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLmF4aXNMaXN0ID0gW107CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKCiAgICAgIHRoaXMuX2FkZEJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGF4aXNMaXN0LnB1c2goZXZlbnQuYm9keSk7CiAgICAgIH07CgogICAgICB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlciA9IGV2ZW50ID0+IHsKICAgICAgICBjb25zdCBpZHggPSBheGlzTGlzdC5pbmRleE9mKGV2ZW50LmJvZHkpOwoKICAgICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgICAgYXhpc0xpc3Quc3BsaWNlKGlkeCwgMSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgaWYgKHdvcmxkKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZCh3b3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hhbmdlIHRoZSB3b3JsZAogICAgICovCgoKICAgIHNldFdvcmxkKHdvcmxkKSB7CiAgICAgIC8vIENsZWFyIHRoZSBvbGQgYXhpcyBhcnJheQogICAgICB0aGlzLmF4aXNMaXN0Lmxlbmd0aCA9IDA7IC8vIEFkZCBhbGwgYm9kaWVzIGZyb20gdGhlIG5ldyB3b3JsZAoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLmF4aXNMaXN0LnB1c2god29ybGQuYm9kaWVzW2ldKTsKICAgICAgfSAvLyBSZW1vdmUgb2xkIGhhbmRsZXJzLCBpZiBhbnkKCgogICAgICB3b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdhZGRCb2R5JywgdGhpcy5fYWRkQm9keUhhbmRsZXIpOwogICAgICB3b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZW1vdmVCb2R5JywgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIpOyAvLyBBZGQgaGFuZGxlcnMgdG8gdXBkYXRlIHRoZSBsaXN0IG9mIGJvZGllcy4KCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENvbGxlY3QgYWxsIGNvbGxpc2lvbiBwYWlycwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0gLy8gTG9vayB0aHJvdWdoIHRoZSBsaXN0CgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgTjsgaisrKSB7CiAgICAgICAgICBjb25zdCBiaiA9IGJvZGllc1tqXTsKCiAgICAgICAgICBpZiAoIXRoaXMubmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYmksIGJqKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIVNBUEJyb2FkcGhhc2UuY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGVzdChiaSwgYmosIHAxLCBwMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc29ydExpc3QoKSB7CiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGNvbnN0IE4gPSBheGlzTGlzdC5sZW5ndGg7IC8vIFVwZGF0ZSBBQUJCcwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiaS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGJpLnVwZGF0ZUFBQkIoKTsKICAgICAgICB9CiAgICAgIH0gLy8gU29ydCB0aGUgbGlzdAoKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDApIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRYKGF4aXNMaXN0KTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRZKGF4aXNMaXN0KTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRaKGF4aXNMaXN0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgdmFyaWFuY2Ugb2YgdGhlIGJvZHkgcG9zaXRpb25zIGFuZCBlc3RpbWF0ZXMgdGhlIGJlc3QgYXhpcyB0byB1c2UuCiAgICAgKiBXaWxsIGF1dG9tYXRpY2FsbHkgc2V0IHByb3BlcnR5IGBheGlzSW5kZXhgLgogICAgICovCgoKICAgIGF1dG9EZXRlY3RBeGlzKCkgewogICAgICBsZXQgc3VtWCA9IDA7CiAgICAgIGxldCBzdW1YMiA9IDA7CiAgICAgIGxldCBzdW1ZID0gMDsKICAgICAgbGV0IHN1bVkyID0gMDsKICAgICAgbGV0IHN1bVogPSAwOwogICAgICBsZXQgc3VtWjIgPSAwOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaW52TiA9IDEgLyBOOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgY29uc3QgY2VudGVyWCA9IGIucG9zaXRpb24ueDsKICAgICAgICBzdW1YICs9IGNlbnRlclg7CiAgICAgICAgc3VtWDIgKz0gY2VudGVyWCAqIGNlbnRlclg7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGIucG9zaXRpb24ueTsKICAgICAgICBzdW1ZICs9IGNlbnRlclk7CiAgICAgICAgc3VtWTIgKz0gY2VudGVyWSAqIGNlbnRlclk7CiAgICAgICAgY29uc3QgY2VudGVyWiA9IGIucG9zaXRpb24uejsKICAgICAgICBzdW1aICs9IGNlbnRlclo7CiAgICAgICAgc3VtWjIgKz0gY2VudGVyWiAqIGNlbnRlclo7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZhcmlhbmNlWCA9IHN1bVgyIC0gc3VtWCAqIHN1bVggKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVkgPSBzdW1ZMiAtIHN1bVkgKiBzdW1ZICogaW52TjsKICAgICAgY29uc3QgdmFyaWFuY2VaID0gc3VtWjIgLSBzdW1aICogc3VtWiAqIGludk47CgogICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VZKSB7CiAgICAgICAgaWYgKHZhcmlhbmNlWCA+IHZhcmlhbmNlWikgewogICAgICAgICAgdGhpcy5heGlzSW5kZXggPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZhcmlhbmNlWSA+IHZhcmlhbmNlWikgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDI7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gYW4gQUFCQi4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGJvZGllcyBpbi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLnNvcnRMaXN0KCk7CiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgbGV0IGF4aXMgPSAneCc7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYXhpcyA9ICd5JzsKICAgICAgfQoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGF4aXMgPSAneic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgYWFiYi5sb3dlckJvdW5kW2F4aXNdOwogICAgICBhYWJiLnVwcGVyQm91bmRbYXhpc107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4aXNMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGF4aXNMaXN0W2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGIuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goYik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNsYXNzIFV0aWxzIHsKICAgIC8qKgogICAgICogRXh0ZW5kIGFuIG9wdGlvbnMgb2JqZWN0IHdpdGggZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgb3B0aW9ucyBvYmplY3QuIE1heSBiZSBmYWxzeTogaW4gdGhpcyBjYXNlLCBhIG5ldyBvYmplY3QgaXMgY3JlYXRlZCBhbmQgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gZGVmYXVsdHMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcmV0dXJuIFRoZSBtb2RpZmllZCBvcHRpb25zIG9iamVjdC4KICAgICAqLwogICAgc3RhdGljIGRlZmF1bHRzKG9wdGlvbnMsIGRlZmF1bHRzKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGtleSBpbiBkZWZhdWx0cykgewogICAgICAgIGlmICghKGtleSBpbiBvcHRpb25zKSkgewogICAgICAgICAgb3B0aW9uc1trZXldID0gZGVmYXVsdHNba2V5XTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBvcHRpb25zOwogICAgfQoKICB9CgogIC8qKgogICAqIENvbnN0cmFpbnQgYmFzZSBjbGFzcwogICAqLwogIGNsYXNzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBFcXVhdGlvbnMgdG8gYmUgc29sdmVkIGluIHRoaXMgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYm9kaWVzIHRvIGNvbGxpZGUgd2hlbiB0aGV5IGFyZSBjb25uZWN0ZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNvbGxpZGVDb25uZWN0ZWQ6IHRydWUsCiAgICAgICAgd2FrZVVwQm9kaWVzOiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgICB0aGlzLmJvZHlBID0gYm9keUE7CiAgICAgIHRoaXMuYm9keUIgPSBib2R5QjsKICAgICAgdGhpcy5pZCA9IENvbnN0cmFpbnQuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuY29sbGlkZUNvbm5lY3RlZCA9IG9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKCiAgICAgIGlmIChvcHRpb25zLndha2VVcEJvZGllcykgewogICAgICAgIGlmIChib2R5QSkgewogICAgICAgICAgYm9keUEud2FrZVVwKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYm9keUIpIHsKICAgICAgICAgIGJvZHlCLndha2VVcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYWxsIHRoZSBlcXVhdGlvbnMgd2l0aCBkYXRhLgogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdtZXRob2QgdXBkYXRlKCkgbm90IGltcGxtZW1lbnRlZCBpbiB0aGlzIENvbnN0cmFpbnQgc3ViY2xhc3MhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEVuYWJsZXMgYWxsIGVxdWF0aW9ucyBpbiB0aGUgY29uc3RyYWludC4KICAgICAqLwoKCiAgICBlbmFibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRGlzYWJsZXMgYWxsIGVxdWF0aW9ucyBpbiB0aGUgY29uc3RyYWludC4KICAgICAqLwoKCiAgICBkaXNhYmxlKCkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZXFzW2ldLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgfQogICAgfQoKICB9CiAgQ29uc3RyYWludC5pZENvdW50ZXIgPSAwOwoKICAvKioKICAgKiBBbiBlbGVtZW50IGNvbnRhaW5pbmcgNiBlbnRyaWVzLCAzIHNwYXRpYWwgYW5kIDMgcm90YXRpb25hbCBkZWdyZWVzIG9mIGZyZWVkb20uCiAgICovCgogIGNsYXNzIEphY29iaWFuRWxlbWVudCB7CiAgICAvKioKICAgICAqIHNwYXRpYWwKICAgICAqLwoKICAgIC8qKgogICAgICogcm90YXRpb25hbAogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5zcGF0aWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yb3RhdGlvbmFsID0gbmV3IFZlYzMoKTsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgd2l0aCBvdGhlciBKYWNvYmlhbkVsZW1lbnQKICAgICAqLwoKCiAgICBtdWx0aXBseUVsZW1lbnQoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5zcGF0aWFsLmRvdCh0aGlzLnNwYXRpYWwpICsgZWxlbWVudC5yb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIHR3byB2ZWN0b3JzCiAgICAgKi8KCgogICAgbXVsdGlwbHlWZWN0b3JzKHNwYXRpYWwsIHJvdGF0aW9uYWwpIHsKICAgICAgcmV0dXJuIHNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyByb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQoKICB9CgogIC8qKgogICAqIEVxdWF0aW9uIGJhc2UgY2xhc3MuCiAgICoKICAgKiBgYWAsIGBiYCBhbmQgYGVwc2AgYXJlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci81RFYwNTgvVlQxNS9sZWN0dXJlcy9TUE9PS2xhYm5vdGVzLnBkZiBTUE9PS30gcGFyYW1ldGVycyB0aGF0IGRlZmF1bHQgdG8gYDAuMGAuIFNlZSB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3NjaHRlcHBlL2Nhbm5vbi5qcy9pc3N1ZXMvMjM4I2lzc3VlY29tbWVudC0xNDcxNzIzMjcgdGhpcyBleGNoYW5nZX0gZm9yIG1vcmUgZGV0YWlscyBvbiBDYW5ub24ncyBwaHlzaWNzIGltcGxlbWVudGF0aW9uLgogICAqLwogIGNsYXNzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogTWluaW11bSAocmVhZDogbmVnYXRpdmUgbWF4KSBmb3JjZSB0byBiZSBhcHBsaWVkIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXhpbXVtIChyZWFkOiBwb3NpdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgbnVtYmVyLCBwcm9wb3J0aW9uYWwgdG8gdGhlIGZvcmNlIGFkZGVkIHRvIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJpLCBiaiwgbWluRm9yY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtaW5Gb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWluRm9yY2UgPSAtMWU2OwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICB0aGlzLmlkID0gRXF1YXRpb24uaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWluRm9yY2UgPSBtaW5Gb3JjZTsKICAgICAgdGhpcy5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB0aGlzLmJpID0gYmk7CiAgICAgIHRoaXMuYmogPSBiajsKICAgICAgdGhpcy5hID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuYiA9IDAuMDsgLy8gU1BPT0sgcGFyYW1ldGVyCgogICAgICB0aGlzLmVwcyA9IDAuMDsgLy8gU1BPT0sgcGFyYW1ldGVyCgogICAgICB0aGlzLmphY29iaWFuRWxlbWVudEEgPSBuZXcgSmFjb2JpYW5FbGVtZW50KCk7CiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QiA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5tdWx0aXBsaWVyID0gMDsKICAgICAgdGhpcy5zZXRTcG9va1BhcmFtcygxZTcsIDQsIDEgLyA2MCk7IC8vIFNldCB0eXBpY2FsIHNwb29rIHBhcmFtcwogICAgfQogICAgLyoqCiAgICAgKiBSZWNhbGN1bGF0ZXMgYSwgYiwgYW5kIGVwcy4KICAgICAqCiAgICAgKiBUaGUgRXF1YXRpb24gY29uc3RydWN0b3Igc2V0cyB0eXBpY2FsIFNQT09LIHBhcmFtZXRlcnMgYXMgc3VjaDoKICAgICAqICogYHN0aWZmbmVzc2AgPSAxZTcKICAgICAqICogYHJlbGF4YXRpb25gID0gNAogICAgICogKiBgdGltZVN0ZXBgPSAxIC8gNjAsIF9ub3RlIHRoZSBoYXJkY29kZWQgcmVmcmVzaCByYXRlLl8KICAgICAqLwoKCiAgICBzZXRTcG9va1BhcmFtcyhzdGlmZm5lc3MsIHJlbGF4YXRpb24sIHRpbWVTdGVwKSB7CiAgICAgIGNvbnN0IGQgPSByZWxheGF0aW9uOwogICAgICBjb25zdCBrID0gc3RpZmZuZXNzOwogICAgICBjb25zdCBoID0gdGltZVN0ZXA7CiAgICAgIHRoaXMuYSA9IDQuMCAvIChoICogKDEgKyA0ICogZCkpOwogICAgICB0aGlzLmIgPSA0LjAgKiBkIC8gKDEgKyA0ICogZCk7CiAgICAgIHRoaXMuZXBzID0gNC4wIC8gKGggKiBoICogayAqICgxICsgNCAqIGQpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgU1BPT0sgZXF1YXRpb24KICAgICAqLwoKCiAgICBjb21wdXRlQihhLCBiLCBoKSB7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR3EgPSB0aGlzLmNvbXB1dGVHcSgpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICByZXR1cm4gLUdxICogYSAtIEdXICogYiAtIEdpTWYgKiBoOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKnEsIHdoZXJlIHEgYXJlIHRoZSBnZW5lcmFsaXplZCBib2R5IGNvb3JkaW5hdGVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdxKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB4aSA9IGJpLnBvc2l0aW9uOwogICAgICBjb25zdCB4aiA9IGJqLnBvc2l0aW9uOwogICAgICByZXR1cm4gR0Euc3BhdGlhbC5kb3QoeGkpICsgR0Iuc3BhdGlhbC5kb3QoeGopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKlcsIHdoZXJlIFcgYXJlIHRoZSBib2R5IHZlbG9jaXRpZXMKICAgICAqLwoKCiAgICBjb21wdXRlR1coKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHZqID0gYmoudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgcmV0dXJuIEdBLm11bHRpcGx5VmVjdG9ycyh2aSwgd2kpICsgR0IubXVsdGlwbHlWZWN0b3JzKHZqLCB3aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqV2xhbWJkYSwgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHV2xhbWJkYSgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52bGFtYmRhOwogICAgICBjb25zdCB2aiA9IGJqLnZsYW1iZGE7CiAgICAgIGNvbnN0IHdpID0gYmkud2xhbWJkYTsKICAgICAgY29uc3Qgd2ogPSBiai53bGFtYmRhOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRyppbnYoTSkqZiwgd2hlcmUgTSBpcyB0aGUgbWFzcyBtYXRyaXggd2l0aCBkaWFnb25hbCBibG9ja3MgZm9yIGVhY2ggYm9keSwgYW5kIGYgYXJlIHRoZSBmb3JjZXMgb24gdGhlIGJvZGllcy4KICAgICAqLwoKCiAgICBjb21wdXRlR2lNZigpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgZmkgPSBiaS5mb3JjZTsKICAgICAgY29uc3QgdGkgPSBiaS50b3JxdWU7CiAgICAgIGNvbnN0IGZqID0gYmouZm9yY2U7CiAgICAgIGNvbnN0IHRqID0gYmoudG9ycXVlOwogICAgICBjb25zdCBpbnZNYXNzaSA9IGJpLmludk1hc3NTb2x2ZTsKICAgICAgY29uc3QgaW52TWFzc2ogPSBiai5pbnZNYXNzU29sdmU7CiAgICAgIGZpLnNjYWxlKGludk1hc3NpLCBpTWZpKTsKICAgICAgZmouc2NhbGUoaW52TWFzc2osIGlNZmopOwogICAgICBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdCh0aSwgaW52SWlfdm11bHRfdGF1aSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRqLCBpbnZJal92bXVsdF90YXVqKTsKICAgICAgcmV0dXJuIEdBLm11bHRpcGx5VmVjdG9ycyhpTWZpLCBpbnZJaV92bXVsdF90YXVpKSArIEdCLm11bHRpcGx5VmVjdG9ycyhpTWZqLCBpbnZJal92bXVsdF90YXVqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRyppbnYoTSkqRycKICAgICAqLwoKCiAgICBjb21wdXRlR2lNR3QoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgY29uc3QgaW52SWkgPSBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZTsKICAgICAgY29uc3QgaW52SWogPSBiai5pbnZJbmVydGlhV29ybGRTb2x2ZTsKICAgICAgbGV0IHJlc3VsdCA9IGludk1hc3NpICsgaW52TWFzc2o7CiAgICAgIGludklpLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdBLnJvdGF0aW9uYWwpOwogICAgICBpbnZJai52bXVsdChHQi5yb3RhdGlvbmFsLCB0bXApOwogICAgICByZXN1bHQgKz0gdG1wLmRvdChHQi5yb3RhdGlvbmFsKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGNvbnN0cmFpbnQgdmVsb2NpdHkgdG8gdGhlIGJvZGllcy4KICAgICAqLwoKCiAgICBhZGRUb1dsYW1iZGEoZGVsdGFsYW1iZGEpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdGVtcCA9IGFkZFRvV2xhbWJkYV90ZW1wOyAvLyBBZGQgdG8gbGluZWFyIHZlbG9jaXR5CiAgICAgIC8vIHZfbGFtYmRhICs9IGludihNKSAqIGRlbHRhX2xhbWJhICogRwoKICAgICAgYmkudmxhbWJkYS5hZGRTY2FsZWRWZWN0b3IoYmkuaW52TWFzc1NvbHZlICogZGVsdGFsYW1iZGEsIEdBLnNwYXRpYWwsIGJpLnZsYW1iZGEpOwogICAgICBiai52bGFtYmRhLmFkZFNjYWxlZFZlY3Rvcihiai5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Iuc3BhdGlhbCwgYmoudmxhbWJkYSk7IC8vIEFkZCB0byBhbmd1bGFyIHZlbG9jaXR5CgogICAgICBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdChHQS5yb3RhdGlvbmFsLCB0ZW1wKTsKICAgICAgYmkud2xhbWJkYS5hZGRTY2FsZWRWZWN0b3IoZGVsdGFsYW1iZGEsIHRlbXAsIGJpLndsYW1iZGEpOwogICAgICBiai5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdChHQi5yb3RhdGlvbmFsLCB0ZW1wKTsKICAgICAgYmoud2xhbWJkYS5hZGRTY2FsZWRWZWN0b3IoZGVsdGFsYW1iZGEsIHRlbXAsIGJqLndsYW1iZGEpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBkZW5vbWluYXRvciBwYXJ0IG9mIHRoZSBTUE9PSyBlcXVhdGlvbjogQyA9IEcqaW52KE0pKkcnICsgZXBzCiAgICAgKi8KCgogICAgY29tcHV0ZUMoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVHaU1HdCgpICsgdGhpcy5lcHM7CiAgICB9CgogIH0KICBFcXVhdGlvbi5pZENvdW50ZXIgPSAwOwogIGNvbnN0IGlNZmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGlNZmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklpX3ZtdWx0X3RhdWkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklqX3ZtdWx0X3RhdWogPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWRkVG9XbGFtYmRhX3RlbXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb250YWN0L25vbi1wZW5ldHJhdGlvbiBjb25zdHJhaW50IGVxdWF0aW9uCiAgICovCiAgY2xhc3MgQ29udGFjdEVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiAiYm91bmNpbmVzcyI6IHUxID0gLWUqdTAKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgZ29lcyBmcm9tIHRoZSBjZW50ZXIgb2YgYmkgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkLW9yaWVudGVkIHZlY3RvciB0aGF0IHN0YXJ0cyBpbiBib2R5IGogcG9zaXRpb24gYW5kIGdvZXMgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbnRhY3Qgbm9ybWFsLCBwb2ludGluZyBvdXQgb2YgYm9keSBpLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgMCwgbWF4Rm9yY2UpOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gMC4wOwogICAgICB0aGlzLnJpID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yaiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubmkgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHJpID0gdGhpcy5yaTsKICAgICAgY29uc3QgcmogPSB0aGlzLnJqOwogICAgICBjb25zdCByaXhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB2aSA9IGJpLnZlbG9jaXR5OwogICAgICBjb25zdCB3aSA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmkuZm9yY2U7CiAgICAgIGJpLnRvcnF1ZTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2ogPSBiai5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGJqLmZvcmNlOwogICAgICBiai50b3JxdWU7CiAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IG4gPSB0aGlzLm5pOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKG4sIHJpeG4pOwogICAgICByai5jcm9zcyhuLCByanhuKTsgLy8gZyA9IHhqK3JqIC0oeGkrcmkpCiAgICAgIC8vIEcgPSBbIC1uaSAgLXJpeG4gIG5pICByanhuIF0KCiAgICAgIG4ubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXhuLm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KG4pOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4bik7IC8vIENhbGN1bGF0ZSB0aGUgcGVuZXRyYXRpb24gdmVjdG9yCgogICAgICBwZW5ldHJhdGlvblZlYy5jb3B5KGJqLnBvc2l0aW9uKTsKICAgICAgcGVuZXRyYXRpb25WZWMudmFkZChyaiwgcGVuZXRyYXRpb25WZWMpOwogICAgICBwZW5ldHJhdGlvblZlYy52c3ViKGJpLnBvc2l0aW9uLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIocmksIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgY29uc3QgZyA9IG4uZG90KHBlbmV0cmF0aW9uVmVjKTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgIGNvbnN0IGVQbHVzT25lID0gdGhpcy5yZXN0aXR1dGlvbiArIDE7CiAgICAgIGNvbnN0IEdXID0gZVBsdXNPbmUgKiB2ai5kb3QobikgLSBlUGx1c09uZSAqIHZpLmRvdChuKSArIHdqLmRvdChyanhuKSAtIHdpLmRvdChyaXhuKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHJlbGF0aXZlIHZlbG9jaXR5IGluIHRoZSBjb250YWN0IHBvaW50LgogICAgICovCgoKICAgIGdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSB7CiAgICAgIGNvbnN0IHZpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmk7CiAgICAgIGNvbnN0IHZqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmo7CiAgICAgIGNvbnN0IHhpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGk7CiAgICAgIGNvbnN0IHhqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGo7CiAgICAgIGNvbnN0IHJlbFZlbCA9IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbDsKICAgICAgdGhpcy5iaS5wb3NpdGlvbi52YWRkKHRoaXMucmksIHhpKTsKICAgICAgdGhpcy5iai5wb3NpdGlvbi52YWRkKHRoaXMucmosIHhqKTsKICAgICAgdGhpcy5iaS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludCh4aSwgdmkpOwogICAgICB0aGlzLmJqLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhqLCB2aik7CiAgICAgIHZpLnZzdWIodmosIHJlbFZlbCk7CiAgICAgIHJldHVybiB0aGlzLm5pLmRvdChyZWxWZWwpOwogICAgfQoKICB9CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzCgogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmogPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29ubmVjdHMgdHdvIGJvZGllcyBhdCBnaXZlbiBvZmZzZXQgcG9pbnRzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGJvZHlBID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGNvbnN0IGJvZHlCID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGJvZHlBLnBvc2l0aW9uLnNldCgtMSwgMCwgMCkKICAgKiAgICAgYm9keUIucG9zaXRpb24uc2V0KDEsIDAsIDApCiAgICogICAgIGJvZHlBLmFkZFNoYXBlKHNoYXBlQSkKICAgKiAgICAgYm9keUIuYWRkU2hhcGUoc2hhcGVCKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlBKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlCKQogICAqICAgICBjb25zdCBsb2NhbFBpdm90QSA9IG5ldyBWZWMzKDEsIDAsIDApCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RCID0gbmV3IFZlYzMoLTEsIDAsIDApCiAgICogICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChib2R5QSwgbG9jYWxQaXZvdEEsIGJvZHlCLCBsb2NhbFBpdm90QikKICAgKiAgICAgd29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KQogICAqLwogIGNsYXNzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUGl2b3QsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5QS4KICAgICAqLwoKICAgIC8qKgogICAgICogUGl2b3QsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHBpdm90QSBUaGUgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIG9mIGJvZHlBIHdoaWNoIGJvZHlBIGlzIGNvbnN0cmFpbmVkIHRvLgogICAgICogQHBhcmFtIGJvZHlCIEJvZHkgdGhhdCB3aWxsIGJlIGNvbnN0cmFpbmVkIGluIGEgc2ltaWxhciB3YXkgdG8gdGhlIHNhbWUgcG9pbnQgYXMgYm9keUEuIFdlIHdpbGwgdGhlcmVmb3JlIGdldCBhIGxpbmsgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIuIElmIG5vdCBzcGVjaWZpZWQsIGJvZHlBIHdpbGwgYmUgY29uc3RyYWluZWQgdG8gYSBzdGF0aWMgcG9pbnQuCiAgICAgKiBAcGFyYW0gcGl2b3RCIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUIgd2hpY2ggYm9keUIgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gbWF4Rm9yY2UgVGhlIG1heGltdW0gZm9yY2UgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBjb25zdHJhaW4gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKHBpdm90QSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHBpdm90QiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5waXZvdEEgPSBwaXZvdEEuY2xvbmUoKTsKICAgICAgdGhpcy5waXZvdEIgPSBwaXZvdEIuY2xvbmUoKTsKICAgICAgY29uc3QgeCA9IHRoaXMuZXF1YXRpb25YID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICBjb25zdCB5ID0gdGhpcy5lcXVhdGlvblkgPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHogPSB0aGlzLmVxdWF0aW9uWiA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsgLy8gRXF1YXRpb25zIHRvIGJlIGZlZCB0byB0aGUgc29sdmVyCgogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHgsIHksIHopOyAvLyBNYWtlIHRoZSBlcXVhdGlvbnMgYmlkaXJlY3Rpb25hbAoKICAgICAgeC5taW5Gb3JjZSA9IHkubWluRm9yY2UgPSB6Lm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICB4Lm1heEZvcmNlID0geS5tYXhGb3JjZSA9IHoubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgeC5uaS5zZXQoMSwgMCwgMCk7CiAgICAgIHkubmkuc2V0KDAsIDEsIDApOwogICAgICB6Lm5pLnNldCgwLCAwLCAxKTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblg7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aOyAvLyBSb3RhdGUgdGhlIHBpdm90cyB0byB3b3JsZCBzcGFjZQoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QSwgeC5yaSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5waXZvdEIsIHgucmopOwogICAgICB5LnJpLmNvcHkoeC5yaSk7CiAgICAgIHkucmouY29weSh4LnJqKTsKICAgICAgei5yaS5jb3B5KHgucmkpOwogICAgICB6LnJqLmNvcHkoeC5yaik7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uZSBlcXVhdGlvbi4gV29ya3MgdG8ga2VlcCB0aGUgZ2l2ZW4gYm9keSB3b3JsZCB2ZWN0b3JzIGFsaWduZWQsIG9yIHRpbHRlZCB3aXRoaW4gYSBnaXZlbiBhbmdsZSBmcm9tIGVhY2ggb3RoZXIuCiAgICovCiAgY2xhc3MgQ29uZUVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEEKICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgYXhpcyBpbiBCCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSAiY29uZSBhbmdsZSIgdG8ga2VlcAogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OwogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDAsIDEsIDApOwogICAgICB0aGlzLmFuZ2xlID0gdHlwZW9mIG9wdGlvbnMuYW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmdsZSA6IDA7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBuaSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IG5qID0gdGhpcy5heGlzQjsKICAgICAgY29uc3Qgbml4bmogPSB0bXBWZWMxJDI7CiAgICAgIGNvbnN0IG5qeG5pID0gdG1wVmVjMiQyOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgbmkuY3Jvc3MobmosIG5peG5qKTsKICAgICAgbmouY3Jvc3MobmksIG5qeG5pKTsgLy8gVGhlIGFuZ2xlIGJldHdlZW4gdHdvIHZlY3RvciBpczoKICAgICAgLy8gY29zKHRoZXRhKSA9IGEgKiBiIC8gKGxlbmd0aChhKSAqIGxlbmd0aChiKSA9IHsgbGVuKGEpID0gbGVuKGIpID0gMSB9ID0gYSAqIGIKICAgICAgLy8gZyA9IGEgKiBiCiAgICAgIC8vIGdkb3QgPSAoYiB4IGEpICogd2kgKyAoYSB4IGIpICogd2oKICAgICAgLy8gRyA9IFswIGJ4YSAwIGF4Yl0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLmFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQyID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogUm90YXRpb25hbCBjb25zdHJhaW50LiBXb3JrcyB0byBrZWVwIHRoZSBsb2NhbCB2ZWN0b3JzIG9ydGhvZ29uYWwgdG8gZWFjaCBvdGhlciBpbiB3b3JsZCBzcGFjZS4KICAgKi8KICBjbGFzcyBSb3RhdGlvbmFsRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBtYXhBbmdsZQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OwogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDAsIDEsIDApOwogICAgICB0aGlzLm1heEFuZ2xlID0gTWF0aC5QSSAvIDI7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBuaSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IG5qID0gdGhpcy5heGlzQjsKICAgICAgY29uc3Qgbml4bmogPSB0bXBWZWMxJDE7CiAgICAgIGNvbnN0IG5qeG5pID0gdG1wVmVjMiQxOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgbmkuY3Jvc3MobmosIG5peG5qKTsKICAgICAgbmouY3Jvc3MobmksIG5qeG5pKTsgLy8gZyA9IG5pICogbmoKICAgICAgLy8gZ2RvdCA9IChuaiB4IG5pKSAqIHdpICsgKG5pIHggbmopICogd2oKICAgICAgLy8gRyA9IFswIG5qeG5pIDAgbml4bmpdCiAgICAgIC8vIFcgPSBbdmkgd2kgdmogd2pdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkobmp4bmkpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkobml4bmopOwogICAgICBjb25zdCBnID0gTWF0aC5jb3ModGhpcy5tYXhBbmdsZSkgLSBuaS5kb3QobmopOwogICAgICBjb25zdCBHVyA9IHRoaXMuY29tcHV0ZUdXKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtZyAqIGEgLSBHVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICBjb25zdCB0bXBWZWMxJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIkMSA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEEgQ29uZSBUd2lzdCBjb25zdHJhaW50LCB1c2VmdWwgZm9yIHJhZ2RvbGxzLgogICAqLwogIGNsYXNzIENvbmVUd2lzdENvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGF4aXMgZGlyZWN0aW9uIGZvciB0aGUgY29uc3RyYWludCBvZiB0aGUgYm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBhcGVydHVyZSBhbmdsZSBvZiB0aGUgY29uZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHR3aXN0IGFuZ2xlIG9mIHRoZSBqb2ludC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsgLy8gU2V0IHBpdm90IHBvaW50IGluIGJldHdlZW4KCiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG9wdGlvbnMuYXhpc0EgPyBvcHRpb25zLmF4aXNBLmNsb25lKCkgOiBuZXcgVmVjMygpOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlkZUNvbm5lY3RlZCA9ICEhb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwogICAgICB0aGlzLmFuZ2xlID0gdHlwZW9mIG9wdGlvbnMuYW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmdsZSA6IDA7CiAgICAgIGNvbnN0IGMgPSB0aGlzLmNvbmVFcXVhdGlvbiA9IG5ldyBDb25lRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgdCA9IHRoaXMudHdpc3RFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgdGhpcy50d2lzdEFuZ2xlID0gdHlwZW9mIG9wdGlvbnMudHdpc3RBbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnR3aXN0QW5nbGUgOiAwOyAvLyBNYWtlIHRoZSBjb25lIGVxdWF0aW9uIHB1c2ggdGhlIGJvZGllcyB0b3dhcmQgdGhlIGNvbmUgYXhpcywgbm90IG91dHdhcmQKCiAgICAgIGMubWF4Rm9yY2UgPSAwOwogICAgICBjLm1pbkZvcmNlID0gLW1heEZvcmNlOyAvLyBNYWtlIHRoZSB0d2lzdCBlcXVhdGlvbiBhZGQgdG9ycXVlIHRvd2FyZCB0aGUgaW5pdGlhbCBwb3NpdGlvbgoKICAgICAgdC5tYXhGb3JjZSA9IDA7CiAgICAgIHQubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goYywgdCk7CiAgICB9CgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgY29uZSA9IHRoaXMuY29uZUVxdWF0aW9uOwogICAgICBjb25zdCB0d2lzdCA9IHRoaXMudHdpc3RFcXVhdGlvbjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIFVwZGF0ZSB0aGUgYXhlcyB0byB0aGUgY29uZSBjb25zdHJhaW50CgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy5heGlzQSwgY29uZS5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNCLCBjb25lLmF4aXNCKTsgLy8gVXBkYXRlIHRoZSB3b3JsZCBheGVzIGluIHRoZSB0d2lzdCBjb25zdHJhaW50CgogICAgICB0aGlzLmF4aXNBLnRhbmdlbnRzKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0d2lzdC5heGlzQSwgdHdpc3QuYXhpc0EpOwogICAgICB0aGlzLmF4aXNCLnRhbmdlbnRzKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0d2lzdC5heGlzQiwgdHdpc3QuYXhpc0IpOwogICAgICBjb25lLmFuZ2xlID0gdGhpcy5hbmdsZTsKICAgICAgdHdpc3QubWF4QW5nbGUgPSB0aGlzLnR3aXN0QW5nbGU7CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdHdvIGJvZGllcyB0byBiZSBhdCBhIGNvbnN0YW50IGRpc3RhbmNlIGZyb20gZWFjaCBvdGhlcnMgY2VudGVyIG9mIG1hc3MuCiAgICovCiAgY2xhc3MgRGlzdGFuY2VDb25zdHJhaW50IGV4dGVuZHMgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkaXN0YW5jZSBUaGUgZGlzdGFuY2UgdG8ga2VlcC4gSWYgdW5kZWZpbmVkLCBpdCB3aWxsIGJlIHNldCB0byB0aGUgY3VycmVudCBkaXN0YW5jZSBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIGRpc3RhbmNlLCBtYXhGb3JjZSkgewogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwoKICAgICAgaWYgKHR5cGVvZiBkaXN0YW5jZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBkaXN0YW5jZSA9IGJvZHlBLnBvc2l0aW9uLmRpc3RhbmNlVG8oYm9keUIucG9zaXRpb24pOwogICAgICB9CgogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgIGNvbnN0IGVxID0gdGhpcy5kaXN0YW5jZUVxdWF0aW9uID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsgLy8gTWFrZSBpdCBiaWRpcmVjdGlvbmFsCgogICAgICBlcS5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgZXEubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb247CiAgICAgIGNvbnN0IGhhbGZEaXN0ID0gdGhpcy5kaXN0YW5jZSAqIDAuNTsKICAgICAgY29uc3Qgbm9ybWFsID0gZXEubmk7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIG5vcm1hbCk7CiAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgbm9ybWFsLnNjYWxlKGhhbGZEaXN0LCBlcS5yaSk7CiAgICAgIG5vcm1hbC5zY2FsZSgtaGFsZkRpc3QsIGVxLnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBMb2NrIGNvbnN0cmFpbnQuIFdpbGwgcmVtb3ZlIGFsbCBkZWdyZWVzIG9mIGZyZWVkb20gYmV0d2VlbiB0aGUgYm9kaWVzLgogICAqLwogIGNsYXNzIExvY2tDb25zdHJhaW50IGV4dGVuZHMgUG9pbnRUb1BvaW50Q29uc3RyYWludCB7CiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGFsZldheSA9IG5ldyBWZWMzKCk7CiAgICAgIGJvZHlBLnBvc2l0aW9uLnZhZGQoYm9keUIucG9zaXRpb24sIGhhbGZXYXkpOwogICAgICBoYWxmV2F5LnNjYWxlKDAuNSwgaGFsZldheSk7CiAgICAgIGJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90Qik7CiAgICAgIGJvZHlBLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90QSk7IC8vIFRoZSBwb2ludC10by1wb2ludCBjb25zdHJhaW50IHdpbGwga2VlcCBhIHBvaW50IHNoYXJlZCBiZXR3ZWVuIHRoZSBib2RpZXMKCiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsgLy8gU3RvcmUgaW5pdGlhbCByb3RhdGlvbiBvZiB0aGUgYm9kaWVzIGFzIHVuaXQgdmVjdG9ycyBpbiB0aGUgbG9jYWwgYm9keSBzcGFjZXMKCiAgICAgIHRoaXMueEEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnhCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9YKTsKICAgICAgdGhpcy55QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMueUIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1kpOwogICAgICB0aGlzLnpBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsKICAgICAgdGhpcy56QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWik7IC8vIC4uLmFuZCB0aGUgZm9sbG93aW5nIHJvdGF0aW9uYWwgZXF1YXRpb25zIHdpbGwga2VlcCBhbGwgcm90YXRpb25hbCBET0YncyBpbiBwbGFjZQoKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByMyA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMyA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyMSwgcjIsIHIzKTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uOwogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjI7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVGhlc2UgdmVjdG9yIHBhaXJzIG11c3QgYmUgb3J0aG9nb25hbAoKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueEEsIHIxLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueUIsIHIxLmF4aXNCKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueUEsIHIyLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuekIsIHIyLmF4aXNCKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuekEsIHIzLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueEIsIHIzLmF4aXNCKTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogUm90YXRpb25hbCBtb3RvciBjb25zdHJhaW50LiBUcmllcyB0byBrZWVwIHRoZSByZWxhdGl2ZSBhbmd1bGFyIHZlbG9jaXR5IG9mIHRoZSBib2RpZXMgdG8gYSBnaXZlbiB2YWx1ZS4KICAgKi8KICBjbGFzcyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1vdG9yIHZlbG9jaXR5LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmF4aXNCID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy50YXJnZXRWZWxvY2l0eSA9IDA7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIHRoaXMuYmk7CiAgICAgIHRoaXMuYmo7CiAgICAgIGNvbnN0IGF4aXNBID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgYXhpc0IgPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIGcgPSAwCiAgICAgIC8vIGdkb3QgPSBheGlzQSAqIHdpIC0gYXhpc0IgKiB3agogICAgICAvLyBnZG90ID0gRyAqIFcgPSBHICogW3ZpIHdpIHZqIHdqXQogICAgICAvLyA9PgogICAgICAvLyBHID0gWzAgYXhpc0EgMCAtYXhpc0JdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkoYXhpc0EpOwogICAgICBheGlzQi5uZWdhdGUoR0Iucm90YXRpb25hbCk7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKSAtIHRoaXMudGFyZ2V0VmVsb2NpdHk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CgogIC8qKgogICAqIEhpbmdlIGNvbnN0cmFpbnQuIFRoaW5rIG9mIGl0IGFzIGEgZG9vciBoaW5nZS4gSXQgdHJpZXMgdG8ga2VlcCB0aGUgZG9vciBpbiB0aGUgY29ycmVjdCBwbGFjZSBhbmQgd2l0aCB0aGUgY29ycmVjdCBvcmllbnRhdGlvbi4KICAgKi8KICBjbGFzcyBIaW5nZUNvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUm90YXRpb24gYXhpcywgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICBheGlzQS5ub3JtYWxpemUoKTsKICAgICAgY29uc3QgYXhpc0IgPSB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICBheGlzQi5ub3JtYWxpemUoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByb3RhdGlvbmFsMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgbW90b3IgPSB0aGlzLm1vdG9yRXF1YXRpb24gPSBuZXcgUm90YXRpb25hbE1vdG9yRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtYXhGb3JjZSk7CiAgICAgIG1vdG9yLmVuYWJsZWQgPSBmYWxzZTsgLy8gTm90IGVuYWJsZWQgYnkgZGVmYXVsdAogICAgICAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2gocm90YXRpb25hbDEsIHJvdGF0aW9uYWwyLCBtb3Rvcik7CiAgICB9CiAgICAvKioKICAgICAqIGVuYWJsZU1vdG9yCiAgICAgKi8KCgogICAgZW5hYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogZGlzYWJsZU1vdG9yCiAgICAgKi8KCgogICAgZGlzYWJsZU1vdG9yKCkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3RvclNwZWVkCiAgICAgKi8KCgogICAgc2V0TW90b3JTcGVlZChzcGVlZCkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24udGFyZ2V0VmVsb2NpdHkgPSBzcGVlZDsKICAgIH0KICAgIC8qKgogICAgICogc2V0TW90b3JNYXhGb3JjZQogICAgICovCgoKICAgIHNldE1vdG9yTWF4Rm9yY2UobWF4Rm9yY2UpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgbW90b3IgPSB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3Qgd29ybGRBeGlzQSA9IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMTsKICAgICAgY29uc3Qgd29ybGRBeGlzQiA9IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMjsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBHZXQgd29ybGQgYXhlcwoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdChheGlzQSwgd29ybGRBeGlzQSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQoYXhpc0IsIHdvcmxkQXhpc0IpOwogICAgICB3b3JsZEF4aXNBLnRhbmdlbnRzKHIxLmF4aXNBLCByMi5heGlzQSk7CiAgICAgIHIxLmF4aXNCLmNvcHkod29ybGRBeGlzQik7CiAgICAgIHIyLmF4aXNCLmNvcHkod29ybGRBeGlzQik7CgogICAgICBpZiAodGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQpIHsKICAgICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMuYXhpc0EsIG1vdG9yLmF4aXNBKTsKICAgICAgICBib2R5Qi5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMuYXhpc0IsIG1vdG9yLmF4aXNCKTsKICAgICAgfQogICAgfQoKICB9CiAgY29uc3QgSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25zdHJhaW5zIHRoZSBzbGlwcGluZyBpbiBhIGNvbnRhY3QgYWxvbmcgYSB0YW5nZW50CiAgICovCiAgY2xhc3MgRnJpY3Rpb25FcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8vIFRhbmdlbnQKCiAgICAvKioKICAgICAqIEBwYXJhbSBzbGlwRm9yY2Ugc2hvdWxkIGJlICstRl9mcmljdGlvbiA9ICstbXUgKiBGX25vcm1hbCA9ICstbXUgKiBtICogZwogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIHNsaXBGb3JjZSkgewogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1zbGlwRm9yY2UsIHNsaXBGb3JjZSk7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy50ID0gbmV3IFZlYzMoKTsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanh0ID0gRnJpY3Rpb25FcXVhdGlvbl9jb21wdXRlQl90ZW1wMjsKICAgICAgY29uc3QgdCA9IHRoaXMudDsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICByaS5jcm9zcyh0LCByaXh0KTsKICAgICAgcmouY3Jvc3ModCwgcmp4dCk7IC8vIEcgPSBbLXQgLXJpeHQgdCByanh0XQogICAgICAvLyBBbmQgcmVtZW1iZXIsIHRoaXMgaXMgYSBwdXJlIHZlbG9jaXR5IGNvbnN0cmFpbnQsIGcgaXMgYWx3YXlzIHplcm8hCgogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIHQubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXh0Lm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KHQpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4dCk7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogRGVmaW5lcyB3aGF0IGhhcHBlbnMgd2hlbiB0d28gbWF0ZXJpYWxzIG1lZXQuCiAgICogQHRvZG8gUmVmYWN0b3IgbWF0ZXJpYWxzIHRvIG1hdGVyaWFsQSBhbmQgbWF0ZXJpYWxCCiAgICovCiAgY2xhc3MgQ29udGFjdE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogSWRlbnRpZmllciBvZiB0aGlzIG1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBQYXJ0aWNpcGF0aW5nIG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBwcm9kdWNlZCBjb250YWN0IGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucwogICAgICogQGRlZmF1bHQgMwogICAgICovCiAgICBjb25zdHJ1Y3RvcihtMSwgbTIsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjMsCiAgICAgICAgY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbjogMywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb246IDMKICAgICAgfSk7CiAgICAgIHRoaXMuaWQgPSBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW20xLCBtMl07CiAgICAgIHRoaXMuZnJpY3Rpb24gPSBvcHRpb25zLmZyaWN0aW9uOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gb3B0aW9ucy5yZXN0aXR1dGlvbjsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uID0gb3B0aW9ucy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uOwogICAgfQoKICB9CiAgQ29udGFjdE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIERlZmluZXMgYSBwaHlzaWNzIG1hdGVyaWFsLgogICAqLwogIGNsYXNzIE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogTWF0ZXJpYWwgbmFtZS4KICAgICAqIElmIG9wdGlvbnMgaXMgYSBzdHJpbmcsIG5hbWUgd2lsbCBiZSBzZXQgdG8gdGhhdCBzdHJpbmcuCiAgICAgKiBAdG9kbyBEZXByZWNhdGUgdGhpcwogICAgICovCgogICAgLyoqIE1hdGVyaWFsIGlkLiAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSBmcmljdGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlc3RpdHV0aW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgICogSWYgbm9uLW5lZ2F0aXZlLCBpdCB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiB0aGUgcmVzdGl0dXRpb24gZ2l2ZW4gYnkgQ29udGFjdE1hdGVyaWFscy4gSWYgdGhlcmUncyBubyBtYXRjaGluZyBDb250YWN0TWF0ZXJpYWwsIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0Q29udGFjdE1hdGVyaWFsYCBpbiB0aGUgV29ybGQgd2lsbCBiZSB1c2VkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGxldCBuYW1lID0gJyc7IC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZpeAoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykgewogICAgICAgIC8vY29uc29sZS53YXJuKGBQYXNzaW5nIGEgc3RyaW5nIHRvIE1hdGVyaWFsT3B0aW9ucyBpcyBkZXByZWNhdGVkLCBhbmQgaGFzIG5vIGVmZmVjdGApCiAgICAgICAgbmFtZSA9IG9wdGlvbnM7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmlkID0gTWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB0eXBlb2Ygb3B0aW9ucy5mcmljdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZyaWN0aW9uIDogLTE7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB0eXBlb2Ygb3B0aW9ucy5yZXN0aXR1dGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnJlc3RpdHV0aW9uIDogLTE7CiAgICB9CgogIH0KICBNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwoKICAvKioKICAgKiBBIHNwcmluZywgY29ubmVjdGluZyB0d28gYm9kaWVzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoYm94Qm9keSwgc3BoZXJlQm9keSwgewogICAqICAgICAgIHJlc3RMZW5ndGg6IDAsCiAgICogICAgICAgc3RpZmZuZXNzOiA1MCwKICAgKiAgICAgICBkYW1waW5nOiAxLAogICAqICAgICB9KQogICAqCiAgICogICAgIC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAogICAqICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIChldmVudCkgPT4gewogICAqICAgICAgIHNwcmluZy5hcHBseUZvcmNlKCkKICAgKiAgICAgfSkKICAgKi8KICBjbGFzcyBTcHJpbmcgewogICAgLyoqCiAgICAgKiBSZXN0IGxlbmd0aCBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+IDAuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMTAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERhbXBpbmcgb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPj0gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogRmlyc3QgY29ubmVjdGVkIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNlY29uZCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QSBpbiBsb2NhbCBib2R5QSBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEEsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuY2hvciBmb3IgYm9keUIgaW4gbG9jYWwgYm9keUIgY29vcmRpbmF0ZXMuCiAgICAgKiBXaGVyZSB0byBob29rIHRoZSBzcHJpbmcgdG8gYm9keSBCLCBpbiBsb2NhbCBib2R5IGNvb3JkaW5hdGVzLgogICAgICogQGRlZmF1bHQgbmV3IFZlYzMoKQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yZXN0TGVuZ3RoID0gdHlwZW9mIG9wdGlvbnMucmVzdExlbmd0aCA9PT0gJ251bWJlcicgPyBvcHRpb25zLnJlc3RMZW5ndGggOiAxOwogICAgICB0aGlzLnN0aWZmbmVzcyA9IG9wdGlvbnMuc3RpZmZuZXNzIHx8IDEwMDsKICAgICAgdGhpcy5kYW1waW5nID0gb3B0aW9ucy5kYW1waW5nIHx8IDE7CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQSkgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JBLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5sb2NhbEFuY2hvckIpIHsKICAgICAgICB0aGlzLmxvY2FsQW5jaG9yQi5jb3B5KG9wdGlvbnMubG9jYWxBbmNob3JCKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMud29ybGRBbmNob3JBKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZEFuY2hvckEob3B0aW9ucy53b3JsZEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckIpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQihvcHRpb25zLndvcmxkQW5jaG9yQik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBBLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JBLCB0aGlzLmxvY2FsQW5jaG9yQSk7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgdXNpbmcgd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgc2V0V29ybGRBbmNob3JCKHdvcmxkQW5jaG9yQikgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkQW5jaG9yQiwgdGhpcy5sb2NhbEFuY2hvckIpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JBKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlBLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JBLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEIsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JCKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0aGUgc3ByaW5nIGZvcmNlIHRvIHRoZSBjb25uZWN0ZWQgYm9kaWVzLgogICAgICovCgoKICAgIGFwcGx5Rm9yY2UoKSB7CiAgICAgIGNvbnN0IGsgPSB0aGlzLnN0aWZmbmVzczsKICAgICAgY29uc3QgZCA9IHRoaXMuZGFtcGluZzsKICAgICAgY29uc3QgbCA9IHRoaXMucmVzdExlbmd0aDsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHIgPSBhcHBseUZvcmNlX3I7CiAgICAgIGNvbnN0IHJfdW5pdCA9IGFwcGx5Rm9yY2Vfcl91bml0OwogICAgICBjb25zdCB1ID0gYXBwbHlGb3JjZV91OwogICAgICBjb25zdCBmID0gYXBwbHlGb3JjZV9mOwogICAgICBjb25zdCB0bXAgPSBhcHBseUZvcmNlX3RtcDsKICAgICAgY29uc3Qgd29ybGRBbmNob3JBID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckE7CiAgICAgIGNvbnN0IHdvcmxkQW5jaG9yQiA9IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCOwogICAgICBjb25zdCByaSA9IGFwcGx5Rm9yY2Vfcmk7CiAgICAgIGNvbnN0IHJqID0gYXBwbHlGb3JjZV9yajsKICAgICAgY29uc3QgcmlfeF9mID0gYXBwbHlGb3JjZV9yaV94X2Y7CiAgICAgIGNvbnN0IHJqX3hfZiA9IGFwcGx5Rm9yY2VfcmpfeF9mOyAvLyBHZXQgd29ybGQgYW5jaG9ycwoKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKTsKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKTsgLy8gR2V0IG9mZnNldCBwb2ludHMKCiAgICAgIHdvcmxkQW5jaG9yQS52c3ViKGJvZHlBLnBvc2l0aW9uLCByaSk7CiAgICAgIHdvcmxkQW5jaG9yQi52c3ViKGJvZHlCLnBvc2l0aW9uLCByaik7IC8vIENvbXB1dGUgZGlzdGFuY2UgdmVjdG9yIGJldHdlZW4gd29ybGQgYW5jaG9yIHBvaW50cwoKICAgICAgd29ybGRBbmNob3JCLnZzdWIod29ybGRBbmNob3JBLCByKTsKICAgICAgY29uc3QgcmxlbiA9IHIubGVuZ3RoKCk7CiAgICAgIHJfdW5pdC5jb3B5KHIpOwogICAgICByX3VuaXQubm9ybWFsaXplKCk7IC8vIENvbXB1dGUgcmVsYXRpdmUgdmVsb2NpdHkgb2YgdGhlIGFuY2hvciBwb2ludHMsIHUKCiAgICAgIGJvZHlCLnZlbG9jaXR5LnZzdWIoYm9keUEudmVsb2NpdHksIHUpOyAvLyBBZGQgcm90YXRpb25hbCB2ZWxvY2l0eQoKICAgICAgYm9keUIuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJqLCB0bXApOwogICAgICB1LnZhZGQodG1wLCB1KTsKICAgICAgYm9keUEuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJpLCB0bXApOwogICAgICB1LnZzdWIodG1wLCB1KTsgLy8gRiA9IC0gayAqICggeCAtIEwgKSAtIEQgKiAoIHUgKQoKICAgICAgcl91bml0LnNjYWxlKC1rICogKHJsZW4gLSBsKSAtIGQgKiB1LmRvdChyX3VuaXQpLCBmKTsgLy8gQWRkIGZvcmNlcyB0byBib2RpZXMKCiAgICAgIGJvZHlBLmZvcmNlLnZzdWIoZiwgYm9keUEuZm9yY2UpOwogICAgICBib2R5Qi5mb3JjZS52YWRkKGYsIGJvZHlCLmZvcmNlKTsgLy8gQW5ndWxhciBmb3JjZQoKICAgICAgcmkuY3Jvc3MoZiwgcmlfeF9mKTsKICAgICAgcmouY3Jvc3MoZiwgcmpfeF9mKTsKICAgICAgYm9keUEudG9ycXVlLnZzdWIocmlfeF9mLCBib2R5QS50b3JxdWUpOwogICAgICBib2R5Qi50b3JxdWUudmFkZChyal94X2YsIGJvZHlCLnRvcnF1ZSk7CiAgICB9CgogIH0KICBjb25zdCBhcHBseUZvcmNlX3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfcl91bml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3UgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yal94X2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdG1wID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogV2hlZWxJbmZvCiAgICovCiAgY2xhc3MgV2hlZWxJbmZvIHsKICAgIC8qKgogICAgICogTWF4IHRyYXZlbCBkaXN0YW5jZSBvZiB0aGUgc3VzcGVuc2lvbiwgaW4gbWV0ZXJzLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBTcGVlZCB0byBhcHBseSB0byB0aGUgd2hlZWwgcm90YXRpb24gd2hlbiB0aGUgd2hlZWwgaXMgc2xpZGluZy4KICAgICAqIEBkZWZhdWx0IC0wLjEKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIGN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlkaW5nCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gcG9pbnQsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgY2hhc3NpcyBib2R5IGZyYW1lLgogICAgICovCgogICAgLyoqCiAgICAgKiBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZUxvY2FsCiAgICAgKi8KCiAgICAvKioKICAgICAqIGF4bGVXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uUmVzdExlbmd0aAogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTWF4TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAyCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJhZGl1cwogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uU3RpZmZuZXNzCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGFtcGluZ0NvbXByZXNzaW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nUmVsYXhhdGlvbgogICAgICogQGRlZmF1bHQgMTAKICAgICAqLwoKICAgIC8qKgogICAgICogZnJpY3Rpb25TbGlwCiAgICAgKiBAZGVmYXVsdCAxMC41CiAgICAgKi8KCiAgICAvKiogZm9yd2FyZEFjY2VsZXJhdGlvbiAqLwoKICAgIC8qKiBzaWRlQWNjZWxlcmF0aW9uICovCgogICAgLyoqCiAgICAgKiBzdGVlcmluZwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiB2YWx1ZSwgaW4gcmFkaWFucy4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGVsdGFSb3RhdGlvbgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiByb2xsSW5mbHVlbmNlCiAgICAgKiBAZGVmYXVsdCAwLjAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heFN1c3BlbnNpb25Gb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBlbmdpbmVGb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBicmFrZQogICAgICovCgogICAgLyoqCiAgICAgKiBpc0Zyb250V2hlZWwKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5CiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25Gb3JjZQogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlwSW5mbwogICAgICovCgogICAgLyoqCiAgICAgKiBza2lkSW5mbwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNpZGVJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGZvcndhcmRJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSByZXN1bHQgZnJvbSByYXljYXN0aW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVlbCB3b3JsZCB0cmFuc2Zvcm0uCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzSW5Db250YWN0CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkOiBuZXcgVmVjMygpLAogICAgICAgIGRpcmVjdGlvbkxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGRpcmVjdGlvbldvcmxkOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBheGxlV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgc3VzcGVuc2lvblJlc3RMZW5ndGg6IDEsCiAgICAgICAgc3VzcGVuc2lvbk1heExlbmd0aDogMiwKICAgICAgICByYWRpdXM6IDEsCiAgICAgICAgc3VzcGVuc2lvblN0aWZmbmVzczogMTAwLAogICAgICAgIGRhbXBpbmdDb21wcmVzc2lvbjogMTAsCiAgICAgICAgZGFtcGluZ1JlbGF4YXRpb246IDEwLAogICAgICAgIGZyaWN0aW9uU2xpcDogMTAuNSwKICAgICAgICBmb3J3YXJkQWNjZWxlcmF0aW9uOiAxLAogICAgICAgIHNpZGVBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc3RlZXJpbmc6IDAsCiAgICAgICAgcm90YXRpb246IDAsCiAgICAgICAgZGVsdGFSb3RhdGlvbjogMCwKICAgICAgICByb2xsSW5mbHVlbmNlOiAwLjAxLAogICAgICAgIG1heFN1c3BlbnNpb25Gb3JjZTogTnVtYmVyLk1BWF9WQUxVRSwKICAgICAgICBpc0Zyb250V2hlZWw6IHRydWUsCiAgICAgICAgY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOiAxLAogICAgICAgIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OiAwLAogICAgICAgIHN1c3BlbnNpb25Gb3JjZTogMCwKICAgICAgICBzbGlwSW5mbzogMCwKICAgICAgICBza2lkSW5mbzogMCwKICAgICAgICBzdXNwZW5zaW9uTGVuZ3RoOiAwLAogICAgICAgIG1heFN1c3BlbnNpb25UcmF2ZWw6IDEsCiAgICAgICAgdXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogZmFsc2UsCiAgICAgICAgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogLTAuMQogICAgICB9KTsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uVHJhdmVsID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICB0aGlzLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgPSBvcHRpb25zLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQ7CiAgICAgIHRoaXMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsID0gb3B0aW9ucy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbkxvY2FsID0gb3B0aW9ucy5kaXJlY3Rpb25Mb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbldvcmxkID0gb3B0aW9ucy5kaXJlY3Rpb25Xb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLmF4bGVMb2NhbCA9IG9wdGlvbnMuYXhsZUxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZVdvcmxkID0gb3B0aW9ucy5heGxlV29ybGQuY2xvbmUoKTsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aCA9IG9wdGlvbnMuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgIHRoaXMuc3VzcGVuc2lvbk1heExlbmd0aCA9IG9wdGlvbnMuc3VzcGVuc2lvbk1heExlbmd0aDsKICAgICAgdGhpcy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1czsKICAgICAgdGhpcy5zdXNwZW5zaW9uU3RpZmZuZXNzID0gb3B0aW9ucy5zdXNwZW5zaW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmRhbXBpbmdDb21wcmVzc2lvbiA9IG9wdGlvbnMuZGFtcGluZ0NvbXByZXNzaW9uOwogICAgICB0aGlzLmRhbXBpbmdSZWxheGF0aW9uID0gb3B0aW9ucy5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgdGhpcy5mcmljdGlvblNsaXAgPSBvcHRpb25zLmZyaWN0aW9uU2xpcDsKICAgICAgdGhpcy5mb3J3YXJkQWNjZWxlcmF0aW9uID0gb3B0aW9ucy5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICB0aGlzLnNpZGVBY2NlbGVyYXRpb24gPSBvcHRpb25zLnNpZGVBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc3RlZXJpbmcgPSAwOwogICAgICB0aGlzLnJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5yb2xsSW5mbHVlbmNlID0gb3B0aW9ucy5yb2xsSW5mbHVlbmNlOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25Gb3JjZSA9IG9wdGlvbnMubWF4U3VzcGVuc2lvbkZvcmNlOwogICAgICB0aGlzLmVuZ2luZUZvcmNlID0gMDsKICAgICAgdGhpcy5icmFrZSA9IDA7CiAgICAgIHRoaXMuaXNGcm9udFdoZWVsID0gb3B0aW9ucy5pc0Zyb250V2hlZWw7CiAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMTsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgdGhpcy5zbGlwSW5mbyA9IDA7CiAgICAgIHRoaXMuc2tpZEluZm8gPSAwOwogICAgICB0aGlzLnN1c3BlbnNpb25MZW5ndGggPSAwOwogICAgICB0aGlzLnNpZGVJbXB1bHNlID0gMDsKICAgICAgdGhpcy5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgIHRoaXMucmF5Y2FzdFJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMud29ybGRUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgICAgIHRoaXMuaXNJbkNvbnRhY3QgPSBmYWxzZTsKICAgIH0KCiAgICB1cGRhdGVXaGVlbChjaGFzc2lzKSB7CiAgICAgIGNvbnN0IHJheWNhc3RSZXN1bHQgPSB0aGlzLnJheWNhc3RSZXN1bHQ7CgogICAgICBpZiAodGhpcy5pc0luQ29udGFjdCkgewogICAgICAgIGNvbnN0IHByb2plY3QgPSByYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChyYXljYXN0UmVzdWx0LmRpcmVjdGlvbldvcmxkKTsKICAgICAgICByYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXMuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocmVscG9zLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKHByb2plY3QgPj0gLTAuMSkgewogICAgICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIHByb2plY3Q7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gcHJvalZlbCAqIGludjsKICAgICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBOb3QgaW4gY29udGFjdCA6IHBvc2l0aW9uIHdoZWVsIGluIGEgbmljZSAocmVzdCBsZW5ndGgpIHBvc2l0aW9uCiAgICAgICAgcmF5Y2FzdFJlc3VsdC5zdXNwZW5zaW9uTGVuZ3RoID0gdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQuc2NhbGUoLTEsIHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQpOwogICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVscG9zID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogVmVoaWNsZSBoZWxwZXIgY2xhc3MgdGhhdCBjYXN0cyByYXlzIGZyb20gdGhlIHdoZWVsIHBvc2l0aW9ucyB0b3dhcmRzIHRoZSBncm91bmQgYW5kIGFwcGxpZXMgZm9yY2VzLgogICAqLwogIGNsYXNzIFJheWNhc3RWZWhpY2xlIHsKICAgIC8qKiBUaGUgY2FyIGNoYXNzaXMgYm9keS4gKi8KCiAgICAvKiogVGhlIHdoZWVscy4gKi8KCiAgICAvKiogV2lsbCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGUgY2FyIGlzIHNsaWRpbmcuICovCgogICAgLyoqIEluZGV4IG9mIHRoZSByaWdodCBheGlzLiB4PTAsIHk9MSwgej0yICovCgogICAgLyoqIEluZGV4IG9mIHRoZSBmb3J3YXJkIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHVwIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogVGhlIGNvbnN0cmFpbnRzLiAqLwoKICAgIC8qKiBPcHRpb25hbCBwcmUtc3RlcCBjYWxsYmFjay4gKi8KCiAgICAvKiogTnVtYmVyIG9mIHdoZWVscyBvbiB0aGUgZ3JvdW5kLiAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gb3B0aW9ucy5jaGFzc2lzQm9keTsKICAgICAgdGhpcy53aGVlbEluZm9zID0gW107CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4UmlnaHRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgOiAyOwogICAgICB0aGlzLmluZGV4Rm9yd2FyZEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhGb3J3YXJkQXhpcyA6IDA7CiAgICAgIHRoaXMuaW5kZXhVcEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleFVwQXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4VXBBeGlzIDogMTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7fTsKCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDA7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3aGVlbC4gRm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcHRpb25zLCBzZWUgYFdoZWVsSW5mb2AuCiAgICAgKi8KCgogICAgYWRkV2hlZWwob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBpbmZvID0gbmV3IFdoZWVsSW5mbyhvcHRpb25zKTsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLndoZWVsSW5mb3MubGVuZ3RoOwogICAgICB0aGlzLndoZWVsSW5mb3MucHVzaChpbmZvKTsKICAgICAgcmV0dXJuIGluZGV4OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHN0ZWVyaW5nIHZhbHVlIG9mIGEgd2hlZWwuCiAgICAgKi8KCgogICAgc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgd2hlZWwuc3RlZXJpbmcgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSB3aGVlbCBmb3JjZSB0byBhcHBseSBvbiBvbmUgb2YgdGhlIHdoZWVscyBlYWNoIHRpbWUgc3RlcAogICAgICovCgoKICAgIGFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmVuZ2luZUZvcmNlID0gdmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYnJha2luZyBmb3JjZSBvZiBhIHdoZWVsCiAgICAgKi8KCgogICAgc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmJyYWtlID0gYnJha2U7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCB0aGUgdmVoaWNsZSBpbmNsdWRpbmcgaXRzIGNvbnN0cmFpbnRzIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICBhZGRUb1dvcmxkKHdvcmxkKSB7CiAgICAgIHdvcmxkLmFkZEJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7CiAgICAgICAgdGhhdC51cGRhdGVWZWhpY2xlKHdvcmxkLmR0KTsKICAgICAgfTsKCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG9uZSBvZiB0aGUgd2hlZWwgYXhsZXMsIHdvcmxkLW9yaWVudGVkLgogICAgICovCgoKICAgIGdldFZlaGljbGVBeGlzV29ybGQoYXhpc0luZGV4LCByZXN1bHQpIHsKICAgICAgcmVzdWx0LnNldChheGlzSW5kZXggPT09IDAgPyAxIDogMCwgYXhpc0luZGV4ID09PSAxID8gMSA6IDAsIGF4aXNJbmRleCA9PT0gMiA/IDEgOiAwKTsKICAgICAgdGhpcy5jaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVzdWx0LCByZXN1bHQpOwogICAgfQoKICAgIHVwZGF0ZVZlaGljbGUodGltZVN0ZXApIHsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtKGkpOwogICAgICB9CgogICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgPSAzLjYgKiBjaGFzc2lzQm9keS52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZm9yd2FyZFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRWZWhpY2xlQXhpc1dvcmxkKHRoaXMuaW5kZXhGb3J3YXJkQXhpcywgZm9yd2FyZFdvcmxkKTsKCiAgICAgIGlmIChmb3J3YXJkV29ybGQuZG90KGNoYXNzaXNCb2R5LnZlbG9jaXR5KSA8IDApIHsKICAgICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgKj0gLTE7CiAgICAgIH0gLy8gc2ltdWxhdGUgc3VzcGVuc2lvbgoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLmNhc3RSYXkod2hlZWxJbmZvc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlU3VzcGVuc2lvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGltcHVsc2UgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIC8vYXBwbHkgc3VzcGVuc2lvbiBmb3JjZQogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBsZXQgc3VzcGVuc2lvbkZvcmNlID0gd2hlZWwuc3VzcGVuc2lvbkZvcmNlOwoKICAgICAgICBpZiAoc3VzcGVuc2lvbkZvcmNlID4gd2hlZWwubWF4U3VzcGVuc2lvbkZvcmNlKSB7CiAgICAgICAgICBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwLCBpbXB1bHNlKTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVscG9zKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVGcmljdGlvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2ogPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBmd2QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB2ZWwgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsgLy9jb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwogICAgICAgIC8vd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbHBvcyk7CgogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgdmVsKTsgLy8gSGFjayB0byBnZXQgdGhlIHJvdGF0aW9uIGluIHRoZSBjb3JyZWN0IGRpcmVjdGlvbgoKICAgICAgICBsZXQgbSA9IDE7CgogICAgICAgIHN3aXRjaCAodGhpcy5pbmRleFVwQXhpcykgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBtID0gLTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvaiA9IGZ3ZC5kb3Qod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHByb2osIGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2opOwogICAgICAgICAgZndkLnZzdWIoaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiwgZndkKTsKICAgICAgICAgIGNvbnN0IHByb2oyID0gZndkLmRvdCh2ZWwpOwogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IG0gKiBwcm9qMiAqIHRpbWVTdGVwIC8gd2hlZWwucmFkaXVzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCh3aGVlbC5zbGlkaW5nIHx8ICF3aGVlbC5pc0luQ29udGFjdCkgJiYgd2hlZWwuZW5naW5lRm9yY2UgIT09IDAgJiYgd2hlZWwudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCkgewogICAgICAgICAgLy8gQXBwbHkgY3VzdG9tIHJvdGF0aW9uIHdoZW4gYWNjZWxlcmF0aW5nIGFuZCBzbGlkaW5nCiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gKHdoZWVsLmVuZ2luZUZvcmNlID4gMCA/IDEgOiAtMSkgKiB3aGVlbC5jdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkICogdGltZVN0ZXA7CiAgICAgICAgfSAvLyBMb2NrIHdoZWVscwoKCiAgICAgICAgaWYgKE1hdGguYWJzKHdoZWVsLmJyYWtlKSA+IE1hdGguYWJzKHdoZWVsLmVuZ2luZUZvcmNlKSkgewogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IDA7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yb3RhdGlvbiArPSB3aGVlbC5kZWx0YVJvdGF0aW9uOyAvLyBVc2UgdGhlIG9sZCB2YWx1ZQoKICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uICo9IDAuOTk7IC8vIGRhbXBpbmcgb2Ygcm90YXRpb24gd2hlbiBub3QgaW4gY29udGFjdAogICAgICB9CiAgICB9CgogICAgdXBkYXRlU3VzcGVuc2lvbihkZWx0YVRpbWUpIHsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBjaGFzc2lzTWFzcyA9IGNoYXNzaXNCb2R5Lm1hc3M7CiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgd19pdCA9IDA7IHdfaXQgPCBudW1XaGVlbHM7IHdfaXQrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1t3X2l0XTsKCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICBsZXQgZm9yY2U7IC8vIFNwcmluZwoKICAgICAgICAgIGNvbnN0IHN1c3BfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgICAgICBjb25zdCBjdXJyZW50X2xlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICBjb25zdCBsZW5ndGhfZGlmZiA9IHN1c3BfbGVuZ3RoIC0gY3VycmVudF9sZW5ndGg7CiAgICAgICAgICBmb3JjZSA9IHdoZWVsLnN1c3BlbnNpb25TdGlmZm5lc3MgKiBsZW5ndGhfZGlmZiAqIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbjsgLy8gRGFtcGVyCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkX3JlbF92ZWwgPSB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eTsKICAgICAgICAgIGxldCBzdXNwX2RhbXBpbmc7CgogICAgICAgICAgaWYgKHByb2plY3RlZF9yZWxfdmVsIDwgMCkgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3JjZSAtPSBzdXNwX2RhbXBpbmcgKiBwcm9qZWN0ZWRfcmVsX3ZlbDsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA9IGZvcmNlICogY2hhc3Npc01hc3M7CgogICAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA8IDApIHsKICAgICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlRnJvbVdvcmxkKHdvcmxkKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHM7CiAgICAgIHdvcmxkLnJlbW92ZUJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgfQoKICAgIGNhc3RSYXkod2hlZWwpIHsKICAgICAgY29uc3QgcmF5dmVjdG9yID0gY2FzdFJheV9yYXl2ZWN0b3I7CiAgICAgIGNvbnN0IHRhcmdldCA9IGNhc3RSYXlfdGFyZ2V0OwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGxldCBkZXB0aCA9IC0xOwogICAgICBjb25zdCByYXlsZW4gPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLnJhZGl1czsKICAgICAgd2hlZWwuZGlyZWN0aW9uV29ybGQuc2NhbGUocmF5bGVuLCByYXl2ZWN0b3IpOwogICAgICBjb25zdCBzb3VyY2UgPSB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ7CiAgICAgIHNvdXJjZS52YWRkKHJheXZlY3RvciwgdGFyZ2V0KTsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQ7CiAgICAgIHJheWNhc3RSZXN1bHQucmVzZXQoKTsgLy8gVHVybiBvZmYgcmF5IGNvbGxpc2lvbiB3aXRoIHRoZSBjaGFzc2lzIHRlbXBvcmFyaWx5CgogICAgICBjb25zdCBvbGRTdGF0ZSA9IGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGZhbHNlOyAvLyBDYXN0IHJheSBhZ2FpbnN0IHdvcmxkCgogICAgICB0aGlzLndvcmxkLnJheVRlc3Qoc291cmNlLCB0YXJnZXQsIHJheWNhc3RSZXN1bHQpOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IG9sZFN0YXRlOwogICAgICBjb25zdCBvYmplY3QgPSByYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuZ3JvdW5kT2JqZWN0ID0gMDsKCiAgICAgIGlmIChvYmplY3QpIHsKICAgICAgICBkZXB0aCA9IHJheWNhc3RSZXN1bHQuZGlzdGFuY2U7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgd2hlZWwuaXNJbkNvbnRhY3QgPSB0cnVlOwogICAgICAgIGNvbnN0IGhpdERpc3RhbmNlID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gaGl0RGlzdGFuY2UgLSB3aGVlbC5yYWRpdXM7IC8vIGNsYW1wIG9uIG1heCBzdXNwZW5zaW9uIHRyYXZlbAoKICAgICAgICBjb25zdCBtaW5TdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggLSB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIGNvbnN0IG1heFN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoIDwgbWluU3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1pblN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA+IG1heFN1c3BlbnNpb25MZW5ndGgpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBtYXhTdXNwZW5zaW9uTGVuZ3RoOwogICAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5yZXNldCgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVub21pbmF0b3IgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdCh3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgICAgY29uc3QgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQgPSBuZXcgVmVjMygpOwogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwogICAgICAgIGNvbnN0IHByb2pWZWwgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CgogICAgICAgIGlmIChkZW5vbWluYXRvciA+PSAtMC4xKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIGRlbm9taW5hdG9yOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL3B1dCB3aGVlbCBpbmZvIGFzIGluIHJlc3QgcG9zaXRpb24KICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggKyAwICogd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CgogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CgogICAgdXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCkgewogICAgICB3aGVlbC5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNoYXNzaXNCb2R5LnBvaW50VG9Xb3JsZEZyYW1lKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwgd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmRpcmVjdGlvbkxvY2FsLCB3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZSh3aGVlbC5heGxlTG9jYWwsIHdoZWVsLmF4bGVXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBvbmUgb2YgdGhlIHdoZWVsIHRyYW5zZm9ybS4KICAgICAqIE5vdGUgd2hlbiByZW5kZXJpbmcgd2hlZWxzOiBkdXJpbmcgZWFjaCBzdGVwLCB3aGVlbCB0cmFuc2Zvcm1zIGFyZSB1cGRhdGVkIEJFRk9SRSB0aGUgY2hhc3NpczsgaWUuIHRoZWlyIHBvc2l0aW9uIGJlY29tZXMgaW52YWxpZCBhZnRlciB0aGUgc3RlcC4gVGh1cyB3aGVuIHlvdSByZW5kZXIgd2hlZWxzLCB5b3UgbXVzdCB1cGRhdGUgd2hlZWwgdHJhbnNmb3JtcyBiZWZvcmUgcmVuZGVyaW5nIHRoZW0uIFNlZSByYXljYXN0VmVoaWNsZSBkZW1vIGZvciBhbiBleGFtcGxlLgogICAgICogQHBhcmFtIHdoZWVsSW5kZXggVGhlIHdoZWVsIGluZGV4IHRvIHVwZGF0ZS4KICAgICAqLwoKCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybSh3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHVwID0gdG1wVmVjNDsKICAgICAgY29uc3QgcmlnaHQgPSB0bXBWZWM1OwogICAgICBjb25zdCBmd2QgPSB0bXBWZWM2OwogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgdGhpcy51cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKTsKICAgICAgd2hlZWwuZGlyZWN0aW9uTG9jYWwuc2NhbGUoLTEsIHVwKTsKICAgICAgcmlnaHQuY29weSh3aGVlbC5heGxlTG9jYWwpOwogICAgICB1cC5jcm9zcyhyaWdodCwgZndkKTsKICAgICAgZndkLm5vcm1hbGl6ZSgpOwogICAgICByaWdodC5ub3JtYWxpemUoKTsgLy8gUm90YXRlIGFyb3VuZCBzdGVlcmluZyBvdmVyIHRoZSB3aGVlbEF4bGUKCiAgICAgIGNvbnN0IHN0ZWVyaW5nID0gd2hlZWwuc3RlZXJpbmc7CiAgICAgIGNvbnN0IHN0ZWVyaW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgc3RlZXJpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZSh1cCwgc3RlZXJpbmcpOwogICAgICBjb25zdCByb3RhdGluZ09ybiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHJvdGF0aW5nT3JuLnNldEZyb21BeGlzQW5nbGUocmlnaHQsIHdoZWVsLnJvdGF0aW9uKTsgLy8gV29ybGQgcm90YXRpb24gb2YgdGhlIHdoZWVsCgogICAgICBjb25zdCBxID0gd2hlZWwud29ybGRUcmFuc2Zvcm0ucXVhdGVybmlvbjsKICAgICAgdGhpcy5jaGFzc2lzQm9keS5xdWF0ZXJuaW9uLm11bHQoc3RlZXJpbmdPcm4sIHEpOwogICAgICBxLm11bHQocm90YXRpbmdPcm4sIHEpOwogICAgICBxLm5vcm1hbGl6ZSgpOyAvLyB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHAgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5wb3NpdGlvbjsKICAgICAgcC5jb3B5KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgcC5zY2FsZSh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoLCBwKTsKICAgICAgcC52YWRkKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgcCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgdHJhbnNmb3JtIG9mIG9uZSBvZiB0aGUgd2hlZWxzCiAgICAgKi8KCgogICAgZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbEluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0ud29ybGRUcmFuc2Zvcm07CiAgICB9CgogICAgdXBkYXRlRnJpY3Rpb24odGltZVN0ZXApIHsKICAgICAgY29uc3Qgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qOyAvL2NhbGN1bGF0ZSB0aGUgaW1wdWxzZSwgc28gdGhhdCB0aGUgd2hlZWxzIGRvbid0IG1vdmUgc2lkZXdhcmRzCgogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBmb3J3YXJkV1MgPSB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1M7CiAgICAgIGNvbnN0IGF4bGUgPSB1cGRhdGVGcmljdGlvbl9heGxlOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kKys7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSAwOwoKICAgICAgICBpZiAoIWZvcndhcmRXU1tpXSkgewogICAgICAgICAgZm9yd2FyZFdTW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CgogICAgICAgIGlmICghYXhsZVtpXSkgewogICAgICAgICAgYXhsZVtpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgYXhsZWkgPSBheGxlW2ldOwogICAgICAgICAgY29uc3Qgd2hlZWxUcmFucyA9IHRoaXMuZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZChpKTsgLy8gR2V0IHdvcmxkIGF4bGUKCiAgICAgICAgICB3aGVlbFRyYW5zLnZlY3RvclRvV29ybGRGcmFtZShkaXJlY3Rpb25zW3RoaXMuaW5kZXhSaWdodEF4aXNdLCBheGxlaSk7CiAgICAgICAgICBjb25zdCBzdXJmTm9ybWFsV1MgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkOwogICAgICAgICAgY29uc3QgcHJvaiA9IGF4bGVpLmRvdChzdXJmTm9ybWFsV1MpOwogICAgICAgICAgc3VyZk5vcm1hbFdTLnNjYWxlKHByb2osIHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaik7CiAgICAgICAgICBheGxlaS52c3ViKHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaiwgYXhsZWkpOwogICAgICAgICAgYXhsZWkubm9ybWFsaXplKCk7CiAgICAgICAgICBzdXJmTm9ybWFsV1MuY3Jvc3MoYXhsZWksIGZvcndhcmRXU1tpXSk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0ubm9ybWFsaXplKCk7CiAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWwoY2hhc3Npc0JvZHksIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGF4bGVpKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHNpZGVGcmljdGlvblN0aWZmbmVzczI7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBzaWRlRmFjdG9yID0gMTsKICAgICAgY29uc3QgZndkRmFjdG9yID0gMC41OwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwogICAgICAgIGxldCByb2xsaW5nRnJpY3Rpb24gPSAwOwogICAgICAgIHdoZWVsLnNsaXBJbmZvID0gMTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgZGVmYXVsdFJvbGxpbmdGcmljdGlvbkltcHVsc2UgPSAwOwogICAgICAgICAgY29uc3QgbWF4SW1wdWxzZSA9IHdoZWVsLmJyYWtlID8gd2hlZWwuYnJha2UgOiBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZTsgLy8gYnRXaGVlbENvbnRhY3RQb2ludCBjb250YWN0UHQoY2hhc3Npc0JvZHksZ3JvdW5kT2JqZWN0LHdoZWVsSW5mcmF5Y2FzdEluZm8uaGl0UG9pbnRXb3JsZCxmb3J3YXJkV1Nbd2hlZWxdLG1heEltcHVsc2UpOwogICAgICAgICAgLy8gcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjb250YWN0UHQpOwoKICAgICAgICAgIHJvbGxpbmdGcmljdGlvbiA9IGNhbGNSb2xsaW5nRnJpY3Rpb24oY2hhc3Npc0JvZHksIGdyb3VuZE9iamVjdCwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBmb3J3YXJkV1NbaV0sIG1heEltcHVsc2UpOwogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uICs9IHdoZWVsLmVuZ2luZUZvcmNlICogdGltZVN0ZXA7IC8vIHJvbGxpbmdGcmljdGlvbiA9IDA7CgogICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4SW1wdWxzZSAvIHJvbGxpbmdGcmljdGlvbjsKICAgICAgICAgIHdoZWVsLnNsaXBJbmZvICo9IGZhY3RvcjsKICAgICAgICB9IC8vc3dpdGNoIGJldHdlZW4gYWN0aXZlIHJvbGxpbmcgKHRocm90dGxlKSwgYnJha2luZyBhbmQgbm9uLWFjdGl2ZSByb2xsaW5nIGZyaWN0aW9uIChudGhyb3R0bGUvYnJlYWspCgoKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuc2tpZEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CiAgICAgICAgICBjb25zdCBtYXhpbXAgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgKiB0aW1lU3RlcCAqIHdoZWVsLmZyaWN0aW9uU2xpcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNpZGUgPSBtYXhpbXA7CiAgICAgICAgICBjb25zdCBtYXhpbXBTcXVhcmVkID0gbWF4aW1wICogbWF4aW1wU2lkZTsKICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gcm9sbGluZ0ZyaWN0aW9uOyAvL3doZWVsSW5mby5lbmdpbmVGb3JjZSogdGltZVN0ZXA7CgogICAgICAgICAgY29uc3QgeCA9IHdoZWVsLmZvcndhcmRJbXB1bHNlICogZndkRmFjdG9yIC8gd2hlZWwuZm9yd2FyZEFjY2VsZXJhdGlvbjsKICAgICAgICAgIGNvbnN0IHkgPSB3aGVlbC5zaWRlSW1wdWxzZSAqIHNpZGVGYWN0b3IgLyB3aGVlbC5zaWRlQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgaW1wdWxzZVNxdWFyZWQgPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgd2hlZWwuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChpbXB1bHNlU3F1YXJlZCA+IG1heGltcFNxdWFyZWQpIHsKICAgICAgICAgICAgdGhpcy5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgd2hlZWwuc2xpZGluZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG1heGltcCAvIE1hdGguc3FydChpbXB1bHNlU3F1YXJlZCk7CiAgICAgICAgICAgIHdoZWVsLnNraWRJbmZvICo9IGZhY3RvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsaWRpbmcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CgogICAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICAgIGlmICh3aGVlbC5za2lkSW5mbyA8IDEpIHsKICAgICAgICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBhcHBseSB0aGUgaW1wdWxzZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IHJlbF9wb3MgPSBuZXcgVmVjMygpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxfcG9zKTsgLy8gY2Fubm9ucyBhcHBseWltcHVsc2UgaXMgdXNpbmcgd29ybGQgY29vcmQgZm9yIHRoZSBwb3NpdGlvbgogICAgICAgIC8vcmVsX3Bvcy5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgIGlmICh3aGVlbC5mb3J3YXJkSW1wdWxzZSAhPT0gMCkgewogICAgICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0uc2NhbGUod2hlZWwuZm9yd2FyZEltcHVsc2UsIGltcHVsc2UpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbF9wb3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgICBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1Yihncm91bmRPYmplY3QucG9zaXRpb24sIHJlbF9wb3MyKTsgLy9yZWxfcG9zMi5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgICAgY29uc3Qgc2lkZUltcCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBheGxlW2ldLnNjYWxlKHdoZWVsLnNpZGVJbXB1bHNlLCBzaWRlSW1wKTsgLy8gU2NhbGUgdGhlIHJlbGF0aXZlIHBvc2l0aW9uIGluIHRoZSB1cCBkaXJlY3Rpb24gd2l0aCByb2xsSW5mbHVlbmNlLgogICAgICAgICAgLy8gSWYgcm9sbEluZmx1ZW5jZSBpcyAxLCB0aGUgaW1wdWxzZSB3aWxsIGJlIGFwcGxpZWQgb24gdGhlIGhpdFBvaW50IChlYXN5IHRvIHJvbGwgb3ZlciksIGlmIGl0IGlzIHplcm8gaXQgd2lsbCBiZSBhcHBsaWVkIGluIHRoZSBzYW1lIHBsYW5lIGFzIHRoZSBjZW50ZXIgb2YgbWFzcyAobm90IGVhc3kgdG8gcm9sbCBvdmVyKS4KCiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb0xvY2FsRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICByZWxfcG9zWyd4eXonW3RoaXMuaW5kZXhVcEF4aXNdXSAqPSB3aGVlbC5yb2xsSW5mbHVlbmNlOwogICAgICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHJlbF9wb3MsIHJlbF9wb3MpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MpOyAvL2FwcGx5IGZyaWN0aW9uIGltcHVsc2Ugb24gdGhlIGdyb3VuZAoKICAgICAgICAgIHNpZGVJbXAuc2NhbGUoLTEsIHNpZGVJbXApOwogICAgICAgICAgZ3JvdW5kT2JqZWN0LmFwcGx5SW1wdWxzZShzaWRlSW1wLCByZWxfcG9zMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM0ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM1ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM2ID0gbmV3IFZlYzMoKTsKICBuZXcgUmF5KCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3JheXZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FzdFJheV90YXJnZXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGRpcmVjdGlvbnMgPSBbbmV3IFZlYzMoMSwgMCwgMCksIG5ldyBWZWMzKDAsIDEsIDApLCBuZXcgVmVjMygwLCAwLCAxKV07CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gbmV3IFZlYzMoKTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9heGxlID0gW107CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fZm9yd2FyZFdTID0gW107CiAgY29uc3Qgc2lkZUZyaWN0aW9uU3RpZmZuZXNzMiA9IDE7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY2FsY1JvbGxpbmdGcmljdGlvbihib2R5MCwgYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQsIG1heEltcHVsc2UpIHsKICAgIGxldCBqMSA9IDA7CiAgICBjb25zdCBjb250YWN0UG9zV29ybGQgPSBmcmljdGlvblBvc1dvcmxkOyAvLyBjb25zdCByZWxfcG9zMSA9IG5ldyBWZWMzKCk7CiAgICAvLyBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CgogICAgY29uc3QgdmVsMSA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMTsKICAgIGNvbnN0IHZlbDIgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDsgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTAucG9zaXRpb24sIHJlbF9wb3MxKTsKICAgIC8vIGNvbnRhY3RQb3NXb3JsZC52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMik7CgogICAgYm9keTAuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwxKTsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KGNvbnRhY3RQb3NXb3JsZCwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHZyZWwgPSBmcmljdGlvbkRpcmVjdGlvbldvcmxkLmRvdCh2ZWwpOwogICAgY29uc3QgZGVub20wID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5MCwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCk7CiAgICBjb25zdCBkZW5vbTEgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkxLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IHJlbGF4YXRpb24gPSAxOwogICAgY29uc3QgamFjRGlhZ0FCSW52ID0gcmVsYXhhdGlvbiAvIChkZW5vbTAgKyBkZW5vbTEpOyAvLyBjYWxjdWxhdGUgaiB0aGF0IG1vdmVzIHVzIHRvIHplcm8gcmVsYXRpdmUgdmVsb2NpdHkKCiAgICBqMSA9IC12cmVsICogamFjRGlhZ0FCSW52OwoKICAgIGlmIChtYXhJbXB1bHNlIDwgajEpIHsKICAgICAgajEgPSBtYXhJbXB1bHNlOwogICAgfQoKICAgIGlmIChqMSA8IC1tYXhJbXB1bHNlKSB7CiAgICAgIGoxID0gLW1heEltcHVsc2U7CiAgICB9CgogICAgcmV0dXJuIGoxOwogIH0KCiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9yMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9jMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfbSA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keSwgcG9zLCBub3JtYWwpIHsKICAgIGNvbnN0IHIwID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9yMDsKICAgIGNvbnN0IGMwID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9jMDsKICAgIGNvbnN0IHZlYyA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfdmVjOwogICAgY29uc3QgbSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfbTsKICAgIHBvcy52c3ViKGJvZHkucG9zaXRpb24sIHIwKTsKICAgIHIwLmNyb3NzKG5vcm1hbCwgYzApOwogICAgYm9keS5pbnZJbmVydGlhV29ybGQudm11bHQoYzAsIG0pOwogICAgbS5jcm9zcyhyMCwgdmVjKTsKICAgIHJldHVybiBib2R5Lmludk1hc3MgKyBub3JtYWwuZG90KHZlYyk7CiAgfQoKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwgPSBuZXcgVmVjMygpOyAvLyBiaWxhdGVyYWwgY29uc3RyYWludCBiZXR3ZWVuIHR3byBkeW5hbWljIG9iamVjdHMKCiAgZnVuY3Rpb24gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChib2R5MSwgcG9zMSwgYm9keTIsIHBvczIsIG5vcm1hbCkgewogICAgY29uc3Qgbm9ybWFsTGVuU3FyID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICBpZiAobm9ybWFsTGVuU3FyID4gMS4xKSB7CiAgICAgIHJldHVybiAwOyAvLyBubyBpbXB1bHNlCiAgICB9IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgIC8vIHBvczEudnN1Yihib2R5MS5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gcG9zMi52c3ViKGJvZHkyLnBvc2l0aW9uLCByZWxfcG9zMik7CgoKICAgIGNvbnN0IHZlbDEgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDE7CiAgICBjb25zdCB2ZWwyID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyOwogICAgY29uc3QgdmVsID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWw7CiAgICBib2R5MS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChwb3MxLCB2ZWwxKTsKICAgIGJvZHkyLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczIsIHZlbDIpOwogICAgdmVsMS52c3ViKHZlbDIsIHZlbCk7CiAgICBjb25zdCByZWxfdmVsID0gbm9ybWFsLmRvdCh2ZWwpOwogICAgY29uc3QgY29udGFjdERhbXBpbmcgPSAwLjI7CiAgICBjb25zdCBtYXNzVGVybSA9IDEgLyAoYm9keTEuaW52TWFzcyArIGJvZHkyLmludk1hc3MpOwogICAgY29uc3QgaW1wdWxzZSA9IC1jb250YWN0RGFtcGluZyAqIHJlbF92ZWwgKiBtYXNzVGVybTsKICAgIHJldHVybiBpbXB1bHNlOwogIH0KCiAgLyoqCiAgICogU3BoZXJpY2FsIHNoYXBlCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzID0gMQogICAqICAgICBjb25zdCBzcGhlcmVTaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKHJhZGl1cykKICAgKiAgICAgY29uc3Qgc3BoZXJlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBzcGhlcmVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHNwaGVyZUJvZHkpCiAgICovCiAgY2xhc3MgU3BoZXJlIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqCiAgICAgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZSwgYSBub24tbmVnYXRpdmUgbnVtYmVyLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihyYWRpdXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlNQSEVSRQogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXMgIT09IHVuZGVmaW5lZCA/IHJhZGl1cyA6IDEuMDsKCiAgICAgIGlmICh0aGlzLnJhZGl1cyA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBzcGhlcmUgcmFkaXVzIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYSAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IEkgPSAyLjAgKiBtYXNzICogdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyAvIDUuMDsKICAgICAgdGFyZ2V0LnggPSBJOwogICAgICB0YXJnZXQueSA9IEk7CiAgICAgIHRhcmdldC56ID0gSTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKiB2b2x1bWUgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIE1hdGgucG93KHRoaXMucmFkaXVzLCAzKSAvIDMuMDsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IHRoaXMucmFkaXVzOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIGNvbnN0IHIgPSB0aGlzLnJhZGl1czsKICAgICAgY29uc3QgYXhlcyA9IFsneCcsICd5JywgJ3onXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGF4ID0gYXhlc1tpXTsKICAgICAgICBtaW5bYXhdID0gcG9zW2F4XSAtIHI7CiAgICAgICAgbWF4W2F4XSA9IHBvc1theF0gKyByOwogICAgICB9CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzIGZvciBjYWxjdWxhdGlvbgoKICBuZXcgVmVjMygpOyAvLyBSZWxhdGl2ZSB2ZWxvY2l0eQoKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEN5bGluZGVyIGNsYXNzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHJhZGl1c1RvcCA9IDAuNQogICAqICAgICBjb25zdCByYWRpdXNCb3R0b20gPSAwLjUKICAgKiAgICAgY29uc3QgaGVpZ2h0ID0gMgogICAqICAgICBjb25zdCBudW1TZWdtZW50cyA9IDEyCiAgICogICAgIGNvbnN0IGN5bGluZGVyU2hhcGUgPSBuZXcgQ0FOTk9OLkN5bGluZGVyKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKQogICAqICAgICBjb25zdCBjeWxpbmRlckJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY3lsaW5kZXJTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGN5bGluZGVyQm9keSkKICAgKi8KCiAgY2xhc3MgQ3lsaW5kZXIgZXh0ZW5kcyBDb252ZXhQb2x5aGVkcm9uIHsKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4gKi8KCiAgICAvKiogVGhlIG51bWJlciBvZiBzZWdtZW50cyB0byBidWlsZCB0aGUgY3lsaW5kZXIgb3V0IG9mLiAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHJhZGl1c1RvcCBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIHJhZGl1c0JvdHRvbSBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4KICAgICAqIEBwYXJhbSBudW1TZWdtZW50cyBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKSB7CiAgICAgIGlmIChyYWRpdXNUb3AgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1c1RvcCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1c0JvdHRvbSA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChoZWlnaHQgPT09IHZvaWQgMCkgewogICAgICAgIGhlaWdodCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChudW1TZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbnVtU2VnbWVudHMgPSA4OwogICAgICB9CgogICAgICBpZiAocmFkaXVzVG9wIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGN5bGluZGVyIHJhZGl1c1RvcCBjYW5ub3QgYmUgbmVnYXRpdmUuJyk7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzQm90dG9tIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgY29uc3QgTiA9IG51bVNlZ21lbnRzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBheGVzID0gW107CiAgICAgIGNvbnN0IGZhY2VzID0gW107CiAgICAgIGNvbnN0IGJvdHRvbWZhY2UgPSBbXTsKICAgICAgY29uc3QgdG9wZmFjZSA9IFtdOwogICAgICBjb25zdCBjb3MgPSBNYXRoLmNvczsKICAgICAgY29uc3Qgc2luID0gTWF0aC5zaW47IC8vIEZpcnN0IGJvdHRvbSBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKDApLCAtaGVpZ2h0ICogMC41LCByYWRpdXNCb3R0b20gKiBjb3MoMCkpKTsKICAgICAgYm90dG9tZmFjZS5wdXNoKDApOyAvLyBGaXJzdCB0b3AgcG9pbnQKCiAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbigwKSwgaGVpZ2h0ICogMC41LCByYWRpdXNUb3AgKiBjb3MoMCkpKTsKICAgICAgdG9wZmFjZS5wdXNoKDEpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCB0aGV0YSA9IDIgKiBNYXRoLlBJIC8gTiAqIChpICsgMSk7CiAgICAgICAgY29uc3QgdGhldGFOID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAwLjUpOwoKICAgICAgICBpZiAoaSA8IE4gLSAxKSB7CiAgICAgICAgICAvLyBCb3R0b20KICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c0JvdHRvbSAqIHNpbih0aGV0YSksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIGJvdHRvbWZhY2UucHVzaCgyICogaSArIDIpOyAvLyBUb3AKCiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNUb3AgKiBzaW4odGhldGEpLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIHRvcGZhY2UucHVzaCgyICogaSArIDMpOyAvLyBGYWNlCgogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMiAqIGkgKyAzLCAyICogaSArIDJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMSwgMF0pOyAvLyBDb25uZWN0CiAgICAgICAgfSAvLyBBeGlzOiB3ZSBjYW4gY3V0IG9mZiBoYWxmIG9mIHRoZW0gaWYgd2UgaGF2ZSBldmVuIG51bWJlciBvZiBzZWdtZW50cwoKCiAgICAgICAgaWYgKE4gJSAyID09PSAxIHx8IGkgPCBOIC8gMikgewogICAgICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKC1zaW4odGhldGFOKSwgMCwgY29zKHRoZXRhTikpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZhY2VzLnB1c2goYm90dG9tZmFjZSk7CiAgICAgIGF4ZXMucHVzaChuZXcgVmVjMygwLCAxLCAwKSk7IC8vIFJlb3JkZXIgdG9wIGZhY2UKCiAgICAgIGNvbnN0IHRlbXAgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wZmFjZS5sZW5ndGg7IGkrKykgewogICAgICAgIHRlbXAucHVzaCh0b3BmYWNlW3RvcGZhY2UubGVuZ3RoIC0gaSAtIDFdKTsKICAgICAgfQoKICAgICAgZmFjZXMucHVzaCh0ZW1wKTsKICAgICAgc3VwZXIoewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMudHlwZSA9IFNoYXBlLnR5cGVzLkNZTElOREVSOwogICAgICB0aGlzLnJhZGl1c1RvcCA9IHJhZGl1c1RvcDsKICAgICAgdGhpcy5yYWRpdXNCb3R0b20gPSByYWRpdXNCb3R0b207CiAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICB0aGlzLm51bVNlZ21lbnRzID0gbnVtU2VnbWVudHM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogUGFydGljbGUgc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGFydGljbGVTaGFwZSA9IG5ldyBDQU5OT04uUGFydGljbGUoKQogICAqICAgICBjb25zdCBwYXJ0aWNsZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogcGFydGljbGVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHBhcnRpY2xlQm9keSkKICAgKi8KICBjbGFzcyBQYXJ0aWNsZSBleHRlbmRzIFNoYXBlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUEFSVElDTEUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gMDsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICBtaW4uY29weShwb3MpOwogICAgICBtYXguY29weShwb3MpOwogICAgfQoKICB9CgogIC8qKgogICAqIEEgcGxhbmUsIGZhY2luZyBpbiB0aGUgWiBkaXJlY3Rpb24uIFRoZSBwbGFuZSBoYXMgaXRzIHN1cmZhY2UgYXQgej0wIGFuZCBldmVyeXRoaW5nIGJlbG93IHo9MCBpcyBhc3N1bWVkIHRvIGJlIHNvbGlkIHBsYW5lLiBUbyBtYWtlIHRoZSBwbGFuZSBmYWNlIGluIHNvbWUgb3RoZXIgZGlyZWN0aW9uIHRoYW4geiwgeW91IG11c3QgcHV0IGl0IGluc2lkZSBhIEJvZHkgYW5kIHJvdGF0ZSB0aGF0IGJvZHkuIFNlZSB0aGUgZGVtb3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGxhbmVTaGFwZSA9IG5ldyBDQU5OT04uUGxhbmUoKQogICAqICAgICBjb25zdCBwbGFuZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAwLCBzaGFwZTogIHBsYW5lU2hhcGUgfSkKICAgKiAgICAgcGxhbmVCb2R5LnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKC1NYXRoLlBJIC8gMiwgMCwgMCkgLy8gbWFrZSBpdCBmYWNlIHVwCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGxhbmVCb2R5KQogICAqLwogIGNsYXNzIFBsYW5lIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHdvcmxkTm9ybWFsICovCgogICAgLyoqIHdvcmxkTm9ybWFsTmVlZHNVcGRhdGUgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUExBTkUKICAgICAgfSk7IC8vIFdvcmxkIG9yaWVudGVkIG5vcm1hbAoKICAgICAgdGhpcy53b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgfQogICAgLyoqIGNvbXB1dGVXb3JsZE5vcm1hbCAqLwoKCiAgICBjb21wdXRlV29ybGROb3JtYWwocXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy53b3JsZE5vcm1hbDsKICAgICAgbi5zZXQoMCwgMCwgMSk7CiAgICAgIHF1YXQudm11bHQobiwgbik7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHBsYW5lIGlzIGluZmluaXRlLi4uCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIFRoZSBwbGFuZSBBQUJCIGlzIGluZmluaXRlLCBleGNlcHQgaWYgdGhlIG5vcm1hbCBpcyBwb2ludGluZyBhbG9uZyBhbnkgYXhpcwogICAgICB0ZW1wTm9ybWFsLnNldCgwLCAwLCAxKTsgLy8gRGVmYXVsdCBwbGFuZSBub3JtYWwgaXMgegoKICAgICAgcXVhdC52bXVsdCh0ZW1wTm9ybWFsLCB0ZW1wTm9ybWFsKTsKICAgICAgY29uc3QgbWF4VmFsID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgbWluLnNldCgtbWF4VmFsLCAtbWF4VmFsLCAtbWF4VmFsKTsKICAgICAgbWF4LnNldChtYXhWYWwsIG1heFZhbCwgbWF4VmFsKTsKCiAgICAgIGlmICh0ZW1wTm9ybWFsLnggPT09IDEpIHsKICAgICAgICBtYXgueCA9IHBvcy54OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueCA9PT0gLTEpIHsKICAgICAgICBtaW4ueCA9IHBvcy54OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC55ID09PSAxKSB7CiAgICAgICAgbWF4LnkgPSBwb3MueTsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnkgPT09IC0xKSB7CiAgICAgICAgbWluLnkgPSBwb3MueTsKICAgICAgfQoKICAgICAgaWYgKHRlbXBOb3JtYWwueiA9PT0gMSkgewogICAgICAgIG1heC56ID0gcG9zLno7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC56ID09PSAtMSkgewogICAgICAgIG1pbi56ID0gcG9zLno7CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CgogIH0KICBjb25zdCB0ZW1wTm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogSGVpZ2h0ZmllbGQgc2hhcGUgY2xhc3MuIEhlaWdodCBkYXRhIGlzIGdpdmVuIGFzIGFuIGFycmF5LiBUaGVzZSBkYXRhIHBvaW50cyBhcmUgc3ByZWFkIG91dCBldmVubHkgd2l0aCBhIGdpdmVuIGRpc3RhbmNlLgogICAqIEB0b2RvIFNob3VsZCBiZSBwb3NzaWJsZSB0byB1c2UgYWxvbmcgYWxsIGF4ZXMsIG5vdCBqdXN0IHkKICAgKiBAdG9kbyBzaG91bGQgYmUgcG9zc2libGUgdG8gc2NhbGUgYWxvbmcgYWxsIGF4ZXMKICAgKiBAdG9kbyBSZWZhY3RvciBlbGVtZW50U2l6ZSB0byBlbGVtZW50U2l6ZVggYW5kIGVsZW1lbnRTaXplWQogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgLy8gR2VuZXJhdGUgc29tZSBoZWlnaHQgZGF0YSAoeS12YWx1ZXMpLgogICAqICAgICBjb25zdCBkYXRhID0gW10KICAgKiAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgKiAgICAgICAgIGNvbnN0IHkgPSAwLjUgKiBNYXRoLmNvcygwLjIgKiBpKQogICAqICAgICAgICAgZGF0YS5wdXNoKHkpCiAgICogICAgIH0KICAgKgogICAqICAgICAvLyBDcmVhdGUgdGhlIGhlaWdodGZpZWxkIHNoYXBlCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkU2hhcGUgPSBuZXcgQ0FOTk9OLkhlaWdodGZpZWxkKGRhdGEsIHsKICAgKiAgICAgICAgIGVsZW1lbnRTaXplOiAxIC8vIERpc3RhbmNlIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9ucwogICAqICAgICB9KQogICAqICAgICBjb25zdCBoZWlnaHRmaWVsZEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBzaGFwZTogaGVpZ2h0ZmllbGRTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGhlaWdodGZpZWxkQm9keSkKICAgKi8KICBjbGFzcyBIZWlnaHRmaWVsZCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXggdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBNaW5pbXVtIHZhbHVlIG9mIHRoZSBkYXRhIHBvaW50cyBpbiB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2luZyBiZXR3ZWVuIHRoZSBkYXRhIHBvaW50cyBpbiBYIGFuZCBZIGRpcmVjdGlvbi4KICAgICAqIEB0b2RvIGVsZW1lbnRTaXplWCBhbmQgWQogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkYXRhIEFuIGFycmF5IG9mIG51bWJlcnMsIG9yIGhlaWdodCB2YWx1ZXMsIHRoYXQgYXJlIHNwcmVhZCBvdXQgYWxvbmcgdGhlIHggYXhpcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZGF0YSwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIG1heFZhbHVlOiBudWxsLAogICAgICAgIG1pblZhbHVlOiBudWxsLAogICAgICAgIGVsZW1lbnRTaXplOiAxCiAgICAgIH0pOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuSEVJR0hURklFTEQKICAgICAgfSk7CiAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgIHRoaXMubWF4VmFsdWUgPSBvcHRpb25zLm1heFZhbHVlOwogICAgICB0aGlzLm1pblZhbHVlID0gb3B0aW9ucy5taW5WYWx1ZTsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IG9wdGlvbnMuZWxlbWVudFNpemU7CgogICAgICBpZiAob3B0aW9ucy5taW5WYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWluVmFsdWUoKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMubWF4VmFsdWUgPT09IG51bGwpIHsKICAgICAgICB0aGlzLnVwZGF0ZU1heFZhbHVlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FjaGVFbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsgLy8gImlfal9pc1VwcGVyIiA9PiB7IGNvbnZleDogLi4uLCBvZmZzZXQ6IC4uLiB9CiAgICAgIC8vIGZvciBleGFtcGxlOgogICAgICAvLyBfY2FjaGVkUGlsbGFyc1siMF8yXzEiXQoKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFycyA9IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1pblZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1pblZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWluVmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPCBtaW5WYWx1ZSkgewogICAgICAgICAgICBtaW5WYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1pblZhbHVlID0gbWluVmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1heFZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1heFZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWF4VmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPiBtYXhWYWx1ZSkgewogICAgICAgICAgICBtYXhWYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1heFZhbHVlID0gbWF4VmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgaGVpZ2h0IHZhbHVlIGF0IGFuIGluZGV4LiBEb24ndCBmb3JnZXQgdG8gdXBkYXRlIG1heFZhbHVlIGFuZCBtaW5WYWx1ZSBhZnRlciB5b3UncmUgZG9uZS4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRWYWx1ZUF0SW5kZXgoeGksIHlpLCB2YWx1ZSkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBkYXRhW3hpXVt5aV0gPSB2YWx1ZTsgLy8gSW52YWxpZGF0ZSBjYWNoZQoKICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZmFsc2UpOwoKICAgICAgaWYgKHhpID4gMCkgewogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCB0cnVlKTsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSwgZmFsc2UpOwogICAgICB9CgogICAgICBpZiAoeWkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWkgLSAxLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDAgJiYgeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWkgLSAxLCB0cnVlKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4L21pbiBpbiBhIHJlY3RhbmdsZSBpbiB0aGUgbWF0cml4IGRhdGEKICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgdGhlIHJlc3VsdHMgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgYXJyYXksIGlmIGl0IHdhcyBwYXNzZWQgaW4uIE1pbmltdW0gd2lsbCBiZSBhdCBwb3NpdGlvbiAwIGFuZCBtYXggYXQgMS4KICAgICAqLwoKCiAgICBnZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIC8vIEdldCBtYXggYW5kIG1pbiBvZiB0aGUgZGF0YQogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOyAvLyBTZXQgZmlyc3QgdmFsdWUKCiAgICAgIGxldCBtYXggPSB0aGlzLm1pblZhbHVlOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDw9IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPD0gaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IGhlaWdodDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlc3VsdFswXSA9IHRoaXMubWluVmFsdWU7CiAgICAgIHJlc3VsdFsxXSA9IG1heDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBpbmRleCBvZiBhIGxvY2FsIHBvc2l0aW9uIG9uIHRoZSBoZWlnaHRmaWVsZC4gVGhlIGluZGV4ZXMgaW5kaWNhdGUgdGhlIHJlY3RhbmdsZXMsIHNvIGlmIHlvdXIgdGVycmFpbiBpcyBtYWRlIG9mIE4geCBOIGhlaWdodCBkYXRhIHBvaW50cywgeW91IHdpbGwgaGF2ZSByZWN0YW5nbGUgaW5kZXhlcyByYW5naW5nIGZyb20gMCB0byBOLTEuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFR3by1lbGVtZW50IGFycmF5CiAgICAgKiBAcGFyYW0gY2xhbXAgSWYgdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBjbGFtcGVkIHRvIHRoZSBoZWlnaHRmaWVsZCBlZGdlLgogICAgICovCgoKICAgIGdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCByZXN1bHQsIGNsYW1wKSB7CiAgICAgIC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAogICAgICBjb25zdCB3ID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IHhpID0gTWF0aC5mbG9vcih4IC8gdyk7CiAgICAgIGxldCB5aSA9IE1hdGguZmxvb3IoeSAvIHcpOwogICAgICByZXN1bHRbMF0gPSB4aTsKICAgICAgcmVzdWx0WzFdID0geWk7CgogICAgICBpZiAoY2xhbXApIHsKICAgICAgICAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwogICAgICAgIGlmICh4aSA8IDApIHsKICAgICAgICAgIHhpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh5aSA8IDApIHsKICAgICAgICAgIHlpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh4aSA+PSBkYXRhLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHhpID0gZGF0YS5sZW5ndGggLSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpID49IGRhdGFbMF0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgeWkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICB9IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCgogICAgICBpZiAoeGkgPCAwIHx8IHlpIDwgMCB8fCB4aSA+PSBkYXRhLmxlbmd0aCAtIDEgfHwgeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBnZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYykgewogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgbG93ZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSB4aSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSB5aSkgKiogMjsKICAgICAgY29uc3QgdXBwZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSAoeGkgKyAxKSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSAoeWkgKyAxKSkgKiogMjsKICAgICAgY29uc3QgdXBwZXIgPSBsb3dlckRpc3QyID4gdXBwZXJEaXN0MjsKICAgICAgdGhpcy5nZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKTsKICAgICAgcmV0dXJuIHVwcGVyOwogICAgfQoKICAgIGdldE5vcm1hbEF0KHgsIHksIGVkZ2VDbGFtcCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGEgPSBnZXROb3JtYWxBdF9hOwogICAgICBjb25zdCBiID0gZ2V0Tm9ybWFsQXRfYjsKICAgICAgY29uc3QgYyA9IGdldE5vcm1hbEF0X2M7CiAgICAgIGNvbnN0IGUwID0gZ2V0Tm9ybWFsQXRfZTA7CiAgICAgIGNvbnN0IGUxID0gZ2V0Tm9ybWFsQXRfZTE7CiAgICAgIHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiLnZzdWIoYSwgZTApOwogICAgICBjLnZzdWIoYSwgZTEpOwogICAgICBlMC5jcm9zcyhlMSwgcmVzdWx0KTsKICAgICAgcmVzdWx0Lm5vcm1hbGl6ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gQUFCQiBvZiBhIHNxdWFyZSBpbiB0aGUgaGVpZ2h0ZmllbGQKICAgICAqIEBwYXJhbSB4aQogICAgICogQHBhcmFtIHlpCiAgICAgKiBAcGFyYW0gcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0QWFiYkF0SW5kZXgoeGksIHlpLCBfcmVmKSB7CiAgICAgIGxldCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBfcmVmOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGxvd2VyQm91bmQuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgIHVwcGVyQm91bmQuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBoZWlnaHQgaW4gdGhlIGhlaWdodGZpZWxkIGF0IGEgZ2l2ZW4gcG9zaXRpb24KICAgICAqLwoKCiAgICBnZXRIZWlnaHRBdCh4LCB5LCBlZGdlQ2xhbXApIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgYSA9IGdldEhlaWdodEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXRIZWlnaHRBdF9iOwogICAgICBjb25zdCBjID0gZ2V0SGVpZ2h0QXRfYzsKICAgICAgY29uc3QgaWR4ID0gZ2V0SGVpZ2h0QXRfaWR4OwogICAgICB0aGlzLmdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCBpZHgsIGVkZ2VDbGFtcCk7CiAgICAgIGxldCB4aSA9IGlkeFswXTsKICAgICAgbGV0IHlpID0gaWR4WzFdOwoKICAgICAgaWYgKGVkZ2VDbGFtcCkgewogICAgICAgIHhpID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB4aSkpOwogICAgICAgIHlpID0gTWF0aC5taW4oZGF0YVswXS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB5aSkpOwogICAgICB9CgogICAgICBjb25zdCB1cHBlciA9IHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyk7CiAgICAgIGNvbnN0IHcgPSBnZXRIZWlnaHRBdF93ZWlnaHRzOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGkgKyAxXVt5aSArIDFdICogdy54ICsgZGF0YVt4aV1beWkgKyAxXSAqIHcueSArIGRhdGFbeGkgKyAxXVt5aV0gKiB3Lno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGldW3lpXSAqIHcueCArIGRhdGFbeGkgKyAxXVt5aV0gKiB3LnkgKyBkYXRhW3hpXVt5aSArIDFdICogdy56OwogICAgICB9CiAgICB9CgogICAgZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIGAke3hpfV8ke3lpfV8ke2dldFVwcGVyVHJpYW5nbGUgPyAxIDogMH1gOwogICAgfQoKICAgIGdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CgogICAgc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCBjb252ZXgsIG9mZnNldCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXSA9IHsKICAgICAgICBjb252ZXgsCiAgICAgICAgb2Zmc2V0CiAgICAgIH07CiAgICB9CgogICAgY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgZGVsZXRlIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBmcm9tIHRoZSBoZWlnaHRmaWVsZAogICAgICovCgoKICAgIGdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgICAgIGIuc2V0KHhpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0pOwogICAgICAgIGMuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGEuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgICAgYi5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgICAgYy5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdHJpYW5nbGUgaW4gdGhlIHRlcnJhaW4gaW4gdGhlIGZvcm0gb2YgYSB0cmlhbmd1bGFyIGNvbnZleCBzaGFwZS4KICAgICAqLwoKCiAgICBnZXRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMucGlsbGFyQ29udmV4OwogICAgICBsZXQgb2Zmc2V0UmVzdWx0ID0gdGhpcy5waWxsYXJPZmZzZXQ7CgogICAgICBpZiAodGhpcy5jYWNoZUVuYWJsZWQpIHsKICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpOwoKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBkYXRhLmNvbnZleDsKICAgICAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gZGF0YS5vZmZzZXQ7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICByZXN1bHQgPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICAgIG9mZnNldFJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5waWxsYXJDb252ZXggPSByZXN1bHQ7CiAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBvZmZzZXRSZXN1bHQ7CiAgICAgIH0KCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZmFjZXMgPSByZXN1bHQuZmFjZXM7IC8vIFJldXNlIHZlcnRzIGlmIHBvc3NpYmxlCgogICAgICByZXN1bHQudmVydGljZXMubGVuZ3RoID0gNjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgaWYgKCFyZXN1bHQudmVydGljZXNbaV0pIHsKICAgICAgICAgIHJlc3VsdC52ZXJ0aWNlc1tpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFJldXNlIGZhY2VzIGlmIHBvc3NpYmxlCgoKICAgICAgZmFjZXMubGVuZ3RoID0gNTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgaWYgKCFmYWNlc1tpXSkgewogICAgICAgICAgZmFjZXNbaV0gPSBbXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gcmVzdWx0LnZlcnRpY2VzOwogICAgICBjb25zdCBoID0gKE1hdGgubWluKGRhdGFbeGldW3lpXSwgZGF0YVt4aSArIDFdW3lpXSwgZGF0YVt4aV1beWkgKyAxXSwgZGF0YVt4aSArIDFdW3lpICsgMV0pIC0gdGhpcy5taW5WYWx1ZSkgLyAyICsgdGhpcy5taW5WYWx1ZTsKCiAgICAgIGlmICghZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICAgIC8vIENlbnRlciBvZiB0aGUgdHJpYW5nbGUgcGlsbGFyIC0gYWxsIHBvbHlnb25zIGFyZSBnaXZlbiByZWxhdGl2ZSB0byB0aGlzIG9uZQogICAgICAgIG9mZnNldFJlc3VsdC5zZXQoKHhpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgLy8gc29ydCBvZiBjZW50ZXIgb2YgYSB0cmlhbmdsZQogICAgICAgICh5aSArIDAuMjUpICogZWxlbWVudFNpemUsIGggLy8gdmVydGljYWwgY2VudGVyCiAgICAgICAgKTsgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzBdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1sxXS5zZXQoMC43NSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldIC0gaCk7CiAgICAgICAgdmVydHNbMl0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOyAvLyBib3R0b20gdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbM10uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzRdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzVdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAwLjc1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOyAvLyB0b3AgdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMF1bMF0gPSAwOwogICAgICAgIGZhY2VzWzBdWzFdID0gMTsKICAgICAgICBmYWNlc1swXVsyXSA9IDI7IC8vIGJvdHRvbSB0cmlhbmdsZQoKICAgICAgICBmYWNlc1sxXVswXSA9IDU7CiAgICAgICAgZmFjZXNbMV1bMV0gPSA0OwogICAgICAgIGZhY2VzWzFdWzJdID0gMzsgLy8gLXggZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbMl1bMF0gPSAwOwogICAgICAgIGZhY2VzWzJdWzFdID0gMjsKICAgICAgICBmYWNlc1syXVsyXSA9IDU7CiAgICAgICAgZmFjZXNbMl1bM10gPSAzOyAvLyAteSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1szXVswXSA9IDE7CiAgICAgICAgZmFjZXNbM11bMV0gPSAwOwogICAgICAgIGZhY2VzWzNdWzJdID0gMzsKICAgICAgICBmYWNlc1szXVszXSA9IDQ7IC8vICt4eSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1s0XVswXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMV0gPSA1OwogICAgICAgIGZhY2VzWzRdWzJdID0gMjsKICAgICAgICBmYWNlc1s0XVszXSA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC43NSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgtMC43NSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAtMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzRdLnNldCgtMC43NSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzVdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOyAvLyBUb3AgdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMF1bMF0gPSAwOwogICAgICAgIGZhY2VzWzBdWzFdID0gMTsKICAgICAgICBmYWNlc1swXVsyXSA9IDI7IC8vIGJvdHRvbSB0cmlhbmdsZQoKICAgICAgICBmYWNlc1sxXVswXSA9IDU7CiAgICAgICAgZmFjZXNbMV1bMV0gPSA0OwogICAgICAgIGZhY2VzWzFdWzJdID0gMzsgLy8gK3ggZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbMl1bMF0gPSAyOwogICAgICAgIGZhY2VzWzJdWzFdID0gNTsKICAgICAgICBmYWNlc1syXVsyXSA9IDM7CiAgICAgICAgZmFjZXNbMl1bM10gPSAwOyAvLyAreSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1szXVswXSA9IDM7CiAgICAgICAgZmFjZXNbM11bMV0gPSA0OwogICAgICAgIGZhY2VzWzNdWzJdID0gMTsKICAgICAgICBmYWNlc1szXVszXSA9IDA7IC8vIC14eSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1s0XVswXSA9IDE7CiAgICAgICAgZmFjZXNbNF1bMV0gPSA0OwogICAgICAgIGZhY2VzWzRdWzJdID0gNTsKICAgICAgICBmYWNlc1s0XVszXSA9IDI7CiAgICAgIH0KCiAgICAgIHJlc3VsdC5jb21wdXRlTm9ybWFscygpOwogICAgICByZXN1bHQuY29tcHV0ZUVkZ2VzKCk7CiAgICAgIHJlc3VsdC51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB0aGlzLnNldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSwgcmVzdWx0LCBvZmZzZXRSZXN1bHQpOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHRlcnJhaW4gaXMgaW5maW5pdGUKICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoqIEBUT0RPIGRvIGl0IHByb3Blcmx5ICovCiAgICAgIG1pbi5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CiAgICAgIG1heC5zZXQoTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSk7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIFVzZSB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBtaW4vbWF4IHZhbHVlcwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBzID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IG5ldyBWZWMzKGRhdGEubGVuZ3RoICogcywgZGF0YVswXS5sZW5ndGggKiBzLCBNYXRoLm1heChNYXRoLmFicyh0aGlzLm1heFZhbHVlKSwgTWF0aC5hYnModGhpcy5taW5WYWx1ZSkpKS5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgaGVpZ2h0IHZhbHVlcyBmcm9tIGFuIGltYWdlLiBDdXJyZW50bHkgb25seSBzdXBwb3J0ZWQgaW4gYnJvd3Nlci4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRzRnJvbUltYWdlKGltYWdlLCBzY2FsZSkgewogICAgICBjb25zdCB7CiAgICAgICAgeCwKICAgICAgICB6LAogICAgICAgIHkKICAgICAgfSA9IHNjYWxlOwogICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CiAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApOwogICAgICBjb25zdCBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTsKICAgICAgY29uc3QgbWF0cml4ID0gdGhpcy5kYXRhOwogICAgICBtYXRyaXgubGVuZ3RoID0gMDsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IE1hdGguYWJzKHgpIC8gaW1hZ2VEYXRhLndpZHRoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZURhdGEuaGVpZ2h0OyBpKyspIHsKICAgICAgICBjb25zdCByb3cgPSBbXTsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbWFnZURhdGEud2lkdGg7IGorKykgewogICAgICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNF07CiAgICAgICAgICBjb25zdCBiID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMV07CiAgICAgICAgICBjb25zdCBjID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMl07CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSAoYSArIGIgKyBjKSAvIDQgLyAyNTUgKiB6OwoKICAgICAgICAgIGlmICh4IDwgMCkgewogICAgICAgICAgICByb3cucHVzaChoZWlnaHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93LnVuc2hpZnQoaGVpZ2h0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh5IDwgMCkgewogICAgICAgICAgbWF0cml4LnVuc2hpZnQocm93KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0cml4LnB1c2gocm93KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZSgpOwogICAgfQoKICB9CiAgY29uc3QgZ2V0SGVpZ2h0QXRfaWR4ID0gW107CiAgY29uc3QgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2UxID0gbmV3IFZlYzMoKTsgLy8gZnJvbSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CYXJ5Y2VudHJpY19jb29yZGluYXRlX3N5c3RlbQoKICBmdW5jdGlvbiBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcmVzdWx0KSB7CiAgICByZXN1bHQueCA9ICgoYnkgLSBjeSkgKiAoeCAtIGN4KSArIChjeCAtIGJ4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnkgPSAoKGN5IC0gYXkpICogKHggLSBjeCkgKyAoYXggLSBjeCkgKiAoeSAtIGN5KSkgLyAoKGJ5IC0gY3kpICogKGF4IC0gY3gpICsgKGN4IC0gYngpICogKGF5IC0gY3kpKTsKICAgIHJlc3VsdC56ID0gMSAtIHJlc3VsdC54IC0gcmVzdWx0Lnk7CiAgfQoKICAvKioKICAgKiBPY3RyZWVOb2RlCiAgICovCiAgY2xhc3MgT2N0cmVlTm9kZSB7CiAgICAvKiogVGhlIHJvb3Qgbm9kZSAqLwoKICAgIC8qKiBCb3VuZGFyeSBvZiB0aGlzIG5vZGUgKi8KCiAgICAvKiogQ29udGFpbmVkIGRhdGEgYXQgdGhlIGN1cnJlbnQgbm9kZSBsZXZlbCAqLwoKICAgIC8qKiBDaGlsZHJlbiB0byB0aGlzIG5vZGUgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yb290ID0gb3B0aW9ucy5yb290IHx8IG51bGw7CiAgICAgIHRoaXMuYWFiYiA9IG9wdGlvbnMuYWFiYiA/IG9wdGlvbnMuYWFiYi5jbG9uZSgpIDogbmV3IEFBQkIoKTsKICAgICAgdGhpcy5kYXRhID0gW107CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogcmVzZXQKICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogSW5zZXJ0IGRhdGEgaW50byB0aGlzIG5vZGUKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBzdWNjZXNzZnVsLCBvdGhlcndpc2UgZmFsc2UKICAgICAqLwoKCiAgICBpbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsKSB7CiAgICAgIGlmIChsZXZlbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbGV2ZWwgPSAwOwogICAgICB9CgogICAgICBjb25zdCBub2RlRGF0YSA9IHRoaXMuZGF0YTsgLy8gSWdub3JlIG9iamVjdHMgdGhhdCBkbyBub3QgYmVsb25nIGluIHRoaXMgbm9kZQoKICAgICAgaWYgKCF0aGlzLmFhYmIuY29udGFpbnMoYWFiYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG9iamVjdCBjYW5ub3QgYmUgYWRkZWQKICAgICAgfQoKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjb25zdCBtYXhEZXB0aCA9IHRoaXMubWF4RGVwdGggfHwgdGhpcy5yb290Lm1heERlcHRoOwoKICAgICAgaWYgKGxldmVsIDwgbWF4RGVwdGgpIHsKICAgICAgICAvLyBTdWJkaXZpZGUgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuIHlldAogICAgICAgIGxldCBzdWJkaXZpZGVkID0gZmFsc2U7CgogICAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLnN1YmRpdmlkZSgpOwogICAgICAgICAgc3ViZGl2aWRlZCA9IHRydWU7CiAgICAgICAgfSAvLyBhZGQgdG8gd2hpY2hldmVyIG5vZGUgd2lsbCBhY2NlcHQgaXQKCgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsICsgMSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZGl2aWRlZCkgewogICAgICAgICAgLy8gTm8gY2hpbGRyZW4gYWNjZXB0ZWQhIE1pZ2h0IGFzIHdlbGwganVzdCByZW1vdmUgZW0gc2luY2UgdGhleSBjb250YWluIG5vbmUKICAgICAgICAgIGNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICB9IC8vIFRvbyBkZWVwLCBvciBjaGlsZHJlbiBkaWRudCB3YW50IGl0LiBhZGQgaXQgaW4gY3VycmVudCBub2RlCgoKICAgICAgbm9kZURhdGEucHVzaChlbGVtZW50RGF0YSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgOCBlcXVhbGx5IHNpemVkIGNoaWxkcmVuIG5vZGVzIGFuZCBwdXQgdGhlbSBpbiB0aGUgYGNoaWxkcmVuYCBhcnJheS4KICAgICAqLwoKCiAgICBzdWJkaXZpZGUoKSB7CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgY2hpbGRyZW4ucHVzaChuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDAsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSkpOwogICAgICB1LnZzdWIobCwgaGFsZkRpYWdvbmFsKTsKICAgICAgaGFsZkRpYWdvbmFsLnNjYWxlKDAuNSwgaGFsZkRpYWdvbmFsKTsKICAgICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdCB8fCB0aGlzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07IC8vIFNldCBjdXJyZW50IG5vZGUgYXMgcm9vdAoKICAgICAgICBjaGlsZC5yb290ID0gcm9vdDsgLy8gQ29tcHV0ZSBib3VuZHMKCiAgICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IGNoaWxkLmFhYmIubG93ZXJCb3VuZDsKICAgICAgICBsb3dlckJvdW5kLnggKj0gaGFsZkRpYWdvbmFsLng7CiAgICAgICAgbG93ZXJCb3VuZC55ICo9IGhhbGZEaWFnb25hbC55OwogICAgICAgIGxvd2VyQm91bmQueiAqPSBoYWxmRGlhZ29uYWwuejsKICAgICAgICBsb3dlckJvdW5kLnZhZGQobCwgbG93ZXJCb3VuZCk7IC8vIFVwcGVyIGJvdW5kIGlzIGFsd2F5cyBsb3dlciBib3VuZCArIGhhbGZEaWFnb25hbAoKICAgICAgICBsb3dlckJvdW5kLnZhZGQoaGFsZkRpYWdvbmFsLCBjaGlsZC5hYWJiLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgd2l0aGluIGFuIEFBQkIKICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIGFhYmJRdWVyeShhYWJiLCByZXN1bHQpIHsKICAgICAgdGhpcy5kYXRhOyAvLyBhYm9ydCBpZiB0aGUgcmFuZ2UgZG9lcyBub3QgaW50ZXJzZWN0IHRoaXMgbm9kZQogICAgICAvLyBpZiAoIXRoaXMuYWFiYi5vdmVybGFwcyhhYWJiKSl7CiAgICAgIC8vICAgICByZXR1cm4gcmVzdWx0OwogICAgICAvLyB9CiAgICAgIC8vIEFkZCBvYmplY3RzIGF0IHRoaXMgbGV2ZWwKICAgICAgLy8gQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocmVzdWx0LCBub2RlRGF0YSk7CiAgICAgIC8vIEFkZCBjaGlsZCBkYXRhCiAgICAgIC8vIEB0b2RvIHVud3JhcCByZWN1cnNpb24gaW50byBhIHF1ZXVlIC8gbG9vcCwgdGhhdCdzIGZhc3RlciBpbiBKUwoKICAgICAgdGhpcy5jaGlsZHJlbjsgLy8gZm9yIChsZXQgaSA9IDAsIE4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIC8vICAgICBjaGlsZHJlbltpXS5hYWJiUXVlcnkoYWFiYiwgcmVzdWx0KTsKICAgICAgLy8gfQoKICAgICAgY29uc3QgcXVldWUgPSBbdGhpc107CgogICAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOwoKICAgICAgICBpZiAobm9kZS5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGUuZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShxdWV1ZSwgbm9kZS5jaGlsZHJlbik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgaW50ZXJzZWN0ZWQgYnkgYSByYXkuCiAgICAgKiBAcmV0dXJuIFRoZSAicmVzdWx0IiBvYmplY3QKICAgICAqLwoKCiAgICByYXlRdWVyeShyYXksIHRyZWVUcmFuc2Zvcm0sIHJlc3VsdCkgewogICAgICAvLyBVc2UgYWFiYiBxdWVyeSBmb3Igbm93LgoKICAgICAgLyoqIEB0b2RvIGltcGxlbWVudCByZWFsIHJheSBxdWVyeSB3aGljaCBuZWVkcyBsZXNzIGxvb2t1cHMgKi8KICAgICAgcmF5LmdldEFBQkIodG1wQUFCQik7CiAgICAgIHRtcEFBQkIudG9Mb2NhbEZyYW1lKHRyZWVUcmFuc2Zvcm0sIHRtcEFBQkIpOwogICAgICB0aGlzLmFhYmJRdWVyeSh0bXBBQUJCLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiByZW1vdmVFbXB0eU5vZGVzCiAgICAgKi8KCgogICAgcmVtb3ZlRW1wdHlOb2RlcygpIHsKICAgICAgZm9yIChsZXQgaSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLnJlbW92ZUVtcHR5Tm9kZXMoKTsKCiAgICAgICAgaWYgKCF0aGlzLmNoaWxkcmVuW2ldLmNoaWxkcmVuLmxlbmd0aCAmJiAhdGhpcy5jaGlsZHJlbltpXS5kYXRhLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICAvKioKICAgKiBPY3RyZWUKICAgKi8KCgogIGNsYXNzIE9jdHJlZSBleHRlbmRzIE9jdHJlZU5vZGUgewogICAgLyoqCiAgICAgKiBNYXhpbXVtIHN1YmRpdmlzaW9uIGRlcHRoCiAgICAgKiBAZGVmYXVsdCA4CiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBhYWJiIFRoZSB0b3RhbCBBQUJCIG9mIHRoZSB0cmVlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGFhYmIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoewogICAgICAgIHJvb3Q6IG51bGwsCiAgICAgICAgYWFiYgogICAgICB9KTsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHR5cGVvZiBvcHRpb25zLm1heERlcHRoICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4RGVwdGggOiA4OwogICAgfQoKICB9CiAgY29uc3QgaGFsZkRpYWdvbmFsID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBBQUJCID0gbmV3IEFBQkIoKTsKCiAgLyoqCiAgICogVHJpbWVzaC4KICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBIb3cgdG8gbWFrZSBhIG1lc2ggd2l0aCBhIHNpbmdsZSB0cmlhbmdsZQogICAqICAgICBjb25zdCB2ZXJ0aWNlcyA9IFsKICAgKiAgICAgICAgIDAsIDAsIDAsIC8vIHZlcnRleCAwCiAgICogICAgICAgICAxLCAwLCAwLCAvLyB2ZXJ0ZXggMQogICAqICAgICAgICAgMCwgMSwgMCAgLy8gdmVydGV4IDIKICAgKiAgICAgXQogICAqICAgICBjb25zdCBpbmRpY2VzID0gWwogICAqICAgICAgICAgMCwgMSwgMiAgLy8gdHJpYW5nbGUgMAogICAqICAgICBdCiAgICogICAgIGNvbnN0IHRyaW1lc2hTaGFwZSA9IG5ldyBDQU5OT04uVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcykKICAgKi8KICBjbGFzcyBUcmltZXNoIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiB2ZXJ0aWNlcwogICAgICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VycywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIHRyaWFuZ2xlIGNvbnNpc3RzIG9mLiBUaGUgbGVuZ3RoIG9mIHRoaXMgYXJyYXkgaXMgdGh1cyAzIHRpbWVzIHRoZSBudW1iZXIgb2YgdHJpYW5nbGVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbm9ybWFscyBkYXRhLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbG9jYWwgQUFCQiBvZiB0aGUgbWVzaC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVmZXJlbmNlcyB0byB2ZXJ0ZXggcGFpcnMsIG1ha2luZyB1cCBhbGwgdW5pcXVlIGVkZ2VzIGluIHRoZSB0cmltZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBzY2FsaW5nIG9mIHRoZSBtZXNoLiBVc2UgLnNldFNjYWxlKCkgdG8gc2V0IGl0LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXhlZCB0cmlhbmdsZXMuIFVzZSAudXBkYXRlVHJlZSgpIHRvIHVwZGF0ZSBpdC4KICAgICAqLwogICAgY29uc3RydWN0b3IodmVydGljZXMsIGluZGljZXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlRSSU1FU0gKICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKTsKICAgICAgdGhpcy5pbmRpY2VzID0gbmV3IEludDE2QXJyYXkoaW5kaWNlcyk7CiAgICAgIHRoaXMubm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoaW5kaWNlcy5sZW5ndGgpOwogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmVkZ2VzID0gbnVsbDsKICAgICAgdGhpcy5zY2FsZSA9IG5ldyBWZWMzKDEsIDEsIDEpOwogICAgICB0aGlzLnRyZWUgPSBuZXcgT2N0cmVlKCk7CiAgICAgIHRoaXMudXBkYXRlRWRnZXMoKTsKICAgICAgdGhpcy51cGRhdGVOb3JtYWxzKCk7CiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMudXBkYXRlVHJlZSgpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVUcmVlCiAgICAgKi8KCgogICAgdXBkYXRlVHJlZSgpIHsKICAgICAgY29uc3QgdHJlZSA9IHRoaXMudHJlZTsKICAgICAgdHJlZS5yZXNldCgpOwogICAgICB0cmVlLmFhYmIuY29weSh0aGlzLmFhYmIpOwogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7IC8vIFRoZSBsb2NhbCBtZXNoIEFBQkIgaXMgc2NhbGVkLCBidXQgdGhlIG9jdHJlZSBBQUJCIHNob3VsZCBiZSB1bnNjYWxlZAoKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueiAqPSAxIC8gc2NhbGUuejsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueiAqPSAxIC8gc2NhbGUuejsgLy8gSW5zZXJ0IGFsbCB0cmlhbmdsZXMKCiAgICAgIGNvbnN0IHRyaWFuZ2xlQUFCQiA9IG5ldyBBQUJCKCk7CiAgICAgIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBvaW50cyA9IFthLCBiLCBjXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vdGhpcy5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIGEsIGIsIGMpOwogICAgICAgIC8vIEdldCB1bnNjYWxlZCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwoKICAgICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKCiAgICAgICAgdHJpYW5nbGVBQUJCLnNldEZyb21Qb2ludHMocG9pbnRzKTsKICAgICAgICB0cmVlLmluc2VydCh0cmlhbmdsZUFBQkIsIGkpOwogICAgICB9CgogICAgICB0cmVlLnJlbW92ZUVtcHR5Tm9kZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRyaWFuZ2xlcyBpbiBhIGxvY2FsIEFBQkIgZnJvbSB0aGUgdHJpbWVzaC4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlZmVyZW5jaW5nIHRoZSBxdWVyaWVkIHRyaWFuZ2xlcy4KICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZXNJbkFBQkIoYWFiYiwgcmVzdWx0KSB7CiAgICAgIHVuc2NhbGVkQUFCQi5jb3B5KGFhYmIpOyAvLyBTY2FsZSBpdCB0byBsb2NhbAoKICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgICBjb25zdCBpc3ggPSBzY2FsZS54OwogICAgICBjb25zdCBpc3kgPSBzY2FsZS55OwogICAgICBjb25zdCBpc3ogPSBzY2FsZS56OwogICAgICBjb25zdCBsID0gdW5zY2FsZWRBQUJCLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB1bnNjYWxlZEFBQkIudXBwZXJCb3VuZDsKICAgICAgbC54IC89IGlzeDsKICAgICAgbC55IC89IGlzeTsKICAgICAgbC56IC89IGlzejsKICAgICAgdS54IC89IGlzeDsKICAgICAgdS55IC89IGlzeTsKICAgICAgdS56IC89IGlzejsKICAgICAgcmV0dXJuIHRoaXMudHJlZS5hYWJiUXVlcnkodW5zY2FsZWRBQUJCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRTY2FsZQogICAgICovCgoKICAgIHNldFNjYWxlKHNjYWxlKSB7CiAgICAgIGNvbnN0IHdhc1VuaWZvcm0gPSB0aGlzLnNjYWxlLnggPT09IHRoaXMuc2NhbGUueSAmJiB0aGlzLnNjYWxlLnkgPT09IHRoaXMuc2NhbGUuejsKICAgICAgY29uc3QgaXNVbmlmb3JtID0gc2NhbGUueCA9PT0gc2NhbGUueSAmJiBzY2FsZS55ID09PSBzY2FsZS56OwoKICAgICAgaWYgKCEod2FzVW5pZm9ybSAmJiBpc1VuaWZvcm0pKSB7CiAgICAgICAgLy8gTm9uLXVuaWZvcm0gc2NhbGluZy4gTmVlZCB0byB1cGRhdGUgbm9ybWFscy4KICAgICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgfQoKICAgICAgdGhpcy5zY2FsZS5jb3B5KHNjYWxlKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuIFdpbGwgc2F2ZSBpbiB0aGUgYC5ub3JtYWxzYCBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGVOb3JtYWxzKCkgewogICAgICBjb25zdCBuID0gY29tcHV0ZU5vcm1hbHNfbjsgLy8gR2VuZXJhdGUgbm9ybWFscwoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMubm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICB0aGlzLmdldFZlcnRleChhLCB2YSk7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYiwgdmIpOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGMsIHZjKTsKICAgICAgICBUcmltZXNoLmNvbXB1dGVOb3JtYWwodmIsIHZhLCB2Yywgbik7CiAgICAgICAgbm9ybWFsc1tpM10gPSBuLng7CiAgICAgICAgbm9ybWFsc1tpMyArIDFdID0gbi55OwogICAgICAgIG5vcm1hbHNbaTMgKyAyXSA9IG4uejsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuZWRnZXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlRWRnZXMoKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0ge307CgogICAgICBjb25zdCBhZGQgPSAoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGtleSA9IGEgPCBiID8gYCR7YX1fJHtifWAgOiBgJHtifV8ke2F9YDsKICAgICAgICBlZGdlc1trZXldID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICBhZGQoYSwgYik7CiAgICAgICAgYWRkKGIsIGMpOwogICAgICAgIGFkZChjLCBhKTsKICAgICAgfQoKICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGVkZ2VzKTsKICAgICAgdGhpcy5lZGdlcyA9IG5ldyBJbnQxNkFycmF5KGtleXMubGVuZ3RoICogMik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBpbmRpY2VzID0ga2V5c1tpXS5zcGxpdCgnXycpOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGldID0gcGFyc2VJbnQoaW5kaWNlc1swXSwgMTApOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGkgKyAxXSA9IHBhcnNlSW50KGluZGljZXNbMV0sIDEwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWRnZSB2ZXJ0ZXgKICAgICAqIEBwYXJhbSBmaXJzdE9yU2Vjb25kIDAgb3IgMSwgZGVwZW5kaW5nIG9uIHdoaWNoIG9uZSBvZiB0aGUgdmVydGljZXMgeW91IG5lZWQuCiAgICAgKiBAcGFyYW0gdmVydGV4U3RvcmUgV2hlcmUgdG8gc3RvcmUgdGhlIHJlc3VsdAogICAgICovCgoKICAgIGdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCBmaXJzdE9yU2Vjb25kLCB2ZXJ0ZXhTdG9yZSkgewogICAgICBjb25zdCB2ZXJ0ZXhJbmRleCA9IHRoaXMuZWRnZXNbZWRnZUluZGV4ICogMiArIChmaXJzdE9yU2Vjb25kID8gMSA6IDApXTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodmVydGV4SW5kZXgsIHZlcnRleFN0b3JlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdmVjdG9yIGFsb25nIGFuIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0RWRnZVZlY3RvcihlZGdlSW5kZXgsIHZlY3RvclN0b3JlKSB7CiAgICAgIGNvbnN0IHZhID0gZ2V0RWRnZVZlY3Rvcl92YTsKICAgICAgY29uc3QgdmIgPSBnZXRFZGdlVmVjdG9yX3ZiOwogICAgICB0aGlzLmdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCAwLCB2YSk7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDEsIHZiKTsKICAgICAgdmIudnN1Yih2YSwgdmVjdG9yU3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdmVydGV4IGkuCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0VmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CgogICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpOwoKICAgICAgb3V0LnggKj0gc2NhbGUueDsKICAgICAgb3V0LnkgKj0gc2NhbGUueTsKICAgICAgb3V0LnogKj0gc2NhbGUuejsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHJhdyB2ZXJ0ZXggaQogICAgICogQHJldHVybiBUaGUgIm91dCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIF9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICByZXR1cm4gb3V0LnNldCh2ZXJ0aWNlc1tpM10sIHZlcnRpY2VzW2kzICsgMV0sIHZlcnRpY2VzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZXJ0ZXggZnJvbSB0aGUgdHJpbWVzaCx0cmFuc2Zvcm1lZCBieSB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0V29ybGRWZXJ0ZXgoaSwgcG9zLCBxdWF0LCBvdXQpIHsKICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgb3V0KTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvcywgcXVhdCwgb3V0LCBvdXQpOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRocmVlIHZlcnRpY2VzIGZvciB0cmlhbmdsZSBpLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYykgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTNdLCBhKTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMV0sIGIpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAyXSwgYyk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiB0cmlhbmdsZSBpLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGdldE5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQodGhpcy5ub3JtYWxzW2kzXSwgdGhpcy5ub3JtYWxzW2kzICsgMV0sIHRoaXMubm9ybWFsc1tpMyArIDJdKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKGNsaV9hYWJiKTsKICAgICAgY29uc3QgeCA9IGNsaV9hYWJiLnVwcGVyQm91bmQueCAtIGNsaV9hYWJiLmxvd2VyQm91bmQueDsKICAgICAgY29uc3QgeSA9IGNsaV9hYWJiLnVwcGVyQm91bmQueSAtIGNsaV9hYWJiLmxvd2VyQm91bmQueTsKICAgICAgY29uc3QgeiA9IGNsaV9hYWJiLnVwcGVyQm91bmQueiAtIGNsaV9hYWJiLmxvd2VyQm91bmQuejsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQoMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopLCAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeCAqIDIgKiB4ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGxvY2FsIEFBQkIgZm9yIHRoZSB0cmltZXNoCiAgICAgKi8KCgogICAgY29tcHV0ZUxvY2FsQUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgdiA9IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0OwogICAgICB0aGlzLmdldFZlcnRleCgwLCB2KTsKICAgICAgbC5jb3B5KHYpOwogICAgICB1LmNvcHkodik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CgogICAgICAgIGlmICh2LnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IHUueCkgewogICAgICAgICAgdS54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGwueSkgewogICAgICAgICAgbC55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgLmFhYmJgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKHRoaXMuYWFiYik7CiAgICB9CiAgICAvKioKICAgICAqIFdpbGwgdXBkYXRlIHRoZSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBBc3N1bWUgcG9pbnRzIGFyZSBkaXN0cmlidXRlZCB3aXRoIGxvY2FsICgwLDAsMCkgYXMgY2VudGVyCiAgICAgIGxldCBtYXgyID0gMDsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdmVydGljZXMubGVuZ3RoIC8gMzsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgY29uc3Qgbm9ybTIgPSB2Lmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoKICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAvIDMsCiAgICAgICAgICAgICAgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICAgICAgY29uc3QgbWlueCxtaW55LG1pbnosbWF4eCxtYXh5LG1heHo7CiAgICAgICAgICAgY29uc3QgdiA9IHRlbXBXb3JsZFZlcnRleDsKICAgICAgICAgIGZvcihsZXQgaT0wOyBpPG47IGkrKyl7CiAgICAgICAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICAgICAgICBwb3MudmFkZCh2LCB2KTsKICAgICAgICAgICAgICBpZiAodi54IDwgbWlueCB8fCBtaW54PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi54ID4gbWF4eCB8fCBtYXh4PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGlmICh2LnkgPCBtaW55IHx8IG1pbnk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW55ID0gdi55OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnkgPiBtYXh5IHx8IG1heHk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh5ID0gdi55OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueiA8IG1pbnogfHwgbWluej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnogPSB2Lno7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueiA+IG1heHogfHwgbWF4ej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHogPSB2Lno7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbWluLnNldChtaW54LG1pbnksbWlueik7CiAgICAgICAgICBtYXguc2V0KG1heHgsbWF4eSxtYXh6KTsKICAgICAgICAgICovCiAgICAgIC8vIEZhc3RlciBhcHByb3hpbWF0aW9uIHVzaW5nIGxvY2FsIEFBQkIKICAgICAgY29uc3QgZnJhbWUgPSBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWU7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiOwogICAgICBmcmFtZS5wb3NpdGlvbiA9IHBvczsKICAgICAgZnJhbWUucXVhdGVybmlvbiA9IHF1YXQ7CiAgICAgIHRoaXMuYWFiYi50b1dvcmxkRnJhbWUoZnJhbWUsIHJlc3VsdCk7CiAgICAgIG1pbi5jb3B5KHJlc3VsdC5sb3dlckJvdW5kKTsKICAgICAgbWF4LmNvcHkocmVzdWx0LnVwcGVyQm91bmQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYXBwcm94aW1hdGUgdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSBhIFRyaW1lc2ggaW5zdGFuY2UsIHNoYXBlZCBhcyBhIHRvcnVzLgogICAgICovCgoKICAgIHN0YXRpYyBjcmVhdGVUb3J1cyhyYWRpdXMsIHR1YmUsIHJhZGlhbFNlZ21lbnRzLCB0dWJ1bGFyU2VnbWVudHMsIGFyYykgewogICAgICBpZiAocmFkaXVzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpdXMgPSAxOwogICAgICB9CgogICAgICBpZiAodHViZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHViZSA9IDAuNTsKICAgICAgfQoKICAgICAgaWYgKHJhZGlhbFNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpYWxTZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmICh0dWJ1bGFyU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHR1YnVsYXJTZWdtZW50cyA9IDY7CiAgICAgIH0KCiAgICAgIGlmIChhcmMgPT09IHZvaWQgMCkgewogICAgICAgIGFyYyA9IE1hdGguUEkgKiAyOwogICAgICB9CgogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBpbmRpY2VzID0gW107CgogICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHUgPSBpIC8gdHVidWxhclNlZ21lbnRzICogYXJjOwogICAgICAgICAgY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwogICAgICAgICAgY29uc3QgeCA9IChyYWRpdXMgKyB0dWJlICogTWF0aC5jb3ModikpICogTWF0aC5jb3ModSk7CiAgICAgICAgICBjb25zdCB5ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLnNpbih1KTsKICAgICAgICAgIGNvbnN0IHogPSB0dWJlICogTWF0aC5zaW4odik7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKHgsIHksIHopOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gcmFkaWFsU2VnbWVudHM7IGorKykgewogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHR1YnVsYXJTZWdtZW50czsgaSsrKSB7CiAgICAgICAgICBjb25zdCBhID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogaiArIGkgLSAxOwogICAgICAgICAgY29uc3QgYiA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpIC0gMTsKICAgICAgICAgIGNvbnN0IGMgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiAoaiAtIDEpICsgaTsKICAgICAgICAgIGNvbnN0IGQgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaTsKICAgICAgICAgIGluZGljZXMucHVzaChhLCBiLCBkKTsKICAgICAgICAgIGluZGljZXMucHVzaChiLCBjLCBkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcyk7CiAgICB9CgogIH0KICBjb25zdCBjb21wdXRlTm9ybWFsc19uID0gbmV3IFZlYzMoKTsKICBjb25zdCB1bnNjYWxlZEFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICBjb25zdCBhYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2xpX2FhYmIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWUgPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgY2FsY3VsYXRlV29ybGRBQUJCX2FhYmIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBDb25zdHJhaW50IGVxdWF0aW9uIHNvbHZlciBiYXNlIGNsYXNzLgogICAqLwogIGNsYXNzIFNvbHZlciB7CiAgICAvKioKICAgICAqIEFsbCBlcXVhdGlvbnMgdG8gYmUgc29sdmVkCiAgICAgKi8KCiAgICAvKioKICAgICAqIEB0b2RvIHJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gc3ViY2xhc3NlcyEKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdAogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgcmV0dXJuICgvLyBTaG91bGQgcmV0dXJuIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyBkb25lIQogICAgICAgIDAKICAgICAgKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgYWRkRXF1YXRpb24oZXEpIHsKICAgICAgaWYgKGVxLmVuYWJsZWQgJiYgIWVxLmJpLmlzVHJpZ2dlciAmJiAhZXEuYmouaXNUcmlnZ2VyKSB7CiAgICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgcmVtb3ZlRXF1YXRpb24oZXEpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IGkgPSBlcXMuaW5kZXhPZihlcSk7CgogICAgICBpZiAoaSAhPT0gLTEpIHsKICAgICAgICBlcXMuc3BsaWNlKGksIDEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhbGwgZXF1YXRpb25zCiAgICAgKi8KCgogICAgcmVtb3ZlQWxsRXF1YXRpb25zKCkgewogICAgICB0aGlzLmVxdWF0aW9ucy5sZW5ndGggPSAwOwogICAgfQoKICB9CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gR2F1c3MtU2VpZGVsIHNvbHZlci4KICAgKiBAdG9kbyBUaGUgc3Bvb2sgcGFyYW1ldGVycyBzaG91bGQgYmUgc3BlY2lmaWVkIGZvciBlYWNoIGNvbnN0cmFpbnQsIG5vdCBnbG9iYWxseS4KICAgKiBAc2VlIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDA5L2xlY3R1cmVzL3Nwb29rbm90ZXMucGRmCiAgICovCiAgY2xhc3MgR1NTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLgogICAgICogVGhlIG1vcmUgaXRlcmF0aW9ucywgdGhlIG1vcmUgY29ycmVjdCBzaW11bGF0aW9uLiBNb3JlIGl0ZXJhdGlvbnMgbmVlZCBtb3JlIGNvbXB1dGF0aW9ucyB0aG91Z2guIElmIHlvdSBoYXZlIGEgbGFyZ2UgZ3Jhdml0eSBmb3JjZSBpbiB5b3VyIHdvcmxkLCB5b3Ugd2lsbCBuZWVkIG1vcmUgaXRlcmF0aW9ucy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0b2xlcmFuY2UgaXMgcmVhY2hlZCwgdGhlIHN5c3RlbSBpcyBhc3N1bWVkIHRvIGJlIGNvbnZlcmdlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBsZXQgaXRlciA9IDA7CiAgICAgIGNvbnN0IG1heEl0ZXIgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IHRvbFNxdWFyZWQgPSB0aGlzLnRvbGVyYW5jZSAqIHRoaXMudG9sZXJhbmNlOwogICAgICBjb25zdCBlcXVhdGlvbnMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgTmVxID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgY29uc3QgYm9kaWVzID0gd29ybGQuYm9kaWVzOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaCA9IGR0OwogICAgICBsZXQgQjsKICAgICAgbGV0IGludkM7CiAgICAgIGxldCBkZWx0YWxhbWJkYTsKICAgICAgbGV0IGRlbHRhbGFtYmRhVG90OwogICAgICBsZXQgR1dsYW1iZGE7CiAgICAgIGxldCBsYW1iZGFqOyAvLyBVcGRhdGUgc29sdmUgbWFzcwoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYm9kaWVzOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS51cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFRoaW5ncyB0aGF0IGRvIG5vdCBjaGFuZ2UgZHVyaW5nIGl0ZXJhdGlvbiBjYW4gYmUgY29tcHV0ZWQgb25jZQoKCiAgICAgIGNvbnN0IGludkNzID0gR1NTb2x2ZXJfc29sdmVfaW52Q3M7CiAgICAgIGNvbnN0IEJzID0gR1NTb2x2ZXJfc29sdmVfQnM7CiAgICAgIGNvbnN0IGxhbWJkYSA9IEdTU29sdmVyX3NvbHZlX2xhbWJkYTsKICAgICAgaW52Q3MubGVuZ3RoID0gTmVxOwogICAgICBCcy5sZW5ndGggPSBOZXE7CiAgICAgIGxhbWJkYS5sZW5ndGggPSBOZXE7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gZXF1YXRpb25zW2ldOwogICAgICAgIGxhbWJkYVtpXSA9IDAuMDsKICAgICAgICBCc1tpXSA9IGMuY29tcHV0ZUIoaCk7CiAgICAgICAgaW52Q3NbaV0gPSAxLjAgLyBjLmNvbXB1dGVDKCk7CiAgICAgIH0KCiAgICAgIGlmIChOZXEgIT09IDApIHsKICAgICAgICAvLyBSZXNldCB2bGFtYmRhCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHZsYW1iZGEgPSBiLnZsYW1iZGE7CiAgICAgICAgICBjb25zdCB3bGFtYmRhID0gYi53bGFtYmRhOwogICAgICAgICAgdmxhbWJkYS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICB3bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICB9IC8vIEl0ZXJhdGUgb3ZlciBlcXVhdGlvbnMKCgogICAgICAgIGZvciAoaXRlciA9IDA7IGl0ZXIgIT09IG1heEl0ZXI7IGl0ZXIrKykgewogICAgICAgICAgLy8gQWNjdW11bGF0ZSB0aGUgdG90YWwgZXJyb3IgZm9yIGVhY2ggaXRlcmF0aW9uLgogICAgICAgICAgZGVsdGFsYW1iZGFUb3QgPSAwLjA7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbal07IC8vIENvbXB1dGUgaXRlcmF0aW9uCgogICAgICAgICAgICBCID0gQnNbal07CiAgICAgICAgICAgIGludkMgPSBpbnZDc1tqXTsKICAgICAgICAgICAgbGFtYmRhaiA9IGxhbWJkYVtqXTsKICAgICAgICAgICAgR1dsYW1iZGEgPSBjLmNvbXB1dGVHV2xhbWJkYSgpOwogICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGludkMgKiAoQiAtIEdXbGFtYmRhIC0gYy5lcHMgKiBsYW1iZGFqKTsgLy8gQ2xhbXAgaWYgd2UgYXJlIG5vdCB3aXRoaW4gdGhlIG1pbi9tYXggaW50ZXJ2YWwKCiAgICAgICAgICAgIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPCBjLm1pbkZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1pbkZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfSBlbHNlIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPiBjLm1heEZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1heEZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFtYmRhW2pdICs9IGRlbHRhbGFtYmRhOwogICAgICAgICAgICBkZWx0YWxhbWJkYVRvdCArPSBkZWx0YWxhbWJkYSA+IDAuMCA/IGRlbHRhbGFtYmRhIDogLWRlbHRhbGFtYmRhOyAvLyBhYnMoZGVsdGFsYW1iZGEpCgogICAgICAgICAgICBjLmFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSk7CiAgICAgICAgICB9IC8vIElmIHRoZSB0b3RhbCBlcnJvciBpcyBzbWFsbCBlbm91Z2ggLSBzdG9wIGl0ZXJhdGUKCgogICAgICAgICAgaWYgKGRlbHRhbGFtYmRhVG90ICogZGVsdGFsYW1iZGFUb3QgPCB0b2xTcXVhcmVkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gQWRkIHJlc3VsdCB0byB2ZWxvY2l0eQoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHYgPSBiLnZlbG9jaXR5OwogICAgICAgICAgY29uc3QgdyA9IGIuYW5ndWxhclZlbG9jaXR5OwogICAgICAgICAgYi52bGFtYmRhLnZtdWwoYi5saW5lYXJGYWN0b3IsIGIudmxhbWJkYSk7CiAgICAgICAgICB2LnZhZGQoYi52bGFtYmRhLCB2KTsKICAgICAgICAgIGIud2xhbWJkYS52bXVsKGIuYW5ndWxhckZhY3RvciwgYi53bGFtYmRhKTsKICAgICAgICAgIHcudmFkZChiLndsYW1iZGEsIHcpOwogICAgICAgIH0gLy8gU2V0IHRoZSBgLm11bHRpcGxpZXJgIHByb3BlcnR5IG9mIGVhY2ggZXF1YXRpb24KCgogICAgICAgIGxldCBsID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgICBjb25zdCBpbnZEdCA9IDEgLyBoOwoKICAgICAgICB3aGlsZSAobC0tKSB7CiAgICAgICAgICBlcXVhdGlvbnNbbF0ubXVsdGlwbGllciA9IGxhbWJkYVtsXSAqIGludkR0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGl0ZXI7CiAgICB9CgogIH0gLy8gSnVzdCB0ZW1wb3JhcnkgbnVtYmVyIGhvbGRlcnMgdGhhdCB3ZSB3YW50IHRvIHJldXNlIGVhY2ggaXRlcmF0aW9uLgoKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9sYW1iZGEgPSBbXTsKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9pbnZDcyA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX0JzID0gW107CgogIC8qKgogICAqIFNwbGl0cyB0aGUgZXF1YXRpb25zIGludG8gaXNsYW5kcyBhbmQgc29sdmVzIHRoZW0gaW5kZXBlbmRlbnRseS4gQ2FuIGltcHJvdmUgcGVyZm9ybWFuY2UuCiAgICovCiAgY2xhc3MgU3BsaXRTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqIHN1YnNvbHZlciAqLwogICAgY29uc3RydWN0b3Ioc3Vic29sdmVyKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICAgIHRoaXMuc3Vic29sdmVyID0gc3Vic29sdmVyOwogICAgICB0aGlzLm5vZGVzID0gW107CiAgICAgIHRoaXMubm9kZVBvb2wgPSBbXTsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlICh0aGlzLm5vZGVQb29sLmxlbmd0aCA8IDEyOCkgewogICAgICAgIHRoaXMubm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY3JlYXRlTm9kZQogICAgICovCgoKICAgIGNyZWF0ZU5vZGUoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYm9keTogbnVsbCwKICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgZXFzOiBbXSwKICAgICAgICB2aXNpdGVkOiBmYWxzZQogICAgICB9OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSB0aGUgc3Vic3lzdGVtcwogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgY29uc3Qgbm9kZXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlczsKICAgICAgY29uc3Qgbm9kZVBvb2wgPSB0aGlzLm5vZGVQb29sOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3Qgc3Vic29sdmVyID0gdGhpcy5zdWJzb2x2ZXI7IC8vIENyZWF0ZSBuZWVkZWQgbm9kZXMsIHJldXNlIGlmIHBvc3NpYmxlCgogICAgICB3aGlsZSAobm9kZVBvb2wubGVuZ3RoIDwgTmJvZGllcykgewogICAgICAgIG5vZGVQb29sLnB1c2godGhpcy5jcmVhdGVOb2RlKCkpOwogICAgICB9CgogICAgICBub2Rlcy5sZW5ndGggPSBOYm9kaWVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOYm9kaWVzOyBpKyspIHsKICAgICAgICBub2Rlc1tpXSA9IG5vZGVQb29sW2ldOwogICAgICB9IC8vIFJlc2V0IG5vZGUgdmFsdWVzCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKICAgICAgICBub2RlLmJvZHkgPSBib2RpZXNbaV07CiAgICAgICAgbm9kZS5jaGlsZHJlbi5sZW5ndGggPSAwOwogICAgICAgIG5vZGUuZXFzLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS52aXNpdGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBOZXE7IGsrKykgewogICAgICAgIGNvbnN0IGVxID0gZXF1YXRpb25zW2tdOwogICAgICAgIGNvbnN0IGkgPSBib2RpZXMuaW5kZXhPZihlcS5iaSk7CiAgICAgICAgY29uc3QgaiA9IGJvZGllcy5pbmRleE9mKGVxLmJqKTsKICAgICAgICBjb25zdCBuaSA9IG5vZGVzW2ldOwogICAgICAgIGNvbnN0IG5qID0gbm9kZXNbal07CiAgICAgICAgbmkuY2hpbGRyZW4ucHVzaChuaik7CiAgICAgICAgbmkuZXFzLnB1c2goZXEpOwogICAgICAgIG5qLmNoaWxkcmVuLnB1c2gobmkpOwogICAgICAgIG5qLmVxcy5wdXNoKGVxKTsKICAgICAgfQoKICAgICAgbGV0IGNoaWxkOwogICAgICBsZXQgbiA9IDA7CiAgICAgIGxldCBlcXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9lcXM7CiAgICAgIHN1YnNvbHZlci50b2xlcmFuY2UgPSB0aGlzLnRvbGVyYW5jZTsKICAgICAgc3Vic29sdmVyLml0ZXJhdGlvbnMgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IGR1bW15V29ybGQgPSBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkOwoKICAgICAgd2hpbGUgKGNoaWxkID0gZ2V0VW52aXNpdGVkTm9kZShub2RlcykpIHsKICAgICAgICBlcXMubGVuZ3RoID0gMDsKICAgICAgICBkdW1teVdvcmxkLmJvZGllcy5sZW5ndGggPSAwOwogICAgICAgIGJmcyhjaGlsZCwgdmlzaXRGdW5jLCBkdW1teVdvcmxkLmJvZGllcywgZXFzKTsKICAgICAgICBjb25zdCBOZXFzID0gZXFzLmxlbmd0aDsKICAgICAgICBlcXMgPSBlcXMuc29ydChzb3J0QnlJZCk7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXFzOyBpKyspIHsKICAgICAgICAgIHN1YnNvbHZlci5hZGRFcXVhdGlvbihlcXNbaV0pOwogICAgICAgIH0KCiAgICAgICAgc3Vic29sdmVyLnNvbHZlKGR0LCBkdW1teVdvcmxkKTsKICAgICAgICBzdWJzb2x2ZXIucmVtb3ZlQWxsRXF1YXRpb25zKCk7CiAgICAgICAgbisrOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KCiAgfSAvLyBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc3Vic3lzdGVtcwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlcyA9IFtdOyAvLyBBbGwgYWxsb2NhdGVkIG5vZGUgb2JqZWN0cwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9lcXMgPSBbXTsgLy8gVGVtcCBhcnJheQoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkID0gewogICAgYm9kaWVzOiBbXQogIH07IC8vIFRlbXAgb2JqZWN0CgogIGNvbnN0IFNUQVRJQyA9IEJvZHkuU1RBVElDOwoKICBmdW5jdGlvbiBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSB7CiAgICBjb25zdCBObm9kZXMgPSBub2Rlcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ub2RlczsgaSsrKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKCiAgICAgIGlmICghbm9kZS52aXNpdGVkICYmICEobm9kZS5ib2R5LnR5cGUgJiBTVEFUSUMpKSB7CiAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBjb25zdCBxdWV1ZSA9IFtdOwoKICBmdW5jdGlvbiBiZnMocm9vdCwgdmlzaXRGdW5jLCBiZHMsIGVxcykgewogICAgcXVldWUucHVzaChyb290KTsKICAgIHJvb3QudmlzaXRlZCA9IHRydWU7CiAgICB2aXNpdEZ1bmMocm9vdCwgYmRzLCBlcXMpOwoKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOyAvLyBMb29wIG92ZXIgdW52aXNpdGVkIGNoaWxkIG5vZGVzCgogICAgICBsZXQgY2hpbGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGUuY2hpbGRyZW4pKSB7CiAgICAgICAgY2hpbGQudmlzaXRlZCA9IHRydWU7CiAgICAgICAgdmlzaXRGdW5jKGNoaWxkLCBiZHMsIGVxcyk7CiAgICAgICAgcXVldWUucHVzaChjaGlsZCk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHZpc2l0RnVuYyhub2RlLCBiZHMsIGVxcykgewogICAgYmRzLnB1c2gobm9kZS5ib2R5KTsKICAgIGNvbnN0IE5lcXMgPSBub2RlLmVxcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICBjb25zdCBlcSA9IG5vZGUuZXFzW2ldOwoKICAgICAgaWYgKCFlcXMuaW5jbHVkZXMoZXEpKSB7CiAgICAgICAgZXFzLnB1c2goZXEpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzb3J0QnlJZChhLCBiKSB7CiAgICByZXR1cm4gYi5pZCAtIGEuaWQ7CiAgfQoKICAvKioKICAgKiBGb3IgcG9vbGluZyBvYmplY3RzIHRoYXQgY2FuIGJlIHJldXNlZC4KICAgKi8KICBjbGFzcyBQb29sIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLm9iamVjdHMgPSBbXTsKICAgICAgdGhpcy50eXBlID0gT2JqZWN0OwogICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSBhbiBvYmplY3QgYWZ0ZXIgdXNlCiAgICAgKi8KICAgIHJlbGVhc2UoKSB7CiAgICAgIGNvbnN0IE5hcmdzID0gYXJndW1lbnRzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYXJnczsgaSsrKSB7CiAgICAgICAgdGhpcy5vYmplY3RzLnB1c2goaSA8IDAgfHwgYXJndW1lbnRzLmxlbmd0aCA8PSBpID8gdW5kZWZpbmVkIDogYXJndW1lbnRzW2ldKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBvYmplY3QKICAgICAqLwoKCiAgICBnZXQoKSB7CiAgICAgIGlmICh0aGlzLm9iamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0T2JqZWN0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMub2JqZWN0cy5wb3AoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYW4gb2JqZWN0LiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gZWFjaCBzdWJjbGFzcy4KICAgICAqLwoKCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY29uc3RydWN0T2JqZWN0KCkgbm90IGltcGxlbWVudGVkIGluIHRoaXMgUG9vbCBzdWJjbGFzcyB5ZXQhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gU2VsZiwgZm9yIGNoYWluaW5nCiAgICAgKi8KCgogICAgcmVzaXplKHNpemUpIHsKICAgICAgY29uc3Qgb2JqZWN0cyA9IHRoaXMub2JqZWN0czsKCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA+IHNpemUpIHsKICAgICAgICBvYmplY3RzLnBvcCgpOwogICAgICB9CgogICAgICB3aGlsZSAob2JqZWN0cy5sZW5ndGggPCBzaXplKSB7CiAgICAgICAgb2JqZWN0cy5wdXNoKHRoaXMuY29uc3RydWN0T2JqZWN0KCkpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfQoKICAvKioKICAgKiBWZWMzUG9vbAogICAqLwoKICBjbGFzcyBWZWMzUG9vbCBleHRlbmRzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7CiAgICAgIHRoaXMudHlwZSA9IFZlYzM7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB2ZWN0b3IKICAgICAqLwogICAgY29uc3RydWN0T2JqZWN0KCkgewogICAgICByZXR1cm4gbmV3IFZlYzMoKTsKICAgIH0KCiAgfQoKICAvLyBOYW1pbmcgcnVsZTogYmFzZWQgb2YgdGhlIG9yZGVyIGluIFNIQVBFX1RZUEVTLAogIC8vIHRoZSBmaXJzdCBwYXJ0IG9mIHRoZSBtZXRob2QgaXMgZm9ybWVkIGJ5IHRoZQogIC8vIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBiZWZvcmUsIGluIHRoZSBzZWNvbmQgcGFydAogIC8vIHRoZXJlIGlzIHRoZSBzaGFwZSB0eXBlIHRoYXQgY29tZXMgYWZ0ZXIgaW4gdGhlIFNIQVBFX1RZUEVTIGxpc3QKICBjb25zdCBDT0xMSVNJT05fVFlQRVMgPSB7CiAgICBzcGhlcmVTcGhlcmU6IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHNwaGVyZVBsYW5lOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5QTEFORSwKICAgIGJveEJveDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQk9YLAogICAgc3BoZXJlQm94OiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBwbGFuZUJveDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBjb252ZXhDb252ZXg6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVDb252ZXg6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBwbGFuZUNvbnZleDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgYm94Q29udmV4OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgc3BoZXJlSGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgYm94SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgY29udmV4SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRCwKICAgIHNwaGVyZVBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHBsYW5lUGFydGljbGU6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBib3hQYXJ0aWNsZTogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBjb252ZXhQYXJ0aWNsZTogU2hhcGUudHlwZXMuUEFSVElDTEUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgY3lsaW5kZXJDeWxpbmRlcjogU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVDeWxpbmRlcjogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwbGFuZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgYm94Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgY29udmV4Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIGhlaWdodGZpZWxkQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwYXJ0aWNsZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgc3BoZXJlVHJpbWVzaDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuVFJJTUVTSCwKICAgIHBsYW5lVHJpbWVzaDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5UUklNRVNICiAgfTsKCiAgLyoqCiAgICogSGVscGVyIGNsYXNzIGZvciB0aGUgV29ybGQuIEdlbmVyYXRlcyBDb250YWN0RXF1YXRpb25zLgogICAqIEB0b2RvIFNwaGVyZS1Db252ZXhQb2x5aGVkcm9uIGNvbnRhY3RzCiAgICogQHRvZG8gQ29udGFjdCByZWR1Y3Rpb24KICAgKiBAdG9kbyBzaG91bGQgbW92ZSBtZXRob2RzIHRvIHByb3RvdHlwZQogICAqLwogIGNsYXNzIE5hcnJvd3BoYXNlIHsKICAgIC8qKgogICAgICogSW50ZXJuYWwgc3RvcmFnZSBvZiBwb29sZWQgY29udGFjdCBwb2ludHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBvb2xlZCB2ZWN0b3JzLgogICAgICovCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVTcGhlcmVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlUGxhbmVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVQbGFuZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5ib3hCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQm94XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQm94OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQm94XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUNvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wbGFuZUNvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveENvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lUGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveFBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94UGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jeWxpbmRlckN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5ib3hDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5oZWlnaHRmaWVsZEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wYXJ0aWNsZUN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGFydGljbGVDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVUcmltZXNoXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlVHJpbWVzaDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wbGFuZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVRyaW1lc2g7CiAgICB9IC8vIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleFRyaW1lc2hdKCkgewogICAgLy8gICByZXR1cm4gdGhpcy5jb252ZXhUcmltZXNoCiAgICAvLyB9CgoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107CiAgICAgIHRoaXMucmVzdWx0ID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBbXTsKICAgICAgdGhpcy52M3Bvb2wgPSBuZXcgVmVjM1Bvb2woKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICB0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgYSBjb250YWN0IG9iamVjdCwgYnkgdXNpbmcgdGhlIGludGVybmFsIHBvb2wgb3IgY3JlYXRpbmcgYSBuZXcgb25lLgogICAgICovCgoKICAgIGNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgb3ZlcnJpZGVTaGFwZUEsIG92ZXJyaWRlU2hhcGVCKSB7CiAgICAgIGxldCBjOwoKICAgICAgaWYgKHRoaXMuY29udGFjdFBvaW50UG9vbC5sZW5ndGgpIHsKICAgICAgICBjID0gdGhpcy5jb250YWN0UG9pbnRQb29sLnBvcCgpOwogICAgICAgIGMuYmkgPSBiaTsKICAgICAgICBjLmJqID0gYmo7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IG5ldyBDb250YWN0RXF1YXRpb24oYmksIGJqKTsKICAgICAgfQoKICAgICAgYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOwogICAgICBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgIGMuc2V0U3Bvb2tQYXJhbXMoY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLCBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLCB0aGlzLndvcmxkLmR0KTsKICAgICAgY29uc3QgbWF0QSA9IHNpLm1hdGVyaWFsIHx8IGJpLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRCID0gc2oubWF0ZXJpYWwgfHwgYmoubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEucmVzdGl0dXRpb24gPj0gMCAmJiBtYXRCLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICBjLnJlc3RpdHV0aW9uID0gbWF0QS5yZXN0aXR1dGlvbiAqIG1hdEIucmVzdGl0dXRpb247CiAgICAgIH0KCiAgICAgIGMuc2kgPSBvdmVycmlkZVNoYXBlQSB8fCBzaTsKICAgICAgYy5zaiA9IG92ZXJyaWRlU2hhcGVCIHx8IHNqOwogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBjcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcXVhdGlvbiwgb3V0QXJyYXkpIHsKICAgICAgY29uc3QgYm9keUEgPSBjb250YWN0RXF1YXRpb24uYmk7CiAgICAgIGNvbnN0IGJvZHlCID0gY29udGFjdEVxdWF0aW9uLmJqOwogICAgICBjb25zdCBzaGFwZUEgPSBjb250YWN0RXF1YXRpb24uc2k7CiAgICAgIGNvbnN0IHNoYXBlQiA9IGNvbnRhY3RFcXVhdGlvbi5zajsKICAgICAgY29uc3Qgd29ybGQgPSB0aGlzLndvcmxkOwogICAgICBjb25zdCBjbSA9IHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbDsgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgbGV0IGZyaWN0aW9uID0gY20uZnJpY3Rpb247CiAgICAgIGNvbnN0IG1hdEEgPSBzaGFwZUEubWF0ZXJpYWwgfHwgYm9keUEubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzaGFwZUIubWF0ZXJpYWwgfHwgYm9keUIubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEuZnJpY3Rpb24gPj0gMCAmJiBtYXRCLmZyaWN0aW9uID49IDApIHsKICAgICAgICBmcmljdGlvbiA9IG1hdEEuZnJpY3Rpb24gKiBtYXRCLmZyaWN0aW9uOwogICAgICB9CgogICAgICBpZiAoZnJpY3Rpb24gPiAwKSB7CiAgICAgICAgLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICBjb25zdCBtdWcgPSBmcmljdGlvbiAqIHdvcmxkLmdyYXZpdHkubGVuZ3RoKCk7CiAgICAgICAgbGV0IHJlZHVjZWRNYXNzID0gYm9keUEuaW52TWFzcyArIGJvZHlCLmludk1hc3M7CgogICAgICAgIGlmIChyZWR1Y2VkTWFzcyA+IDApIHsKICAgICAgICAgIHJlZHVjZWRNYXNzID0gMSAvIHJlZHVjZWRNYXNzOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcG9vbCA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgY29uc3QgYzEgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjb25zdCBjMiA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJvZHlBLCBib2R5QiwgbXVnICogcmVkdWNlZE1hc3MpOwogICAgICAgIGMxLmJpID0gYzIuYmkgPSBib2R5QTsKICAgICAgICBjMS5iaiA9IGMyLmJqID0gYm9keUI7CiAgICAgICAgYzEubWluRm9yY2UgPSBjMi5taW5Gb3JjZSA9IC1tdWcgKiByZWR1Y2VkTWFzczsKICAgICAgICBjMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnICogcmVkdWNlZE1hc3M7IC8vIENvcHkgb3ZlciB0aGUgcmVsYXRpdmUgdmVjdG9ycwoKICAgICAgICBjMS5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzEucmouY29weShjb250YWN0RXF1YXRpb24ucmopOwogICAgICAgIGMyLnJpLmNvcHkoY29udGFjdEVxdWF0aW9uLnJpKTsKICAgICAgICBjMi5yai5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaik7IC8vIENvbnN0cnVjdCB0YW5nZW50cwoKICAgICAgICBjb250YWN0RXF1YXRpb24ubmkudGFuZ2VudHMoYzEudCwgYzIudCk7IC8vIFNldCBzcG9vayBwYXJhbXMKCiAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMi5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgd29ybGQuZHQpOwogICAgICAgIGMxLmVuYWJsZWQgPSBjMi5lbmFibGVkID0gY29udGFjdEVxdWF0aW9uLmVuYWJsZWQ7CiAgICAgICAgb3V0QXJyYXkucHVzaChjMSwgYzIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFRha2UgdGhlIGF2ZXJhZ2UgTiBsYXRlc3QgY29udGFjdCBwb2ludCBvbiB0aGUgcGxhbmUuCiAgICAgKi8KCgogICAgY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cykgewogICAgICAvLyBUaGUgbGFzdCBjb250YWN0RXF1YXRpb24KICAgICAgbGV0IGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxXTsgLy8gQ3JlYXRlIHRoZSByZXN1bHQ6IHR3byAiYXZlcmFnZSIgZnJpY3Rpb24gZXF1YXRpb25zCgogICAgICBpZiAoIXRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjLCB0aGlzLmZyaWN0aW9uUmVzdWx0KSB8fCBudW1Db250YWN0cyA9PT0gMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgZjEgPSB0aGlzLmZyaWN0aW9uUmVzdWx0W3RoaXMuZnJpY3Rpb25SZXN1bHQubGVuZ3RoIC0gMl07CiAgICAgIGNvbnN0IGYyID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDFdOwogICAgICBhdmVyYWdlTm9ybWFsLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEuc2V0WmVybygpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zZXRaZXJvKCk7CiAgICAgIGNvbnN0IGJvZHlBID0gYy5iaTsKICAgICAgYy5iajsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBudW1Db250YWN0czsgaSsrKSB7CiAgICAgICAgYyA9IHRoaXMucmVzdWx0W3RoaXMucmVzdWx0Lmxlbmd0aCAtIDEgLSBpXTsKCiAgICAgICAgaWYgKGMuYmkgIT09IGJvZHlBKSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZhZGQoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaiwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZzdWIoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaSwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgaW52TnVtQ29udGFjdHMgPSAxIC8gbnVtQ29udGFjdHM7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaSk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaik7CiAgICAgIGYyLnJpLmNvcHkoZjEucmkpOyAvLyBTaG91bGQgYmUgdGhlIHNhbWUKCiAgICAgIGYyLnJqLmNvcHkoZjEucmopOwogICAgICBhdmVyYWdlTm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBhdmVyYWdlTm9ybWFsLnRhbmdlbnRzKGYxLnQsIGYyLnQpOyAvLyByZXR1cm4gZXE7CiAgICB9CiAgICAvKioKICAgICAqIEdlbmVyYXRlIGFsbCBjb250YWN0cyBiZXR3ZWVuIGEgbGlzdCBvZiBib2R5IHBhaXJzCiAgICAgKiBAcGFyYW0gcDEgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcDIgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFycmF5IHRvIHN0b3JlIGdlbmVyYXRlZCBjb250YWN0cwogICAgICogQHBhcmFtIG9sZGNvbnRhY3RzIE9wdGlvbmFsLiBBcnJheSBvZiByZXVzYWJsZSBjb250YWN0IG9iamVjdHMKICAgICAqLwoKCiAgICBnZXRDb250YWN0cyhwMSwgcDIsIHdvcmxkLCByZXN1bHQsIG9sZGNvbnRhY3RzLCBmcmljdGlvblJlc3VsdCwgZnJpY3Rpb25Qb29sKSB7CiAgICAgIC8vIFNhdmUgb2xkIGNvbnRhY3Qgb2JqZWN0cwogICAgICB0aGlzLmNvbnRhY3RQb2ludFBvb2wgPSBvbGRjb250YWN0czsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IGZyaWN0aW9uUG9vbDsKICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBmcmljdGlvblJlc3VsdDsKICAgICAgY29uc3QgcWkgPSB0bXBRdWF0MTsKICAgICAgY29uc3QgcWogPSB0bXBRdWF0MjsKICAgICAgY29uc3QgeGkgPSB0bXBWZWMxOwogICAgICBjb25zdCB4aiA9IHRtcFZlYzI7CgogICAgICBmb3IgKGxldCBrID0gMCwgTiA9IHAxLmxlbmd0aDsgayAhPT0gTjsgaysrKSB7CiAgICAgICAgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGJvZGllcwogICAgICAgIGNvbnN0IGJpID0gcDFba107CiAgICAgICAgY29uc3QgYmogPSBwMltrXTsgLy8gR2V0IGNvbnRhY3QgbWF0ZXJpYWwKCiAgICAgICAgbGV0IGJvZHlDb250YWN0TWF0ZXJpYWwgPSBudWxsOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGJvZHlDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCBudWxsOwogICAgICAgIH0KCiAgICAgICAgY29uc3QganVzdFRlc3QgPSBiaS50eXBlICYgQm9keS5LSU5FTUFUSUMgJiYgYmoudHlwZSAmIEJvZHkuU1RBVElDIHx8IGJpLnR5cGUgJiBCb2R5LlNUQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUMgfHwgYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LktJTkVNQVRJQzsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaS5zaGFwZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJpLnF1YXRlcm5pb24ubXVsdChiaS5zaGFwZU9yaWVudGF0aW9uc1tpXSwgcWkpOwogICAgICAgICAgYmkucXVhdGVybmlvbi52bXVsdChiaS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICAgIHhpLnZhZGQoYmkucG9zaXRpb24sIHhpKTsKICAgICAgICAgIGNvbnN0IHNpID0gYmkuc2hhcGVzW2ldOwoKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmouc2hhcGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIC8vIENvbXB1dGUgd29ybGQgdHJhbnNmb3JtIG9mIHNoYXBlcwogICAgICAgICAgICBiai5xdWF0ZXJuaW9uLm11bHQoYmouc2hhcGVPcmllbnRhdGlvbnNbal0sIHFqKTsKICAgICAgICAgICAgYmoucXVhdGVybmlvbi52bXVsdChiai5zaGFwZU9mZnNldHNbal0sIHhqKTsKICAgICAgICAgICAgeGoudmFkZChiai5wb3NpdGlvbiwgeGopOwogICAgICAgICAgICBjb25zdCBzaiA9IGJqLnNoYXBlc1tqXTsKCiAgICAgICAgICAgIGlmICghKHNpLmNvbGxpc2lvbkZpbHRlck1hc2sgJiBzai5jb2xsaXNpb25GaWx0ZXJHcm91cCAmJiBzai5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2kuY29sbGlzaW9uRmlsdGVyR3JvdXApKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSAvLyBHZXQgY29sbGlzaW9uIG1hdGVyaWFsCgoKICAgICAgICAgICAgbGV0IHNoYXBlQ29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChzaS5tYXRlcmlhbCAmJiBzai5tYXRlcmlhbCkgewogICAgICAgICAgICAgIHNoYXBlQ29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKHNpLm1hdGVyaWFsLCBzai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsID0gc2hhcGVDb250YWN0TWF0ZXJpYWwgfHwgYm9keUNvbnRhY3RNYXRlcmlhbCB8fCB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOyAvLyBHZXQgY29udGFjdHMKCiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVySW5kZXggPSBzaS50eXBlIHwgc2oudHlwZTsKICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXIgPSB0aGlzW3Jlc29sdmVySW5kZXhdOwoKICAgICAgICAgICAgaWYgKHJlc29sdmVyKSB7CiAgICAgICAgICAgICAgbGV0IHJldHZhbCA9IGZhbHNlOyAvLyBUTyBETzogaW52ZXN0aWdhdGUgd2h5IHNwaGVyZVBhcnRpY2xlIGFuZCBjb252ZXhQYXJ0aWNsZQogICAgICAgICAgICAgIC8vIHJlc29sdmVycyBleHBlY3Qgc2kgYW5kIHNqIHNoYXBlcyB0byBiZSBpbiByZXZlcnNlIG9yZGVyCiAgICAgICAgICAgICAgLy8gKGkuZS4gbGFyZ2VyIGludGVnZXIgdmFsdWUgdHlwZSBmaXJzdCBpbnN0ZWFkIG9mIHNtYWxsZXIgZmlyc3QpCgogICAgICAgICAgICAgIGlmIChzaS50eXBlIDwgc2oudHlwZSkgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR2YWwgPSByZXNvbHZlci5jYWxsKHRoaXMsIHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocmV0dmFsICYmIGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICAvLyBSZWdpc3RlciBvdmVybGFwCiAgICAgICAgICAgICAgICB3b3JsZC5zaGFwZU92ZXJsYXBLZWVwZXIuc2V0KHNpLmlkLCBzai5pZCk7CiAgICAgICAgICAgICAgICB3b3JsZC5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVTcGhlcmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgcmV0dXJuIHhpLmRpc3RhbmNlU3F1YXJlZCh4aikgPCAoc2kucmFkaXVzICsgc2oucmFkaXVzKSAqKiAyOwogICAgICB9IC8vIFdlIHdpbGwgaGF2ZSBvbmx5IG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQoKCiAgICAgIGNvbnN0IGNvbnRhY3RFcSA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICB4ai52c3ViKHhpLCBjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEubmkubm9ybWFsaXplKCk7IC8vIENvbnRhY3QgcG9pbnQgbG9jYXRpb25zCgogICAgICBjb250YWN0RXEucmkuY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmouY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmkuc2NhbGUoc2kucmFkaXVzLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmouc2NhbGUoLXNqLnJhZGl1cywgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJpLnZhZGQoeGksIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yaS52c3ViKGJpLnBvc2l0aW9uLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmoudmFkZCh4aiwgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJqLnZzdWIoYmoucG9zaXRpb24sIGNvbnRhY3RFcS5yaik7CiAgICAgIHRoaXMucmVzdWx0LnB1c2goY29udGFjdEVxKTsKICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcSwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICB9CgogICAgc3BoZXJlUGxhbmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gV2Ugd2lsbCBoYXZlIG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQogICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgIHIubmkuc2V0KDAsIDAsIDEpOwogICAgICBxai52bXVsdChyLm5pLCByLm5pKTsKICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIGJvZHkgaSBpcyB0aGUgc3BoZXJlLCBmbGlwIG5vcm1hbAoKICAgICAgci5uaS5ub3JtYWxpemUoKTsgLy8gTmVlZGVkPwogICAgICAvLyBWZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QgcG9pbnQKCiAgICAgIHIubmkuc2NhbGUoc2kucmFkaXVzLCByLnJpKTsgLy8gUHJvamVjdCBkb3duIHNwaGVyZSBvbiBwbGFuZQoKICAgICAgeGkudnN1Yih4aiwgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKTsKICAgICAgci5uaS5zY2FsZShyLm5pLmRvdChwb2ludF9vbl9wbGFuZV90b19zcGhlcmUpLCBwbGFuZV90b19zcGhlcmVfb3J0aG8pOwogICAgICBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUudnN1YihwbGFuZV90b19zcGhlcmVfb3J0aG8sIHIucmopOyAvLyBUaGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byBwbGFuZQoKICAgICAgaWYgKC1wb2ludF9vbl9wbGFuZV90b19zcGhlcmUuZG90KHIubmkpIDw9IHNpLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgoKICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveEJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4KHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7IC8vIHdlIHJlZmVyIHRvIHRoZSBib3ggYXMgYm9keSBqCgogICAgICBjb25zdCBzaWRlcyA9IHNwaGVyZUJveF9zaWRlczsKICAgICAgeGkudnN1Yih4aiwgYm94X3RvX3NwaGVyZSk7CiAgICAgIHNqLmdldFNpZGVOb3JtYWxzKHNpZGVzLCBxaik7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CgogICAgICBsZXQgZm91bmQgPSBmYWxzZTsgLy8gU3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIHBlbmV0cmF0aW9uIGluZm8KCiAgICAgIGNvbnN0IHNpZGVfbnMgPSBzcGhlcmVCb3hfc2lkZV9uczsKICAgICAgY29uc3Qgc2lkZV9uczEgPSBzcGhlcmVCb3hfc2lkZV9uczE7CiAgICAgIGNvbnN0IHNpZGVfbnMyID0gc3BoZXJlQm94X3NpZGVfbnMyOwogICAgICBsZXQgc2lkZV9oID0gbnVsbDsKICAgICAgbGV0IHNpZGVfcGVuZXRyYXRpb25zID0gMDsKICAgICAgbGV0IHNpZGVfZG90MSA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDIgPSAwOwogICAgICBsZXQgc2lkZV9kaXN0YW5jZSA9IG51bGw7CgogICAgICBmb3IgKGxldCBpZHggPSAwLCBuc2lkZXMgPSBzaWRlcy5sZW5ndGg7IGlkeCAhPT0gbnNpZGVzICYmIGZvdW5kID09PSBmYWxzZTsgaWR4KyspIHsKICAgICAgICAvLyBHZXQgdGhlIHBsYW5lIHNpZGUgbm9ybWFsIChucykKICAgICAgICBjb25zdCBucyA9IHNwaGVyZUJveF9uczsKICAgICAgICBucy5jb3B5KHNpZGVzW2lkeF0pOwogICAgICAgIGNvbnN0IGggPSBucy5sZW5ndGgoKTsKICAgICAgICBucy5ub3JtYWxpemUoKTsgLy8gVGhlIG5vcm1hbC9kaXN0YW5jZSBkb3QgcHJvZHVjdCB0ZWxscyB3aGljaCBzaWRlIG9mIHRoZSBwbGFuZSB3ZSBhcmUKCiAgICAgICAgY29uc3QgZG90ID0gYm94X3RvX3NwaGVyZS5kb3QobnMpOwoKICAgICAgICBpZiAoZG90IDwgaCArIFIgJiYgZG90ID4gMCkgewogICAgICAgICAgLy8gSW50ZXJzZWN0cyBwbGFuZS4gTm93IGNoZWNrIHRoZSBvdGhlciB0d28gZGltZW5zaW9ucwogICAgICAgICAgY29uc3QgbnMxID0gc3BoZXJlQm94X25zMTsKICAgICAgICAgIGNvbnN0IG5zMiA9IHNwaGVyZUJveF9uczI7CiAgICAgICAgICBuczEuY29weShzaWRlc1soaWR4ICsgMSkgJSAzXSk7CiAgICAgICAgICBuczIuY29weShzaWRlc1soaWR4ICsgMikgJSAzXSk7CiAgICAgICAgICBjb25zdCBoMSA9IG5zMS5sZW5ndGgoKTsKICAgICAgICAgIGNvbnN0IGgyID0gbnMyLmxlbmd0aCgpOwogICAgICAgICAgbnMxLm5vcm1hbGl6ZSgpOwogICAgICAgICAgbnMyLm5vcm1hbGl6ZSgpOwogICAgICAgICAgY29uc3QgZG90MSA9IGJveF90b19zcGhlcmUuZG90KG5zMSk7CiAgICAgICAgICBjb25zdCBkb3QyID0gYm94X3RvX3NwaGVyZS5kb3QobnMyKTsKCiAgICAgICAgICBpZiAoZG90MSA8IGgxICYmIGRvdDEgPiAtaDEgJiYgZG90MiA8IGgyICYmIGRvdDIgPiAtaDIpIHsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguYWJzKGRvdCAtIGggLSBSKTsKCiAgICAgICAgICAgIGlmIChzaWRlX2Rpc3RhbmNlID09PSBudWxsIHx8IGRpc3QgPCBzaWRlX2Rpc3RhbmNlKSB7CiAgICAgICAgICAgICAgc2lkZV9kaXN0YW5jZSA9IGRpc3Q7CiAgICAgICAgICAgICAgc2lkZV9kb3QxID0gZG90MTsKICAgICAgICAgICAgICBzaWRlX2RvdDIgPSBkb3QyOwogICAgICAgICAgICAgIHNpZGVfaCA9IGg7CiAgICAgICAgICAgICAgc2lkZV9ucy5jb3B5KG5zKTsKICAgICAgICAgICAgICBzaWRlX25zMS5jb3B5KG5zMSk7CiAgICAgICAgICAgICAgc2lkZV9uczIuY29weShuczIpOwogICAgICAgICAgICAgIHNpZGVfcGVuZXRyYXRpb25zKys7CgogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoc2lkZV9wZW5ldHJhdGlvbnMpIHsKICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgc2lkZV9ucy5zY2FsZSgtUiwgci5yaSk7IC8vIFNwaGVyZSByCgogICAgICAgIHIubmkuY29weShzaWRlX25zKTsKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHNob3VsZCBiZSBvdXQgb2Ygc3BoZXJlCgogICAgICAgIHNpZGVfbnMuc2NhbGUoc2lkZV9oLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMS5zY2FsZShzaWRlX2RvdDEsIHNpZGVfbnMxKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczEsIHNpZGVfbnMpOwogICAgICAgIHNpZGVfbnMyLnNjYWxlKHNpZGVfZG90Miwgc2lkZV9uczIpOwogICAgICAgIHNpZGVfbnMudmFkZChzaWRlX25zMiwgci5yaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0gLy8gQ2hlY2sgY29ybmVycwoKCiAgICAgIGxldCByaiA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3Qgc3BoZXJlX3RvX2Nvcm5lciA9IHNwaGVyZUJveF9zcGhlcmVfdG9fY29ybmVyOwoKICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IDIgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gMiAmJiAhZm91bmQ7IGsrKykgewogICAgICAgICAgZm9yIChsZXQgbCA9IDA7IGwgIT09IDIgJiYgIWZvdW5kOyBsKyspIHsKICAgICAgICAgICAgcmouc2V0KDAsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGopIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzBdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaykgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMV0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1syXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSAvLyBXb3JsZCBwb3NpdGlvbiBvZiBjb3JuZXIKCgogICAgICAgICAgICB4ai52YWRkKHJqLCBzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgICAgc3BoZXJlX3RvX2Nvcm5lci52c3ViKHhpLCBzcGhlcmVfdG9fY29ybmVyKTsKCiAgICAgICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgICAgci5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByLm5pLmNvcHkoci5yaSk7CiAgICAgICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgICAgICByLnJqLmNvcHkocmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShyaik7CiAgICAgIHJqID0gbnVsbDsgLy8gQ2hlY2sgZWRnZXMKCiAgICAgIGNvbnN0IGVkZ2VUYW5nZW50ID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBlZGdlQ2VudGVyID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCByID0gdjNwb29sLmdldCgpOyAvLyByID0gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlcgoKICAgICAgY29uc3Qgb3J0aG9nb25hbCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZGlzdCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgTnNpZGVzID0gc2lkZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5zaWRlcyAmJiAhZm91bmQ7IGorKykgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGlmIChqICUgMyAhPT0gayAlIDMpIHsKICAgICAgICAgICAgLy8gR2V0IGVkZ2UgdGFuZ2VudAogICAgICAgICAgICBzaWRlc1trXS5jcm9zcyhzaWRlc1tqXSwgZWRnZVRhbmdlbnQpOwogICAgICAgICAgICBlZGdlVGFuZ2VudC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgc2lkZXNbal0udmFkZChzaWRlc1trXSwgZWRnZUNlbnRlcik7CiAgICAgICAgICAgIHIuY29weSh4aSk7CiAgICAgICAgICAgIHIudnN1YihlZGdlQ2VudGVyLCByKTsKICAgICAgICAgICAgci52c3ViKHhqLCByKTsKICAgICAgICAgICAgY29uc3Qgb3J0aG9ub3JtID0gci5kb3QoZWRnZVRhbmdlbnQpOyAvLyBkaXN0YW5jZSBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIgaW4gdGhlIHRhbmdlbnQgZGlyZWN0aW9uCgogICAgICAgICAgICBlZGdlVGFuZ2VudC5zY2FsZShvcnRob25vcm0sIG9ydGhvZ29uYWwpOyAvLyBWZWN0b3IgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgogICAgICAgICAgICAvLyBGaW5kIHRoZSB0aGlyZCBzaWRlIG9ydGhvZ29uYWwgdG8gdGhpcyBvbmUKCiAgICAgICAgICAgIGxldCBsID0gMDsKCiAgICAgICAgICAgIHdoaWxlIChsID09PSBqICUgMyB8fCBsID09PSBrICUgMykgewogICAgICAgICAgICAgIGwrKzsKICAgICAgICAgICAgfSAvLyB2ZWMgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgcHJvamVjdGVkIHRvIHRoZSBwbGFuZSBvcnRob2dvbmFsIHRvIHRoZSBlZGdlIHRhbmdlbnQKCgogICAgICAgICAgICBkaXN0LmNvcHkoeGkpOwogICAgICAgICAgICBkaXN0LnZzdWIob3J0aG9nb25hbCwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1YihlZGdlQ2VudGVyLCBkaXN0KTsKICAgICAgICAgICAgZGlzdC52c3ViKHhqLCBkaXN0KTsgLy8gRGlzdGFuY2VzIGluIHRhbmdlbnQgZGlyZWN0aW9uIGFuZCBkaXN0YW5jZSBpbiB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byBpdAoKICAgICAgICAgICAgY29uc3QgdGRpc3QgPSBNYXRoLmFicyhvcnRob25vcm0pOwogICAgICAgICAgICBjb25zdCBuZGlzdCA9IGRpc3QubGVuZ3RoKCk7CgogICAgICAgICAgICBpZiAodGRpc3QgPCBzaWRlc1tsXS5sZW5ndGgoKSAmJiBuZGlzdCA8IFIpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbnN0IHJlcyA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgZWRnZUNlbnRlci52YWRkKG9ydGhvZ29uYWwsIHJlcy5yaik7IC8vIGJveCByagoKICAgICAgICAgICAgICByZXMucmouY29weShyZXMucmopOwogICAgICAgICAgICAgIGRpc3QubmVnYXRlKHJlcy5uaSk7CiAgICAgICAgICAgICAgcmVzLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHJlcy5yaS5jb3B5KHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGosIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHJlcy5yaS5zY2FsZShSLCByZXMucmkpOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgICAgICByZXMucmkudmFkZCh4aSwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkudnN1YihiaS5wb3NpdGlvbiwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmoudmFkZCh4aiwgcmVzLnJqKTsKICAgICAgICAgICAgICByZXMucmoudnN1Yihiai5wb3NpdGlvbiwgcmVzLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHJlcyk7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHJlcywgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHYzcG9vbC5yZWxlYXNlKGVkZ2VUYW5nZW50LCBlZGdlQ2VudGVyLCByLCBvcnRob2dvbmFsLCBkaXN0KTsKICAgIH0KCiAgICBwbGFuZUJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzai5tYXRlcmlhbDsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5pZCA9IHNqLmlkOwogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleChzaSwgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IHNlcEF4aXMgPSBjb252ZXhDb252ZXhfc2VwQXhpczsKCiAgICAgIGlmICh4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChzaS5maW5kU2VwYXJhdGluZ0F4aXMoc2osIHhpLCBxaSwgeGosIHFqLCBzZXBBeGlzLCBmYWNlTGlzdEEsIGZhY2VMaXN0QikpIHsKICAgICAgICBjb25zdCByZXMgPSBbXTsKICAgICAgICBjb25zdCBxID0gY29udmV4Q29udmV4X3E7CiAgICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLCBxaSwgc2osIHhqLCBxaiwgc2VwQXhpcywgLTEwMCwgMTAwLCByZXMpOwogICAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIGNvbnN0IHJpID0gci5yaTsKICAgICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICAgIHNlcEF4aXMubmVnYXRlKHIubmkpOwogICAgICAgICAgcmVzW2pdLm5vcm1hbC5uZWdhdGUocSk7CiAgICAgICAgICBxLnNjYWxlKHJlc1tqXS5kZXB0aCwgcSk7CiAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAgICAgICByai5jb3B5KHJlc1tqXS5wb2ludCk7IC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKCiAgICAgICAgICByaS52c3ViKHhpLCByaSk7CiAgICAgICAgICByai52c3ViKHhqLCByaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZUNvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCB2M3Bvb2wgPSB0aGlzLnYzcG9vbDsKICAgICAgeGkudnN1Yih4aiwgY29udmV4X3RvX3NwaGVyZSk7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBzai5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgZmFjZXMgPSBzai5mYWNlczsKICAgICAgY29uc3QgdmVydHMgPSBzai52ZXJ0aWNlczsKICAgICAgY29uc3QgUiA9IHNpLnJhZGl1czsKICAgICAgLy8gICAgIHJldHVybjsKICAgICAgLy8gfQoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIENoZWNrIGNvcm5lcnMKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB2ZXJ0cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgogICAgICAgIGNvbnN0IHdvcmxkQ29ybmVyID0gc3BoZXJlQ29udmV4X3dvcmxkQ29ybmVyOwogICAgICAgIHFqLnZtdWx0KHYsIHdvcmxkQ29ybmVyKTsKICAgICAgICB4ai52YWRkKHdvcmxkQ29ybmVyLCB3b3JsZENvcm5lcik7CiAgICAgICAgY29uc3Qgc3BoZXJlX3RvX2Nvcm5lciA9IHNwaGVyZUNvbnZleF9zcGhlcmVUb0Nvcm5lcjsKICAgICAgICB3b3JsZENvcm5lci52c3ViKHhpLCBzcGhlcmVfdG9fY29ybmVyKTsKCiAgICAgICAgaWYgKHNwaGVyZV90b19jb3JuZXIubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIHIucmkuY29weShzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICByLm5pLmNvcHkoci5yaSk7CiAgICAgICAgICByLnJpLnNjYWxlKFIsIHIucmkpOwogICAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gLy8gQ2hlY2sgc2lkZSAocGxhbmUpIGludGVyc2VjdGlvbnMKCgogICAgICBmb3IgKGxldCBpID0gMCwgbmZhY2VzID0gZmFjZXMubGVuZ3RoOyBpICE9PSBuZmFjZXMgJiYgZm91bmQgPT09IGZhbHNlOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtYWwgPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IGZhY2UgPSBmYWNlc1tpXTsgLy8gR2V0IHdvcmxkLXRyYW5zZm9ybWVkIG5vcm1hbCBvZiB0aGUgZmFjZQoKICAgICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbDsKICAgICAgICBxai52bXVsdChub3JtYWwsIHdvcmxkTm9ybWFsKTsgLy8gR2V0IGEgd29ybGQgdmVydGV4IGZyb20gdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGRQb2ludCA9IHNwaGVyZUNvbnZleF93b3JsZFBvaW50OwogICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbMF1dLCB3b3JsZFBvaW50KTsKICAgICAgICB3b3JsZFBvaW50LnZhZGQoeGosIHdvcmxkUG9pbnQpOyAvLyBHZXQgYSBwb2ludCBvbiB0aGUgc3BoZXJlLCBjbG9zZXN0IHRvIHRoZSBmYWNlIG5vcm1hbAoKICAgICAgICBjb25zdCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBzcGhlcmVDb252ZXhfd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lOwogICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUpOwogICAgICAgIHhpLnZhZGQod29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLCB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUpOyAvLyBWZWN0b3IgZnJvbSBhIGZhY2UgcG9pbnQgdG8gdGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHNwaGVyZQoKICAgICAgICBjb25zdCBwZW5ldHJhdGlvblZlYyA9IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYzsKICAgICAgICB3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUudnN1Yih3b3JsZFBvaW50LCBwZW5ldHJhdGlvblZlYyk7IC8vIFRoZSBwZW5ldHJhdGlvbi4gTmVnYXRpdmUgdmFsdWUgbWVhbnMgb3ZlcmxhcC4KCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb24gPSBwZW5ldHJhdGlvblZlYy5kb3Qod29ybGROb3JtYWwpOwogICAgICAgIGNvbnN0IHdvcmxkUG9pbnRUb1NwaGVyZSA9IHNwaGVyZUNvbnZleF9zcGhlcmVUb1dvcmxkUG9pbnQ7CiAgICAgICAgeGkudnN1Yih3b3JsZFBvaW50LCB3b3JsZFBvaW50VG9TcGhlcmUpOwoKICAgICAgICBpZiAocGVuZXRyYXRpb24gPCAwICYmIHdvcmxkUG9pbnRUb1NwaGVyZS5kb3Qod29ybGROb3JtYWwpID4gMCkgewogICAgICAgICAgLy8gSW50ZXJzZWN0cyBwbGFuZS4gTm93IGNoZWNrIGlmIHRoZSBzcGhlcmUgaXMgaW5zaWRlIHRoZSBmYWNlIHBvbHlnb24KICAgICAgICAgIGNvbnN0IGZhY2VWZXJ0cyA9IFtdOyAvLyBGYWNlIHZlcnRpY2VzLCBpbiB3b3JsZCBjb29yZHMKCiAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTnZlcnRzID0gZmFjZS5sZW5ndGg7IGogIT09IE52ZXJ0czsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IHdvcmxkVmVydGV4ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlW2pdXSwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICB4ai52YWRkKHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgICAgIGZhY2VWZXJ0cy5wdXNoKHdvcmxkVmVydGV4KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAocG9pbnRJblBvbHlnb24oZmFjZVZlcnRzLCB3b3JsZE5vcm1hbCwgeGkpKSB7CiAgICAgICAgICAgIC8vIElzIHRoZSBzcGhlcmUgY2VudGVyIGluIHRoZSBmYWNlIHBvbHlnb24/CiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgci5yaSk7IC8vIENvbnRhY3Qgb2Zmc2V0LCBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gY29udGFjdAoKICAgICAgICAgICAgd29ybGROb3JtYWwubmVnYXRlKHIubmkpOyAvLyBOb3JtYWwgcG9pbnRpbmcgb3V0IG9mIHNwaGVyZQoKICAgICAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtcGVuZXRyYXRpb24sIHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCBwZW5ldHJhdGlvblNwaGVyZVBvaW50KTsgLy94aS52c3ViKHhqKS52YWRkKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpLnZhZGQocGVuZXRyYXRpb25WZWMyICwgci5yaik7CgogICAgICAgICAgICB4aS52c3ViKHhqLCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQsIHIucmopOwogICAgICAgICAgICByLnJqLnZhZGQocGVuZXRyYXRpb25WZWMyLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocGVuZXRyYXRpb25WZWMyKTsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocGVuZXRyYXRpb25TcGhlcmVQb2ludCk7CiAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47IC8vIFdlIG9ubHkgZXhwZWN0ICpvbmUqIGZhY2UgY29udGFjdAogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gRWRnZT8KICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IGZhY2UubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgICAvLyBHZXQgdHdvIHdvcmxkIHRyYW5zZm9ybWVkIHZlcnRpY2VzCiAgICAgICAgICAgICAgY29uc3QgdjEgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgY29uc3QgdjIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVsoaiArIDEpICUgZmFjZS5sZW5ndGhdXSwgdjEpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAyKSAlIGZhY2UubGVuZ3RoXV0sIHYyKTsKICAgICAgICAgICAgICB4ai52YWRkKHYxLCB2MSk7CiAgICAgICAgICAgICAgeGoudmFkZCh2MiwgdjIpOyAvLyBDb25zdHJ1Y3QgZWRnZSB2ZWN0b3IKCiAgICAgICAgICAgICAgY29uc3QgZWRnZSA9IHNwaGVyZUNvbnZleF9lZGdlOwogICAgICAgICAgICAgIHYyLnZzdWIodjEsIGVkZ2UpOyAvLyBDb25zdHJ1Y3QgdGhlIHNhbWUgdmVjdG9yLCBidXQgbm9ybWFsaXplZAoKICAgICAgICAgICAgICBjb25zdCBlZGdlVW5pdCA9IHNwaGVyZUNvbnZleF9lZGdlVW5pdDsKICAgICAgICAgICAgICBlZGdlLnVuaXQoZWRnZVVuaXQpOyAvLyBwIGlzIHhpIHByb2plY3RlZCBvbnRvIHRoZSBlZGdlCgogICAgICAgICAgICAgIGNvbnN0IHAgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgY29uc3QgdjFfdG9feGkgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgeGkudnN1Yih2MSwgdjFfdG9feGkpOwogICAgICAgICAgICAgIGNvbnN0IGRvdCA9IHYxX3RvX3hpLmRvdChlZGdlVW5pdCk7CiAgICAgICAgICAgICAgZWRnZVVuaXQuc2NhbGUoZG90LCBwKTsKICAgICAgICAgICAgICBwLnZhZGQodjEsIHApOyAvLyBDb21wdXRlIGEgdmVjdG9yIGZyb20gcCB0byB0aGUgY2VudGVyIG9mIHRoZSBzcGhlcmUKCiAgICAgICAgICAgICAgY29uc3QgeGlfdG9fcCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBwLnZzdWIoeGksIHhpX3RvX3ApOyAvLyBDb2xsaXNpb24gaWYgdGhlIGVkZ2Utc3BoZXJlIGRpc3RhbmNlIGlzIGxlc3MgdGhhbiB0aGUgcmFkaXVzCiAgICAgICAgICAgICAgLy8gQU5EIGlmIHAgaXMgaW4gYmV0d2VlbiB2MSBhbmQgdjIKCiAgICAgICAgICAgICAgaWYgKGRvdCA+IDAgJiYgZG90ICogZG90IDwgZWRnZS5sZW5ndGhTcXVhcmVkKCkgJiYgeGlfdG9fcC5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgICAgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgICAgLy8gRWRnZSBjb250YWN0IQogICAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgICAgcC52c3ViKHhqLCByLnJqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aSwgci5uaSk7CiAgICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgICAgci5uaS5zY2FsZShSLCByLnJpKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOyAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgogICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MSk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHhpX3RvX3ApOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYyKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MV90b194aSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKCiAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHBsYW5lQ29udmV4KHBsYW5lU2hhcGUsIGNvbnZleFNoYXBlLCBwbGFuZVBvc2l0aW9uLCBjb252ZXhQb3NpdGlvbiwgcGxhbmVRdWF0LCBjb252ZXhRdWF0LCBwbGFuZUJvZHksIGNvbnZleEJvZHksIHNpLCBzaiwganVzdFRlc3QpIHsKICAgICAgLy8gU2ltcGx5IHJldHVybiB0aGUgcG9pbnRzIGJlaGluZCB0aGUgcGxhbmUuCiAgICAgIGNvbnN0IHdvcmxkVmVydGV4ID0gcGxhbmVDb252ZXhfdjsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBwbGFuZUNvbnZleF9ub3JtYWw7CiAgICAgIHdvcmxkTm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgcGxhbmVRdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgbGV0IG51bUNvbnRhY3RzID0gMDsKICAgICAgY29uc3QgcmVscG9zID0gcGxhbmVDb252ZXhfcmVscG9zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGNvbnZleFNoYXBlLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIGNvbnZleCB2ZXJ0ZXgKICAgICAgICB3b3JsZFZlcnRleC5jb3B5KGNvbnZleFNoYXBlLnZlcnRpY2VzW2ldKTsKICAgICAgICBjb252ZXhRdWF0LnZtdWx0KHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgY29udmV4UG9zaXRpb24udmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIHdvcmxkVmVydGV4LnZzdWIocGxhbmVQb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjb25zdCBkb3QgPSB3b3JsZE5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCBjb252ZXhCb2R5LCBwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgc2ksIHNqKTsgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZUNvbnZleF9wcm9qZWN0ZWQ7CiAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSh3b3JsZE5vcm1hbC5kb3QocmVscG9zKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOwogICAgICAgICAgcHJvamVjdGVkLnZzdWIocGxhbmVQb3NpdGlvbiwgci5yaSk7IC8vIEZyb20gcGxhbmUgdG8gdmVydGV4IHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIHIubmkuY29weSh3b3JsZE5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwgb3V0IGZyb20gcGxhbmUKICAgICAgICAgIC8vIHJqIGlzIG5vdyBqdXN0IHRoZSB2ZWN0b3IgZnJvbSB0aGUgY29udmV4IGNlbnRlciB0byB0aGUgdmVydGV4CgogICAgICAgICAgd29ybGRWZXJ0ZXgudnN1Yihjb252ZXhQb3NpdGlvbiwgci5yaik7IC8vIE1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIGJvZHkKCiAgICAgICAgICByLnJpLnZhZGQocGxhbmVQb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIocGxhbmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmoudmFkZChjb252ZXhQb3NpdGlvbiwgci5yaik7CiAgICAgICAgICByLnJqLnZzdWIoY29udmV4Qm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgbnVtQ29udGFjdHMrKzsKCiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gJiYgbnVtQ29udGFjdHMpIHsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpOwogICAgICB9CiAgICB9CgogICAgYm94Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4KHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHNwaGVyZUhlaWdodGZpZWxkKHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBzcGhlcmVQb3MsIGhmUG9zLCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGRhdGEgPSBoZlNoYXBlLmRhdGE7CiAgICAgIGNvbnN0IHJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgY29uc3QgdyA9IGhmU2hhcGUuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMjsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIHNwaGVyZVBvcywgbG9jYWxTcGhlcmVQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsU3BoZXJlUG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsU3BoZXJlUG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSBjYW4ndCB0b3VjaCB0aGUgYm91bmRpbmcgaGVpZ2h0IGJveAoKICAgICAgaWYgKGxvY2FsU3BoZXJlUG9zLnogLSByYWRpdXMgPiBtYXggfHwgbG9jYWxTcGhlcmVQb3MueiArIHJhZGl1cyA8IG1pbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgbnVtQ29udGFjdHNCZWZvcmUgPSByZXN1bHQubGVuZ3RoOwogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKHNwaGVyZVBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc3BoZXJlU2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5zcGhlcmVDb252ZXgoc3BoZXJlU2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBzcGhlcmVQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgc3BoZXJlU2hhcGUsIGhmU2hhcGUsIGp1c3RUZXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKHNwaGVyZVBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc3BoZXJlU2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5zcGhlcmVDb252ZXgoc3BoZXJlU2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBzcGhlcmVQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBzcGhlcmVRdWF0LCBoZlF1YXQsIHNwaGVyZUJvZHksIGhmQm9keSwgc3BoZXJlU2hhcGUsIGhmU2hhcGUsIGp1c3RUZXN0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzID0gcmVzdWx0Lmxlbmd0aCAtIG51bUNvbnRhY3RzQmVmb3JlOwoKICAgICAgICAgIGlmIChudW1Db250YWN0cyA+IDIpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgLyoKICAgICAgICAgICAgLy8gU2tpcCBhbGwgYnV0IDEKICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBudW1Db250YWN0cyAtIDE7IGsrKykgewogICAgICAgICAgICAgICAgcmVzdWx0LnBvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAqLwoKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBib3hIZWlnaHRmaWVsZChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkKHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleEhlaWdodGZpZWxkKGNvbnZleFNoYXBlLCBoZlNoYXBlLCBjb252ZXhQb3MsIGhmUG9zLCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGRhdGEgPSBoZlNoYXBlLmRhdGE7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCByYWRpdXMgPSBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBjb252ZXhIZWlnaHRmaWVsZF90bXAyOwogICAgICBjb25zdCBmYWNlTGlzdCA9IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0OyAvLyBHZXQgc3BoZXJlIHBvc2l0aW9uIHRvIGhlaWdodGZpZWxkIGxvY2FsIQoKICAgICAgY29uc3QgbG9jYWxDb252ZXhQb3MgPSBjb252ZXhIZWlnaHRmaWVsZF90bXAxOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUoaGZQb3MsIGhmUXVhdCwgY29udmV4UG9zLCBsb2NhbENvbnZleFBvcyk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgbGV0IGlNaW5YID0gTWF0aC5mbG9vcigobG9jYWxDb252ZXhQb3MueCAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WCA9IE1hdGguY2VpbCgobG9jYWxDb252ZXhQb3MueCArIHJhZGl1cykgLyB3KSArIDE7CiAgICAgIGxldCBpTWluWSA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnkgLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFkgPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnkgKyByYWRpdXMpIC8gdykgKyAxOyAvLyBCYWlsIG91dCBpZiB3ZSBhcmUgb3V0IG9mIHRoZSB0ZXJyYWluCgogICAgICBpZiAoaU1heFggPCAwIHx8IGlNYXhZIDwgMCB8fCBpTWluWCA+IGRhdGEubGVuZ3RoIHx8IGlNaW5ZID4gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2xhbXAgaW5kZXggdG8gZWRnZXMKCgogICAgICBpZiAoaU1pblggPCAwKSB7CiAgICAgICAgaU1pblggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFggPCAwKSB7CiAgICAgICAgaU1heFggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPCAwKSB7CiAgICAgICAgaU1pblkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPCAwKSB7CiAgICAgICAgaU1heFkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWluWCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1heFggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNYXhZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWluWSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgY29uc3QgbWluTWF4ID0gW107CiAgICAgIGhmU2hhcGUuZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgbWluTWF4KTsKICAgICAgY29uc3QgbWluID0gbWluTWF4WzBdOwogICAgICBjb25zdCBtYXggPSBtaW5NYXhbMV07IC8vIEJhaWwgb3V0IGlmIHdlJ3JlIGNhbnQgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbENvbnZleFBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsQ29udmV4UG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBsZXQgaW50ZXJzZWN0aW5nID0gZmFsc2U7IC8vIExvd2VyIHRyaWFuZ2xlCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoY29udmV4UG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLmNvbnZleENvbnZleChjb252ZXhTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIGNvbnZleFBvcywgd29ybGRQaWxsYXJPZmZzZXQsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCBudWxsLCBudWxsLCBqdXN0VGVzdCwgZmFjZUxpc3QsIG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoY29udmV4UG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBjb252ZXhTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLmNvbnZleENvbnZleChjb252ZXhTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIGNvbnZleFBvcywgd29ybGRQaWxsYXJPZmZzZXQsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCBudWxsLCBudWxsLCBqdXN0VGVzdCwgZmFjZUxpc3QsIG51bGwpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlUGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gVGhlIG5vcm1hbCBpcyB0aGUgdW5pdCB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHBhcnRpY2xlIGNlbnRlcgogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVNwaGVyZV9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHhpLnZzdWIoeGosIG5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbmd0aFNxdWFyZWQgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKGxlbmd0aFNxdWFyZWQgPD0gc2oucmFkaXVzICogc2oucmFkaXVzKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICByLnJqLmNvcHkobm9ybWFsKTsKICAgICAgICByLnJqLnNjYWxlKHNqLnJhZGl1cywgci5yaik7CiAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBhcnRpY2xlUGxhbmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBiai5xdWF0ZXJuaW9uLnZtdWx0KG5vcm1hbCwgbm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lIG9yaWVudGF0aW9uCgogICAgICBjb25zdCByZWxwb3MgPSBwYXJ0aWNsZVBsYW5lX3JlbHBvczsKICAgICAgeGkudnN1Yihiai5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgY29uc3QgZG90ID0gbm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwKCiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQogICAgICAgIC8vIEdldCBwYXJ0aWNsZSBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGFydGljbGVQbGFuZV9wcm9qZWN0ZWQ7CiAgICAgICAgbm9ybWFsLnNjYWxlKG5vcm1hbC5kb3QoeGkpLCBwcm9qZWN0ZWQpOwogICAgICAgIHhpLnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOyAvL3Byb2plY3RlZC52YWRkKGJqLnBvc2l0aW9uLHByb2plY3RlZCk7CiAgICAgICAgLy8gcmogaXMgbm93IHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgci5yai5jb3B5KHByb2plY3RlZCk7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hQYXJ0aWNsZShzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlKHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleFBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGxldCBwZW5ldHJhdGVkRmFjZUluZGV4ID0gLTE7CiAgICAgIGNvbnN0IHBlbmV0cmF0ZWRGYWNlTm9ybWFsID0gY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWw7CiAgICAgIGNvbnN0IHdvcmxkUGVuZXRyYXRpb25WZWMgPSBjb252ZXhQYXJ0aWNsZV93b3JsZFBlbmV0cmF0aW9uVmVjOwogICAgICBsZXQgbWluUGVuZXRyYXRpb24gPSBudWxsOwoKICAgICAgY29uc3QgbG9jYWwgPSBjb252ZXhQYXJ0aWNsZV9sb2NhbDsKICAgICAgbG9jYWwuY29weSh4aSk7CiAgICAgIGxvY2FsLnZzdWIoeGosIGxvY2FsKTsgLy8gQ29udmVydCBwb3NpdGlvbiB0byByZWxhdGl2ZSB0aGUgY29udmV4IG9yaWdpbgoKICAgICAgcWouY29uanVnYXRlKGNxaik7CiAgICAgIGNxai52bXVsdChsb2NhbCwgbG9jYWwpOwoKICAgICAgaWYgKHNqLnBvaW50SXNJbnNpZGUobG9jYWwpKSB7CiAgICAgICAgaWYgKHNqLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSkgewogICAgICAgICAgc2ouY29tcHV0ZVdvcmxkVmVydGljZXMoeGosIHFqKTsKICAgICAgICB9CgogICAgICAgIGlmIChzai53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZEZhY2VOb3JtYWxzKHFqKTsKICAgICAgICB9IC8vIEZvciBlYWNoIHdvcmxkIHBvbHlnb24gaW4gdGhlIHBvbHloZWRyYQoKCiAgICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IHNqLmZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzOyBpKyspIHsKICAgICAgICAgIC8vIENvbnN0cnVjdCB3b3JsZCBmYWNlIHZlcnRpY2VzCiAgICAgICAgICBjb25zdCB2ZXJ0cyA9IFtzai53b3JsZFZlcnRpY2VzW3NqLmZhY2VzW2ldWzBdXV07CiAgICAgICAgICBjb25zdCBub3JtYWwgPSBzai53b3JsZEZhY2VOb3JtYWxzW2ldOyAvLyBDaGVjayBob3cgbXVjaCB0aGUgcGFydGljbGUgcGVuZXRyYXRlcyB0aGUgcG9seWdvbiBwbGFuZS4KCiAgICAgICAgICB4aS52c3ViKHZlcnRzWzBdLCBjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlKTsKICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gLW5vcm1hbC5kb3QoY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CgogICAgICAgICAgaWYgKG1pblBlbmV0cmF0aW9uID09PSBudWxsIHx8IE1hdGguYWJzKHBlbmV0cmF0aW9uKSA8IE1hdGguYWJzKG1pblBlbmV0cmF0aW9uKSkgewogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWluUGVuZXRyYXRpb24gPSBwZW5ldHJhdGlvbjsKICAgICAgICAgICAgcGVuZXRyYXRlZEZhY2VJbmRleCA9IGk7CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlTm9ybWFsLmNvcHkobm9ybWFsKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChwZW5ldHJhdGVkRmFjZUluZGV4ICE9PSAtMSkgewogICAgICAgICAgLy8gU2V0dXAgY29udGFjdAogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5zY2FsZShtaW5QZW5ldHJhdGlvbiwgd29ybGRQZW5ldHJhdGlvblZlYyk7IC8vIHJqIGlzIHRoZSBwYXJ0aWNsZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGZhY2UKCiAgICAgICAgICB3b3JsZFBlbmV0cmF0aW9uVmVjLnZhZGQoeGksIHdvcmxkUGVuZXRyYXRpb25WZWMpOwogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52c3ViKHhqLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHIucmouY29weSh3b3JsZFBlbmV0cmF0aW9uVmVjKTsgLy9jb25zdCBwcm9qZWN0ZWRUb0ZhY2UgPSB4aS52c3ViKHhqKS52YWRkKHdvcmxkUGVuZXRyYXRpb25WZWMpOwogICAgICAgICAgLy9wcm9qZWN0ZWRUb0ZhY2UuY29weShyLnJqKTsKICAgICAgICAgIC8vcWoudm11bHQoci5yaixyLnJqKTsKCiAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5uZWdhdGUoci5uaSk7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQoKICAgICAgICAgIGNvbnN0IHJpID0gci5yaTsKICAgICAgICAgIGNvbnN0IHJqID0gci5yajsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ1BvaW50IGZvdW5kIGluc2lkZSBjb252ZXgsIGJ1dCBkaWQgbm90IGZpbmQgcGVuZXRyYXRpbmcgZmFjZSEnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBoZWlnaHRmaWVsZEN5bGluZGVyKGhmU2hhcGUsIGNvbnZleFNoYXBlLCBoZlBvcywgY29udmV4UG9zLCBoZlF1YXQsIGNvbnZleFF1YXQsIGhmQm9keSwgY29udmV4Qm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkKGNvbnZleFNoYXBlLCBoZlNoYXBlLCBjb252ZXhQb3MsIGhmUG9zLCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBwYXJ0aWNsZUN5bGluZGVyKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVUcmltZXNoKHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHNwaGVyZVBvcywgdHJpbWVzaFBvcywgc3BoZXJlUXVhdCwgdHJpbWVzaFF1YXQsIHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZWRnZVZlcnRleEEgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhBOwogICAgICBjb25zdCBlZGdlVmVydGV4QiA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEI7CiAgICAgIGNvbnN0IGVkZ2VWZWN0b3IgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3I7CiAgICAgIGNvbnN0IGVkZ2VWZWN0b3JVbml0ID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yVW5pdDsKICAgICAgY29uc3QgbG9jYWxTcGhlcmVQb3MgPSBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zOwogICAgICBjb25zdCB0bXAgPSBzcGhlcmVUcmltZXNoX3RtcDsKICAgICAgY29uc3QgbG9jYWxTcGhlcmVBQUJCID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkI7CiAgICAgIGNvbnN0IHYyID0gc3BoZXJlVHJpbWVzaF92MjsKICAgICAgY29uc3QgcmVscG9zID0gc3BoZXJlVHJpbWVzaF9yZWxwb3M7CiAgICAgIGNvbnN0IHRyaWFuZ2xlcyA9IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzOyAvLyBDb252ZXJ0IHNwaGVyZSBwb3NpdGlvbiB0byBsb2NhbCBpbiB0aGUgdHJpbWVzaAoKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBhYWJiIG9mIHRoZSBzcGhlcmUgbG9jYWxseSBpbiB0aGUgdHJpbWVzaAoKICAgICAgY29uc3Qgc3BoZXJlUmFkaXVzID0gc3BoZXJlU2hhcGUucmFkaXVzOwogICAgICBsb2NhbFNwaGVyZUFBQkIubG93ZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCAtIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSAtIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiAtIHNwaGVyZVJhZGl1cyk7CiAgICAgIGxvY2FsU3BoZXJlQUFCQi51cHBlckJvdW5kLnNldChsb2NhbFNwaGVyZVBvcy54ICsgc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy55ICsgc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy56ICsgc3BoZXJlUmFkaXVzKTsKICAgICAgdHJpbWVzaFNoYXBlLmdldFRyaWFuZ2xlc0luQUFCQihsb2NhbFNwaGVyZUFBQkIsIHRyaWFuZ2xlcyk7IC8vZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUuaW5kaWNlcy5sZW5ndGggLyAzOyBpKyspIHRyaWFuZ2xlcy5wdXNoKGkpOyAvLyBBbGwKICAgICAgLy8gVmVydGljZXMKCiAgICAgIGNvbnN0IHYgPSBzcGhlcmVUcmltZXNoX3Y7CiAgICAgIGNvbnN0IHJhZGl1c1NxdWFyZWQgPSBzcGhlcmVTaGFwZS5yYWRpdXMgKiBzcGhlcmVTaGFwZS5yYWRpdXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaWFuZ2xlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyBqXSwgdik7IC8vIENoZWNrIHZlcnRleCBvdmVybGFwIGluIHNwaGVyZQoKICAgICAgICAgIHYudnN1Yihsb2NhbFNwaGVyZVBvcywgcmVscG9zKTsKCiAgICAgICAgICBpZiAocmVscG9zLmxlbmd0aFNxdWFyZWQoKSA8PSByYWRpdXNTcXVhcmVkKSB7CiAgICAgICAgICAgIC8vIFNhZmUgdXAKICAgICAgICAgICAgdjIuY29weSh2KTsKICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB2Miwgdik7CiAgICAgICAgICAgIHYudnN1YihzcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICByLm5pLmNvcHkocmVscG9zKTsKICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsgLy8gcmkgaXMgdGhlIHZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gdGhlIHNwaGVyZSBzdXJmYWNlCgogICAgICAgICAgICByLnJpLmNvcHkoci5uaSk7CiAgICAgICAgICAgIHIucmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgci5yaS52YWRkKHNwaGVyZVBvcywgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihzcGhlcmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgICByLnJqLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOyAvLyBTdG9yZSByZXN1bHQKCiAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gQ2hlY2sgYWxsIGVkZ2VzCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIGVkZ2VWZXJ0ZXhBKTsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIChqICsgMSkgJSAzXSwgZWRnZVZlcnRleEIpOwogICAgICAgICAgZWRnZVZlcnRleEIudnN1YihlZGdlVmVydGV4QSwgZWRnZVZlY3Rvcik7IC8vIFByb2plY3Qgc3BoZXJlIHBvc2l0aW9uIHRvIHRoZSBlZGdlCgogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QiwgdG1wKTsKICAgICAgICAgIGNvbnN0IHBvc2l0aW9uQWxvbmdFZGdlQiA9IHRtcC5kb3QoZWRnZVZlY3Rvcik7CiAgICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKGVkZ2VWZXJ0ZXhBLCB0bXApOwogICAgICAgICAgbGV0IHBvc2l0aW9uQWxvbmdFZGdlQSA9IHRtcC5kb3QoZWRnZVZlY3Rvcik7CgogICAgICAgICAgaWYgKHBvc2l0aW9uQWxvbmdFZGdlQSA+IDAgJiYgcG9zaXRpb25BbG9uZ0VkZ2VCIDwgMCkgewogICAgICAgICAgICAvLyBOb3cgY2hlY2sgdGhlIG9ydGhvZ29uYWwgZGlzdGFuY2UgZnJvbSBlZGdlIHRvIHNwaGVyZSBjZW50ZXIKICAgICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuY29weShlZGdlVmVjdG9yKTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHBvc2l0aW9uQWxvbmdFZGdlQSA9IHRtcC5kb3QoZWRnZVZlY3RvclVuaXQpOwogICAgICAgICAgICBlZGdlVmVjdG9yVW5pdC5zY2FsZShwb3NpdGlvbkFsb25nRWRnZUEsIHRtcCk7CiAgICAgICAgICAgIHRtcC52YWRkKGVkZ2VWZXJ0ZXhBLCB0bXApOyAvLyB0bXAgaXMgbm93IHRoZSBzcGhlcmUgY2VudGVyIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgZWRnZSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSB0cmltZXNoIGZyYW1lCgogICAgICAgICAgICBjb25zdCBkaXN0ID0gdG1wLmRpc3RhbmNlVG8obG9jYWxTcGhlcmVQb3MpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPCBzcGhlcmVTaGFwZS5yYWRpdXMpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCBzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5zY2FsZShzcGhlcmVTaGFwZS5yYWRpdXMsIHIucmkpOwogICAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICAgIHIucmkudnN1YihzcGhlcmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHRtcCwgdG1wKTsKICAgICAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5uaSwgci5uaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5yaSwgci5yaSk7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gVHJpYW5nbGUgZmFjZXMKCgogICAgICBjb25zdCB2YSA9IHNwaGVyZVRyaW1lc2hfdmE7CiAgICAgIGNvbnN0IHZiID0gc3BoZXJlVHJpbWVzaF92YjsKICAgICAgY29uc3QgdmMgPSBzcGhlcmVUcmltZXNoX3ZjOwogICAgICBjb25zdCBub3JtYWwgPSBzcGhlcmVUcmltZXNoX25vcm1hbDsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdHJpYW5nbGVzLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldFRyaWFuZ2xlVmVydGljZXModHJpYW5nbGVzW2ldLCB2YSwgdmIsIHZjKTsKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0Tm9ybWFsKHRyaWFuZ2xlc1tpXSwgbm9ybWFsKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHZhLCB0bXApOwogICAgICAgIGxldCBkaXN0ID0gdG1wLmRvdChub3JtYWwpOwogICAgICAgIG5vcm1hbC5zY2FsZShkaXN0LCB0bXApOwogICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIodG1wLCB0bXApOyAvLyB0bXAgaXMgbm93IHRoZSBzcGhlcmUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSB0cmlhbmdsZSBwbGFuZQoKICAgICAgICBkaXN0ID0gdG1wLmRpc3RhbmNlVG8obG9jYWxTcGhlcmVQb3MpOwoKICAgICAgICBpZiAoUmF5LnBvaW50SW5UcmlhbmdsZSh0bXAsIHZhLCB2YiwgdmMpICYmIGRpc3QgPCBzcGhlcmVTaGFwZS5yYWRpdXMpIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBsZXQgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCBzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICB0bXAudnN1Yihsb2NhbFNwaGVyZVBvcywgci5uaSk7CiAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5zY2FsZShzcGhlcmVTaGFwZS5yYWRpdXMsIHIucmkpOwogICAgICAgICAgci5yaS52YWRkKHNwaGVyZVBvcywgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHRtcCwgdG1wKTsKICAgICAgICAgIHRtcC52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5yaSwgci5yaSk7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdHJpYW5nbGVzLmxlbmd0aCA9IDA7CiAgICB9CgogICAgcGxhbmVUcmltZXNoKHBsYW5lU2hhcGUsIHRyaW1lc2hTaGFwZSwgcGxhbmVQb3MsIHRyaW1lc2hQb3MsIHBsYW5lUXVhdCwgdHJpbWVzaFF1YXQsIHBsYW5lQm9keSwgdHJpbWVzaEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBNYWtlIGNvbnRhY3RzIQogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgbm9ybWFsID0gcGxhbmVUcmltZXNoX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgcGxhbmVRdWF0LnZtdWx0KG5vcm1hbCwgbm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaW1lc2hTaGFwZS52ZXJ0aWNlcy5sZW5ndGggLyAzOyBpKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgdmVydGV4IGZyb20gdHJpbWVzaAogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgoaSwgdik7IC8vIFNhZmUgdXAKCiAgICAgICAgY29uc3QgdjIgPSBuZXcgVmVjMygpOwogICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB2Miwgdik7IC8vIENoZWNrIHBsYW5lIHNpZGUKCiAgICAgICAgY29uc3QgcmVscG9zID0gcGxhbmVUcmltZXNoX3JlbHBvczsKICAgICAgICB2LnZzdWIocGxhbmVQb3MsIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gbm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCBwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCiAgICAgICAgICAvLyBHZXQgdmVydGV4IHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBsYW5lVHJpbWVzaF9wcm9qZWN0ZWQ7CiAgICAgICAgICBub3JtYWwuc2NhbGUocmVscG9zLmRvdChub3JtYWwpLCBwcm9qZWN0ZWQpOwogICAgICAgICAgdi52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy8gcmkgaXMgdGhlIHByb2plY3RlZCB3b3JsZCBwb3NpdGlvbiBtaW51cyBwbGFuZSBwb3NpdGlvbgoKICAgICAgICAgIHIucmkuY29weShwcm9qZWN0ZWQpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLmNvcHkodik7CiAgICAgICAgICByLnJqLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOyAvLyBTdG9yZSByZXN1bHQKCiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgIH0KICAgICAgfQogICAgfSAvLyBjb252ZXhUcmltZXNoKAogICAgLy8gICBzaTogQ29udmV4UG9seWhlZHJvbiwgc2o6IFRyaW1lc2gsIHhpOiBWZWMzLCB4ajogVmVjMywgcWk6IFF1YXRlcm5pb24sIHFqOiBRdWF0ZXJuaW9uLAogICAgLy8gICBiaTogQm9keSwgYmo6IEJvZHksIHJzaT86IFNoYXBlIHwgbnVsbCwgcnNqPzogU2hhcGUgfCBudWxsLAogICAgLy8gICBmYWNlTGlzdEE/OiBudW1iZXJbXSB8IG51bGwsIGZhY2VMaXN0Qj86IG51bWJlcltdIHwgbnVsbCwKICAgIC8vICkgewogICAgLy8gICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CiAgICAvLyAgIGlmKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cyl7CiAgICAvLyAgICAgICByZXR1cm47CiAgICAvLyAgIH0KICAgIC8vICAgLy8gQ29uc3RydWN0IGEgdGVtcCBodWxsIGZvciBlYWNoIHRyaWFuZ2xlCiAgICAvLyAgIGNvbnN0IGh1bGxCID0gbmV3IENvbnZleFBvbHloZWRyb24oKTsKICAgIC8vICAgaHVsbEIuZmFjZXMgPSBbWzAsMSwyXV07CiAgICAvLyAgIGNvbnN0IHZhID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogICAgLy8gICBjb25zdCB2YyA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGh1bGxCLnZlcnRpY2VzID0gWwogICAgLy8gICAgICAgdmEsCiAgICAvLyAgICAgICB2YiwKICAgIC8vICAgICAgIHZjCiAgICAvLyAgIF07CiAgICAvLyAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2ouaW5kaWNlcy5sZW5ndGggLyAzOyBpKyspIHsKICAgIC8vICAgICAgIGNvbnN0IHRyaWFuZ2xlTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgIC8vICAgICAgIHNqLmdldE5vcm1hbChpLCB0cmlhbmdsZU5vcm1hbCk7CiAgICAvLyAgICAgICBodWxsQi5mYWNlTm9ybWFscyA9IFt0cmlhbmdsZU5vcm1hbF07CiAgICAvLyAgICAgICBzai5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIHZhLCB2YiwgdmMpOwogICAgLy8gICAgICAgbGV0IGQgPSBzaS50ZXN0U2VwQXhpcyh0cmlhbmdsZU5vcm1hbCwgaHVsbEIsIHhpLCBxaSwgeGosIHFqKTsKICAgIC8vICAgICAgIGlmKCFkKXsKICAgIC8vICAgICAgICAgICB0cmlhbmdsZU5vcm1hbC5zY2FsZSgtMSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgICAgIGQgPSBzaS50ZXN0U2VwQXhpcyh0cmlhbmdsZU5vcm1hbCwgaHVsbEIsIHhpLCBxaSwgeGosIHFqKTsKICAgIC8vICAgICAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgLy8gICAgICAgICAgIH0KICAgIC8vICAgICAgIH0KICAgIC8vICAgICAgIGNvbnN0IHJlczogQ29udmV4UG9seWhlZHJvbkNvbnRhY3RQb2ludFtdID0gW107CiAgICAvLyAgICAgICBjb25zdCBxID0gY29udmV4Q29udmV4X3E7CiAgICAvLyAgICAgICBzaS5jbGlwQWdhaW5zdEh1bGwoeGkscWksaHVsbEIseGoscWosdHJpYW5nbGVOb3JtYWwsLTEwMCwxMDAscmVzKTsKICAgIC8vICAgICAgIGZvcihsZXQgaiA9IDA7IGogIT09IHJlcy5sZW5ndGg7IGorKyl7CiAgICAvLyAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLGJqLHNpLHNqLHJzaSxyc2opLAogICAgLy8gICAgICAgICAgICAgICByaSA9IHIucmksCiAgICAvLyAgICAgICAgICAgICAgIHJqID0gci5yajsKICAgIC8vICAgICAgICAgICByLm5pLmNvcHkodHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgLy8gICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgLy8gICAgICAgICAgIHEubXVsdChyZXNbal0uZGVwdGgsIHEpOwogICAgLy8gICAgICAgICAgIHJlc1tqXS5wb2ludC52YWRkKHEsIHJpKTsKICAgIC8vICAgICAgICAgICByai5jb3B5KHJlc1tqXS5wb2ludCk7CiAgICAvLyAgICAgICAgICAgLy8gQ29udGFjdCBwb2ludHMgYXJlIGluIHdvcmxkIGNvb3JkaW5hdGVzLiBUcmFuc2Zvcm0gYmFjayB0byByZWxhdGl2ZQogICAgLy8gICAgICAgICAgIHJpLnZzdWIoeGkscmkpOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoeGoscmopOwogICAgLy8gICAgICAgICAgIC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCiAgICAvLyAgICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgLy8gICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgIC8vICAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAvLyAgICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgLy8gICAgICAgICAgIHJlc3VsdC5wdXNoKHIpOwogICAgLy8gICAgICAgfQogICAgLy8gICB9CiAgICAvLyB9CgoKICB9CiAgY29uc3QgYXZlcmFnZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXZlcmFnZUNvbnRhY3RQb2ludEEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRCID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0MSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgdG1wUXVhdDIgPSBuZXcgUXVhdGVybmlvbigpOwoKICBjb25zdCBwbGFuZVRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZVRyaW1lc2hfcHJvamVjdGVkID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9yZWxwb3MgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3YyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhBID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVQb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZhID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZiID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3ZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lX3RvX3NwaGVyZV9vcnRobyA9IG5ldyBWZWMzKCk7IC8vIFNlZSBodHRwOi8vYnVsbGV0cGh5c2ljcy5jb20vQnVsbGV0L0J1bGxldEZ1bGwvU3BoZXJlVHJpYW5nbGVEZXRlY3Rvcl84Y3BwX3NvdXJjZS5odG1sCgogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX2VkZ2VfeF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBvaW50SW5Qb2x5Z29uX3Z0cCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIHBvaW50SW5Qb2x5Z29uKHZlcnRzLCBub3JtYWwsIHApIHsKICAgIGxldCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICBjb25zdCBOID0gdmVydHMubGVuZ3RoOwoKICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOyAvLyBHZXQgZWRnZSB0byB0aGUgbmV4dCB2ZXJ0ZXgKCiAgICAgIGNvbnN0IGVkZ2UgPSBwb2ludEluUG9seWdvbl9lZGdlOwogICAgICB2ZXJ0c1soaSArIDEpICUgTl0udnN1Yih2LCBlZGdlKTsgLy8gR2V0IGNyb3NzIHByb2R1Y3QgYmV0d2VlbiBwb2x5Z29uIG5vcm1hbCBhbmQgdGhlIGVkZ2UKCiAgICAgIGNvbnN0IGVkZ2VfeF9ub3JtYWwgPSBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsOyAvL2NvbnN0IGVkZ2VfeF9ub3JtYWwgPSBuZXcgVmVjMygpOwoKICAgICAgZWRnZS5jcm9zcyhub3JtYWwsIGVkZ2VfeF9ub3JtYWwpOyAvLyBHZXQgdmVjdG9yIGJldHdlZW4gcG9pbnQgYW5kIGN1cnJlbnQgdmVydGV4CgogICAgICBjb25zdCB2ZXJ0ZXhfdG9fcCA9IHBvaW50SW5Qb2x5Z29uX3Z0cDsKICAgICAgcC52c3ViKHYsIHZlcnRleF90b19wKTsgLy8gVGhpcyBkb3QgcHJvZHVjdCBkZXRlcm1pbmVzIHdoaWNoIHNpZGUgb2YgdGhlIGVkZ2UgdGhlIHBvaW50IGlzCgogICAgICBjb25zdCByID0gZWRnZV94X25vcm1hbC5kb3QodmVydGV4X3RvX3ApOyAvLyBJZiBhbGwgc3VjaCBkb3QgcHJvZHVjdHMgaGF2ZSBzYW1lIHNpZ24sIHdlIGFyZSBpbnNpZGUgdGhlIHBvbHlnb24uCgogICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwgfHwgciA+IDAgJiYgcG9zaXRpdmVSZXN1bHQgPT09IHRydWUgfHwgciA8PSAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgIGlmIChwb3NpdGl2ZVJlc3VsdCA9PT0gbnVsbCkgewogICAgICAgICAgcG9zaXRpdmVSZXN1bHQgPSByID4gMDsKICAgICAgICB9CgogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICB9CiAgICB9IC8vIElmIHdlIGdvdCBoZXJlLCBhbGwgZG90IHByb2R1Y3RzIHdlcmUgb2YgdGhlIHNhbWUgc2lnbi4KCgogICAgcmV0dXJuIHRydWU7CiAgfQoKICBjb25zdCBib3hfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9uczIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlcyA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKICBjb25zdCBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfZWRnZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2VVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZENvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3BlbmV0cmF0aW9uVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50ID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9yZWxwb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4Q29udmV4X3NlcEF4aXMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9xID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9yZWxwb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVNwaGVyZV9ub3JtYWwgPSBuZXcgVmVjMygpOyAvLyBXSVAKCiAgY29uc3QgY3FqID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV9sb2NhbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV9wZW5ldHJhdGVkRmFjZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfdG1wMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfdG1wMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4SGVpZ2h0ZmllbGRfZmFjZUxpc3QgPSBbMF07CiAgY29uc3Qgc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlSGVpZ2h0ZmllbGRfdG1wMiA9IG5ldyBWZWMzKCk7CgogIGNsYXNzIE92ZXJsYXBLZWVwZXIgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5jdXJyZW50ID0gW107CiAgICAgIHRoaXMucHJldmlvdXMgPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogZ2V0S2V5CiAgICAgKi8KCgogICAgZ2V0S2V5KGksIGopIHsKICAgICAgaWYgKGogPCBpKSB7CiAgICAgICAgY29uc3QgdGVtcCA9IGo7CiAgICAgICAgaiA9IGk7CiAgICAgICAgaSA9IHRlbXA7CiAgICAgIH0KCiAgICAgIHJldHVybiBpIDw8IDE2IHwgajsKICAgIH0KICAgIC8qKgogICAgICogc2V0CiAgICAgKi8KCgogICAgc2V0KGksIGopIHsKICAgICAgLy8gSW5zZXJ0aW9uIHNvcnQuIFRoaXMgd2F5IHRoZSBkaWZmIHdpbGwgaGF2ZSBsaW5lYXIgY29tcGxleGl0eS4KICAgICAgY29uc3Qga2V5ID0gdGhpcy5nZXRLZXkoaSwgaik7CiAgICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmN1cnJlbnQ7CiAgICAgIGxldCBpbmRleCA9IDA7CgogICAgICB3aGlsZSAoa2V5ID4gY3VycmVudFtpbmRleF0pIHsKICAgICAgICBpbmRleCsrOwogICAgICB9CgogICAgICBpZiAoa2V5ID09PSBjdXJyZW50W2luZGV4XSkgewogICAgICAgIHJldHVybjsgLy8gUGFpciB3YXMgYWxyZWFkeSBhZGRlZAogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gY3VycmVudC5sZW5ndGggLSAxOyBqID49IGluZGV4OyBqLS0pIHsKICAgICAgICBjdXJyZW50W2ogKyAxXSA9IGN1cnJlbnRbal07CiAgICAgIH0KCiAgICAgIGN1cnJlbnRbaW5kZXhdID0ga2V5OwogICAgfQogICAgLyoqCiAgICAgKiB0aWNrCiAgICAgKi8KCgogICAgdGljaygpIHsKICAgICAgY29uc3QgdG1wID0gdGhpcy5jdXJyZW50OwogICAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLnByZXZpb3VzOwogICAgICB0aGlzLnByZXZpb3VzID0gdG1wOwogICAgICB0aGlzLmN1cnJlbnQubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogZ2V0RGlmZgogICAgICovCgoKICAgIGdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscykgewogICAgICBjb25zdCBhID0gdGhpcy5jdXJyZW50OwogICAgICBjb25zdCBiID0gdGhpcy5wcmV2aW91czsKICAgICAgY29uc3QgYWwgPSBhLmxlbmd0aDsKICAgICAgY29uc3QgYmwgPSBiLmxlbmd0aDsKICAgICAgbGV0IGogPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbDsgaSsrKSB7CiAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgY29uc3Qga2V5QSA9IGFbaV07CgogICAgICAgIHdoaWxlIChrZXlBID4gYltqXSkgewogICAgICAgICAgaisrOwogICAgICAgIH0KCiAgICAgICAgZm91bmQgPSBrZXlBID09PSBiW2pdOwoKICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICB1bnBhY2tBbmRQdXNoKGFkZGl0aW9ucywga2V5QSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUIgPSBiW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QiA+IGFbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0gYVtqXSA9PT0ga2V5QjsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChyZW1vdmFscywga2V5Qik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KCiAgZnVuY3Rpb24gdW5wYWNrQW5kUHVzaChhcnJheSwga2V5KSB7CiAgICBhcnJheS5wdXNoKChrZXkgJiAweGZmZmYwMDAwKSA+PiAxNiwga2V5ICYgMHgwMDAwZmZmZik7CiAgfQoKICBjb25zdCBnZXRLZXkgPSAoaSwgaikgPT4gaSA8IGogPyBgJHtpfS0ke2p9YCA6IGAke2p9LSR7aX1gOwogIC8qKgogICAqIFR1cGxlRGljdGlvbmFyeQogICAqLwoKCiAgY2xhc3MgVHVwbGVEaWN0aW9uYXJ5IHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmRhdGEgPSB7CiAgICAgICAga2V5czogW10KICAgICAgfTsKICAgIH0KCiAgICAvKiogZ2V0ICovCiAgICBnZXQoaSwgaikgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7CiAgICAgIHJldHVybiB0aGlzLmRhdGFba2V5XTsKICAgIH0KICAgIC8qKiBzZXQgKi8KCgogICAgc2V0KGksIGosIHZhbHVlKSB7CiAgICAgIGNvbnN0IGtleSA9IGdldEtleShpLCBqKTsgLy8gQ2hlY2sgaWYga2V5IGFscmVhZHkgZXhpc3RzCgogICAgICBpZiAoIXRoaXMuZ2V0KGksIGopKSB7CiAgICAgICAgdGhpcy5kYXRhLmtleXMucHVzaChrZXkpOwogICAgICB9CgogICAgICB0aGlzLmRhdGFba2V5XSA9IHZhbHVlOwogICAgfQogICAgLyoqIGRlbGV0ZSAqLwoKCiAgICBkZWxldGUoaSwgaikgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7CiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5kYXRhLmtleXMuaW5kZXhPZihrZXkpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KCiAgICAgIGRlbGV0ZSB0aGlzLmRhdGFba2V5XTsKICAgIH0KICAgIC8qKiByZXNldCAqLwoKCiAgICByZXNldCgpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3Qga2V5cyA9IGRhdGEua2V5czsKCiAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBrZXkgPSBrZXlzLnBvcCgpOwogICAgICAgIGRlbGV0ZSBkYXRhW2tleV07CiAgICAgIH0KICAgIH0KCiAgfQoKICAvKioKICAgKiBUaGUgcGh5c2ljcyB3b3JsZAogICAqLwogIGNsYXNzIFdvcmxkIGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBDdXJyZW50bHkgLyBsYXN0IHVzZWQgdGltZXN0ZXAuIElzIHNldCB0byAtMSBpZiBub3QgYXZhaWxhYmxlLiBUaGlzIHZhbHVlIGlzIHVwZGF0ZWQgYmVmb3JlIGVhY2ggaW50ZXJuYWwgc3RlcCwgd2hpY2ggbWVhbnMgdGhhdCBpdCBpcyAiZnJlc2giIGluc2lkZSBldmVudCBjYWxsYmFja3MuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1ha2VzIGJvZGllcyBnbyB0byBzbGVlcCB3aGVuIHRoZXkndmUgYmVlbiBpbmFjdGl2ZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgY3VycmVudCBjb250YWN0cyAoaW5zdGFuY2VzIG9mIENvbnRhY3RFcXVhdGlvbikgaW4gdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBIb3cgb2Z0ZW4gdG8gbm9ybWFsaXplIHF1YXRlcm5pb25zLiBTZXQgdG8gMCBmb3IgZXZlcnkgc3RlcCwgMSBmb3IgZXZlcnkgc2Vjb25kIGV0Yy4uIEEgbGFyZ2VyIHZhbHVlIGluY3JlYXNlcyBwZXJmb3JtYW5jZS4gSWYgYm9kaWVzIHRlbmQgdG8gZXhwbG9kZSwgc2V0IHRvIGEgc21hbGxlciB2YWx1ZSAoemVybyB0byBiZSBzdXJlIG5vdGhpbmcgY2FuIGdvIHdyb25nKS4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgdG8gdXNlIGZhc3QgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBJdCBpcyBvZnRlbiBlbm91Z2ggYWNjdXJhdGUgdG8gdXNlLgogICAgICogSWYgYm9kaWVzIHRlbmQgdG8gZXhwbG9kZSwgc2V0IHRvIGZhbHNlLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdhbGwtY2xvY2sgdGltZSBzaW5jZSBzaW11bGF0aW9uIHN0YXJ0LgogICAgICovCgogICAgLyoqCiAgICAgKiBOdW1iZXIgb2YgdGltZXN0ZXBzIHRha2VuIHNpbmNlIHN0YXJ0LgogICAgICovCgogICAgLyoqCiAgICAgKiBEZWZhdWx0IGFuZCBsYXN0IHRpbWVzdGVwIHNpemVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZ3Jhdml0eSBvZiB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBicm9hZHBoYXNlIGFsZ29yaXRobSB0byB1c2UuCiAgICAgKiBAZGVmYXVsdCBOYWl2ZUJyb2FkcGhhc2UKICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGJvZGllcyBpbiB0aGlzIHdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRydWUgaWYgYW55IGJvZGllcyBhcmUgbm90IHNsZWVwaW5nLCBmYWxzZSBpZiBldmVyeSBib2R5IGlzIHNsZWVwaW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgc29sdmVyIGFsZ29yaXRobSB0byB1c2UuCiAgICAgKiBAZGVmYXVsdCBHU1NvbHZlcgogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25NYXRyaXgKICAgICAqLwoKICAgIC8qKgogICAgICogQ29sbGlzaW9uTWF0cml4IGZyb20gdGhlIHByZXZpb3VzIHN0ZXAuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCBhZGRlZCBjb250YWN0bWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIHRvIGxvb2sgdXAgYSBDb250YWN0TWF0ZXJpYWwgZ2l2ZW4gdHdvIGluc3RhbmNlcyBvZiBNYXRlcmlhbC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgbWF0ZXJpYWwgb2YgdGhlIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhpcyBjb250YWN0IG1hdGVyaWFsIGlzIHVzZWQgaWYgbm8gc3VpdGFibGUgY29udGFjdG1hdGVyaWFsIGlzIGZvdW5kIGZvciBhIGNvbnRhY3QuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRpbWUgYWNjdW11bGF0b3IgZm9yIGludGVycG9sYXRpb24uCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2FmZmVyb25nYW1lcy5jb20vZ2FtZS1waHlzaWNzL2ZpeC15b3VyLXRpbWVzdGVwLwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgYmVlbiBhZGRlZCB0byB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5kdCA9IC0xOwogICAgICB0aGlzLmFsbG93U2xlZXAgPSAhIW9wdGlvbnMuYWxsb3dTbGVlcDsKICAgICAgdGhpcy5jb250YWN0cyA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zID0gW107CiAgICAgIHRoaXMucXVhdE5vcm1hbGl6ZVNraXAgPSBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwIDogMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplRmFzdCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgOiBmYWxzZTsKICAgICAgdGhpcy50aW1lID0gMC4wOwogICAgICB0aGlzLnN0ZXBudW1iZXIgPSAwOwogICAgICB0aGlzLmRlZmF1bHRfZHQgPSAxIC8gNjA7CiAgICAgIHRoaXMubmV4dElkID0gMDsKICAgICAgdGhpcy5ncmF2aXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmdyYXZpdHkpIHsKICAgICAgICB0aGlzLmdyYXZpdHkuY29weShvcHRpb25zLmdyYXZpdHkpOwogICAgICB9CgogICAgICB0aGlzLmJyb2FkcGhhc2UgPSBvcHRpb25zLmJyb2FkcGhhc2UgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYnJvYWRwaGFzZSA6IG5ldyBOYWl2ZUJyb2FkcGhhc2UoKTsKICAgICAgdGhpcy5ib2RpZXMgPSBbXTsKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKICAgICAgdGhpcy5zb2x2ZXIgPSBvcHRpb25zLnNvbHZlciAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5zb2x2ZXIgOiBuZXcgR1NTb2x2ZXIoKTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwogICAgICB0aGlzLm5hcnJvd3BoYXNlID0gbmV3IE5hcnJvd3BoYXNlKHRoaXMpOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzID0gbmV3IEFycmF5Q29sbGlzaW9uTWF0cml4KCk7CiAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlciA9IG5ldyBPdmVybGFwS2VlcGVyKCk7CiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscyA9IFtdOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlID0gbmV3IFR1cGxlRGljdGlvbmFyeSgpOwogICAgICB0aGlzLmRlZmF1bHRNYXRlcmlhbCA9IG5ldyBNYXRlcmlhbCgnZGVmYXVsdCcpOwogICAgICB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwgPSBuZXcgQ29udGFjdE1hdGVyaWFsKHRoaXMuZGVmYXVsdE1hdGVyaWFsLCB0aGlzLmRlZmF1bHRNYXRlcmlhbCwgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMAogICAgICB9KTsKICAgICAgdGhpcy5kb1Byb2ZpbGluZyA9IGZhbHNlOwogICAgICB0aGlzLnByb2ZpbGUgPSB7CiAgICAgICAgc29sdmU6IDAsCiAgICAgICAgbWFrZUNvbnRhY3RDb25zdHJhaW50czogMCwKICAgICAgICBicm9hZHBoYXNlOiAwLAogICAgICAgIGludGVncmF0ZTogMCwKICAgICAgICBuYXJyb3dwaGFzZTogMAogICAgICB9OwogICAgICB0aGlzLmFjY3VtdWxhdG9yID0gMDsKICAgICAgdGhpcy5zdWJzeXN0ZW1zID0gW107CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50ID0gewogICAgICAgIHR5cGU6ICdhZGRCb2R5JywKICAgICAgICBib2R5OiBudWxsCiAgICAgIH07CiAgICAgIHRoaXMucmVtb3ZlQm9keUV2ZW50ID0gewogICAgICAgIHR5cGU6ICdyZW1vdmVCb2R5JywKICAgICAgICBib2R5OiBudWxsCiAgICAgIH07CiAgICAgIHRoaXMuaWRUb0JvZHlNYXAgPSB7fTsKICAgICAgdGhpcy5icm9hZHBoYXNlLnNldFdvcmxkKHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNvbnRhY3QgbWF0ZXJpYWwgYmV0d2VlbiBtYXRlcmlhbHMgbTEgYW5kIG0yCiAgICAgKiBAcmV0dXJuIFRoZSBjb250YWN0IG1hdGVyaWFsIGlmIGl0IHdhcyBmb3VuZC4KICAgICAqLwoKCiAgICBnZXRDb250YWN0TWF0ZXJpYWwobTEsIG0yKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmdldChtMS5pZCwgbTIuaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdG9yZSBvbGQgY29sbGlzaW9uIHN0YXRlIGluZm8KICAgICAqLwoKCiAgICBjb2xsaXNpb25NYXRyaXhUaWNrKCkgewogICAgICBjb25zdCB0ZW1wID0gdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91czsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IHRoaXMuY29sbGlzaW9uTWF0cml4OwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IHRlbXA7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnJlc2V0KCk7CiAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci50aWNrKCk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIGNvbnN0cmFpbnQgdG8gdGhlIHNpbXVsYXRpb24uCiAgICAgKi8KCgogICAgYWRkQ29uc3RyYWludChjKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHMucHVzaChjKTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnN0cmFpbnQKICAgICAqLwoKCiAgICByZW1vdmVDb25zdHJhaW50KGMpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb25zdHJhaW50cy5pbmRleE9mKGMpOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmNvbnN0cmFpbnRzLnNwbGljZShpZHgsIDEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJheWNhc3QgdGVzdAogICAgICogQGRlcHJlY2F0ZWQgVXNlIC5yYXljYXN0QWxsLCAucmF5Y2FzdENsb3Nlc3Qgb3IgLnJheWNhc3RBbnkgaW5zdGVhZC4KICAgICAqLwoKCiAgICByYXlUZXN0KGZyb20sIHRvLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCBpbnN0YW5jZW9mIFJheWNhc3RSZXN1bHQpIHsKICAgICAgICAvLyBEbyByYXljYXN0Q2xvc2VzdAogICAgICAgIHRoaXMucmF5Y2FzdENsb3Nlc3QoZnJvbSwgdG8sIHsKICAgICAgICAgIHNraXBCYWNrZmFjZXM6IHRydWUKICAgICAgICB9LCByZXN1bHQpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIERvIHJheWNhc3RBbGwKICAgICAgICB0aGlzLnJheWNhc3RBbGwoZnJvbSwgdG8sIHsKICAgICAgICAgIHNraXBCYWNrZmFjZXM6IHRydWUKICAgICAgICB9LCByZXN1bHQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJheSBjYXN0IGFnYWluc3QgYWxsIGJvZGllcy4gVGhlIHByb3ZpZGVkIGNhbGxiYWNrIHdpbGwgYmUgZXhlY3V0ZWQgZm9yIGVhY2ggaGl0IHdpdGggYSBSYXljYXN0UmVzdWx0IGFzIHNpbmdsZSBhcmd1bWVudC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbGwoZnJvbSwgdG8sIG9wdGlvbnMsIGNhbGxiYWNrKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5BTEw7CiAgICAgIG9wdGlvbnMuZnJvbSA9IGZyb207CiAgICAgIG9wdGlvbnMudG8gPSB0bzsKICAgICAgb3B0aW9ucy5jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHN0b3AgYXQgdGhlIGZpcnN0IHJlc3VsdC4gTm90ZSB0aGF0IHRoZSBvcmRlciBpcyByYW5kb20gLSBidXQgdGhlIG1ldGhvZCBpcyBmYXN0LgogICAgICogQHJldHVybiBUcnVlIGlmIGFueSBib2R5IHdhcyBoaXQuCiAgICAgKi8KCgogICAgcmF5Y2FzdEFueShmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5BTlk7CiAgICAgIG9wdGlvbnMuZnJvbSA9IGZyb207CiAgICAgIG9wdGlvbnMudG8gPSB0bzsKICAgICAgb3B0aW9ucy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHJldHVybiB0bXBSYXkuaW50ZXJzZWN0V29ybGQodGhpcywgb3B0aW9ucyk7CiAgICB9CiAgICAvKioKICAgICAqIFJheSBjYXN0LCBhbmQgcmV0dXJuIGluZm9ybWF0aW9uIG9mIHRoZSBjbG9zZXN0IGhpdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCBvcHRpb25zLCByZXN1bHQpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkNMT1NFU1Q7CiAgICAgIG9wdGlvbnMuZnJvbSA9IGZyb207CiAgICAgIG9wdGlvbnMudG8gPSB0bzsKICAgICAgb3B0aW9ucy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHJldHVybiB0bXBSYXkuaW50ZXJzZWN0V29ybGQodGhpcywgb3B0aW9ucyk7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHJpZ2lkIGJvZHkgdG8gdGhlIHNpbXVsYXRpb24uCiAgICAgKiBAdG9kbyBJZiB0aGUgc2ltdWxhdGlvbiBoYXMgbm90IHlldCBzdGFydGVkLCB3aHkgcmVjcmV0ZSBhbmQgY29weSBhcnJheXMgZm9yIGVhY2ggYm9keT8gQWNjdW11bGF0ZSBpbiBkeW5hbWljIGFycmF5cyBpbiB0aGlzIGNhc2UuCiAgICAgKiBAdG9kbyBBZGRpbmcgYW4gYXJyYXkgb2YgYm9kaWVzIHNob3VsZCBiZSBwb3NzaWJsZS4gVGhpcyB3b3VsZCBzYXZlIHNvbWUgbG9vcHMgdG9vCiAgICAgKi8KCgogICAgYWRkQm9keShib2R5KSB7CiAgICAgIGlmICh0aGlzLmJvZGllcy5pbmNsdWRlcyhib2R5KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgYm9keS5pbmRleCA9IHRoaXMuYm9kaWVzLmxlbmd0aDsKICAgICAgdGhpcy5ib2RpZXMucHVzaChib2R5KTsKICAgICAgYm9keS53b3JsZCA9IHRoaXM7CiAgICAgIGJvZHkuaW5pdFBvc2l0aW9uLmNvcHkoYm9keS5wb3NpdGlvbik7CiAgICAgIGJvZHkuaW5pdFZlbG9jaXR5LmNvcHkoYm9keS52ZWxvY2l0eSk7CiAgICAgIGJvZHkudGltZUxhc3RTbGVlcHkgPSB0aGlzLnRpbWU7CgogICAgICBpZiAoYm9keSBpbnN0YW5jZW9mIEJvZHkpIHsKICAgICAgICBib2R5LmluaXRBbmd1bGFyVmVsb2NpdHkuY29weShib2R5LmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgICAgYm9keS5pbml0UXVhdGVybmlvbi5jb3B5KGJvZHkucXVhdGVybmlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnNldE51bU9iamVjdHModGhpcy5ib2RpZXMubGVuZ3RoKTsKICAgICAgdGhpcy5hZGRCb2R5RXZlbnQuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuaWRUb0JvZHlNYXBbYm9keS5pZF0gPSBib2R5OwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5hZGRCb2R5RXZlbnQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSByaWdpZCBib2R5IGZyb20gdGhlIHNpbXVsYXRpb24uCiAgICAgKi8KCgogICAgcmVtb3ZlQm9keShib2R5KSB7CiAgICAgIGJvZHkud29ybGQgPSBudWxsOwogICAgICBjb25zdCBuID0gdGhpcy5ib2RpZXMubGVuZ3RoIC0gMTsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IGlkeCA9IGJvZGllcy5pbmRleE9mKGJvZHkpOwoKICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICBib2RpZXMuc3BsaWNlKGlkeCwgMSk7IC8vIFRvZG86IHNob3VsZCB1c2UgYSBnYXJiYWdlIGZyZWUgbWV0aG9kCiAgICAgICAgLy8gUmVjb21wdXRlIGluZGV4CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS5pbmRleCA9IGk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKG4pOwogICAgICAgIHRoaXMucmVtb3ZlQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICAgIGRlbGV0ZSB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdOwogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCh0aGlzLnJlbW92ZUJvZHlFdmVudCk7CiAgICAgIH0KICAgIH0KCiAgICBnZXRCb2R5QnlJZChpZCkgewogICAgICByZXR1cm4gdGhpcy5pZFRvQm9keU1hcFtpZF07CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE1ha2UgYSBmYXN0ZXIgbWFwCiAgICAgKi8KCgogICAgZ2V0U2hhcGVCeUlkKGlkKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZXMgPSBib2RpZXNbaV0uc2hhcGVzOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbal07CgogICAgICAgICAgaWYgKHNoYXBlLmlkID09PSBpZCkgewogICAgICAgICAgICByZXR1cm4gc2hhcGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQWRkcyBhIGNvbnRhY3QgbWF0ZXJpYWwgdG8gdGhlIFdvcmxkCiAgICAgKi8KCgogICAgYWRkQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgLy8gQWRkIGNvbnRhY3QgbWF0ZXJpYWwKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnB1c2goY21hdCk7IC8vIEFkZCBjdXJyZW50IGNvbnRhY3QgbWF0ZXJpYWwgdG8gdGhlIG1hdGVyaWFsIHRhYmxlCgogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLnNldChjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQsIGNtYXQpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGEgY29udGFjdCBtYXRlcmlhbCBmcm9tIHRoZSBXb3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoY21hdCkgewogICAgICBjb25zdCBpZHggPSB0aGlzLmNvbnRhY3RtYXRlcmlhbHMuaW5kZXhPZihjbWF0KTsKCiAgICAgIGlmIChpZHggPT09IC0xKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuZGVsZXRlKGNtYXQubWF0ZXJpYWxzWzBdLmlkLCBjbWF0Lm1hdGVyaWFsc1sxXS5pZCk7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHNpbXVsYXRpb24gZm9yd2FyZCBrZWVwaW5nIHRyYWNrIG9mIGxhc3QgY2FsbGVkIHRpbWUKICAgICAqIHRvIGJlIGFibGUgdG8gc3RlcCB0aGUgd29ybGQgYXQgYSBmaXhlZCByYXRlLCBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZHQgVGhlIGZpeGVkIHRpbWUgc3RlcCBzaXplIHRvIHVzZSAoZGVmYXVsdDogMSAvIDYwKS4KICAgICAqIEBwYXJhbSBtYXhTdWJTdGVwcyBNYXhpbXVtIG51bWJlciBvZiBmaXhlZCBzdGVwcyB0byB0YWtlIHBlciBmdW5jdGlvbiBjYWxsIChkZWZhdWx0OiAxMCkuCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2FmZmVyb25nYW1lcy5jb20vcG9zdC9maXhfeW91cl90aW1lc3RlcC8KICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgLy8gUnVuIHRoZSBzaW11bGF0aW9uIGluZGVwZW5kZW50bHkgb2YgZnJhbWVyYXRlIGV2ZXJ5IDEgLyA2MCBtcwogICAgICogICAgIHdvcmxkLmZpeGVkU3RlcCgpCiAgICAgKi8KCgogICAgZml4ZWRTdGVwKGR0LCBtYXhTdWJTdGVwcykgewogICAgICBpZiAoZHQgPT09IHZvaWQgMCkgewogICAgICAgIGR0ID0gMSAvIDYwOwogICAgICB9CgogICAgICBpZiAobWF4U3ViU3RlcHMgPT09IHZvaWQgMCkgewogICAgICAgIG1heFN1YlN0ZXBzID0gMTA7CiAgICAgIH0KCiAgICAgIGNvbnN0IHRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAvIDEwMDA7IC8vIHNlY29uZHMKCiAgICAgIGlmICghdGhpcy5sYXN0Q2FsbFRpbWUpIHsKICAgICAgICB0aGlzLnN0ZXAoZHQsIHVuZGVmaW5lZCwgbWF4U3ViU3RlcHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RDYWxsZWQgPSB0aW1lIC0gdGhpcy5sYXN0Q2FsbFRpbWU7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB0aW1lU2luY2VMYXN0Q2FsbGVkLCBtYXhTdWJTdGVwcyk7CiAgICAgIH0KCiAgICAgIHRoaXMubGFzdENhbGxUaW1lID0gdGltZTsKICAgIH0KICAgIC8qKgogICAgICogU3RlcCB0aGUgcGh5c2ljcyB3b3JsZCBmb3J3YXJkIGluIHRpbWUuCiAgICAgKgogICAgICogVGhlcmUgYXJlIHR3byBtb2Rlcy4gVGhlIHNpbXBsZSBtb2RlIGlzIGZpeGVkIHRpbWVzdGVwcGluZyB3aXRob3V0IGludGVycG9sYXRpb24uIEluIHRoaXMgY2FzZSB5b3Ugb25seSB1c2UgdGhlIGZpcnN0IGFyZ3VtZW50LiBUaGUgc2Vjb25kIGNhc2UgdXNlcyBpbnRlcnBvbGF0aW9uLiBJbiB0aGF0IHlvdSBhbHNvIHByb3ZpZGUgdGhlIHRpbWUgc2luY2UgdGhlIGZ1bmN0aW9uIHdhcyBsYXN0IHVzZWQsIGFzIHdlbGwgYXMgdGhlIG1heGltdW0gZml4ZWQgdGltZXN0ZXBzIHRvIHRha2UuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UuCiAgICAgKiBAcGFyYW0gdGltZVNpbmNlTGFzdENhbGxlZCBUaGUgdGltZSBlbGFwc2VkIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCBjYWxsZWQuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL3dlYi5hcmNoaXZlLm9yZy93ZWIvMjAxODA0MjYxNTQ1MzEvaHR0cDovL2J1bGxldHBoeXNpY3Mub3JnL21lZGlhd2lraS0xLjUuOC9pbmRleC5waHAvU3RlcHBpbmdfVGhlX1dvcmxkI1doYXRfZG9fdGhlX3BhcmFtZXRlcnNfdG9fYnREeW5hbWljc1dvcmxkOjpzdGVwU2ltdWxhdGlvbl9tZWFuLjNGCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIGZpeGVkIHRpbWVzdGVwcGluZyB3aXRob3V0IGludGVycG9sYXRpb24KICAgICAqICAgICB3b3JsZC5zdGVwKDEgLyA2MCkKICAgICAqLwoKCiAgICBzdGVwKGR0LCB0aW1lU2luY2VMYXN0Q2FsbGVkLCBtYXhTdWJTdGVwcykgewogICAgICBpZiAobWF4U3ViU3RlcHMgPT09IHZvaWQgMCkgewogICAgICAgIG1heFN1YlN0ZXBzID0gMTA7CiAgICAgIH0KCiAgICAgIGlmICh0aW1lU2luY2VMYXN0Q2FsbGVkID09PSB1bmRlZmluZWQpIHsKICAgICAgICAvLyBGaXhlZCwgc2ltcGxlIHN0ZXBwaW5nCiAgICAgICAgdGhpcy5pbnRlcm5hbFN0ZXAoZHQpOyAvLyBJbmNyZW1lbnQgdGltZQoKICAgICAgICB0aGlzLnRpbWUgKz0gZHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5hY2N1bXVsYXRvciArPSB0aW1lU2luY2VMYXN0Q2FsbGVkOwogICAgICAgIGNvbnN0IHQwID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgbGV0IHN1YnN0ZXBzID0gMDsKCiAgICAgICAgd2hpbGUgKHRoaXMuYWNjdW11bGF0b3IgPj0gZHQgJiYgc3Vic3RlcHMgPCBtYXhTdWJTdGVwcykgewogICAgICAgICAgLy8gRG8gZml4ZWQgc3RlcHMgdG8gY2F0Y2ggdXAKICAgICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsKICAgICAgICAgIHRoaXMuYWNjdW11bGF0b3IgLT0gZHQ7CiAgICAgICAgICBzdWJzdGVwcysrOwoKICAgICAgICAgIGlmIChwZXJmb3JtYW5jZS5ub3coKSAtIHQwID4gZHQgKiAxMDAwKSB7CiAgICAgICAgICAgIC8vIFRoZSBmcmFtZXJhdGUgaXMgbm90IGludGVyYWN0aXZlIGFueW1vcmUuCiAgICAgICAgICAgIC8vIFdlIGFyZSBiZWxvdyB0aGUgdGFyZ2V0IGZyYW1lcmF0ZS4KICAgICAgICAgICAgLy8gQmV0dGVyIGJhaWwgb3V0LgogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9IC8vIFJlbW92ZSB0aGUgZXhjZXNzIGFjY3VtdWxhdG9yLCBzaW5jZSB3ZSBtYXkgbm90CiAgICAgICAgLy8gaGF2ZSBoYWQgZW5vdWdoIHN1YnN0ZXBzIGF2YWlsYWJsZSB0byBjYXRjaCB1cAoKCiAgICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IHRoaXMuYWNjdW11bGF0b3IgJSBkdDsKICAgICAgICBjb25zdCB0ID0gdGhpcy5hY2N1bXVsYXRvciAvIGR0OwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gdGhpcy5ib2RpZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGIgPSB0aGlzLmJvZGllc1tqXTsKICAgICAgICAgIGIucHJldmlvdXNQb3NpdGlvbi5sZXJwKGIucG9zaXRpb24sIHQsIGIuaW50ZXJwb2xhdGVkUG9zaXRpb24pOwogICAgICAgICAgYi5wcmV2aW91c1F1YXRlcm5pb24uc2xlcnAoYi5xdWF0ZXJuaW9uLCB0LCBiLmludGVycG9sYXRlZFF1YXRlcm5pb24pOwogICAgICAgICAgYi5wcmV2aW91c1F1YXRlcm5pb24ubm9ybWFsaXplKCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLnRpbWUgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgfQogICAgfQoKICAgIGludGVybmFsU3RlcChkdCkgewogICAgICB0aGlzLmR0ID0gZHQ7CiAgICAgIGNvbnN0IGNvbnRhY3RzID0gdGhpcy5jb250YWN0czsKICAgICAgY29uc3QgcDEgPSBXb3JsZF9zdGVwX3AxOwogICAgICBjb25zdCBwMiA9IFdvcmxkX3N0ZXBfcDI7CiAgICAgIGNvbnN0IE4gPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBzb2x2ZXIgPSB0aGlzLnNvbHZlcjsKICAgICAgY29uc3QgZ3Jhdml0eSA9IHRoaXMuZ3Jhdml0eTsKICAgICAgY29uc3QgZG9Qcm9maWxpbmcgPSB0aGlzLmRvUHJvZmlsaW5nOwogICAgICBjb25zdCBwcm9maWxlID0gdGhpcy5wcm9maWxlOwogICAgICBjb25zdCBEWU5BTUlDID0gQm9keS5EWU5BTUlDOwogICAgICBsZXQgcHJvZmlsaW5nU3RhcnQgPSAtSW5maW5pdHk7CiAgICAgIGNvbnN0IGNvbnN0cmFpbnRzID0gdGhpcy5jb25zdHJhaW50czsKICAgICAgY29uc3QgZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBXb3JsZF9zdGVwX2ZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICBncmF2aXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBneCA9IGdyYXZpdHkueDsKICAgICAgY29uc3QgZ3kgPSBncmF2aXR5Lnk7CiAgICAgIGNvbnN0IGd6ID0gZ3Jhdml0eS56OwogICAgICBsZXQgaSA9IDA7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBncmF2aXR5IHRvIGFsbCBvYmplY3RzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS50eXBlID09PSBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgZiA9IGJpLmZvcmNlOwogICAgICAgICAgY29uc3QgbSA9IGJpLm1hc3M7CiAgICAgICAgICBmLnggKz0gbSAqIGd4OwogICAgICAgICAgZi55ICs9IG0gKiBneTsKICAgICAgICAgIGYueiArPSBtICogZ3o7CiAgICAgICAgfQogICAgICB9IC8vIFVwZGF0ZSBzdWJzeXN0ZW1zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIE5zdWJzeXN0ZW1zID0gdGhpcy5zdWJzeXN0ZW1zLmxlbmd0aDsgaSAhPT0gTnN1YnN5c3RlbXM7IGkrKykgewogICAgICAgIHRoaXMuc3Vic3lzdGVtc1tpXS51cGRhdGUoKTsKICAgICAgfSAvLyBDb2xsaXNpb24gZGV0ZWN0aW9uCgoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfQoKICAgICAgcDEubGVuZ3RoID0gMDsgLy8gQ2xlYW4gdXAgcGFpciBhcnJheXMgZnJvbSBsYXN0IHN0ZXAKCiAgICAgIHAyLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5jb2xsaXNpb25QYWlycyh0aGlzLCBwMSwgcDIpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5icm9hZHBoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBSZW1vdmUgY29uc3RyYWluZWQgcGFpcnMgd2l0aCBjb2xsaWRlQ29ubmVjdGVkID09IGZhbHNlCgoKICAgICAgbGV0IE5jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5jb25zdHJhaW50czsgaSsrKSB7CiAgICAgICAgY29uc3QgYyA9IGNvbnN0cmFpbnRzW2ldOwoKICAgICAgICBpZiAoIWMuY29sbGlkZUNvbm5lY3RlZCkgewogICAgICAgICAgZm9yIChsZXQgaiA9IHAxLmxlbmd0aCAtIDE7IGogPj0gMDsgaiAtPSAxKSB7CiAgICAgICAgICAgIGlmIChjLmJvZHlBID09PSBwMVtqXSAmJiBjLmJvZHlCID09PSBwMltqXSB8fCBjLmJvZHlCID09PSBwMVtqXSAmJiBjLmJvZHlBID09PSBwMltqXSkgewogICAgICAgICAgICAgIHAxLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICBwMi5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4VGljaygpOyAvLyBHZW5lcmF0ZSBjb250YWN0cwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfQoKICAgICAgY29uc3Qgb2xkY29udGFjdHMgPSBXb3JsZF9zdGVwX29sZENvbnRhY3RzOwogICAgICBjb25zdCBOb2xkQ29udGFjdHMgPSBjb250YWN0cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOb2xkQ29udGFjdHM7IGkrKykgewogICAgICAgIG9sZGNvbnRhY3RzLnB1c2goY29udGFjdHNbaV0pOwogICAgICB9CgogICAgICBjb250YWN0cy5sZW5ndGggPSAwOyAvLyBUcmFuc2ZlciBGcmljdGlvbkVxdWF0aW9uIGZyb20gY3VycmVudCBsaXN0IHRvIHRoZSBwb29sIGZvciByZXVzZQoKICAgICAgY29uc3QgTm9sZEZyaWN0aW9uRXF1YXRpb25zID0gdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOb2xkRnJpY3Rpb25FcXVhdGlvbnM7IGkrKykgewogICAgICAgIGZyaWN0aW9uRXF1YXRpb25Qb29sLnB1c2godGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoID0gMDsKICAgICAgdGhpcy5uYXJyb3dwaGFzZS5nZXRDb250YWN0cyhwMSwgcDIsIHRoaXMsIGNvbnRhY3RzLCBvbGRjb250YWN0cywgLy8gVG8gYmUgcmV1c2VkCiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMsIGZyaWN0aW9uRXF1YXRpb25Qb29sKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUubmFycm93cGhhc2UgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIExvb3Agb3ZlciBhbGwgY29sbGlzaW9ucwoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0gLy8gQWRkIGFsbCBmcmljdGlvbiBlcXMKCgogICAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5sZW5ndGg7IGkrKykgewogICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbih0aGlzLmZyaWN0aW9uRXF1YXRpb25zW2ldKTsKICAgICAgfQoKICAgICAgY29uc3QgbmNvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IG5jb250YWN0czsgaysrKSB7CiAgICAgICAgLy8gQ3VycmVudCBjb250YWN0CiAgICAgICAgY29uc3QgYyA9IGNvbnRhY3RzW2tdOyAvLyBHZXQgY3VycmVudCBjb2xsaXNpb24gaW5kZWNlcwoKICAgICAgICBjb25zdCBiaSA9IGMuYmk7CiAgICAgICAgY29uc3QgYmogPSBjLmJqOwogICAgICAgIGNvbnN0IHNpID0gYy5zaTsKICAgICAgICBjb25zdCBzaiA9IGMuc2o7IC8vIEdldCBjb2xsaXNpb24gcHJvcGVydGllcwoKICAgICAgICBsZXQgY207CgogICAgICAgIGlmIChiaS5tYXRlcmlhbCAmJiBiai5tYXRlcmlhbCkgewogICAgICAgICAgY20gPSB0aGlzLmdldENvbnRhY3RNYXRlcmlhbChiaS5tYXRlcmlhbCwgYmoubWF0ZXJpYWwpIHx8IHRoaXMuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY20gPSB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSAvLyBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKCgogICAgICAgIGNtLmZyaWN0aW9uOyAvLyBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgICAgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGlmIChiaS5tYXRlcmlhbC5mcmljdGlvbiA+PSAwICYmIGJqLm1hdGVyaWFsLmZyaWN0aW9uID49IDApIHsKICAgICAgICAgICAgYmkubWF0ZXJpYWwuZnJpY3Rpb24gKiBiai5tYXRlcmlhbC5mcmljdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGMucmVzdGl0dXRpb24gPSBiaS5tYXRlcmlhbC5yZXN0aXR1dGlvbiAqIGJqLm1hdGVyaWFsLnJlc3RpdHV0aW9uOwogICAgICAgICAgfQogICAgICAgIH0gLy8gYy5zZXRTcG9va1BhcmFtcygKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLAogICAgICAgIC8vICAgICAgICAgICBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLAogICAgICAgIC8vICAgICAgICAgICBkdAogICAgICAgIC8vICAgICAgICk7CgoKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24oYyk7IC8vIC8vIEFkZCBmcmljdGlvbiBjb25zdHJhaW50IGVxdWF0aW9uCiAgICAgICAgLy8gaWYobXUgPiAwKXsKICAgICAgICAvLyAJLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICAvLyAJY29uc3QgbXVnID0gbXUgKiBnbm9ybTsKICAgICAgICAvLyAJY29uc3QgcmVkdWNlZE1hc3MgPSAoYmkuaW52TWFzcyArIGJqLmludk1hc3MpOwogICAgICAgIC8vIAlpZihyZWR1Y2VkTWFzcyA+IDApewogICAgICAgIC8vIAkJcmVkdWNlZE1hc3MgPSAxL3JlZHVjZWRNYXNzOwogICAgICAgIC8vIAl9CiAgICAgICAgLy8gCWNvbnN0IHBvb2wgPSBmcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgICAvLyAJY29uc3QgYzEgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAljb25zdCBjMiA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJpLGJqLG11ZypyZWR1Y2VkTWFzcyk7CiAgICAgICAgLy8gCXRoaXMuZnJpY3Rpb25FcXVhdGlvbnMucHVzaChjMSwgYzIpOwogICAgICAgIC8vIAljMS5iaSA9IGMyLmJpID0gYmk7CiAgICAgICAgLy8gCWMxLmJqID0gYzIuYmogPSBiajsKICAgICAgICAvLyAJYzEubWluRm9yY2UgPSBjMi5taW5Gb3JjZSA9IC1tdWcqcmVkdWNlZE1hc3M7CiAgICAgICAgLy8gCWMxLm1heEZvcmNlID0gYzIubWF4Rm9yY2UgPSBtdWcqcmVkdWNlZE1hc3M7CiAgICAgICAgLy8gCS8vIENvcHkgb3ZlciB0aGUgcmVsYXRpdmUgdmVjdG9ycwogICAgICAgIC8vIAljMS5yaS5jb3B5KGMucmkpOwogICAgICAgIC8vIAljMS5yai5jb3B5KGMucmopOwogICAgICAgIC8vIAljMi5yaS5jb3B5KGMucmkpOwogICAgICAgIC8vIAljMi5yai5jb3B5KGMucmopOwogICAgICAgIC8vIAkvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKICAgICAgICAvLyAJYy5uaS50YW5nZW50cyhjMS50LCBjMi50KTsKICAgICAgICAvLyAgICAgICAgICAgLy8gU2V0IHNwb29rIHBhcmFtcwogICAgICAgIC8vICAgICAgICAgICBjMS5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgZHQpOwogICAgICAgIC8vICAgICAgICAgICBjMi5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgZHQpOwogICAgICAgIC8vICAgICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGMuZW5hYmxlZDsKICAgICAgICAvLyAJLy8gQWRkIGVxdWF0aW9ucyB0byBzb2x2ZXIKICAgICAgICAvLyAJc29sdmVyLmFkZEVxdWF0aW9uKGMxKTsKICAgICAgICAvLyAJc29sdmVyLmFkZEVxdWF0aW9uKGMyKTsKICAgICAgICAvLyB9CgogICAgICAgIGlmIChiaS5hbGxvd1NsZWVwICYmIGJpLnR5cGUgPT09IEJvZHkuRFlOQU1JQyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HICYmIGJqLnNsZWVwU3RhdGUgPT09IEJvZHkuQVdBS0UgJiYgYmoudHlwZSAhPT0gQm9keS5TVEFUSUMpIHsKICAgICAgICAgIGNvbnN0IHNwZWVkU3F1YXJlZEIgPSBiai52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyBiai5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpOwogICAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWRCID0gYmouc2xlZXBTcGVlZExpbWl0ICoqIDI7CgogICAgICAgICAgaWYgKHNwZWVkU3F1YXJlZEIgPj0gc3BlZWRMaW1pdFNxdWFyZWRCICogMikgewogICAgICAgICAgICBiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChiai5hbGxvd1NsZWVwICYmIGJqLnR5cGUgPT09IEJvZHkuRFlOQU1JQyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HICYmIGJpLnNsZWVwU3RhdGUgPT09IEJvZHkuQVdBS0UgJiYgYmkudHlwZSAhPT0gQm9keS5TVEFUSUMpIHsKICAgICAgICAgIGNvbnN0IHNwZWVkU3F1YXJlZEEgPSBiaS52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyBiaS5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpOwogICAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWRBID0gYmkuc2xlZXBTcGVlZExpbWl0ICoqIDI7CgogICAgICAgICAgaWYgKHNwZWVkU3F1YXJlZEEgPj0gc3BlZWRMaW1pdFNxdWFyZWRBICogMikgewogICAgICAgICAgICBiai53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9IC8vIE5vdyB3ZSBrbm93IHRoYXQgaSBhbmQgaiBhcmUgaW4gY29udGFjdC4gU2V0IGNvbGxpc2lvbiBtYXRyaXggc3RhdGUKCgogICAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnNldChiaSwgYmosIHRydWUpOwoKICAgICAgICBpZiAoIXRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMuZ2V0KGJpLCBiaikpIHsKICAgICAgICAgIC8vIEZpcnN0IGNvbnRhY3QhCiAgICAgICAgICAvLyBXZSByZXVzZSB0aGUgY29sbGlkZUV2ZW50IG9iamVjdCwgb3RoZXJ3aXNlIHdlIHdpbGwgZW5kIHVwIGNyZWF0aW5nIG5ldyBvYmplY3RzIGZvciBlYWNoIG5ldyBjb250YWN0LCBldmVuIGlmIHRoZXJlJ3Mgbm8gZXZlbnQgbGlzdGVuZXIgYXR0YWNoZWQuCiAgICAgICAgICBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudC5ib2R5ID0gYmo7CiAgICAgICAgICBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudC5jb250YWN0ID0gYzsKICAgICAgICAgIGJpLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJpOwogICAgICAgICAgYmouZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnNldChiaS5pZCwgYmouaWQpOwogICAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICB9CgogICAgICB0aGlzLmVtaXRDb250YWN0RXZlbnRzKCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm1ha2VDb250YWN0Q29uc3RyYWludHMgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0gLy8gV2FrZSB1cCBib2RpZXMKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UpIHsKICAgICAgICAgIGJpLndha2VVcCgpOwogICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSAvLyBBZGQgdXNlci1hZGRlZCBjb25zdHJhaW50cwoKCiAgICAgIE5jb25zdHJhaW50cyA9IGNvbnN0cmFpbnRzLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5jb25zdHJhaW50czsgaSsrKSB7CiAgICAgICAgY29uc3QgYyA9IGNvbnN0cmFpbnRzW2ldOwogICAgICAgIGMudXBkYXRlKCk7CgogICAgICAgIGZvciAobGV0IGogPSAwLCBOZXEgPSBjLmVxdWF0aW9ucy5sZW5ndGg7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICBjb25zdCBlcSA9IGMuZXF1YXRpb25zW2pdOwogICAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGVxKTsKICAgICAgICB9CiAgICAgIH0gLy8gU29sdmUgdGhlIGNvbnN0cmFpbmVkIHN5c3RlbQoKCiAgICAgIHNvbHZlci5zb2x2ZShkdCwgdGhpcyk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLnNvbHZlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBSZW1vdmUgYWxsIGNvbnRhY3RzIGZyb20gc29sdmVyCgoKICAgICAgc29sdmVyLnJlbW92ZUFsbEVxdWF0aW9ucygpOyAvLyBBcHBseSBkYW1waW5nLCBzZWUgaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2J1bGxldC9pc3N1ZXMvZGV0YWlsP2lkPTc0IGZvciBkZXRhaWxzCgogICAgICBjb25zdCBwb3cgPSBNYXRoLnBvdzsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSAmIERZTkFNSUMpIHsKICAgICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMgYm9kaWVzCiAgICAgICAgICBjb25zdCBsZCA9IHBvdygxLjAgLSBiaS5saW5lYXJEYW1waW5nLCBkdCk7CiAgICAgICAgICBjb25zdCB2ID0gYmkudmVsb2NpdHk7CiAgICAgICAgICB2LnNjYWxlKGxkLCB2KTsKICAgICAgICAgIGNvbnN0IGF2ID0gYmkuYW5ndWxhclZlbG9jaXR5OwoKICAgICAgICAgIGlmIChhdikgewogICAgICAgICAgICBjb25zdCBhZCA9IHBvdygxLjAgLSBiaS5hbmd1bGFyRGFtcGluZywgZHQpOwogICAgICAgICAgICBhdi5zY2FsZShhZCwgYXYpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50KTsgLy8gTGVhcCBmcm9nCiAgICAgIC8vIHZuZXcgPSB2ICsgaCpmL20KICAgICAgLy8geG5ldyA9IHggKyBoKnZuZXcKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHN0ZXBudW1iZXIgPSB0aGlzLnN0ZXBudW1iZXI7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemUgPSBzdGVwbnVtYmVyICUgKHRoaXMucXVhdE5vcm1hbGl6ZVNraXAgKyAxKSA9PT0gMDsKICAgICAgY29uc3QgcXVhdE5vcm1hbGl6ZUZhc3QgPSB0aGlzLnF1YXROb3JtYWxpemVGYXN0OwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgYm9kaWVzW2ldLmludGVncmF0ZShkdCwgcXVhdE5vcm1hbGl6ZSwgcXVhdE5vcm1hbGl6ZUZhc3QpOwogICAgICB9CgogICAgICB0aGlzLmNsZWFyRm9yY2VzKCk7CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5kaXJ0eSA9IHRydWU7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLmludGVncmF0ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gVXBkYXRlIHN0ZXAgbnVtYmVyCgoKICAgICAgdGhpcy5zdGVwbnVtYmVyICs9IDE7CiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3Bvc3RTdGVwRXZlbnQpOyAvLyBTbGVlcGluZyB1cGRhdGUKCiAgICAgIGxldCBoYXNBY3RpdmVCb2RpZXMgPSB0cnVlOwoKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IGZhbHNlOwoKICAgICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmkuc2xlZXBUaWNrKHRoaXMudGltZSk7CgogICAgICAgICAgaWYgKGJpLnNsZWVwU3RhdGUgIT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAgICAgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gaGFzQWN0aXZlQm9kaWVzOwogICAgfQoKICAgIGVtaXRDb250YWN0RXZlbnRzKCkgewogICAgICBjb25zdCBoYXNCZWdpbkNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2JlZ2luQ29udGFjdCcpOwogICAgICBjb25zdCBoYXNFbmRDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRDb250YWN0Jyk7CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0IHx8IGhhc0VuZENvbnRhY3QpIHsKICAgICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLmdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscyk7CiAgICAgIH0KCiAgICAgIGlmIChoYXNCZWdpbkNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaV0pOwogICAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKGFkZGl0aW9uc1tpICsgMV0pOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGJlZ2luQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5Db250YWN0RXZlbnQuYm9keUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcmVtb3ZhbHMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUEgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IHRoaXMuZ2V0Qm9keUJ5SWQocmVtb3ZhbHNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gZW5kQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgYWRkaXRpb25zLmxlbmd0aCA9IHJlbW92YWxzLmxlbmd0aCA9IDA7CiAgICAgIGNvbnN0IGhhc0JlZ2luU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpblNoYXBlQ29udGFjdCcpOwogICAgICBjb25zdCBoYXNFbmRTaGFwZUNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2VuZFNoYXBlQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luU2hhcGVDb250YWN0IHx8IGhhc0VuZFNoYXBlQ29udGFjdCkgewogICAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyLmdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscyk7CiAgICAgIH0KCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYWRkaXRpb25zLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgY29uc3Qgc2hhcGVBID0gdGhpcy5nZXRTaGFwZUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpICsgMV0pOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IHNoYXBlQjsKICAgICAgICAgIGlmIChzaGFwZUEpIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBzaGFwZUEuYm9keTsKICAgICAgICAgIGlmIChzaGFwZUIpIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpblNoYXBlQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgY29uc3Qgc2hhcGVBID0gdGhpcy5nZXRTaGFwZUJ5SWQocmVtb3ZhbHNbaV0pOwogICAgICAgICAgY29uc3Qgc2hhcGVCID0gdGhpcy5nZXRTaGFwZUJ5SWQocmVtb3ZhbHNbaSArIDFdKTsKICAgICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IHNoYXBlQTsKICAgICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IHNoYXBlQjsKICAgICAgICAgIGlmIChzaGFwZUEpIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IHNoYXBlQi5ib2R5OwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGVuZFNoYXBlQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgYWxsIGJvZHkgZm9yY2VzIGluIHRoZSB3b3JsZCB0byB6ZXJvLgogICAgICovCgoKICAgIGNsZWFyRm9yY2VzKCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBiLmZvcmNlOwogICAgICAgIGIudG9ycXVlOwogICAgICAgIGIuZm9yY2Uuc2V0KDAsIDAsIDApOwogICAgICAgIGIudG9ycXVlLnNldCgwLCAwLCAwKTsKICAgICAgfQogICAgfQoKICB9IC8vIFRlbXAgc3R1ZmYKCiAgbmV3IEFBQkIoKTsKICBjb25zdCB0bXBSYXkgPSBuZXcgUmF5KCk7IC8vIHBlcmZvcm1hbmNlLm5vdygpIGZhbGxiYWNrIG9uIERhdGUubm93KCkKCiAgY29uc3QgcGVyZm9ybWFuY2UgPSBnbG9iYWxUaGlzLnBlcmZvcm1hbmNlIHx8IHt9OwoKICBpZiAoIXBlcmZvcm1hbmNlLm5vdykgewogICAgbGV0IG5vd09mZnNldCA9IERhdGUubm93KCk7CgogICAgaWYgKHBlcmZvcm1hbmNlLnRpbWluZyAmJiBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0KSB7CiAgICAgIG5vd09mZnNldCA9IHBlcmZvcm1hbmNlLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQ7CiAgICB9CgogICAgcGVyZm9ybWFuY2Uubm93ID0gKCkgPT4gRGF0ZS5ub3coKSAtIG5vd09mZnNldDsKICB9CgogIG5ldyBWZWMzKCk7IC8vIERpc3BhdGNoZWQgYWZ0ZXIgdGhlIHdvcmxkIGhhcyBzdGVwcGVkIGZvcndhcmQgaW4gdGltZS4KICAvLyBSZXVzYWJsZSBldmVudCBvYmplY3RzIHRvIHNhdmUgbWVtb3J5LgoKICBjb25zdCBXb3JsZF9zdGVwX3Bvc3RTdGVwRXZlbnQgPSB7CiAgICB0eXBlOiAncG9zdFN0ZXAnCiAgfTsgLy8gRGlzcGF0Y2hlZCBiZWZvcmUgdGhlIHdvcmxkIHN0ZXBzIGZvcndhcmQgaW4gdGltZS4KCiAgY29uc3QgV29ybGRfc3RlcF9wcmVTdGVwRXZlbnQgPSB7CiAgICB0eXBlOiAncHJlU3RlcCcKICB9OwogIGNvbnN0IFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50ID0gewogICAgdHlwZTogQm9keS5DT0xMSURFX0VWRU5UX05BTUUsCiAgICBib2R5OiBudWxsLAogICAgY29udGFjdDogbnVsbAogIH07IC8vIFBvb2xzIGZvciB1bnVzZWQgb2JqZWN0cwoKICBjb25zdCBXb3JsZF9zdGVwX29sZENvbnRhY3RzID0gW107CiAgY29uc3QgV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbCA9IFtdOyAvLyBSZXVzYWJsZSBhcnJheXMgZm9yIGNvbGxpc2lvbiBwYWlycwoKICBjb25zdCBXb3JsZF9zdGVwX3AxID0gW107CiAgY29uc3QgV29ybGRfc3RlcF9wMiA9IFtdOyAvLyBTdHVmZiBmb3IgZW1pdENvbnRhY3RFdmVudHMKCiAgY29uc3QgYWRkaXRpb25zID0gW107CiAgY29uc3QgcmVtb3ZhbHMgPSBbXTsKICBjb25zdCBiZWdpbkNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdiZWdpbkNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbAogIH07CiAgY29uc3QgZW5kQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2VuZENvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbAogIH07CiAgY29uc3QgYmVnaW5TaGFwZUNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdiZWdpblNoYXBlQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsLAogICAgc2hhcGVBOiBudWxsLAogICAgc2hhcGVCOiBudWxsCiAgfTsKICBjb25zdCBlbmRTaGFwZUNvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRTaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CgogIGNvbnN0IGFkZENvbnRhY3RNYXRlcmlhbCA9ICh3b3JsZCwgY3JlYXRlTWF0ZXJpYWwsIF9yZWYsIHV1aWQpID0+IHsKICAgIGxldCBbbWF0ZXJpYWxBLCBtYXRlcmlhbEIsIG9wdGlvbnNdID0gX3JlZjsKICAgIGNvbnN0IG1hdEEgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEEpOwogICAgY29uc3QgbWF0QiA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsQik7CiAgICBjb25zdCBjb250YWN0TWF0ZXJpYWwgPSBuZXcgQ29udGFjdE1hdGVyaWFsKG1hdEEsIG1hdEIsIG9wdGlvbnMpOwogICAgY29udGFjdE1hdGVyaWFsLnV1aWQgPSB1dWlkOwogICAgd29ybGQuYWRkQ29udGFjdE1hdGVyaWFsKGNvbnRhY3RNYXRlcmlhbCk7CiAgfTsKICBjb25zdCByZW1vdmVDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNtVVVJRCkgPT4gewogICAgY29uc3QgaW5kZXggPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLmZpbmRJbmRleChfcmVmMiA9PiB7CiAgICAgIGxldCB7CiAgICAgICAgdXVpZAogICAgICB9ID0gX3JlZjI7CiAgICAgIHJldHVybiB1dWlkID09PSBjbVVVSUQ7CiAgICB9KTsKICAgIGNvbnN0IFt7CiAgICAgIGlkOiBpCiAgICB9LCB7CiAgICAgIGlkOiBqCiAgICB9XSA9IHdvcmxkLmNvbnRhY3RtYXRlcmlhbHNbaW5kZXhdLm1hdGVyaWFsczsKICAgIHdvcmxkLmNvbnRhY3RtYXRlcmlhbHMuc3BsaWNlKGluZGV4LCAxKTsKICAgIGRlbGV0ZSB3b3JsZC5jb250YWN0TWF0ZXJpYWxUYWJsZS5kYXRhW2kgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YF07CiAgfTsKCiAgbGV0IG1hdGVyaWFsSWQgPSAwOwogIGNvbnN0IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeSA9IG1hdGVyaWFscyA9PiBmdW5jdGlvbiAobmFtZU9yT3B0aW9ucykgewogICAgaWYgKG5hbWVPck9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICBuYW1lT3JPcHRpb25zID0ge307CiAgICB9CgogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwoKICBjb25zdCBwcmVwYXJlU3BoZXJlID0gYXJncyA9PiBBcnJheS5pc0FycmF5KGFyZ3MpID8gYXJncyA6IFthcmdzXTsKCiAgY29uc3QgcHJlcGFyZUNvbnZleFBvbHloZWRyb24gPSBfcmVmMiA9PiB7CiAgICBsZXQgW3YsIGZhY2VzLCBuLCBhLCBib3VuZGluZ1NwaGVyZVJhZGl1c10gPSBfcmVmMjsKICAgIHJldHVybiBbewogICAgICBheGVzOiBhID8gYS5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICBib3VuZGluZ1NwaGVyZVJhZGl1cywKICAgICAgZmFjZXMsCiAgICAgIG5vcm1hbHM6IG4gPyBuLm1hcChtYWtlVmVjMykgOiB1bmRlZmluZWQsCiAgICAgIHZlcnRpY2VzOiB2ID8gdi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkCiAgICB9XTsKICB9OwoKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCgogICAgICBjYXNlICdDb252ZXhQb2x5aGVkcm9uJzoKICAgICAgICByZXR1cm4gbmV3IENvbnZleFBvbHloZWRyb24oLi4ucHJlcGFyZUNvbnZleFBvbHloZWRyb24oYXJncykpOwoKICAgICAgY2FzZSAnQ3lsaW5kZXInOgogICAgICAgIHJldHVybiBuZXcgQ3lsaW5kZXIoLi4uYXJncyk7CiAgICAgIC8vIFsgcmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMgXSA9IGFyZ3MKCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKCiAgICAgIGNhc2UgJ1BhcnRpY2xlJzoKICAgICAgICByZXR1cm4gbmV3IFBhcnRpY2xlKCk7CiAgICAgIC8vIG5vIGFyZ3MKCiAgICAgIGNhc2UgJ1BsYW5lJzoKICAgICAgICByZXR1cm4gbmV3IFBsYW5lKCk7CiAgICAgIC8vIG5vIGFyZ3MsIGluZmluaXRlIHggYW5kIHkKCiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKCiAgICAgIGNhc2UgJ1RyaW1lc2gnOgogICAgICAgIHJldHVybiBuZXcgVHJpbWVzaCguLi5hcmdzKTsKICAgICAgLy8gW3ZlcnRpY2VzLCBpbmRpY2VzXSA9IGFyZ3MKICAgIH0KICB9CiAgLyoqCiAgICogQGZ1bmN0aW9uCiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMKICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy51dWlkCiAgICogQHBhcmFtIHtCb2R5UHJvcHN9IG9wdGlvbnMucHJvcHMKICAgKiBAcGFyYW0ge0JvZHlTaGFwZVR5cGV9IG9wdGlvbnMudHlwZQogICAqIEBwYXJhbSB7KG1hdGVyaWFsT3B0aW9uczogTWF0ZXJpYWxPcHRpb25zKSA9PiBNYXRlcmlhbCA9fSBvcHRpb25zLmNyZWF0ZU1hdGVyaWFsCiAgICogQHJldHVybnMge0JvZHl9CiAgICovCgoKICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uID0gWzAsIDAsIDBdLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7IC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKCiAgICBpZiAoY29sbGlzaW9uUmVzcG9uc2UgIT09IHVuZGVmaW5lZCkgewogICAgICBib2R5LmNvbGxpc2lvblJlc3BvbnNlID0gY29sbGlzaW9uUmVzcG9uc2U7CiAgICB9CgogICAgaWYgKHR5cGUgPT09ICdDb21wb3VuZCcpIHsKICAgICAgc2hhcGVzLmZvckVhY2goX3JlZjMgPT4gewogICAgICAgIGxldCB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgYXJncywKICAgICAgICAgIHBvc2l0aW9uLAogICAgICAgICAgcm90YXRpb24sCiAgICAgICAgICBtYXRlcmlhbCwKICAgICAgICAgIC4uLmV4dHJhCiAgICAgICAgfSA9IF9yZWYzOwogICAgICAgIGNvbnN0IHNoYXBlQm9keSA9IGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncyksIHBvc2l0aW9uID8gbmV3IFZlYzMoLi4ucG9zaXRpb24pIDogdW5kZWZpbmVkLCByb3RhdGlvbiA/IG5ldyBRdWF0ZXJuaW9uKCkuc2V0RnJvbUV1bGVyKC4uLnJvdGF0aW9uKSA6IHVuZGVmaW5lZCk7CiAgICAgICAgaWYgKG1hdGVyaWFsKSBzaGFwZUJvZHkubWF0ZXJpYWwgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbCk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzaGFwZUJvZHksIGV4dHJhKTsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBib2R5LmFkZFNoYXBlKGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpKTsKICAgIH0KCiAgICBib2R5LnBvc2l0aW9uLnNldChwb3NpdGlvblswXSwgcG9zaXRpb25bMV0sIHBvc2l0aW9uWzJdKTsKICAgIGJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIocm90YXRpb25bMF0sIHJvdGF0aW9uWzFdLCByb3RhdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1dWlkLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IGJvZHkgPSBwcm9wc1RvQm9keSh7CiAgICAgICAgY3JlYXRlTWF0ZXJpYWwsCiAgICAgICAgcHJvcHM6IHByb3BzW2ldLAogICAgICAgIHR5cGUsCiAgICAgICAgdXVpZDogdXVpZFtpXQogICAgICB9KTsKICAgICAgc3RhdGUud29ybGQuYWRkQm9keShib2R5KTsKICAgICAgaWYgKHByb3BzW2ldLm9uQ29sbGlkZSkgYm9keS5hZGRFdmVudExpc3RlbmVyKCdjb2xsaWRlJywgX3JlZjIgPT4gewogICAgICAgIGxldCB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgYm9keSwKICAgICAgICAgIHRhcmdldCwKICAgICAgICAgIGNvbnRhY3QKICAgICAgICB9ID0gX3JlZjI7CiAgICAgICAgaWYgKCFib2R5LnV1aWQgfHwgIXRhcmdldC51dWlkKSByZXR1cm47CiAgICAgICAgY29uc3QgewogICAgICAgICAgbmksCiAgICAgICAgICByaSwKICAgICAgICAgIHJqLAogICAgICAgICAgYmksCiAgICAgICAgICBiaiwKICAgICAgICAgIGlkCiAgICAgICAgfSA9IGNvbnRhY3Q7CiAgICAgICAgY29uc3QgY29udGFjdFBvaW50ID0gYmkucG9zaXRpb24udmFkZChyaSk7CiAgICAgICAgY29uc3QgY29udGFjdE5vcm1hbCA9IGJpID09PSBib2R5ID8gbmkgOiBuaS5zY2FsZSgtMSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBib2R5OiBib2R5LnV1aWQsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJzOiB7CiAgICAgICAgICAgIGJvZHlGaWx0ZXJHcm91cDogYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgYm9keUZpbHRlck1hc2s6IGJvZHkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyR3JvdXA6IHRhcmdldC5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyTWFzazogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlck1hc2sKICAgICAgICAgIH0sCiAgICAgICAgICBjb250YWN0OiB7CiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogdXNlIGlkIGluc3RlYWQgb2YgdXVpZAogICAgICAgICAgICBiaTogYmkudXVpZCwKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJqOiBiai51dWlkLAogICAgICAgICAgICAvLyBOb3JtYWwgb2YgdGhlIGNvbnRhY3QsIHJlbGF0aXZlIHRvIHRoZSBjb2xsaWRpbmcgYm9keQogICAgICAgICAgICBjb250YWN0Tm9ybWFsOiBjb250YWN0Tm9ybWFsLnRvQXJyYXkoKSwKICAgICAgICAgICAgLy8gV29ybGQgcG9zaXRpb24gb2YgdGhlIGNvbnRhY3QKICAgICAgICAgICAgY29udGFjdFBvaW50OiBjb250YWN0UG9pbnQudG9BcnJheSgpLAogICAgICAgICAgICBpZCwKICAgICAgICAgICAgaW1wYWN0VmVsb2NpdHk6IGNvbnRhY3QuZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpLAogICAgICAgICAgICBuaTogbmkudG9BcnJheSgpLAogICAgICAgICAgICByaTogcmkudG9BcnJheSgpLAogICAgICAgICAgICByajogcmoudG9BcnJheSgpCiAgICAgICAgICB9LAogICAgICAgICAgb3A6ICdldmVudCcsCiAgICAgICAgICB0YXJnZXQ6IHRhcmdldC51dWlkLAogICAgICAgICAgdHlwZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9OwoKICBjb25zdCB0cmlwbGV0VG9WZWMzID0gdCA9PiB0ID8gbmV3IFZlYzMoLi4udCkgOiB1bmRlZmluZWQ7CgogIGNvbnN0IGFkZENvbnN0cmFpbnQgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgYW5nbGUsCiAgICAgICAgYXhpc0EsCiAgICAgICAgYXhpc0IsCiAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICBkaXN0YW5jZSwKICAgICAgICBtYXhGb3JjZSwKICAgICAgICBtYXhNdWx0aXBsaWVyLAogICAgICAgIHBpdm90QSwKICAgICAgICBwaXZvdEIsCiAgICAgICAgdHdpc3RBbmdsZSwKICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgfV0sCiAgICAgIHR5cGUsCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgbGV0IGNvbnN0cmFpbnQ7CgogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgJ1BvaW50VG9Qb2ludCc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgdHJpcGxldFRvVmVjMyhwaXZvdEIpLCBtYXhGb3JjZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdIaW5nZSc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBIaW5nZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgYXhpc0E6IHRyaXBsZXRUb1ZlYzMoYXhpc0EpLAogICAgICAgICAgYXhpc0I6IHRyaXBsZXRUb1ZlYzMoYXhpc0IpLAogICAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICAgIG1heEZvcmNlLAogICAgICAgICAgcGl2b3RBOiB0cmlwbGV0VG9WZWMzKHBpdm90QSksCiAgICAgICAgICBwaXZvdEI6IHRyaXBsZXRUb1ZlYzMocGl2b3RCKQogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnRGlzdGFuY2UnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgRGlzdGFuY2VDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIGRpc3RhbmNlLCBtYXhGb3JjZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgd2FrZVVwQm9kaWVzCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICB9CgogICAgY29uc3RyYWludC51dWlkID0gdXVpZDsKICAgIHN0YXRlLndvcmxkLmFkZENvbnN0cmFpbnQoY29uc3RyYWludCk7CgogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwoKICAgICAgICBpZiAobXVsdGlwbGllciA+IG1heE11bHRpcGxpZXIpIHsKICAgICAgICAgIGNvbnN0cmFpbnQuZGlzYWJsZSgpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHN0YXRlLmNvbnN0cmFpbnRzW3V1aWRdID0gcG9zdFN0ZXBDb25zdHJhaW50OwogICAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLmNvbnN0cmFpbnRzW3V1aWRdKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiB0b1VwcGVyY2FzZShzdHIpIHsKICAgIHJldHVybiBzdHIudG9VcHBlckNhc2UoKTsKICB9CgogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwoKICAgIHN0YXRlLnJheXNbdXVpZF0gPSAoKSA9PiB7CiAgICAgIHJheS5pbnRlcnNlY3RXb3JsZChzdGF0ZS53b3JsZCwgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy5yZXN1bHQgfHwgIW9wdGlvbnMucmVzdWx0LmJvZHkpIHJldHVybjsKICAgICAgY29uc3QgewogICAgICAgIGJvZHksCiAgICAgICAgc2hhcGUsCiAgICAgICAgcmF5RnJvbVdvcmxkLAogICAgICAgIHJheVRvV29ybGQsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQsCiAgICAgICAgaGl0UG9pbnRXb3JsZCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSBvcHRpb25zLnJlc3VsdDsKICAgICAgY29uc3QgYm9keVVVSUQgPSBib2R5LnV1aWQ7CiAgICAgIGlmICghYm9keVVVSUQpIHJldHVybjsKICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgYm9keTogYm9keVVVSUQsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQ6IGhpdE5vcm1hbFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBoaXRQb2ludFdvcmxkOiBoaXRQb2ludFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICByYXk6IHsKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlckdyb3VwOiByYXkuY29sbGlzaW9uRmlsdGVyR3JvdXAsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJNYXNrOiByYXkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgIGRpcmVjdGlvbjogcmF5LmRpcmVjdGlvbi50b0FycmF5KCksCiAgICAgICAgICBmcm9tLAogICAgICAgICAgdG8sCiAgICAgICAgICB1dWlkCiAgICAgICAgfSwKICAgICAgICByYXlGcm9tV29ybGQ6IHJheUZyb21Xb3JsZC50b0FycmF5KCksCiAgICAgICAgcmF5VG9Xb3JsZDogcmF5VG9Xb3JsZC50b0FycmF5KCksCiAgICAgICAgc2hhcGU6IHNoYXBlID8geyAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnJheXNbdXVpZF0pOwogIH07CgogIGNvbnN0IGFkZFJheWNhc3RWZWhpY2xlID0gKHN0YXRlLCBkYXRhKSA9PiB7CiAgICBjb25zdCBbY2hhc3Npc0JvZHksIHdoZWVscywgd2hlZWxJbmZvcywgaW5kZXhGb3J3YXJkQXhpcywgaW5kZXhSaWdodEF4aXMsIGluZGV4VXBBeGlzXSA9IGRhdGEucHJvcHM7CiAgICBjb25zdCB2ZWhpY2xlID0gbmV3IFJheWNhc3RWZWhpY2xlKHsKICAgICAgY2hhc3Npc0JvZHk6IHN0YXRlLmJvZGllc1tjaGFzc2lzQm9keV0sCiAgICAgIGluZGV4Rm9yd2FyZEF4aXMsCiAgICAgIGluZGV4UmlnaHRBeGlzLAogICAgICBpbmRleFVwQXhpcwogICAgfSk7CiAgICB2ZWhpY2xlLndvcmxkID0gc3RhdGUud29ybGQ7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBheGxlTG9jYWwsCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLAogICAgICAgIGRpcmVjdGlvbkxvY2FsLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IHdoZWVsSW5mb3NbaV07CiAgICAgIHZlaGljbGUuYWRkV2hlZWwoewogICAgICAgIGF4bGVMb2NhbDogdHJpcGxldFRvVmVjMyhheGxlTG9jYWwpLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogdHJpcGxldFRvVmVjMyhjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwpLAogICAgICAgIGRpcmVjdGlvbkxvY2FsOiB0cmlwbGV0VG9WZWMzKGRpcmVjdGlvbkxvY2FsKSwKICAgICAgICAuLi5yZXN0CiAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwoKICAgIGNvbnN0IHBvc3RTdGVwID0gKCkgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZlaGljbGUud2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZlaGljbGUudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgICAgY29uc3QgdCA9IHZlaGljbGUud2hlZWxJbmZvc1tpXS53b3JsZFRyYW5zZm9ybTsKICAgICAgICBjb25zdCB3aGVlbEJvZHkgPSBzdGF0ZS5ib2RpZXNbd2hlZWxzW2ldXTsKICAgICAgICB3aGVlbEJvZHkucG9zaXRpb24uY29weSh0LnBvc2l0aW9uKTsKICAgICAgICB3aGVlbEJvZHkucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbik7CiAgICAgIH0KICAgIH07CgogICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXSA9IHsKICAgICAgcG9zdFN0ZXAsCiAgICAgIHByZVN0ZXAsCiAgICAgIHZlaGljbGUKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgcHJlU3RlcCk7CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHBvc3RTdGVwKTsKICB9OwoKICBjb25zdCBhZGRTcHJpbmcgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgZGFtcGluZywKICAgICAgICBsb2NhbEFuY2hvckEsCiAgICAgICAgbG9jYWxBbmNob3JCLAogICAgICAgIHJlc3RMZW5ndGgsCiAgICAgICAgc3RpZmZuZXNzLAogICAgICAgIHdvcmxkQW5jaG9yQSwKICAgICAgICB3b3JsZEFuY2hvckIKICAgICAgfV0sCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgIGRhbXBpbmcsCiAgICAgIGxvY2FsQW5jaG9yQTogdHJpcGxldFRvVmVjMyhsb2NhbEFuY2hvckEpLAogICAgICBsb2NhbEFuY2hvckI6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JCKSwKICAgICAgcmVzdExlbmd0aCwKICAgICAgc3RpZmZuZXNzLAogICAgICB3b3JsZEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMod29ybGRBbmNob3JBKSwKICAgICAgd29ybGRBbmNob3JCOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQikKICAgIH0pOwogICAgc3ByaW5nLnV1aWQgPSB1dWlkOwoKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKCiAgICBzdGF0ZS5zcHJpbmdzW3V1aWRdID0gcG9zdFN0ZXBTcHJpbmc7CiAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbdXVpZF0gPSBzcHJpbmc7IC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAoKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBlbWl0RW5kQ29udGFjdChfcmVmMikgewogICAgbGV0IHsKICAgICAgYm9keUEsCiAgICAgIGJvZHlCCiAgICB9ID0gX3JlZjI7CiAgICBpZiAoIShib2R5QSAhPSBudWxsICYmIGJvZHlBLnV1aWQpIHx8ICEoYm9keUIgIT0gbnVsbCAmJiBib2R5Qi51dWlkKSkgcmV0dXJuOwogICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIGJvZHlBOiBib2R5QS51dWlkLAogICAgICBib2R5QjogYm9keUIudXVpZCwKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlRW5kJwogICAgfSk7CiAgfQoKICBjb25zdCBpbml0ID0gKHdvcmxkLCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgYWxsb3dTbGVlcCwKICAgICAgYXhpc0luZGV4ID0gMCwKICAgICAgYnJvYWRwaGFzZSwKICAgICAgZGVmYXVsdENvbnRhY3RNYXRlcmlhbCwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLnF1YXROb3JtYWxpemVGYXN0ID0gcXVhdE5vcm1hbGl6ZUZhc3Q7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplU2tpcCA9IHF1YXROb3JtYWxpemVTa2lwOwoKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KCiAgICBpZiAod29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgd29ybGQuc29sdmVyLnRvbGVyYW5jZSA9IHRvbGVyYW5jZTsKICAgICAgd29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBpdGVyYXRpb25zOwogICAgfQoKICAgIHdvcmxkLmJyb2FkcGhhc2UgPSBicm9hZHBoYXNlID09PSAnU0FQJyA/IG5ldyBTQVBCcm9hZHBoYXNlKHdvcmxkKSA6IG5ldyBOYWl2ZUJyb2FkcGhhc2UoKTsKCiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CgogICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYmVnaW5Db250YWN0JywgZW1pdEJlZ2luQ29udGFjdCk7CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdlbmRDb250YWN0JywgZW1pdEVuZENvbnRhY3QpOwogICAgT2JqZWN0LmFzc2lnbih3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsLCBkZWZhdWx0Q29udGFjdE1hdGVyaWFsKTsKICB9OwoKICBjb25zdCBpc1FvclYgPSB2ID0+IHYgaW5zdGFuY2VvZiBRdWF0ZXJuaW9uIHx8IHYgaW5zdGFuY2VvZiBWZWMzOwoKICBjb25zdCBzdGVwID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwb3NpdGlvbnMsCiAgICAgIHByb3BzOiB7CiAgICAgICAgbWF4U3ViU3RlcHMsCiAgICAgICAgc3RlcFNpemUsCiAgICAgICAgdGltZVNpbmNlTGFzdENhbGxlZAogICAgICB9LAogICAgICBxdWF0ZXJuaW9ucwogICAgfSA9IF9yZWY7CiAgICBzdGF0ZS53b3JsZC5zdGVwKHN0ZXBTaXplLCB0aW1lU2luY2VMYXN0Q2FsbGVkLCBtYXhTdWJTdGVwcyk7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQoKICAgIGNvbnN0IG9ic2VydmF0aW9ucyA9IFtdOwoKICAgIGZvciAoY29uc3QgaWQgb2YgT2JqZWN0LmtleXMoc3RhdGUuc3Vic2NyaXB0aW9ucykpIHsKICAgICAgY29uc3QgW3V1aWQsIHR5cGUsIHRhcmdldCA9ICdib2RpZXMnXSA9IHN0YXRlLnN1YnNjcmlwdGlvbnNbaWRdOwogICAgICBjb25zdCB7CiAgICAgICAgYm9kaWVzLAogICAgICAgIHZlaGljbGVzCiAgICAgIH0gPSBzdGF0ZTsKICAgICAgY29uc3QgdmFsdWUgPSB0YXJnZXQgPT09ICd2ZWhpY2xlcycgPyAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICB2ZWhpY2xlc1t1dWlkXS52ZWhpY2xlW3R5cGVdIDogLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgYm9kaWVzW3V1aWRdW3R5cGVdOwogICAgICBjb25zdCBzZXJpYWxpemFibGVWYWx1ZSA9IGlzUW9yVih2YWx1ZSkgPyB2YWx1ZS50b0FycmF5KCkgOiB2YWx1ZTsKICAgICAgb2JzZXJ2YXRpb25zLnB1c2goW051bWJlcihpZCksIHNlcmlhbGl6YWJsZVZhbHVlLCAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICB0eXBlXSk7CiAgICB9CgogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CgogICAgaWYgKHN0YXRlLmJvZGllc05lZWRTeW5jaW5nKSB7CiAgICAgIG1lc3NhZ2UuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiB7CiAgICAgICAgaWYgKGJvZHkudXVpZCkgYm9kaWVzLnB1c2goYm9keS51dWlkKTsKICAgICAgICByZXR1cm4gYm9kaWVzOwogICAgICB9LCBbXSk7CiAgICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gZmFsc2U7CiAgICB9CgogICAgc2VsZi5wb3N0TWVzc2FnZShtZXNzYWdlLCBbcG9zaXRpb25zLmJ1ZmZlciwgcXVhdGVybmlvbnMuYnVmZmVyXSk7CiAgfTsKCiAgY29uc3Qgc3RhdGUgPSB7CiAgICBib2RpZXM6IHt9LAogICAgYm9kaWVzTmVlZFN5bmNpbmc6IGZhbHNlLAogICAgY29uc3RyYWludHM6IHt9LAogICAgbWF0ZXJpYWxzOiB7fSwKICAgIHJheXM6IHt9LAogICAgc3ByaW5nSW5zdGFuY2VzOiB7fSwKICAgIHNwcmluZ3M6IHt9LAogICAgc3Vic2NyaXB0aW9uczoge30sCiAgICB2ZWhpY2xlczoge30sCiAgICB3b3JsZDogbmV3IFdvcmxkKCkKICB9OwoKICAvLy8gPHJlZmVyZW5jZSBuby1kZWZhdWx0LWxpYj0idHJ1ZSIvPgoKICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKCiAgZnVuY3Rpb24gc3luY0JvZGllcygpIHsKICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gdHJ1ZTsKICAgIHN0YXRlLmJvZGllcyA9IHN0YXRlLndvcmxkLmJvZGllcy5yZWR1Y2UoKGJvZGllcywgYm9keSkgPT4gYm9keS51dWlkID8geyAuLi5ib2RpZXMsCiAgICAgIFtib2R5LnV1aWRdOiBib2R5CiAgICB9IDogYm9kaWVzLCB7fSk7CiAgfQoKICBjb25zdCBicm9hZHBoYXNlcyA9IHsKICAgIE5haXZlQnJvYWRwaGFzZSwKICAgIFNBUEJyb2FkcGhhc2UKICB9OwogIGNvbnN0IGNyZWF0ZU1hdGVyaWFsID0gY3JlYXRlTWF0ZXJpYWxGYWN0b3J5KHN0YXRlLm1hdGVyaWFscyk7CgogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKCiAgICBzd2l0Y2ggKGRhdGEub3ApIHsKICAgICAgY2FzZSAnaW5pdCc6CiAgICAgICAgewogICAgICAgICAgaW5pdChzdGF0ZS53b3JsZCwgZGF0YS5wcm9wcyk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzdGVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGVwKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVCb2RpZXMnOgogICAgICAgIHsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS51dWlkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUJvZHkoc3RhdGUuYm9kaWVzW2RhdGEudXVpZFtpXV0pOwogICAgICAgICAgfQoKICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3N1YnNjcmliZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBpZCwKICAgICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgICB0eXBlCiAgICAgICAgICB9ID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnN1YnNjcmlwdGlvbnNbaWRdID0gW2RhdGEudXVpZCwgdHlwZSwgdGFyZ2V0XTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFBvc2l0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5wb3NpdGlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRRdWF0ZXJuaW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdLCBkYXRhLnByb3BzWzNdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS52ZWxvY2l0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyVmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJWZWxvY2l0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyRmFjdG9yJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyRmFjdG9yLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldE1hc3MnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLm1hc3MgPSBkYXRhLnByb3BzOwogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TGluZWFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubGluZWFyRGFtcGluZyA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYW5ndWxhckRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRTbGVlcFNwZWVkTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwU3BlZWRMaW1pdCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRTbGVlcFRpbWVMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBUaW1lTGltaXQgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbGxpc2lvbkZpbHRlck1hc2snOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlck1hc2sgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uUmVzcG9uc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvblJlc3BvbnNlID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0R3Jhdml0eSc6CiAgICAgICAgc3RhdGUud29ybGQuZ3Jhdml0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRUb2xlcmFuY2UnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyLnRvbGVyYW5jZSA9IGRhdGEucHJvcHM7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEl0ZXJhdGlvbnMnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEF4aXNJbmRleCc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLmJyb2FkcGhhc2UgaW5zdGFuY2VvZiBTQVBCcm9hZHBoYXNlKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlLmF4aXNJbmRleCA9IGRhdGEucHJvcHMgPT09IHVuZGVmaW5lZCB8fCBkYXRhLnByb3BzID09PSBudWxsID8gMCA6IGRhdGEucHJvcHM7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5SW1wdWxzZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUxvY2FsRm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxGb3JjZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseVRvcnF1ZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlUb3JxdWUobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYWRkQ29uc3RyYWludCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29uc3RyYWludChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKCiAgICAgICAgaWYgKHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF0pIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSk7CiAgICAgICAgICBkZWxldGUgc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZGlzYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5tYXAoYyA9PiBjLmRpc2FibGUoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdlbmFibGVDb25zdHJhaW50TW90b3InOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuZW5hYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3RvclNwZWVkJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yU3BlZWQoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yTWF4Rm9yY2UnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JNYXhGb3JjZShkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdTdGlmZm5lc3MnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLnN0aWZmbmVzcyA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdSZXN0TGVuZ3RoJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5yZXN0TGVuZ3RoID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnNwcmluZ3NbZGF0YS51dWlkXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRSYXknOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheShzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FkZFJheWNhc3RWZWhpY2xlJzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXljYXN0VmVoaWNsZShzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVSYXljYXN0VmVoaWNsZSc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0ucHJlU3RlcCk7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0ucG9zdFN0ZXApOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLndvcmxkID0gbnVsbDsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVTdGVlcmluZ1ZhbHVlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbdmFsdWUsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FwcGx5UmF5Y2FzdFZlaGljbGVFbmdpbmVGb3JjZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW3ZhbHVlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRDb250YWN0TWF0ZXJpYWwnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnRhY3RNYXRlcmlhbChzdGF0ZS53b3JsZCwgY3JlYXRlTWF0ZXJpYWwsIGRhdGEucHJvcHMsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVDb250YWN0TWF0ZXJpYWwnOgogICAgICAgIHsKICAgICAgICAgIHJlbW92ZUNvbnRhY3RNYXRlcmlhbChzdGF0ZS53b3JsZCwgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzbGVlcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXAoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICB9OwoKfSkoKTsKCg==",null,!1),MK=function(e){Li(n,e);var t=Di(n);function n(e){var i;di(this,n);var r=e.allowSleep,a=void 0!==r&&r,o=e.axisIndex,s=void 0===o?0:o,g=e.broadphase,l=void 0===g?"Naive":g,u=e.defaultContactMaterial,c=void 0===u?{contactEquationStiffness:1e6}:u,I=e.gravity,C=void 0===I?[0,-9.81,0]:I,d=e.iterations,h=void 0===d?5:d,A=e.quatNormalizeFast,p=void 0!==A&&A,m=e.quatNormalizeSkip,f=void 0===m?0:m,v=e.size,b=void 0===v?1e3:v,y=e.solver,G=void 0===y?"GS":y,B=e.tolerance,Z=void 0===B?.001:B;return(i=t.call(this)).messageQueue=[],i.worker=null,i.config={allowSleep:a,axisIndex:s,broadphase:l,defaultContactMaterial:c,gravity:C,iterations:h,quatNormalizeFast:p,quatNormalizeSkip:f,size:b,solver:G,tolerance:Z},i.buffers={positions:new Float32Array(3*b),quaternions:new Float32Array(4*b)},i}return Ai(n,[{key:"axisIndex",get:function(){return this.config.axisIndex},set:function(e){this.config.axisIndex=e,this.postMessage({op:"setAxisIndex",props:e})}},{key:"broadphase",get:function(){return this.config.broadphase},set:function(e){this.config.broadphase=e,this.postMessage({op:"setBroadphase",props:e})}},{key:"gravity",get:function(){return this.config.gravity},set:function(e){this.config.gravity=e,this.postMessage({op:"setGravity",props:e})}},{key:"iterations",get:function(){return this.config.iterations},set:function(e){this.config.iterations=e,this.postMessage({op:"setIterations",props:e})}},{key:"tolerance",get:function(){return this.config.tolerance},set:function(e){this.config.tolerance=e,this.postMessage({op:"setTolerance",props:e})}},{key:"addBodies",value:function(e){var t=e.props,n=e.type,i=e.uuid;this.postMessage({op:"addBodies",props:t,type:n,uuid:i})}},{key:"addConstraint",value:function(e){var t=Ir(e.props,3),n=t[0],i=t[1],r=t[2],a=e.type,o=e.uuid;this.postMessage({op:"addConstraint",props:[n,i,r],type:a,uuid:o})}},{key:"addContactMaterial",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"addContactMaterial",props:t,uuid:n})}},{key:"addRay",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"addRay",props:t,uuid:n})}},{key:"addRaycastVehicle",value:function(e){var t=Ir(e.props,6),n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],g=e.uuid;this.postMessage({op:"addRaycastVehicle",props:[n,i,r,a,o,s],uuid:g})}},{key:"addSpring",value:function(e){var t=Ir(e.props,3),n=t[0],i=t[1],r=t[2],a=e.uuid;this.postMessage({op:"addSpring",props:[n,i,r],uuid:a})}},{key:"applyForce",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"applyForce",props:t,uuid:n})}},{key:"applyImpulse",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"applyImpulse",props:t,uuid:n})}},{key:"applyLocalForce",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"applyLocalForce",props:t,uuid:n})}},{key:"applyLocalImpulse",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"applyLocalImpulse",props:t,uuid:n})}},{key:"applyRaycastVehicleEngineForce",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"applyRaycastVehicleEngineForce",props:t,uuid:n})}},{key:"applyTorque",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"applyTorque",props:t,uuid:n})}},{key:"connect",value:function(){var e=this;this.worker=new FK,this.worker.onmessage=function(t){if("frame"===t.data.op)return e.buffers.positions=t.data.positions,e.buffers.quaternions=t.data.quaternions,void e.emit(t.data.op,t.data);e.emit(t.data.type,t.data)};var t,n=Cr(this.messageQueue);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.worker.postMessage(i)}}catch(r){n.e(r)}finally{n.f()}this.messageQueue.length=0}},{key:"disableConstraint",value:function(e){var t=e.uuid;this.postMessage({op:"disableConstraint",uuid:t})}},{key:"disableConstraintMotor",value:function(e){var t=e.uuid;this.postMessage({op:"disableConstraintMotor",uuid:t})}},{key:"disconnect",value:function(){this.worker&&(this.worker.onmessage=null)}},{key:"enableConstraint",value:function(e){var t=e.uuid;this.postMessage({op:"enableConstraint",uuid:t})}},{key:"enableConstraintMotor",value:function(e){var t=e.uuid;this.postMessage({op:"enableConstraintMotor",uuid:t})}},{key:"init",value:function(){var e=this.config,t=e.allowSleep,n=e.axisIndex,i=e.broadphase,r=e.defaultContactMaterial,a=e.gravity,o=e.iterations,s=e.quatNormalizeFast,g=e.quatNormalizeSkip,l=e.solver,u=e.tolerance;this.postMessage({op:"init",props:{allowSleep:t,axisIndex:n,broadphase:i,defaultContactMaterial:r,gravity:a,iterations:o,quatNormalizeFast:s,quatNormalizeSkip:g,solver:l,tolerance:u}})}},{key:"removeBodies",value:function(e){var t=e.uuid;this.postMessage({op:"removeBodies",uuid:t})}},{key:"removeConstraint",value:function(e){var t=e.uuid;this.postMessage({op:"removeConstraint",uuid:t})}},{key:"removeContactMaterial",value:function(e){var t=e.uuid;this.postMessage({op:"removeContactMaterial",uuid:t})}},{key:"removeRay",value:function(e){var t=e.uuid;this.postMessage({op:"removeRay",uuid:t})}},{key:"removeRaycastVehicle",value:function(e){var t=e.uuid;this.postMessage({op:"removeRaycastVehicle",uuid:t})}},{key:"removeSpring",value:function(e){var t=e.uuid;this.postMessage({op:"removeSpring",uuid:t})}},{key:"setAllowSleep",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setAllowSleep",props:t,uuid:n})}},{key:"setAngularDamping",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setAngularDamping",props:t,uuid:n})}},{key:"setAngularFactor",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setAngularFactor",props:t,uuid:n})}},{key:"setAngularVelocity",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setAngularVelocity",props:t,uuid:n})}},{key:"setCollisionFilterGroup",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setCollisionFilterGroup",props:t,uuid:n})}},{key:"setCollisionFilterMask",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setCollisionFilterMask",props:t,uuid:n})}},{key:"setCollisionResponse",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setCollisionResponse",props:t,uuid:n})}},{key:"setConstraintMotorMaxForce",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setConstraintMotorMaxForce",props:t,uuid:n})}},{key:"setConstraintMotorSpeed",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setConstraintMotorSpeed",props:t,uuid:n})}},{key:"setFixedRotation",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setFixedRotation",props:t,uuid:n})}},{key:"setIsTrigger",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setIsTrigger",props:t,uuid:n})}},{key:"setLinearDamping",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setLinearDamping",props:t,uuid:n})}},{key:"setLinearFactor",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setLinearFactor",props:t,uuid:n})}},{key:"setMass",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setMass",props:t,uuid:n})}},{key:"setMaterial",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setMaterial",props:t,uuid:n})}},{key:"setPosition",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setPosition",props:t,uuid:n})}},{key:"setQuaternion",value:function(e){var t=Ir(e.props,4),n=t[0],i=t[1],r=t[2],a=t[3],o=e.uuid;this.postMessage({op:"setQuaternion",props:[n,i,r,a],uuid:o})}},{key:"setRaycastVehicleBrake",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setRaycastVehicleBrake",props:t,uuid:n})}},{key:"setRaycastVehicleSteeringValue",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setRaycastVehicleSteeringValue",props:t,uuid:n})}},{key:"setRotation",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setRotation",props:t,uuid:n})}},{key:"setSleepSpeedLimit",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setSleepSpeedLimit",props:t,uuid:n})}},{key:"setSleepTimeLimit",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setSleepTimeLimit",props:t,uuid:n})}},{key:"setSpringDamping",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setSpringDamping",props:t,uuid:n})}},{key:"setSpringRestLength",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setSpringRestLength",props:t,uuid:n})}},{key:"setSpringStiffness",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setSpringStiffness",props:t,uuid:n})}},{key:"setUserData",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setUserData",props:t,uuid:n})}},{key:"setVelocity",value:function(e){var t=e.props,n=e.uuid;this.postMessage({op:"setVelocity",props:t,uuid:n})}},{key:"sleep",value:function(e){var t=e.uuid;this.postMessage({op:"sleep",uuid:t})}},{key:"step",value:function(e){var t,n=this.buffers,i=n.positions,r=n.quaternions;(i.byteLength||r.byteLength)&&(null==(t=this.worker)||t.postMessage({op:"step",positions:i,props:e,quaternions:r},[i.buffer,r.buffer]))}},{key:"subscribe",value:function(e){var t=e.props,n=t.id,i=t.target,r=t.type,a=e.uuid;this.postMessage({op:"subscribe",props:{id:n,target:i,type:r},uuid:a})}},{key:"terminate",value:function(){var e;null==(e=this.worker)||e.terminate(),this.worker=null}},{key:"unsubscribe",value:function(e){var t=e.props;this.postMessage({op:"unsubscribe",props:t})}},{key:"wakeUp",value:function(e){var t=e.uuid;this.postMessage({op:"wakeUp",uuid:t})}},{key:"postMessage",value:function(e){if(this.worker)return this.worker.postMessage(e);this.messageQueue.push(e)}}]),n}(YK),KK=function(){function e(t){di(this,e),void 0===t&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}return Ai(e,[{key:"identity",value:function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}},{key:"setZero",value:function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}},{key:"setTrace",value:function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}},{key:"getTrace",value:function(e){void 0===e&&(e=new zK);var t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}},{key:"vmult",value:function(e,t){void 0===t&&(t=new zK);var n=this.elements,i=e.x,r=e.y,a=e.z;return t.x=n[0]*i+n[1]*r+n[2]*a,t.y=n[3]*i+n[4]*r+n[5]*a,t.z=n[6]*i+n[7]*r+n[8]*a,t}},{key:"smult",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e}},{key:"mmult",value:function(t,n){void 0===n&&(n=new e);var i=this.elements,r=t.elements,a=n.elements,o=i[0],s=i[1],g=i[2],l=i[3],u=i[4],c=i[5],I=i[6],C=i[7],d=i[8],h=r[0],A=r[1],p=r[2],m=r[3],f=r[4],v=r[5],b=r[6],y=r[7],G=r[8];return a[0]=o*h+s*m+g*b,a[1]=o*A+s*f+g*y,a[2]=o*p+s*v+g*G,a[3]=l*h+u*m+c*b,a[4]=l*A+u*f+c*y,a[5]=l*p+u*v+c*G,a[6]=I*h+C*m+d*b,a[7]=I*A+C*f+d*y,a[8]=I*p+C*v+d*G,n}},{key:"scale",value:function(t,n){void 0===n&&(n=new e);for(var i=this.elements,r=n.elements,a=0;3!==a;a++)r[3*a+0]=t.x*i[3*a+0],r[3*a+1]=t.y*i[3*a+1],r[3*a+2]=t.z*i[3*a+2];return n}},{key:"solve",value:function(e,t){void 0===t&&(t=new zK);var n,i,r=[];for(n=0;n<12;n++)r.push(0);for(n=0;n<3;n++)for(i=0;i<3;i++)r[n+4*i]=this.elements[n+3*i];r[3]=e.x,r[7]=e.y,r[11]=e.z;var a,o,s=3,g=s;do{if(0===r[(n=g-s)+4*n])for(i=n+1;i<g;i++)if(0!==r[n+4*i]){a=4;do{r[(o=4-a)+4*n]+=r[o+4*i]}while(--a);break}if(0!==r[n+4*n])for(i=n+1;i<g;i++){var l=r[n+4*i]/r[n+4*n];a=4;do{r[(o=4-a)+4*i]=o<=n?0:r[o+4*i]-r[o+4*n]*l}while(--a)}}while(--s);if(t.z=r[11]/r[10],t.y=(r[7]-r[6]*t.z)/r[5],t.x=(r[3]-r[2]*t.z-r[1]*t.y)/r[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=[".concat(t.toString(),"], b=[").concat(e.toString(),"], A=[").concat(this.toString(),"]");return t}},{key:"e",value:function(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}},{key:"copy",value:function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}},{key:"toString",value:function(){for(var e="",t=0;t<9;t++)e+=this.elements[t]+",";return e}},{key:"reverse",value:function(t){void 0===t&&(t=new e);var n,i,r=NK;for(n=0;n<3;n++)for(i=0;i<3;i++)r[n+6*i]=this.elements[n+3*i];r[3]=1,r[9]=0,r[15]=0,r[4]=0,r[10]=1,r[16]=0,r[5]=0,r[11]=0,r[17]=1;var a,o,s=3,g=s;do{if(0===r[(n=g-s)+6*n])for(i=n+1;i<g;i++)if(0!==r[n+6*i]){a=6;do{r[(o=6-a)+6*n]+=r[o+6*i]}while(--a);break}if(0!==r[n+6*n])for(i=n+1;i<g;i++){var l=r[n+6*i]/r[n+6*n];a=6;do{r[(o=6-a)+6*i]=o<=n?0:r[o+6*i]-r[o+6*n]*l}while(--a)}}while(--s);n=2;do{i=n-1;do{var u=r[n+6*i]/r[n+6*n];a=6;do{r[(o=6-a)+6*i]=r[o+6*i]-r[o+6*n]*u}while(--a)}while(i--)}while(--n);n=2;do{var c=1/r[n+6*n];a=6;do{r[(o=6-a)+6*n]=r[o+6*n]*c}while(--a)}while(n--);n=2;do{i=2;do{if(o=r[3+i+6*n],isNaN(o)||o===1/0)throw"Could not reverse! A=[".concat(this.toString(),"]");t.e(n,i,o)}while(i--)}while(n--);return t}},{key:"setRotationFromQuaternion",value:function(e){var t=e.x,n=e.y,i=e.z,r=e.w,a=t+t,o=n+n,s=i+i,g=t*a,l=t*o,u=t*s,c=n*o,I=n*s,C=i*s,d=r*a,h=r*o,A=r*s,p=this.elements;return p[0]=1-(c+C),p[1]=l-A,p[2]=u+h,p[3]=l+A,p[4]=1-(g+C),p[5]=I-d,p[6]=u-h,p[7]=I+d,p[8]=1-(g+c),this}},{key:"transpose",value:function(t){void 0===t&&(t=new e);var n,i=this.elements,r=t.elements;return r[0]=i[0],r[4]=i[4],r[8]=i[8],n=i[1],r[1]=i[3],r[3]=n,n=i[2],r[2]=i[6],r[6]=n,n=i[5],r[5]=i[7],r[7]=n,t}}]),e}(),NK=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],zK=function(){function e(t,n,i){di(this,e),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=n,this.z=i}return Ai(e,[{key:"cross",value:function(t,n){void 0===n&&(n=new e);var i=t.x,r=t.y,a=t.z,o=this.x,s=this.y,g=this.z;return n.x=s*a-g*r,n.y=g*i-o*a,n.z=o*r-s*i,n}},{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setZero",value:function(){this.x=this.y=this.z=0}},{key:"vadd",value:function(t,n){if(!n)return new e(this.x+t.x,this.y+t.y,this.z+t.z);n.x=t.x+this.x,n.y=t.y+this.y,n.z=t.z+this.z}},{key:"vsub",value:function(t,n){if(!n)return new e(this.x-t.x,this.y-t.y,this.z-t.z);n.x=this.x-t.x,n.y=this.y-t.y,n.z=this.z-t.z}},{key:"crossmat",value:function(){return new KK([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}},{key:"normalize",value:function(){var e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){var r=1/i;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return i}},{key:"unit",value:function(t){void 0===t&&(t=new e);var n=this.x,i=this.y,r=this.z,a=Math.sqrt(n*n+i*i+r*r);return a>0?(a=1/a,t.x=n*a,t.y=i*a,t.z=r*a):(t.x=1,t.y=0,t.z=0),t}},{key:"length",value:function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}},{key:"lengthSquared",value:function(){return this.dot(this)}},{key:"distanceTo",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z;return Math.sqrt((r-t)*(r-t)+(a-n)*(a-n)+(o-i)*(o-i))}},{key:"distanceSquared",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z;return(r-t)*(r-t)+(a-n)*(a-n)+(o-i)*(o-i)}},{key:"scale",value:function(t,n){void 0===n&&(n=new e);var i=this.x,r=this.y,a=this.z;return n.x=t*i,n.y=t*r,n.z=t*a,n}},{key:"vmul",value:function(t,n){return void 0===n&&(n=new e),n.x=t.x*this.x,n.y=t.y*this.y,n.z=t.z*this.z,n}},{key:"addScaledVector",value:function(t,n,i){return void 0===i&&(i=new e),i.x=this.x+t*n.x,i.y=this.y+t*n.y,i.z=this.z+t*n.z,i}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"isZero",value:function(){return 0===this.x&&0===this.y&&0===this.z}},{key:"negate",value:function(t){return void 0===t&&(t=new e),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}},{key:"tangents",value:function(e,t){var n=this.length();if(n>0){var i=LK,r=1/n;i.set(this.x*r,this.y*r,this.z*r);var a=_K;Math.abs(i.x)<.9?(a.set(1,0,0),i.cross(a,e)):(a.set(0,1,0),i.cross(a,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.z)}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"lerp",value:function(e,t,n){var i=this.x,r=this.y,a=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=a+(e.z-a)*t}},{key:"almostEquals",value:function(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}},{key:"almostZero",value:function(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}},{key:"isAntiparallelTo",value:function(e,t){return this.negate(TK),TK.almostEquals(e,t)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();zK.ZERO=new zK(0,0,0),zK.UNIT_X=new zK(1,0,0),zK.UNIT_Y=new zK(0,1,0),zK.UNIT_Z=new zK(0,0,1);var LK=new zK,_K=new zK,TK=new zK,EK=function(){function e(t){di(this,e),void 0===t&&(t={}),this.lowerBound=new zK,this.upperBound=new zK,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}return Ai(e,[{key:"setFromPoints",value:function(e,t,n,i){var r=this.lowerBound,a=this.upperBound,o=n;r.copy(e[0]),o&&o.vmult(r,r),a.copy(r);for(var s=1;s<e.length;s++){var g=e[s];o&&(o.vmult(g,JK),g=JK),g.x>a.x&&(a.x=g.x),g.x<r.x&&(r.x=g.x),g.y>a.y&&(a.y=g.y),g.y<r.y&&(r.y=g.y),g.z>a.z&&(a.z=g.z),g.z<r.z&&(r.z=g.z)}return t&&(t.vadd(r,r),t.vadd(a,a)),i&&(r.x-=i,r.y-=i,r.z-=i,a.x+=i,a.y+=i,a.z+=i),this}},{key:"copy",value:function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"extend",value:function(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}},{key:"overlaps",value:function(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound,a=i.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,o=i.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,s=i.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return a&&o&&s}},{key:"volume",value:function(){var e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}},{key:"contains",value:function(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return t.x<=i.x&&n.x>=r.x&&t.y<=i.y&&n.y>=r.y&&t.z<=i.z&&n.z>=r.z}},{key:"getCorners",value:function(e,t,n,i,r,a,o,s){var g=this.lowerBound,l=this.upperBound;e.copy(g),t.set(l.x,g.y,g.z),n.set(l.x,l.y,g.z),i.set(g.x,l.y,l.z),r.set(l.x,g.y,l.z),a.set(g.x,l.y,g.z),o.set(g.x,g.y,l.z),s.copy(l)}},{key:"toLocalFrame",value:function(e,t){var n=DK,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],g=n[5],l=n[6],u=n[7];this.getCorners(i,r,a,o,s,g,l,u);for(var c=0;8!==c;c++){var I=n[c];e.pointToLocal(I,I)}return t.setFromPoints(n)}},{key:"toWorldFrame",value:function(e,t){var n=DK,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],g=n[5],l=n[6],u=n[7];this.getCorners(i,r,a,o,s,g,l,u);for(var c=0;8!==c;c++){var I=n[c];e.pointToWorld(I,I)}return t.setFromPoints(n)}},{key:"overlapsRay",value:function(e){var t=e.direction,n=e.from,i=1/t.x,r=1/t.y,a=1/t.z,o=(this.lowerBound.x-n.x)*i,s=(this.upperBound.x-n.x)*i,g=(this.lowerBound.y-n.y)*r,l=(this.upperBound.y-n.y)*r,u=(this.lowerBound.z-n.z)*a,c=(this.upperBound.z-n.z)*a,I=Math.max(Math.max(Math.min(o,s),Math.min(g,l)),Math.min(u,c)),C=Math.min(Math.min(Math.max(o,s),Math.max(g,l)),Math.max(u,c));return!(C<0)&&!(I>C)}}]),e}(),JK=new zK,DK=[new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK],UK=function(){function e(){di(this,e)}return Ai(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return!(void 0===n[e]||!n[e].includes(t))}},{key:"hasAnyEventListener",value:function(e){return void 0!==this._listeners&&void 0!==this._listeners[e]}},{key:"removeEventListener",value:function(e,t){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[e])return this;var i=n[e].indexOf(t);return-1!==i&&n[e].splice(i,1),this}},{key:"dispatchEvent",value:function(e){if(void 0===this._listeners)return this;var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=0,i=t.length;n<i;n++)t[n].call(this,e)}return this}}]),e}(),PK=function(){function e(t,n,i,r){di(this,e),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=t,this.y=n,this.z=i,this.w=r}return Ai(e,[{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.z,",").concat(this.w)}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"setFromAxisAngle",value:function(e,t){var n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}},{key:"toAxisAngle",value:function(e){void 0===e&&(e=new zK),this.normalize();var t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}},{key:"setFromVectors",value:function(e,t){if(e.isAntiparallelTo(t)){var n=QK,i=OK;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{var r=e.cross(t);this.x=r.x,this.y=r.y,this.z=r.z,this.w=Math.sqrt(Math.pow(e.length(),2)*Math.pow(t.length(),2))+e.dot(t),this.normalize()}return this}},{key:"mult",value:function(t,n){void 0===n&&(n=new e);var i=this.x,r=this.y,a=this.z,o=this.w,s=t.x,g=t.y,l=t.z,u=t.w;return n.x=i*u+o*s+r*l-a*g,n.y=r*u+o*g+a*s-i*l,n.z=a*u+o*l+i*g-r*s,n.w=o*u-i*s-r*g-a*l,n}},{key:"inverse",value:function(t){void 0===t&&(t=new e);var n=this.x,i=this.y,r=this.z,a=this.w;this.conjugate(t);var o=1/(n*n+i*i+r*r+a*a);return t.x*=o,t.y*=o,t.z*=o,t.w*=o,t}},{key:"conjugate",value:function(t){return void 0===t&&(t=new e),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"normalizeFast",value:function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"vmult",value:function(e,t){void 0===t&&(t=new zK);var n=e.x,i=e.y,r=e.z,a=this.x,o=this.y,s=this.z,g=this.w,l=g*n+o*r-s*i,u=g*i+s*n-a*r,c=g*r+a*i-o*n,I=-a*n-o*i-s*r;return t.x=l*g+I*-a+u*-s-c*-o,t.y=u*g+I*-o+c*-a-l*-s,t.z=c*g+I*-s+l*-o-u*-a,t}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"toEuler",value:function(e,t){var n,i,r;void 0===t&&(t="YZX");var a=this.x,o=this.y,s=this.z,g=this.w;if("YZX"!==t)throw new Error("Euler order ".concat(t," not supported yet."));var l=a*o+s*g;if(l>.499&&(n=2*Math.atan2(a,g),i=Math.PI/2,r=0),l<-.499&&(n=-2*Math.atan2(a,g),i=-Math.PI/2,r=0),void 0===n){var u=a*a,c=o*o,I=s*s;n=Math.atan2(2*o*g-2*a*s,1-2*c-2*I),i=Math.asin(2*l),r=Math.atan2(2*a*g-2*o*s,1-2*u-2*I)}e.y=n,e.z=i,e.x=r}},{key:"setFromEuler",value:function(e,t,n,i){void 0===i&&(i="XYZ");var r=Math.cos(e/2),a=Math.cos(t/2),o=Math.cos(n/2),s=Math.sin(e/2),g=Math.sin(t/2),l=Math.sin(n/2);return"XYZ"===i?(this.x=s*a*o+r*g*l,this.y=r*g*o-s*a*l,this.z=r*a*l+s*g*o,this.w=r*a*o-s*g*l):"YXZ"===i?(this.x=s*a*o+r*g*l,this.y=r*g*o-s*a*l,this.z=r*a*l-s*g*o,this.w=r*a*o+s*g*l):"ZXY"===i?(this.x=s*a*o-r*g*l,this.y=r*g*o+s*a*l,this.z=r*a*l+s*g*o,this.w=r*a*o-s*g*l):"ZYX"===i?(this.x=s*a*o-r*g*l,this.y=r*g*o+s*a*l,this.z=r*a*l-s*g*o,this.w=r*a*o+s*g*l):"YZX"===i?(this.x=s*a*o+r*g*l,this.y=r*g*o+s*a*l,this.z=r*a*l-s*g*o,this.w=r*a*o-s*g*l):"XZY"===i&&(this.x=s*a*o-r*g*l,this.y=r*g*o-s*a*l,this.z=r*a*l+s*g*o,this.w=r*a*o+s*g*l),this}},{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.w)}},{key:"slerp",value:function(t,n,i){void 0===i&&(i=new e);var r,a,o,s,g,l=this.x,u=this.y,c=this.z,I=this.w,C=t.x,d=t.y,h=t.z,A=t.w;return(a=l*C+u*d+c*h+I*A)<0&&(a=-a,C=-C,d=-d,h=-h,A=-A),1-a>1e-6?(r=Math.acos(a),o=Math.sin(r),s=Math.sin((1-n)*r)/o,g=Math.sin(n*r)/o):(s=1-n,g=n),i.x=s*l+g*C,i.y=s*u+g*d,i.z=s*c+g*h,i.w=s*I+g*A,i}},{key:"integrate",value:function(t,n,i,r){void 0===r&&(r=new e);var a=t.x*i.x,o=t.y*i.y,s=t.z*i.z,g=this.x,l=this.y,u=this.z,c=this.w,I=.5*n;return r.x+=I*(a*c+o*u-s*l),r.y+=I*(o*c+s*g-a*u),r.z+=I*(s*c+a*l-o*g),r.w+=I*(-a*g-o*l-s*u),r}}]),e}(),QK=new zK,OK=new zK,jK=function(){function e(t){di(this,e),void 0===t&&(t={}),this.id=e.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}return Ai(e,[{key:"updateBoundingSphereRadius",value:function(){throw"computeBoundingSphereRadius() not implemented for shape type ".concat(this.type)}},{key:"volume",value:function(){throw"volume() not implemented for shape type ".concat(this.type)}},{key:"calculateLocalInertia",value:function(e,t){throw"calculateLocalInertia() not implemented for shape type ".concat(this.type)}},{key:"calculateWorldAABB",value:function(e,t,n,i){throw"calculateWorldAABB() not implemented for shape type ".concat(this.type)}}]),e}();jK.idCounter=0,jK.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};var qK=function(){function e(t){di(this,e),void 0===t&&(t={}),this.position=new zK,this.quaternion=new PK,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}return Ai(e,[{key:"pointToLocal",value:function(t,n){return e.pointToLocalFrame(this.position,this.quaternion,t,n)}},{key:"pointToWorld",value:function(t,n){return e.pointToWorldFrame(this.position,this.quaternion,t,n)}},{key:"vectorToWorldFrame",value:function(e,t){return void 0===t&&(t=new zK),this.quaternion.vmult(e,t),t}}],[{key:"pointToLocalFrame",value:function(e,t,n,i){return void 0===i&&(i=new zK),n.vsub(e,i),t.conjugate($K),$K.vmult(i,i),i}},{key:"pointToWorldFrame",value:function(e,t,n,i){return void 0===i&&(i=new zK),t.vmult(n,i),i.vadd(e,i),i}},{key:"vectorToWorldFrame",value:function(e,t,n){return void 0===n&&(n=new zK),e.vmult(t,n),n}},{key:"vectorToLocalFrame",value:function(e,t,n,i){return void 0===i&&(i=new zK),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}]),e}(),$K=new PK,eN=function(e){Li(n,e);var t=Di(n);function n(e){var i;di(this,n),void 0===e&&(e={});var r=e,a=r.vertices,o=void 0===a?[]:a,s=r.faces,g=void 0===s?[]:s,l=r.normals,u=void 0===l?[]:l,c=r.axes,I=r.boundingSphereRadius;return(i=t.call(this,{type:jK.types.CONVEXPOLYHEDRON})).vertices=o,i.faces=g,i.faceNormals=u,0===i.faceNormals.length&&i.computeNormals(),I?i.boundingSphereRadius=I:i.updateBoundingSphereRadius(),i.worldVertices=[],i.worldVerticesNeedsUpdate=!0,i.worldFaceNormals=[],i.worldFaceNormalsNeedsUpdate=!0,i.uniqueAxes=c?c.slice():null,i.uniqueEdges=[],i.computeEdges(),i}return Ai(n,[{key:"computeEdges",value:function(){var e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;for(var i=new zK,r=0;r!==e.length;r++)for(var a=e[r],o=a.length,s=0;s!==o;s++){var g=(s+1)%o;t[a[s]].vsub(t[a[g]],i),i.normalize();for(var l=!1,u=0;u!==n.length;u++)if(n[u].almostEquals(i)||n[u].almostEquals(i)){l=!0;break}l||n.push(i.clone())}}},{key:"computeNormals",value:function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex ".concat(this.faces[e][t]," not found!"));var n=this.faceNormals[e]||new zK;this.getFaceNormal(e,n),n.negate(n),this.faceNormals[e]=n;var i=this.vertices[this.faces[e][0]];if(n.dot(i)<0){console.error(".faceNormals[".concat(e,"] = Vec3(").concat(n.toString(),") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."));for(var r=0;r<this.faces[e].length;r++)console.warn(".vertices[".concat(this.faces[e][r],"] = Vec3(").concat(this.vertices[this.faces[e][r]].toString(),")"))}}}},{key:"getFaceNormal",value:function(e,t){var i=this.faces[e],r=this.vertices[i[0]],a=this.vertices[i[1]],o=this.vertices[i[2]];n.computeNormal(r,a,o,t)}},{key:"clipAgainstHull",value:function(e,t,n,i,r,a,o,s,g){for(var l=new zK,u=-1,c=-Number.MAX_VALUE,I=0;I<n.faces.length;I++){l.copy(n.faceNormals[I]),r.vmult(l,l);var C=l.dot(a);C>c&&(c=C,u=I)}for(var d=[],h=0;h<n.faces[u].length;h++){var A=n.vertices[n.faces[u][h]],p=new zK;p.copy(A),r.vmult(p,p),i.vadd(p,p),d.push(p)}u>=0&&this.clipFaceAgainstHull(a,e,t,d,o,s,g)}},{key:"findSeparatingAxis",value:function(e,t,n,i,r,a,o,s){var g=new zK,l=new zK,u=new zK,c=new zK,I=new zK,C=new zK,d=Number.MAX_VALUE,h=this;if(h.uniqueAxes)for(var A=0;A!==h.uniqueAxes.length;A++){n.vmult(h.uniqueAxes[A],g);var p=h.testSepAxis(g,e,t,n,i,r);if(!1===p)return!1;p<d&&(d=p,a.copy(g))}else for(var m=o?o.length:h.faces.length,f=0;f<m;f++){var v=o?o[f]:f;g.copy(h.faceNormals[v]),n.vmult(g,g);var b=h.testSepAxis(g,e,t,n,i,r);if(!1===b)return!1;b<d&&(d=b,a.copy(g))}if(e.uniqueAxes)for(var y=0;y!==e.uniqueAxes.length;y++){r.vmult(e.uniqueAxes[y],l);var G=h.testSepAxis(l,e,t,n,i,r);if(!1===G)return!1;G<d&&(d=G,a.copy(l))}else for(var B=s?s.length:e.faces.length,Z=0;Z<B;Z++){var w=s?s[Z]:Z;l.copy(e.faceNormals[w]),r.vmult(l,l);var S=h.testSepAxis(l,e,t,n,i,r);if(!1===S)return!1;S<d&&(d=S,a.copy(l))}for(var W=0;W!==h.uniqueEdges.length;W++){n.vmult(h.uniqueEdges[W],c);for(var x=0;x!==e.uniqueEdges.length;x++)if(r.vmult(e.uniqueEdges[x],I),c.cross(I,C),!C.almostZero()){C.normalize();var R=h.testSepAxis(C,e,t,n,i,r);if(!1===R)return!1;R<d&&(d=R,a.copy(C))}}return i.vsub(t,u),u.dot(a)>0&&a.negate(a),!0}},{key:"testSepAxis",value:function(e,t,i,r,a,o){n.project(this,e,i,r,tN),n.project(t,e,a,o,nN);var s=tN[0],g=tN[1],l=nN[0],u=nN[1];if(s<u||l<g)return!1;var c=s-u,I=l-g;return c<I?c:I}},{key:"calculateLocalInertia",value:function(e,t){var n=new zK,i=new zK;this.computeLocalAABB(i,n);var r=n.x-i.x,a=n.y-i.y,o=n.z-i.z;t.x=1/12*e*(2*a*2*a+2*o*2*o),t.y=1/12*e*(2*r*2*r+2*o*2*o),t.z=1/12*e*(2*a*2*a+2*r*2*r)}},{key:"getPlaneConstantOfFace",value:function(e){var t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}},{key:"clipFaceAgainstHull",value:function(e,t,n,i,r,a,o){for(var s=new zK,g=new zK,l=new zK,u=new zK,c=new zK,I=new zK,C=new zK,d=new zK,h=this,A=i,p=[],m=-1,f=Number.MAX_VALUE,v=0;v<h.faces.length;v++){s.copy(h.faceNormals[v]),n.vmult(s,s);var b=s.dot(e);b<f&&(f=b,m=v)}if(!(m<0)){var y=h.faces[m];y.connectedFaces=[];for(var G=0;G<h.faces.length;G++)for(var B=0;B<h.faces[G].length;B++)-1!==y.indexOf(h.faces[G][B])&&G!==m&&-1===y.connectedFaces.indexOf(G)&&y.connectedFaces.push(G);for(var Z=y.length,w=0;w<Z;w++){var S=h.vertices[y[w]],W=h.vertices[y[(w+1)%Z]];S.vsub(W,g),l.copy(g),n.vmult(l,l),t.vadd(l,l),u.copy(this.faceNormals[m]),n.vmult(u,u),t.vadd(u,u),l.cross(u,c),c.negate(c),I.copy(S),n.vmult(I,I),t.vadd(I,I);var x=y.connectedFaces[w];C.copy(this.faceNormals[x]);var R=this.getPlaneConstantOfFace(x);d.copy(C),n.vmult(d,d);var V=R-d.dot(t);for(this.clipFaceAgainstPlane(A,p,d,V);A.length;)A.shift();for(;p.length;)A.push(p.shift())}C.copy(this.faceNormals[m]);var k=this.getPlaneConstantOfFace(m);d.copy(C),n.vmult(d,d);for(var X=k-d.dot(t),Y=0;Y<A.length;Y++){var H=d.dot(A[Y])+X;if(H<=r&&(console.log("clamped: depth=".concat(H," to minDist=").concat(r)),H=r),H<=a){var F=A[Y];if(H<=1e-6){var M={point:F,normal:d,depth:H};o.push(M)}}}}}},{key:"clipFaceAgainstPlane",value:function(e,t,n,i){var r,a,o=e.length;if(o<2)return t;var s=e[e.length-1],g=e[0];r=n.dot(s)+i;for(var l=0;l<o;l++){if(g=e[l],a=n.dot(g)+i,r<0)if(a<0){var u=new zK;u.copy(g),t.push(u)}else{var c=new zK;s.lerp(g,r/(r-a),c),t.push(c)}else if(a<0){var I=new zK;s.lerp(g,r/(r-a),I),t.push(I),t.push(g)}s=g,r=a}return t}},{key:"computeWorldVertices",value:function(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new zK);for(var n=this.vertices,i=this.worldVertices,r=0;r!==this.vertices.length;r++)t.vmult(n[r],i[r]),e.vadd(i[r],i[r]);this.worldVerticesNeedsUpdate=!1}},{key:"computeLocalAABB",value:function(e,t){var n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;i<this.vertices.length;i++){var r=n[i];r.x<e.x?e.x=r.x:r.x>t.x&&(t.x=r.x),r.y<e.y?e.y=r.y:r.y>t.y&&(t.y=r.y),r.z<e.z?e.z=r.z:r.z>t.z&&(t.z=r.z)}}},{key:"computeWorldFaceNormals",value:function(e){for(var t=this.faceNormals.length;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new zK);for(var n=this.faceNormals,i=this.worldFaceNormals,r=0;r!==t;r++)e.vmult(n[r],i[r]);this.worldFaceNormalsNeedsUpdate=!1}},{key:"updateBoundingSphereRadius",value:function(){for(var e=0,t=this.vertices,n=0;n!==t.length;n++){var i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}},{key:"calculateWorldAABB",value:function(e,t,n,i){for(var r,a,o,s,g,l,u=this.vertices,c=new zK,I=0;I<u.length;I++){c.copy(u[I]),t.vmult(c,c),e.vadd(c,c);var C=c;(void 0===r||C.x<r)&&(r=C.x),(void 0===s||C.x>s)&&(s=C.x),(void 0===a||C.y<a)&&(a=C.y),(void 0===g||C.y>g)&&(g=C.y),(void 0===o||C.z<o)&&(o=C.z),(void 0===l||C.z>l)&&(l=C.z)}n.set(r,a,o),i.set(s,g,l)}},{key:"volume",value:function(){return 4*Math.PI*this.boundingSphereRadius/3}},{key:"getAveragePointLocal",value:function(e){void 0===e&&(e=new zK);for(var t=this.vertices,n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}},{key:"transformAllPoints",value:function(e,t){var n=this.vertices.length,i=this.vertices;if(t){for(var r=0;r<n;r++){var a=i[r];t.vmult(a,a)}for(var o=0;o<this.faceNormals.length;o++){var s=this.faceNormals[o];t.vmult(s,s)}}if(e)for(var g=0;g<n;g++){var l=i[g];l.vadd(e,l)}}},{key:"pointIsInside",value:function(e){var t=this.vertices,n=this.faces,i=this.faceNormals,r=new zK;this.getAveragePointLocal(r);for(var a=0;a<this.faces.length;a++){var o=i[a],s=t[n[a][0]],g=new zK;e.vsub(s,g);var l=o.dot(g),u=new zK;r.vsub(s,u);var c=o.dot(u);if(l<0&&c>0||l>0&&c<0)return!1}return-1}}],[{key:"computeNormal",value:function(e,t,n,i){var r=new zK,a=new zK;t.vsub(e,a),n.vsub(t,r),r.cross(a,i),i.isZero()||i.normalize()}},{key:"project",value:function(e,t,n,i,r){var a=e.vertices.length,o=iN,s=0,g=0,l=rN,u=e.vertices;l.setZero(),qK.vectorToLocalFrame(n,i,t,o),qK.pointToLocalFrame(n,i,l,l);var c=l.dot(o);g=s=u[0].dot(o);for(var I=1;I<a;I++){var C=u[I].dot(o);C>s&&(s=C),C<g&&(g=C)}if((g-=c)>(s-=c)){var d=g;g=s,s=d}r[0]=s,r[1]=g}}]),n}(jK),tN=[],nN=[];new zK;var iN=new zK,rN=new zK,aN=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,{type:jK.types.BOX})).halfExtents=e,i.convexPolyhedronRepresentation=null,i.updateConvexPolyhedronRepresentation(),i.updateBoundingSphereRadius(),i}return Ai(n,[{key:"updateConvexPolyhedronRepresentation",value:function(){var e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=zK,r=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],a=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],o=new eN({vertices:r,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:a});this.convexPolyhedronRepresentation=o,o.material=this.material}},{key:"calculateLocalInertia",value:function(e,t){return void 0===t&&(t=new zK),n.calculateInertia(this.halfExtents,e,t),t}},{key:"getSideNormals",value:function(e,t){var n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==t)for(var r=0;r!==n.length;r++)t.vmult(n[r],n[r]);return n}},{key:"volume",value:function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}},{key:"updateBoundingSphereRadius",value:function(){this.boundingSphereRadius=this.halfExtents.length()}},{key:"forEachWorldCorner",value:function(e,t,n){for(var i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],a=0;a<r.length;a++)oN.set(r[a][0],r[a][1],r[a][2]),t.vmult(oN,oN),e.vadd(oN,oN),n(oN.x,oN.y,oN.z)}},{key:"calculateWorldAABB",value:function(e,t,n,i){var r=this.halfExtents;sN[0].set(r.x,r.y,r.z),sN[1].set(-r.x,r.y,r.z),sN[2].set(-r.x,-r.y,r.z),sN[3].set(-r.x,-r.y,-r.z),sN[4].set(r.x,-r.y,-r.z),sN[5].set(r.x,r.y,-r.z),sN[6].set(-r.x,r.y,-r.z),sN[7].set(r.x,-r.y,r.z);var a=sN[0];t.vmult(a,a),e.vadd(a,a),i.copy(a),n.copy(a);for(var o=1;o<8;o++){var s=sN[o];t.vmult(s,s),e.vadd(s,s);var g=s.x,l=s.y,u=s.z;g>i.x&&(i.x=g),l>i.y&&(i.y=l),u>i.z&&(i.z=u),g<n.x&&(n.x=g),l<n.y&&(n.y=l),u<n.z&&(n.z=u)}}}],[{key:"calculateInertia",value:function(e,t,n){var i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}}]),n}(jK),oN=new zK,sN=[new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK],gN=1,lN=2,uN=4,cN=0,IN=1,CN=2,dN=function(e){Li(n,e);var t=Di(n);function n(e){var i;di(this,n),void 0===e&&(e={}),(i=t.call(this)).id=n.idCounter++,i.index=-1,i.world=null,i.vlambda=new zK,i.collisionFilterGroup="number"===typeof e.collisionFilterGroup?e.collisionFilterGroup:1,i.collisionFilterMask="number"===typeof e.collisionFilterMask?e.collisionFilterMask:-1,i.collisionResponse="boolean"!==typeof e.collisionResponse||e.collisionResponse,i.position=new zK,i.previousPosition=new zK,i.interpolatedPosition=new zK,i.initPosition=new zK,e.position&&(i.position.copy(e.position),i.previousPosition.copy(e.position),i.interpolatedPosition.copy(e.position),i.initPosition.copy(e.position)),i.velocity=new zK,e.velocity&&i.velocity.copy(e.velocity),i.initVelocity=new zK,i.force=new zK;var r="number"===typeof e.mass?e.mass:0;return i.mass=r,i.invMass=r>0?1/r:0,i.material=e.material||null,i.linearDamping="number"===typeof e.linearDamping?e.linearDamping:.01,i.type=r<=0?n.STATIC:n.DYNAMIC,typeof e.type===typeof n.STATIC&&(i.type=e.type),i.allowSleep="undefined"===typeof e.allowSleep||e.allowSleep,i.sleepState=n.AWAKE,i.sleepSpeedLimit="undefined"!==typeof e.sleepSpeedLimit?e.sleepSpeedLimit:.1,i.sleepTimeLimit="undefined"!==typeof e.sleepTimeLimit?e.sleepTimeLimit:1,i.timeLastSleepy=0,i.wakeUpAfterNarrowphase=!1,i.torque=new zK,i.quaternion=new PK,i.initQuaternion=new PK,i.previousQuaternion=new PK,i.interpolatedQuaternion=new PK,e.quaternion&&(i.quaternion.copy(e.quaternion),i.initQuaternion.copy(e.quaternion),i.previousQuaternion.copy(e.quaternion),i.interpolatedQuaternion.copy(e.quaternion)),i.angularVelocity=new zK,e.angularVelocity&&i.angularVelocity.copy(e.angularVelocity),i.initAngularVelocity=new zK,i.shapes=[],i.shapeOffsets=[],i.shapeOrientations=[],i.inertia=new zK,i.invInertia=new zK,i.invInertiaWorld=new KK,i.invMassSolve=0,i.invInertiaSolve=new zK,i.invInertiaWorldSolve=new KK,i.fixedRotation="undefined"!==typeof e.fixedRotation&&e.fixedRotation,i.angularDamping="undefined"!==typeof e.angularDamping?e.angularDamping:.01,i.linearFactor=new zK(1,1,1),e.linearFactor&&i.linearFactor.copy(e.linearFactor),i.angularFactor=new zK(1,1,1),e.angularFactor&&i.angularFactor.copy(e.angularFactor),i.aabb=new EK,i.aabbNeedsUpdate=!0,i.boundingRadius=0,i.wlambda=new zK,i.isTrigger=Boolean(e.isTrigger),e.shape&&i.addShape(e.shape),i.updateMassProperties(),i}return Ai(n,[{key:"wakeUp",value:function(){var e=this.sleepState;this.sleepState=n.AWAKE,this.wakeUpAfterNarrowphase=!1,e===n.SLEEPING&&this.dispatchEvent(n.wakeupEvent)}},{key:"sleep",value:function(){this.sleepState=n.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}},{key:"sleepTick",value:function(e){if(this.allowSleep){var t=this.sleepState,i=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=Math.pow(this.sleepSpeedLimit,2);t===n.AWAKE&&i<r?(this.sleepState=n.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(n.sleepyEvent)):t===n.SLEEPY&&i>r?this.wakeUp():t===n.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(n.sleepEvent))}}},{key:"updateSolveMassProperties",value:function(){this.sleepState===n.SLEEPING||this.type===n.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}},{key:"pointToLocalFrame",value:function(e,t){return void 0===t&&(t=new zK),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}},{key:"vectorToLocalFrame",value:function(e,t){return void 0===t&&(t=new zK),this.quaternion.conjugate().vmult(e,t),t}},{key:"pointToWorldFrame",value:function(e,t){return void 0===t&&(t=new zK),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}},{key:"vectorToWorldFrame",value:function(e,t){return void 0===t&&(t=new zK),this.quaternion.vmult(e,t),t}},{key:"addShape",value:function(e,t,n){var i=new zK,r=new PK;return t&&i.copy(t),n&&r.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}},{key:"removeShape",value:function(e){var t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}},{key:"updateBoundingRadius",value:function(){for(var e=this.shapes,t=this.shapeOffsets,n=e.length,i=0,r=0;r!==n;r++){var a=e[r];a.updateBoundingSphereRadius();var o=t[r].length(),s=a.boundingSphereRadius;o+s>i&&(i=o+s)}this.boundingRadius=i}},{key:"updateAABB",value:function(){for(var e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,r=hN,a=AN,o=this.quaternion,s=this.aabb,g=pN,l=0;l!==i;l++){var u=e[l];o.vmult(t[l],r),r.vadd(this.position,r),o.mult(n[l],a),u.calculateWorldAABB(r,a,g.lowerBound,g.upperBound),0===l?s.copy(g):s.extend(g)}this.aabbNeedsUpdate=!1}},{key:"updateInertiaWorld",value:function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var n=mN,i=fN;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(t,n),n.mmult(i,this.invInertiaWorld)}else;}},{key:"applyForce",value:function(e,t){if(void 0===t&&(t=new zK),this.type===n.DYNAMIC){this.sleepState===n.SLEEPING&&this.wakeUp();var i=vN;t.cross(e,i),this.force.vadd(e,this.force),this.torque.vadd(i,this.torque)}}},{key:"applyLocalForce",value:function(e,t){if(void 0===t&&(t=new zK),this.type===n.DYNAMIC){var i=bN,r=yN;this.vectorToWorldFrame(e,i),this.vectorToWorldFrame(t,r),this.applyForce(i,r)}}},{key:"applyTorque",value:function(e){this.type===n.DYNAMIC&&(this.sleepState===n.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}},{key:"applyImpulse",value:function(e,t){if(void 0===t&&(t=new zK),this.type===n.DYNAMIC){this.sleepState===n.SLEEPING&&this.wakeUp();var i=t,r=GN;r.copy(e),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);var a=BN;i.cross(e,a),this.invInertiaWorld.vmult(a,a),this.angularVelocity.vadd(a,this.angularVelocity)}}},{key:"applyLocalImpulse",value:function(e,t){if(void 0===t&&(t=new zK),this.type===n.DYNAMIC){var i=ZN,r=wN;this.vectorToWorldFrame(e,i),this.vectorToWorldFrame(t,r),this.applyImpulse(i,r)}}},{key:"updateMassProperties",value:function(){var e=SN;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),aN.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}},{key:"getVelocityAtWorldPoint",value:function(e,t){var n=new zK;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}},{key:"integrate",value:function(e,t,i){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===n.DYNAMIC||this.type===n.KINEMATIC)&&this.sleepState!==n.SLEEPING){var r=this.velocity,a=this.angularVelocity,o=this.position,s=this.force,g=this.torque,l=this.quaternion,u=this.invMass,c=this.invInertiaWorld,I=this.linearFactor,C=u*e;r.x+=s.x*C*I.x,r.y+=s.y*C*I.y,r.z+=s.z*C*I.z;var d=c.elements,h=this.angularFactor,A=g.x*h.x,p=g.y*h.y,m=g.z*h.z;a.x+=e*(d[0]*A+d[1]*p+d[2]*m),a.y+=e*(d[3]*A+d[4]*p+d[5]*m),a.z+=e*(d[6]*A+d[7]*p+d[8]*m),o.x+=r.x*e,o.y+=r.y*e,o.z+=r.z*e,l.integrate(this.angularVelocity,e,this.angularFactor,l),t&&(i?l.normalizeFast():l.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}}]),n}(UK);dN.idCounter=0,dN.COLLIDE_EVENT_NAME="collide",dN.DYNAMIC=gN,dN.STATIC=lN,dN.KINEMATIC=uN,dN.AWAKE=cN,dN.SLEEPY=IN,dN.SLEEPING=CN,dN.wakeupEvent={type:"wakeup"},dN.sleepyEvent={type:"sleepy"},dN.sleepEvent={type:"sleep"};var hN=new zK,AN=new PK,pN=new EK,mN=new KK,fN=new KK;new KK;var vN=new zK,bN=new zK,yN=new zK,GN=new zK,BN=new zK,ZN=new zK,wN=new zK,SN=new zK;new zK,new zK,new PK,new zK,new zK,new zK,new zK;var WN=function(){function e(){di(this,e),this.rayFromWorld=new zK,this.rayToWorld=new zK,this.hitNormalWorld=new zK,this.hitPointWorld=new zK,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}return Ai(e,[{key:"reset",value:function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}},{key:"abort",value:function(){this.shouldStop=!0}},{key:"set",value:function(e,t,n,i,r,a,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=a,this.distance=o}}]),e}(),xN=1,RN=2,VN=4,kN=function(e,t,n,i,r,a,o){function s(e,t){di(this,s),void 0===e&&(e=new zK),void 0===t&&(t=new zK),this.from=e.clone(),this.to=t.clone(),this.direction=new zK,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=s.ANY,this.result=new WN,this.hasHit=!1,this.callback=function(e){}}return Ai(s,[{key:e,get:function(){return this._intersectSphere}},{key:t,get:function(){return this._intersectPlane}},{key:n,get:function(){return this._intersectBox}},{key:i,get:function(){return this._intersectConvex}},{key:r,get:function(){return this._intersectConvex}},{key:a,get:function(){return this._intersectHeightfield}},{key:o,get:function(){return this._intersectTrimesh}},{key:"intersectWorld",value:function(e,t){return this.mode=t.mode||s.ANY,this.result=t.result||new WN,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask="undefined"!==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!==typeof t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse="undefined"===typeof t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(XN),YN.length=0,e.broadphase.aabbQuery(e,XN,YN),this.intersectBodies(YN),this.hasHit}},{key:"intersectBody",value:function(e,t){t&&(this.result=t,this.updateDirection());var n=this.checkCollisionResponse;if((!n||e.collisionResponse)&&0!==(this.collisionFilterGroup&e.collisionFilterMask)&&0!==(e.collisionFilterGroup&this.collisionFilterMask))for(var i=MN,r=KN,a=0,o=e.shapes.length;a<o;a++){var s=e.shapes[a];if((!n||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[a],r),e.quaternion.vmult(e.shapeOffsets[a],i),i.vadd(e.position,i),this.intersectShape(s,r,i,e),this.result.shouldStop))break}}},{key:"intersectBodies",value:function(e,t){t&&(this.result=t,this.updateDirection());for(var n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}},{key:"updateDirection",value:function(){this.to.vsub(this.from,this.direction),this.direction.normalize()}},{key:"intersectShape",value:function(e,t,n,i){var r=function(e,t,n){n.vsub(e,az);var i=az.dot(t);return t.scale(i,oz),oz.vadd(e,oz),n.distanceTo(oz)}(this.from,this.direction,n);if(!(r>e.boundingSphereRadius)){var a=this[e.type];a&&a.call(this,e,t,n,i,e)}}},{key:"_intersectBox",value:function(e,t,n,i,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,r)}},{key:"_intersectPlane",value:function(e,t,n,i,r){var a=this.from,o=this.to,s=this.direction,g=new zK(0,0,1);t.vmult(g,g);var l=new zK;a.vsub(n,l);var u=l.dot(g);if(o.vsub(n,l),!(u*l.dot(g)>0)&&!(a.distanceTo(o)<u)){var c=g.dot(s);if(!(Math.abs(c)<this.precision)){var I=new zK,C=new zK,d=new zK;a.vsub(n,I);var h=-g.dot(I)/c;s.scale(h,C),a.vadd(C,d),this.reportIntersection(g,d,r,i,-1)}}}},{key:"getAABB",value:function(e){var t=e.lowerBound,n=e.upperBound,i=this.to,r=this.from;t.x=Math.min(i.x,r.x),t.y=Math.min(i.y,r.y),t.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}},{key:"_intersectHeightfield",value:function(e,t,n,i,r){e.data,e.elementSize;var a=JN;a.from.copy(this.from),a.to.copy(this.to),qK.pointToLocalFrame(n,t,a.from,a.from),qK.pointToLocalFrame(n,t,a.to,a.to),a.updateDirection();var o,s,g,l,u=DN;o=s=0,g=l=e.data.length-1;var c=new EK;a.getAABB(c),e.getIndexOfPosition(c.lowerBound.x,c.lowerBound.y,u,!0),o=Math.max(o,u[0]),s=Math.max(s,u[1]),e.getIndexOfPosition(c.upperBound.x,c.upperBound.y,u,!0),g=Math.min(g,u[0]+1),l=Math.min(l,u[1]+1);for(var I=o;I<g;I++)for(var C=s;C<l;C++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(I,C,c),c.overlapsRay(a)){if(e.getConvexTrianglePillar(I,C,!1),qK.pointToWorldFrame(n,t,e.pillarOffset,EN),this._intersectConvex(e.pillarConvex,t,EN,i,r,TN),this.result.shouldStop)return;e.getConvexTrianglePillar(I,C,!0),qK.pointToWorldFrame(n,t,e.pillarOffset,EN),this._intersectConvex(e.pillarConvex,t,EN,i,r,TN)}}}},{key:"_intersectSphere",value:function(e,t,n,i,r){var a=this.from,o=this.to,s=e.radius,g=Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2)+Math.pow(o.z-a.z,2),l=2*((o.x-a.x)*(a.x-n.x)+(o.y-a.y)*(a.y-n.y)+(o.z-a.z)*(a.z-n.z)),u=Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2)+Math.pow(a.z-n.z,2)-Math.pow(s,2),c=Math.pow(l,2)-4*g*u,I=UN,C=PN;if(!(c<0))if(0===c)a.lerp(o,c,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,r,i,-1);else{var d=(-l-Math.sqrt(c))/(2*g),h=(-l+Math.sqrt(c))/(2*g);if(d>=0&&d<=1&&(a.lerp(o,d,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,r,i,-1)),this.result.shouldStop)return;h>=0&&h<=1&&(a.lerp(o,h,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,r,i,-1))}}},{key:"_intersectConvex",value:function(e,t,n,i,r,a){for(var o=QN,g=ON,l=a&&a.faceList||null,u=e.faces,c=e.vertices,I=e.faceNormals,C=this.direction,d=this.from,h=this.to,A=d.distanceTo(h),p=l?l.length:u.length,m=this.result,f=0;!m.shouldStop&&f<p;f++){var v=l?l[f]:f,b=u[v],y=I[v],G=t,B=n;g.copy(c[b[0]]),G.vmult(g,g),g.vadd(B,g),g.vsub(d,g),G.vmult(y,o);var Z=C.dot(o);if(!(Math.abs(Z)<this.precision)){var w=o.dot(g)/Z;if(!(w<0)){C.scale(w,NN),NN.vadd(d,NN),zN.copy(c[b[0]]),G.vmult(zN,zN),B.vadd(zN,zN);for(var S=1;!m.shouldStop&&S<b.length-1;S++){LN.copy(c[b[S]]),_N.copy(c[b[S+1]]),G.vmult(LN,LN),G.vmult(_N,_N),B.vadd(LN,LN),B.vadd(_N,_N);var W=NN.distanceTo(d);!s.pointInTriangle(NN,zN,LN,_N)&&!s.pointInTriangle(NN,LN,zN,_N)||W>A||this.reportIntersection(o,NN,r,i,v)}}}}}},{key:"_intersectTrimesh",value:function(e,t,n,i,r,a){var o=jN,g=iz,l=rz,u=ON,c=qN,I=$N,C=ez,d=nz,h=tz,A=e.indices;e.vertices;var p=this.from,m=this.to,f=this.direction;l.position.copy(n),l.quaternion.copy(t),qK.vectorToLocalFrame(n,t,f,c),qK.pointToLocalFrame(n,t,p,I),qK.pointToLocalFrame(n,t,m,C),C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,I.x*=e.scale.x,I.y*=e.scale.y,I.z*=e.scale.z,C.vsub(I,c),c.normalize();var v=I.distanceSquared(C);e.tree.rayQuery(this,l,g);for(var b=0,y=g.length;!this.result.shouldStop&&b!==y;b++){var G=g[b];e.getNormal(G,o),e.getVertex(A[3*G],zN),zN.vsub(I,u);var B=c.dot(o),Z=o.dot(u)/B;if(!(Z<0)){c.scale(Z,NN),NN.vadd(I,NN),e.getVertex(A[3*G+1],LN),e.getVertex(A[3*G+2],_N);var w=NN.distanceSquared(I);!s.pointInTriangle(NN,LN,zN,_N)&&!s.pointInTriangle(NN,zN,LN,_N)||w>v||(qK.vectorToWorldFrame(t,o,h),qK.pointToWorldFrame(n,t,NN,d),this.reportIntersection(h,d,r,i,G))}}g.length=0}},{key:"reportIntersection",value:function(e,t,n,i,r){var a=this.from,o=this.to,g=a.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex="undefined"!==typeof r?r:-1,this.mode){case s.ALL:this.hasHit=!0,l.set(a,o,e,t,n,i,g),l.hasHit=!0,this.callback(l);break;case s.CLOSEST:(g<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(a,o,e,t,n,i,g));break;case s.ANY:this.hasHit=!0,l.hasHit=!0,l.set(a,o,e,t,n,i,g),l.shouldStop=!0}}}],[{key:"pointInTriangle",value:function(e,t,n,i){i.vsub(t,az),n.vsub(t,HN),e.vsub(t,FN);var r,a,o=az.dot(az),s=az.dot(HN),g=az.dot(FN),l=HN.dot(HN),u=HN.dot(FN);return(r=l*g-s*u)>=0&&(a=o*u-s*g)>=0&&r+a<o*l-s*s}}]),s}(jK.types.SPHERE,jK.types.PLANE,jK.types.BOX,jK.types.CYLINDER,jK.types.CONVEXPOLYHEDRON,jK.types.HEIGHTFIELD,jK.types.TRIMESH);kN.CLOSEST=xN,kN.ANY=RN,kN.ALL=VN;var XN=new EK,YN=[],HN=new zK,FN=new zK,MN=new zK,KN=new PK,NN=new zK,zN=new zK,LN=new zK,_N=new zK;new zK,new WN;var TN={faceList:[0]},EN=new zK,JN=new kN,DN=[],UN=new zK,PN=new zK,QN=new zK;new zK,new zK;var ON=new zK,jN=new zK,qN=new zK,$N=new zK,ez=new zK,tz=new zK,nz=new zK;new EK;var iz=[],rz=new qK,az=new zK,oz=new zK;new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK;var sz=Ai((function e(t){di(this,e),void 0===t&&(t={});var n="";"string"===typeof t&&(n=t,t={}),this.name=n,this.id=e.idCounter++,this.friction="undefined"!==typeof t.friction?t.friction:-1,this.restitution="undefined"!==typeof t.restitution?t.restitution:-1}));sz.idCounter=0,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new kN,new zK,new zK,new zK,new zK(1,0,0),new zK(0,1,0),new zK(0,0,1),new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK;new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK;new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK;new zK,new EK,new zK,new EK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new EK,new zK,new qK,new EK;jK.types.SPHERE,jK.types.SPHERE,jK.types.PLANE,jK.types.BOX,jK.types.BOX,jK.types.SPHERE,jK.types.BOX,jK.types.PLANE,jK.types.BOX,jK.types.CONVEXPOLYHEDRON,jK.types.SPHERE,jK.types.CONVEXPOLYHEDRON,jK.types.PLANE,jK.types.CONVEXPOLYHEDRON,jK.types.BOX,jK.types.CONVEXPOLYHEDRON,jK.types.SPHERE,jK.types.HEIGHTFIELD,jK.types.BOX,jK.types.HEIGHTFIELD,jK.types.CONVEXPOLYHEDRON,jK.types.HEIGHTFIELD,jK.types.PARTICLE,jK.types.SPHERE,jK.types.PLANE,jK.types.PARTICLE,jK.types.BOX,jK.types.PARTICLE,jK.types.PARTICLE,jK.types.CONVEXPOLYHEDRON,jK.types.CYLINDER,jK.types.SPHERE,jK.types.CYLINDER,jK.types.PLANE,jK.types.CYLINDER,jK.types.BOX,jK.types.CYLINDER,jK.types.CONVEXPOLYHEDRON,jK.types.CYLINDER,jK.types.HEIGHTFIELD,jK.types.CYLINDER,jK.types.PARTICLE,jK.types.CYLINDER,jK.types.SPHERE,jK.types.TRIMESH,jK.types.PLANE,jK.types.TRIMESH,new zK,new zK,new zK,new zK,new zK,new PK,new PK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new EK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new PK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new zK,new EK,new kN;var gz=globalThis.performance||{};if(!gz.now){var lz=Date.now();gz.timing&&gz.timing.navigationStart&&(lz=gz.timing.navigationStart),gz.now=function(){return Date.now()-lz}}new zK;var uz=function(){function e(t){di(this,e),void 0===t&&(t=[0,0,0,0,0,0,0,0,0]),this.elements=t}return Ai(e,[{key:"identity",value:function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}},{key:"setZero",value:function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}},{key:"setTrace",value:function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}},{key:"getTrace",value:function(e){void 0===e&&(e=new Iz);var t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}},{key:"vmult",value:function(e,t){void 0===t&&(t=new Iz);var n=this.elements,i=e.x,r=e.y,a=e.z;return t.x=n[0]*i+n[1]*r+n[2]*a,t.y=n[3]*i+n[4]*r+n[5]*a,t.z=n[6]*i+n[7]*r+n[8]*a,t}},{key:"smult",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e}},{key:"mmult",value:function(t,n){void 0===n&&(n=new e);var i=this.elements,r=t.elements,a=n.elements,o=i[0],s=i[1],g=i[2],l=i[3],u=i[4],c=i[5],I=i[6],C=i[7],d=i[8],h=r[0],A=r[1],p=r[2],m=r[3],f=r[4],v=r[5],b=r[6],y=r[7],G=r[8];return a[0]=o*h+s*m+g*b,a[1]=o*A+s*f+g*y,a[2]=o*p+s*v+g*G,a[3]=l*h+u*m+c*b,a[4]=l*A+u*f+c*y,a[5]=l*p+u*v+c*G,a[6]=I*h+C*m+d*b,a[7]=I*A+C*f+d*y,a[8]=I*p+C*v+d*G,n}},{key:"scale",value:function(t,n){void 0===n&&(n=new e);for(var i=this.elements,r=n.elements,a=0;3!==a;a++)r[3*a+0]=t.x*i[3*a+0],r[3*a+1]=t.y*i[3*a+1],r[3*a+2]=t.z*i[3*a+2];return n}},{key:"solve",value:function(e,t){void 0===t&&(t=new Iz);var n,i,r=[];for(n=0;n<12;n++)r.push(0);for(n=0;n<3;n++)for(i=0;i<3;i++)r[n+4*i]=this.elements[n+3*i];r[3]=e.x,r[7]=e.y,r[11]=e.z;var a,o,s=3,g=s;do{if(0===r[(n=g-s)+4*n])for(i=n+1;i<g;i++)if(0!==r[n+4*i]){a=4;do{r[(o=4-a)+4*n]+=r[o+4*i]}while(--a);break}if(0!==r[n+4*n])for(i=n+1;i<g;i++){var l=r[n+4*i]/r[n+4*n];a=4;do{r[(o=4-a)+4*i]=o<=n?0:r[o+4*i]-r[o+4*n]*l}while(--a)}}while(--s);if(t.z=r[11]/r[10],t.y=(r[7]-r[6]*t.z)/r[5],t.x=(r[3]-r[2]*t.z-r[1]*t.y)/r[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=[".concat(t.toString(),"], b=[").concat(e.toString(),"], A=[").concat(this.toString(),"]");return t}},{key:"e",value:function(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}},{key:"copy",value:function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}},{key:"toString",value:function(){for(var e="",t=0;t<9;t++)e+=this.elements[t]+",";return e}},{key:"reverse",value:function(t){void 0===t&&(t=new e);var n,i,r=cz;for(n=0;n<3;n++)for(i=0;i<3;i++)r[n+6*i]=this.elements[n+3*i];r[3]=1,r[9]=0,r[15]=0,r[4]=0,r[10]=1,r[16]=0,r[5]=0,r[11]=0,r[17]=1;var a,o,s=3,g=s;do{if(0===r[(n=g-s)+6*n])for(i=n+1;i<g;i++)if(0!==r[n+6*i]){a=6;do{r[(o=6-a)+6*n]+=r[o+6*i]}while(--a);break}if(0!==r[n+6*n])for(i=n+1;i<g;i++){var l=r[n+6*i]/r[n+6*n];a=6;do{r[(o=6-a)+6*i]=o<=n?0:r[o+6*i]-r[o+6*n]*l}while(--a)}}while(--s);n=2;do{i=n-1;do{var u=r[n+6*i]/r[n+6*n];a=6;do{r[(o=6-a)+6*i]=r[o+6*i]-r[o+6*n]*u}while(--a)}while(i--)}while(--n);n=2;do{var c=1/r[n+6*n];a=6;do{r[(o=6-a)+6*n]=r[o+6*n]*c}while(--a)}while(n--);n=2;do{i=2;do{if(o=r[3+i+6*n],isNaN(o)||o===1/0)throw"Could not reverse! A=[".concat(this.toString(),"]");t.e(n,i,o)}while(i--)}while(n--);return t}},{key:"setRotationFromQuaternion",value:function(e){var t=e.x,n=e.y,i=e.z,r=e.w,a=t+t,o=n+n,s=i+i,g=t*a,l=t*o,u=t*s,c=n*o,I=n*s,C=i*s,d=r*a,h=r*o,A=r*s,p=this.elements;return p[0]=1-(c+C),p[1]=l-A,p[2]=u+h,p[3]=l+A,p[4]=1-(g+C),p[5]=I-d,p[6]=u-h,p[7]=I+d,p[8]=1-(g+c),this}},{key:"transpose",value:function(t){void 0===t&&(t=new e);var n,i=this.elements,r=t.elements;return r[0]=i[0],r[4]=i[4],r[8]=i[8],n=i[1],r[1]=i[3],r[3]=n,n=i[2],r[2]=i[6],r[6]=n,n=i[5],r[5]=i[7],r[7]=n,t}}]),e}(),cz=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Iz=function(){function e(t,n,i){di(this,e),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=n,this.z=i}return Ai(e,[{key:"cross",value:function(t,n){void 0===n&&(n=new e);var i=t.x,r=t.y,a=t.z,o=this.x,s=this.y,g=this.z;return n.x=s*a-g*r,n.y=g*i-o*a,n.z=o*r-s*i,n}},{key:"set",value:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},{key:"setZero",value:function(){this.x=this.y=this.z=0}},{key:"vadd",value:function(t,n){if(!n)return new e(this.x+t.x,this.y+t.y,this.z+t.z);n.x=t.x+this.x,n.y=t.y+this.y,n.z=t.z+this.z}},{key:"vsub",value:function(t,n){if(!n)return new e(this.x-t.x,this.y-t.y,this.z-t.z);n.x=this.x-t.x,n.y=this.y-t.y,n.z=this.z-t.z}},{key:"crossmat",value:function(){return new uz([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}},{key:"normalize",value:function(){var e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){var r=1/i;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return i}},{key:"unit",value:function(t){void 0===t&&(t=new e);var n=this.x,i=this.y,r=this.z,a=Math.sqrt(n*n+i*i+r*r);return a>0?(a=1/a,t.x=n*a,t.y=i*a,t.z=r*a):(t.x=1,t.y=0,t.z=0),t}},{key:"length",value:function(){var e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}},{key:"lengthSquared",value:function(){return this.dot(this)}},{key:"distanceTo",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z;return Math.sqrt((r-t)*(r-t)+(a-n)*(a-n)+(o-i)*(o-i))}},{key:"distanceSquared",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z;return(r-t)*(r-t)+(a-n)*(a-n)+(o-i)*(o-i)}},{key:"scale",value:function(t,n){void 0===n&&(n=new e);var i=this.x,r=this.y,a=this.z;return n.x=t*i,n.y=t*r,n.z=t*a,n}},{key:"vmul",value:function(t,n){return void 0===n&&(n=new e),n.x=t.x*this.x,n.y=t.y*this.y,n.z=t.z*this.z,n}},{key:"addScaledVector",value:function(t,n,i){return void 0===i&&(i=new e),i.x=this.x+t*n.x,i.y=this.y+t*n.y,i.z=this.z+t*n.z,i}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"isZero",value:function(){return 0===this.x&&0===this.y&&0===this.z}},{key:"negate",value:function(t){return void 0===t&&(t=new e),t.x=-this.x,t.y=-this.y,t.z=-this.z,t}},{key:"tangents",value:function(e,t){var n=this.length();if(n>0){var i=Cz,r=1/n;i.set(this.x*r,this.y*r,this.z*r);var a=dz;Math.abs(i.x)<.9?(a.set(1,0,0),i.cross(a,e)):(a.set(0,1,0),i.cross(a,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.z)}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"lerp",value:function(e,t,n){var i=this.x,r=this.y,a=this.z;n.x=i+(e.x-i)*t,n.y=r+(e.y-r)*t,n.z=a+(e.z-a)*t}},{key:"almostEquals",value:function(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}},{key:"almostZero",value:function(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}},{key:"isAntiparallelTo",value:function(e,t){return this.negate(hz),hz.almostEquals(e,t)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();Iz.ZERO=new Iz(0,0,0),Iz.UNIT_X=new Iz(1,0,0),Iz.UNIT_Y=new Iz(0,1,0),Iz.UNIT_Z=new Iz(0,0,1);var Cz=new Iz,dz=new Iz,hz=new Iz,Az=function(){function e(t){di(this,e),void 0===t&&(t={}),this.lowerBound=new Iz,this.upperBound=new Iz,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}return Ai(e,[{key:"setFromPoints",value:function(e,t,n,i){var r=this.lowerBound,a=this.upperBound,o=n;r.copy(e[0]),o&&o.vmult(r,r),a.copy(r);for(var s=1;s<e.length;s++){var g=e[s];o&&(o.vmult(g,pz),g=pz),g.x>a.x&&(a.x=g.x),g.x<r.x&&(r.x=g.x),g.y>a.y&&(a.y=g.y),g.y<r.y&&(r.y=g.y),g.z>a.z&&(a.z=g.z),g.z<r.z&&(r.z=g.z)}return t&&(t.vadd(r,r),t.vadd(a,a)),i&&(r.x-=i,r.y-=i,r.z-=i,a.x+=i,a.y+=i,a.z+=i),this}},{key:"copy",value:function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"extend",value:function(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}},{key:"overlaps",value:function(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound,a=i.x<=n.x&&n.x<=r.x||t.x<=r.x&&r.x<=n.x,o=i.y<=n.y&&n.y<=r.y||t.y<=r.y&&r.y<=n.y,s=i.z<=n.z&&n.z<=r.z||t.z<=r.z&&r.z<=n.z;return a&&o&&s}},{key:"volume",value:function(){var e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}},{key:"contains",value:function(e){var t=this.lowerBound,n=this.upperBound,i=e.lowerBound,r=e.upperBound;return t.x<=i.x&&n.x>=r.x&&t.y<=i.y&&n.y>=r.y&&t.z<=i.z&&n.z>=r.z}},{key:"getCorners",value:function(e,t,n,i,r,a,o,s){var g=this.lowerBound,l=this.upperBound;e.copy(g),t.set(l.x,g.y,g.z),n.set(l.x,l.y,g.z),i.set(g.x,l.y,l.z),r.set(l.x,g.y,l.z),a.set(g.x,l.y,g.z),o.set(g.x,g.y,l.z),s.copy(l)}},{key:"toLocalFrame",value:function(e,t){var n=mz,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],g=n[5],l=n[6],u=n[7];this.getCorners(i,r,a,o,s,g,l,u);for(var c=0;8!==c;c++){var I=n[c];e.pointToLocal(I,I)}return t.setFromPoints(n)}},{key:"toWorldFrame",value:function(e,t){var n=mz,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],g=n[5],l=n[6],u=n[7];this.getCorners(i,r,a,o,s,g,l,u);for(var c=0;8!==c;c++){var I=n[c];e.pointToWorld(I,I)}return t.setFromPoints(n)}},{key:"overlapsRay",value:function(e){var t=e.direction,n=e.from,i=1/t.x,r=1/t.y,a=1/t.z,o=(this.lowerBound.x-n.x)*i,s=(this.upperBound.x-n.x)*i,g=(this.lowerBound.y-n.y)*r,l=(this.upperBound.y-n.y)*r,u=(this.lowerBound.z-n.z)*a,c=(this.upperBound.z-n.z)*a,I=Math.max(Math.max(Math.min(o,s),Math.min(g,l)),Math.min(u,c)),C=Math.min(Math.min(Math.max(o,s),Math.max(g,l)),Math.max(u,c));return!(C<0)&&!(I>C)}}]),e}(),pz=new Iz,mz=[new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz],fz=function(){function e(t,n,i,r){di(this,e),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),this.x=t,this.y=n,this.z=i,this.w=r}return Ai(e,[{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.z,",").concat(this.w)}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"setFromAxisAngle",value:function(e,t){var n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}},{key:"toAxisAngle",value:function(e){void 0===e&&(e=new Iz),this.normalize();var t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}},{key:"setFromVectors",value:function(e,t){if(e.isAntiparallelTo(t)){var n=vz,i=bz;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{var r=e.cross(t);this.x=r.x,this.y=r.y,this.z=r.z,this.w=Math.sqrt(Math.pow(e.length(),2)*Math.pow(t.length(),2))+e.dot(t),this.normalize()}return this}},{key:"mult",value:function(t,n){void 0===n&&(n=new e);var i=this.x,r=this.y,a=this.z,o=this.w,s=t.x,g=t.y,l=t.z,u=t.w;return n.x=i*u+o*s+r*l-a*g,n.y=r*u+o*g+a*s-i*l,n.z=a*u+o*l+i*g-r*s,n.w=o*u-i*s-r*g-a*l,n}},{key:"inverse",value:function(t){void 0===t&&(t=new e);var n=this.x,i=this.y,r=this.z,a=this.w;this.conjugate(t);var o=1/(n*n+i*i+r*r+a*a);return t.x*=o,t.y*=o,t.z*=o,t.w*=o,t}},{key:"conjugate",value:function(t){return void 0===t&&(t=new e),t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"normalizeFast",value:function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"vmult",value:function(e,t){void 0===t&&(t=new Iz);var n=e.x,i=e.y,r=e.z,a=this.x,o=this.y,s=this.z,g=this.w,l=g*n+o*r-s*i,u=g*i+s*n-a*r,c=g*r+a*i-o*n,I=-a*n-o*i-s*r;return t.x=l*g+I*-a+u*-s-c*-o,t.y=u*g+I*-o+c*-a-l*-s,t.z=c*g+I*-s+l*-o-u*-a,t}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"toEuler",value:function(e,t){var n,i,r;void 0===t&&(t="YZX");var a=this.x,o=this.y,s=this.z,g=this.w;if("YZX"!==t)throw new Error("Euler order ".concat(t," not supported yet."));var l=a*o+s*g;if(l>.499&&(n=2*Math.atan2(a,g),i=Math.PI/2,r=0),l<-.499&&(n=-2*Math.atan2(a,g),i=-Math.PI/2,r=0),void 0===n){var u=a*a,c=o*o,I=s*s;n=Math.atan2(2*o*g-2*a*s,1-2*c-2*I),i=Math.asin(2*l),r=Math.atan2(2*a*g-2*o*s,1-2*u-2*I)}e.y=n,e.z=i,e.x=r}},{key:"setFromEuler",value:function(e,t,n,i){void 0===i&&(i="XYZ");var r=Math.cos(e/2),a=Math.cos(t/2),o=Math.cos(n/2),s=Math.sin(e/2),g=Math.sin(t/2),l=Math.sin(n/2);return"XYZ"===i?(this.x=s*a*o+r*g*l,this.y=r*g*o-s*a*l,this.z=r*a*l+s*g*o,this.w=r*a*o-s*g*l):"YXZ"===i?(this.x=s*a*o+r*g*l,this.y=r*g*o-s*a*l,this.z=r*a*l-s*g*o,this.w=r*a*o+s*g*l):"ZXY"===i?(this.x=s*a*o-r*g*l,this.y=r*g*o+s*a*l,this.z=r*a*l+s*g*o,this.w=r*a*o-s*g*l):"ZYX"===i?(this.x=s*a*o-r*g*l,this.y=r*g*o+s*a*l,this.z=r*a*l-s*g*o,this.w=r*a*o+s*g*l):"YZX"===i?(this.x=s*a*o+r*g*l,this.y=r*g*o+s*a*l,this.z=r*a*l-s*g*o,this.w=r*a*o-s*g*l):"XZY"===i&&(this.x=s*a*o-r*g*l,this.y=r*g*o-s*a*l,this.z=r*a*l+s*g*o,this.w=r*a*o+s*g*l),this}},{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.w)}},{key:"slerp",value:function(t,n,i){void 0===i&&(i=new e);var r,a,o,s,g,l=this.x,u=this.y,c=this.z,I=this.w,C=t.x,d=t.y,h=t.z,A=t.w;return(a=l*C+u*d+c*h+I*A)<0&&(a=-a,C=-C,d=-d,h=-h,A=-A),1-a>1e-6?(r=Math.acos(a),o=Math.sin(r),s=Math.sin((1-n)*r)/o,g=Math.sin(n*r)/o):(s=1-n,g=n),i.x=s*l+g*C,i.y=s*u+g*d,i.z=s*c+g*h,i.w=s*I+g*A,i}},{key:"integrate",value:function(t,n,i,r){void 0===r&&(r=new e);var a=t.x*i.x,o=t.y*i.y,s=t.z*i.z,g=this.x,l=this.y,u=this.z,c=this.w,I=.5*n;return r.x+=I*(a*c+o*u-s*l),r.y+=I*(o*c+s*g-a*u),r.z+=I*(s*c+a*l-o*g),r.w+=I*(-a*g-o*l-s*u),r}}]),e}(),vz=new Iz,bz=new Iz,yz=function(){function e(t){di(this,e),void 0===t&&(t={}),this.id=e.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}return Ai(e,[{key:"updateBoundingSphereRadius",value:function(){throw"computeBoundingSphereRadius() not implemented for shape type ".concat(this.type)}},{key:"volume",value:function(){throw"volume() not implemented for shape type ".concat(this.type)}},{key:"calculateLocalInertia",value:function(e,t){throw"calculateLocalInertia() not implemented for shape type ".concat(this.type)}},{key:"calculateWorldAABB",value:function(e,t,n,i){throw"calculateWorldAABB() not implemented for shape type ".concat(this.type)}}]),e}();yz.idCounter=0,yz.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};var Gz=function(){function e(t){di(this,e),void 0===t&&(t={}),this.position=new Iz,this.quaternion=new fz,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}return Ai(e,[{key:"pointToLocal",value:function(t,n){return e.pointToLocalFrame(this.position,this.quaternion,t,n)}},{key:"pointToWorld",value:function(t,n){return e.pointToWorldFrame(this.position,this.quaternion,t,n)}},{key:"vectorToWorldFrame",value:function(e,t){return void 0===t&&(t=new Iz),this.quaternion.vmult(e,t),t}}],[{key:"pointToLocalFrame",value:function(e,t,n,i){return void 0===i&&(i=new Iz),n.vsub(e,i),t.conjugate(Bz),Bz.vmult(i,i),i}},{key:"pointToWorldFrame",value:function(e,t,n,i){return void 0===i&&(i=new Iz),t.vmult(n,i),i.vadd(e,i),i}},{key:"vectorToWorldFrame",value:function(e,t,n){return void 0===n&&(n=new Iz),e.vmult(t,n),n}},{key:"vectorToLocalFrame",value:function(e,t,n,i){return void 0===i&&(i=new Iz),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}]),e}(),Bz=new fz;new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new fz,new Az,new uz,new uz,new uz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new fz,new Iz,new Iz,new Iz,new Iz;var Zz=function(){function e(){di(this,e),this.rayFromWorld=new Iz,this.rayToWorld=new Iz,this.hitNormalWorld=new Iz,this.hitPointWorld=new Iz,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}return Ai(e,[{key:"reset",value:function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}},{key:"abort",value:function(){this.shouldStop=!0}},{key:"set",value:function(e,t,n,i,r,a,o){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=a,this.distance=o}}]),e}(),wz=1,Sz=2,Wz=4,xz=function(e,t,n,i,r,a,o){function s(e,t){di(this,s),void 0===e&&(e=new Iz),void 0===t&&(t=new Iz),this.from=e.clone(),this.to=t.clone(),this.direction=new Iz,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=s.ANY,this.result=new Zz,this.hasHit=!1,this.callback=function(e){}}return Ai(s,[{key:e,get:function(){return this._intersectSphere}},{key:t,get:function(){return this._intersectPlane}},{key:n,get:function(){return this._intersectBox}},{key:i,get:function(){return this._intersectConvex}},{key:r,get:function(){return this._intersectConvex}},{key:a,get:function(){return this._intersectHeightfield}},{key:o,get:function(){return this._intersectTrimesh}},{key:"intersectWorld",value:function(e,t){return this.mode=t.mode||s.ANY,this.result=t.result||new Zz,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask="undefined"!==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!==typeof t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse="undefined"===typeof t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(Rz),Vz.length=0,e.broadphase.aabbQuery(e,Rz,Vz),this.intersectBodies(Vz),this.hasHit}},{key:"intersectBody",value:function(e,t){t&&(this.result=t,this.updateDirection());var n=this.checkCollisionResponse;if((!n||e.collisionResponse)&&0!==(this.collisionFilterGroup&e.collisionFilterMask)&&0!==(e.collisionFilterGroup&this.collisionFilterMask))for(var i=Yz,r=Hz,a=0,o=e.shapes.length;a<o;a++){var s=e.shapes[a];if((!n||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[a],r),e.quaternion.vmult(e.shapeOffsets[a],i),i.vadd(e.position,i),this.intersectShape(s,r,i,e),this.result.shouldStop))break}}},{key:"intersectBodies",value:function(e,t){t&&(this.result=t,this.updateDirection());for(var n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}},{key:"updateDirection",value:function(){this.to.vsub(this.from,this.direction),this.direction.normalize()}},{key:"intersectShape",value:function(e,t,n,i){var r=function(e,t,n){n.vsub(e,nL);var i=nL.dot(t);return t.scale(i,iL),iL.vadd(e,iL),n.distanceTo(iL)}(this.from,this.direction,n);if(!(r>e.boundingSphereRadius)){var a=this[e.type];a&&a.call(this,e,t,n,i,e)}}},{key:"_intersectBox",value:function(e,t,n,i,r){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,r)}},{key:"_intersectPlane",value:function(e,t,n,i,r){var a=this.from,o=this.to,s=this.direction,g=new Iz(0,0,1);t.vmult(g,g);var l=new Iz;a.vsub(n,l);var u=l.dot(g);if(o.vsub(n,l),!(u*l.dot(g)>0)&&!(a.distanceTo(o)<u)){var c=g.dot(s);if(!(Math.abs(c)<this.precision)){var I=new Iz,C=new Iz,d=new Iz;a.vsub(n,I);var h=-g.dot(I)/c;s.scale(h,C),a.vadd(C,d),this.reportIntersection(g,d,r,i,-1)}}}},{key:"getAABB",value:function(e){var t=e.lowerBound,n=e.upperBound,i=this.to,r=this.from;t.x=Math.min(i.x,r.x),t.y=Math.min(i.y,r.y),t.z=Math.min(i.z,r.z),n.x=Math.max(i.x,r.x),n.y=Math.max(i.y,r.y),n.z=Math.max(i.z,r.z)}},{key:"_intersectHeightfield",value:function(e,t,n,i,r){e.data,e.elementSize;var a=_z;a.from.copy(this.from),a.to.copy(this.to),Gz.pointToLocalFrame(n,t,a.from,a.from),Gz.pointToLocalFrame(n,t,a.to,a.to),a.updateDirection();var o,s,g,l,u=Tz;o=s=0,g=l=e.data.length-1;var c=new Az;a.getAABB(c),e.getIndexOfPosition(c.lowerBound.x,c.lowerBound.y,u,!0),o=Math.max(o,u[0]),s=Math.max(s,u[1]),e.getIndexOfPosition(c.upperBound.x,c.upperBound.y,u,!0),g=Math.min(g,u[0]+1),l=Math.min(l,u[1]+1);for(var I=o;I<g;I++)for(var C=s;C<l;C++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(I,C,c),c.overlapsRay(a)){if(e.getConvexTrianglePillar(I,C,!1),Gz.pointToWorldFrame(n,t,e.pillarOffset,Lz),this._intersectConvex(e.pillarConvex,t,Lz,i,r,zz),this.result.shouldStop)return;e.getConvexTrianglePillar(I,C,!0),Gz.pointToWorldFrame(n,t,e.pillarOffset,Lz),this._intersectConvex(e.pillarConvex,t,Lz,i,r,zz)}}}},{key:"_intersectSphere",value:function(e,t,n,i,r){var a=this.from,o=this.to,s=e.radius,g=Math.pow(o.x-a.x,2)+Math.pow(o.y-a.y,2)+Math.pow(o.z-a.z,2),l=2*((o.x-a.x)*(a.x-n.x)+(o.y-a.y)*(a.y-n.y)+(o.z-a.z)*(a.z-n.z)),u=Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2)+Math.pow(a.z-n.z,2)-Math.pow(s,2),c=Math.pow(l,2)-4*g*u,I=Ez,C=Jz;if(!(c<0))if(0===c)a.lerp(o,c,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,r,i,-1);else{var d=(-l-Math.sqrt(c))/(2*g),h=(-l+Math.sqrt(c))/(2*g);if(d>=0&&d<=1&&(a.lerp(o,d,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,r,i,-1)),this.result.shouldStop)return;h>=0&&h<=1&&(a.lerp(o,h,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,r,i,-1))}}},{key:"_intersectConvex",value:function(e,t,n,i,r,a){for(var o=Dz,g=Uz,l=a&&a.faceList||null,u=e.faces,c=e.vertices,I=e.faceNormals,C=this.direction,d=this.from,h=this.to,A=d.distanceTo(h),p=l?l.length:u.length,m=this.result,f=0;!m.shouldStop&&f<p;f++){var v=l?l[f]:f,b=u[v],y=I[v],G=t,B=n;g.copy(c[b[0]]),G.vmult(g,g),g.vadd(B,g),g.vsub(d,g),G.vmult(y,o);var Z=C.dot(o);if(!(Math.abs(Z)<this.precision)){var w=o.dot(g)/Z;if(!(w<0)){C.scale(w,Fz),Fz.vadd(d,Fz),Mz.copy(c[b[0]]),G.vmult(Mz,Mz),B.vadd(Mz,Mz);for(var S=1;!m.shouldStop&&S<b.length-1;S++){Kz.copy(c[b[S]]),Nz.copy(c[b[S+1]]),G.vmult(Kz,Kz),G.vmult(Nz,Nz),B.vadd(Kz,Kz),B.vadd(Nz,Nz);var W=Fz.distanceTo(d);!s.pointInTriangle(Fz,Mz,Kz,Nz)&&!s.pointInTriangle(Fz,Kz,Mz,Nz)||W>A||this.reportIntersection(o,Fz,r,i,v)}}}}}},{key:"_intersectTrimesh",value:function(e,t,n,i,r,a){var o=Pz,g=eL,l=tL,u=Uz,c=Qz,I=Oz,C=jz,d=$z,h=qz,A=e.indices;e.vertices;var p=this.from,m=this.to,f=this.direction;l.position.copy(n),l.quaternion.copy(t),Gz.vectorToLocalFrame(n,t,f,c),Gz.pointToLocalFrame(n,t,p,I),Gz.pointToLocalFrame(n,t,m,C),C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,I.x*=e.scale.x,I.y*=e.scale.y,I.z*=e.scale.z,C.vsub(I,c),c.normalize();var v=I.distanceSquared(C);e.tree.rayQuery(this,l,g);for(var b=0,y=g.length;!this.result.shouldStop&&b!==y;b++){var G=g[b];e.getNormal(G,o),e.getVertex(A[3*G],Mz),Mz.vsub(I,u);var B=c.dot(o),Z=o.dot(u)/B;if(!(Z<0)){c.scale(Z,Fz),Fz.vadd(I,Fz),e.getVertex(A[3*G+1],Kz),e.getVertex(A[3*G+2],Nz);var w=Fz.distanceSquared(I);!s.pointInTriangle(Fz,Kz,Mz,Nz)&&!s.pointInTriangle(Fz,Mz,Kz,Nz)||w>v||(Gz.vectorToWorldFrame(t,o,h),Gz.pointToWorldFrame(n,t,Fz,d),this.reportIntersection(h,d,r,i,G))}}g.length=0}},{key:"reportIntersection",value:function(e,t,n,i,r){var a=this.from,o=this.to,g=a.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex="undefined"!==typeof r?r:-1,this.mode){case s.ALL:this.hasHit=!0,l.set(a,o,e,t,n,i,g),l.hasHit=!0,this.callback(l);break;case s.CLOSEST:(g<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(a,o,e,t,n,i,g));break;case s.ANY:this.hasHit=!0,l.hasHit=!0,l.set(a,o,e,t,n,i,g),l.shouldStop=!0}}}],[{key:"pointInTriangle",value:function(e,t,n,i){i.vsub(t,nL),n.vsub(t,kz),e.vsub(t,Xz);var r,a,o=nL.dot(nL),s=nL.dot(kz),g=nL.dot(Xz),l=kz.dot(kz),u=kz.dot(Xz);return(r=l*g-s*u)>=0&&(a=o*u-s*g)>=0&&r+a<o*l-s*s}}]),s}(yz.types.SPHERE,yz.types.PLANE,yz.types.BOX,yz.types.CYLINDER,yz.types.CONVEXPOLYHEDRON,yz.types.HEIGHTFIELD,yz.types.TRIMESH);xz.CLOSEST=wz,xz.ANY=Sz,xz.ALL=Wz;var Rz=new Az,Vz=[],kz=new Iz,Xz=new Iz,Yz=new Iz,Hz=new fz,Fz=new Iz,Mz=new Iz,Kz=new Iz,Nz=new Iz;new Iz,new Zz;var zz={faceList:[0]},Lz=new Iz,_z=new xz,Tz=[],Ez=new Iz,Jz=new Iz,Dz=new Iz;new Iz,new Iz;var Uz=new Iz,Pz=new Iz,Qz=new Iz,Oz=new Iz,jz=new Iz,qz=new Iz,$z=new Iz;new Az;var eL=[],tL=new Gz,nL=new Iz,iL=new Iz;new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new xz,new Iz,new Iz,new Iz,new Iz(1,0,0),new Iz(0,1,0),new Iz(0,0,1),new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Az,new Iz,new Az,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Az,new Iz,new Gz,new Az,yz.types.SPHERE,yz.types.SPHERE,yz.types.PLANE,yz.types.BOX,yz.types.BOX,yz.types.SPHERE,yz.types.BOX,yz.types.PLANE,yz.types.BOX,yz.types.CONVEXPOLYHEDRON,yz.types.SPHERE,yz.types.CONVEXPOLYHEDRON,yz.types.PLANE,yz.types.CONVEXPOLYHEDRON,yz.types.BOX,yz.types.CONVEXPOLYHEDRON,yz.types.SPHERE,yz.types.HEIGHTFIELD,yz.types.BOX,yz.types.HEIGHTFIELD,yz.types.CONVEXPOLYHEDRON,yz.types.HEIGHTFIELD,yz.types.PARTICLE,yz.types.SPHERE,yz.types.PLANE,yz.types.PARTICLE,yz.types.BOX,yz.types.PARTICLE,yz.types.PARTICLE,yz.types.CONVEXPOLYHEDRON,yz.types.CYLINDER,yz.types.SPHERE,yz.types.CYLINDER,yz.types.PLANE,yz.types.CYLINDER,yz.types.BOX,yz.types.CYLINDER,yz.types.CONVEXPOLYHEDRON,yz.types.CYLINDER,yz.types.HEIGHTFIELD,yz.types.CYLINDER,yz.types.PARTICLE,yz.types.CYLINDER,yz.types.SPHERE,yz.types.TRIMESH,yz.types.PLANE,yz.types.TRIMESH,new Iz,new Iz,new Iz,new Iz,new Iz,new fz,new fz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Az,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new fz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Iz,new Az,new xz;var rL=globalThis.performance||{};if(!rL.now){var aL=Date.now();rL.timing&&rL.timing.navigationStart&&(aL=rL.timing.navigationStart),rL.now=function(){return Date.now()-aL}}new Iz;var oL=(0,t.createContext)(null),sL=(0,t.createContext)(null),gL=function(){var e=(0,t.useContext)(sL);if(!e)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return e};new MZ,new KZ(1,1,1),new KZ,new hw;var lL=new zw;function uL(e){var n=(0,t.useRef)(null);return e&&"function"!==typeof e?e:n}function cL(e){return e.charAt(0).toUpperCase()+e.slice(1)}function IL(e,t){var n=void 0===t?"":"/".concat(t);return"function"===typeof e?null:e&&e.current&&"".concat(e.current.uuid).concat(n)}var CL=new Zw,dL=new MZ,hL=0;function AL(e,t,n,i,r,a){return void 0===a&&(a="bodies"),function(o){var s=hL++;n[s]=Eo({},i,o);var g=IL(e,r);return g&&t.subscribe({props:{id:s,target:a,type:i},uuid:g}),function(){delete n[s],t.unsubscribe({props:s})}}}function pL(e,t){var n,i,r=t.position,a=void 0===r?[0,0,0]:r,o=t.rotation,s=void 0===o?[0,0,0]:o,g=t.userData,l=void 0===g?{}:g;e.userData=l,(n=e.position).set.apply(n,Ci(a)),(i=e.rotation).set.apply(i,Ci(s)),e.updateMatrix()}function mL(e,t,n){var i=t.onCollide,r=t.onCollideBegin,a=t.onCollideEnd;e[n]={collide:i,collideBegin:r,collideEnd:a}}function fL(e,n,i,r,a){void 0===r&&(r=null),void 0===a&&(a=[]);var o=uL(r),s=gL(),g=s.events,l=s.refs,u=s.scaleOverrides,c=s.subscriptions,I=s.worker,C=(0,t.useContext)(oL);(0,t.useLayoutEffect)((function(){o.current||(o.current=new zw);var t=o.current,r=I,a=t instanceof SV?(t.instanceMatrix.setUsage(MB),t.count):1,s=t instanceof SV?new Array(a).fill(0).map((function(e,n){return"".concat(t.uuid,"/").concat(n)})):[t.uuid],u=t instanceof SV?s.map((function(r,a){var o=n(a);return pL(lL,o),t.setMatrixAt(a,lL.matrix),t.instanceMatrix.needsUpdate=!0,l[r]=t,null==C||C.add(r,o,e),mL(g,o,r),Vb(Vb({},o),{},{args:i(o.args)})})):s.map((function(r,a){var o=n(a);return pL(t,o),l[r]=t,null==C||C.add(r,o,e),mL(g,o,r),Vb(Vb({},o),{},{args:i(o.args)})}));return r.addBodies({props:u.map((function(e){var t=e.onCollide,n=(e.onCollideBegin,e.onCollideEnd,kb(e,dK));return Vb({onCollide:Boolean(t)},n)})),type:e,uuid:s}),function(){s.forEach((function(e){delete l[e],null==C||C.remove(e),delete g[e]})),r.removeBodies({uuid:s})}}),a);var d=(0,t.useMemo)((function(){var e=function(e,t){var n="set".concat(cL(e));return{set:function(e){var i=IL(o,t);i&&I[n]({props:e,uuid:i})},subscribe:AL(o,I,c,e,t)}},t=function(e){return{copy:function(t){var n=t.w,i=t.x,r=t.y,a=t.z,s=IL(o,e);s&&I.setQuaternion({props:[i,r,a,n],uuid:s})},set:function(t,n,i,r){var a=IL(o,e);a&&I.setQuaternion({props:[t,n,i,r],uuid:a})},subscribe:AL(o,I,c,"quaternion",e)}},n=function(e){return{copy:function(t){var n=t.x,i=t.y,r=t.z,a=IL(o,e);a&&I.setRotation({props:[n,i,r],uuid:a})},set:function(t,n,i){var r=IL(o,e);r&&I.setRotation({props:[t,n,i],uuid:r})},subscribe:function(t){var n=hL++,i="quaternion",r=IL(o,e);return c[n]=Eo({},i,function(e){return function(t){return e(CL.setFromQuaternion(dL.fromArray(t)).toArray())}}(t)),r&&I.subscribe({props:{id:n,target:"bodies",type:i},uuid:r}),function(){delete c[n],I.unsubscribe({props:n})}}}},i=function(e,t){var n="set".concat(cL(e));return{copy:function(e){var i=e.x,r=e.y,a=e.z,s=IL(o,t);s&&I[n]({props:[i,r,a],uuid:s})},set:function(e,i,r){var a=IL(o,t);a&&I[n]({props:[e,i,r],uuid:a})},subscribe:AL(o,I,c,e,t)}};function r(r){return{allowSleep:e("allowSleep",r),angularDamping:e("angularDamping",r),angularFactor:i("angularFactor",r),angularVelocity:i("angularVelocity",r),applyForce:function(e,t){var n=IL(o,r);n&&I.applyForce({props:[e,t],uuid:n})},applyImpulse:function(e,t){var n=IL(o,r);n&&I.applyImpulse({props:[e,t],uuid:n})},applyLocalForce:function(e,t){var n=IL(o,r);n&&I.applyLocalForce({props:[e,t],uuid:n})},applyLocalImpulse:function(e,t){var n=IL(o,r);n&&I.applyLocalImpulse({props:[e,t],uuid:n})},applyTorque:function(e){var t=IL(o,r);t&&I.applyTorque({props:[e],uuid:t})},collisionFilterGroup:e("collisionFilterGroup",r),collisionFilterMask:e("collisionFilterMask",r),collisionResponse:e("collisionResponse",r),fixedRotation:e("fixedRotation",r),isTrigger:e("isTrigger",r),linearDamping:e("linearDamping",r),linearFactor:i("linearFactor",r),mass:e("mass",r),material:e("material",r),position:i("position",r),quaternion:t(r),rotation:n(r),scaleOverride:function(e){var t=IL(o,r);t&&(u[t]=Ui(KZ,Ci(e)))},sleep:function(){var e=IL(o,r);e&&I.sleep({uuid:e})},sleepSpeedLimit:e("sleepSpeedLimit",r),sleepTimeLimit:e("sleepTimeLimit",r),userData:e("userData",r),velocity:i("velocity",r),wakeUp:function(){var e=IL(o,r);e&&I.wakeUp({uuid:e})}}}var a={};return Vb(Vb({},r(void 0)),{},{at:function(e){return a[e]||(a[e]=r(e))}})}),[]);return[o,d]}var vL=new KZ,bL=new KZ(1,1,1),yL=new MZ,GL=new hw;function BL(e,t,n,i,r){return void 0===i&&(i=bL),void 0!==e?(GL.compose(vL.fromArray(t,3*e),yL.fromArray(n,4*e),i),r&&(r.matrixAutoUpdate=!1,r.matrix.copy(GL)),GL):GL.identity()}function ZL(e){var n=e.allowSleep,i=void 0!==n&&n,r=e.axisIndex,a=void 0===r?0:r,o=e.broadphase,s=void 0===o?"Naive":o,g=e.children,l=e.defaultContactMaterial,u=void 0===l?{contactEquationStiffness:1e6}:l,c=e.gravity,I=void 0===c?[0,-9.81,0]:c,C=e.isPaused,d=void 0!==C&&C,h=e.iterations,A=void 0===h?5:h,p=e.maxSubSteps,m=void 0===p?10:p,f=e.quatNormalizeFast,v=void 0!==f&&f,b=e.quatNormalizeSkip,y=void 0===b?0:b,G=e.shouldInvalidate,B=void 0===G||G,Z=e.size,w=void 0===Z?1e3:Z,S=e.solver,W=void 0===S?"GS":S,x=e.stepSize,R=void 0===x?1/60:x,V=e.tolerance,k=void 0===V?.001:V,X=vM().invalidate,Y=Ir((0,t.useState)((function(){return{bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new MK({allowSleep:i,axisIndex:a,broadphase:s,defaultContactMaterial:u,gravity:I,iterations:A,quatNormalizeFast:v,quatNormalizeSkip:y,size:w,solver:W,tolerance:k})}})),1)[0],H=Y.bodies,F=Y.events,M=Y.refs,K=Y.scaleOverrides,N=Y.subscriptions,z=Y.worker,L=0,_=(0,t.useCallback)((function(e,t){d||(L+=t,z.step({maxSubSteps:m,stepSize:R,timeSinceLastCalled:L}),L=0)}),[d,m,R]),T=function(e){var t,n=e.body,i=e.contact,r=i.bi,a=i.bj,o=kb(i,hK),s=e.target,g=kb(e,AK),l=null==(t=F[s])?void 0:t.collide;l&&l(Vb({body:M[n],contact:Vb({bi:M[r],bj:M[a]},o),target:M[s]},g))},E=function(e){var t,n,i=e.bodyA,r=e.bodyB,a=null==(t=F[i])?void 0:t.collideBegin;a&&a({body:M[r],op:"event",target:M[i],type:"collideBegin"});var o=null==(n=F[r])?void 0:n.collideBegin;o&&o({body:M[i],op:"event",target:M[r],type:"collideBegin"})},J=function(e){var t,n,i=e.bodyA,r=e.bodyB,a=null==(t=F[i])?void 0:t.collideEnd;a&&a({body:M[r],op:"event",target:M[i],type:"collideEnd"});var o=null==(n=F[r])?void 0:n.collideEnd;o&&o({body:M[i],op:"event",target:M[r],type:"collideEnd"})},D=function(e){for(var t=e.active,n=e.bodies,i=void 0===n?[]:n,r=e.observations,a=e.positions,o=e.quaternions,s=0;s<i.length;s++)H[i[s]]=s;if(r.forEach((function(e){var t=Ir(e,3),n=t[0],i=t[1],r=t[2],a=(N[n]||{})[r];a&&a(i)})),t){for(var g=0,l=Object.values(M);g<l.length;g++){var u=l[g];if(u instanceof SV)for(var c=0;c<u.count;c++){var I="".concat(u.uuid,"/").concat(c),C=H[I];void 0!==C&&(u.setMatrixAt(c,BL(C,a,o,K[I])),u.instanceMatrix.needsUpdate=!0)}else{var d=K[u.uuid]||u.scale;BL(H[u.uuid],a,o,d,u)}}B&&X()}},U=function(e){var t,n=e.body,i=e.ray,r=i.uuid,a=kb(i,pK),o=kb(e,mK),s=null==(t=F[r])?void 0:t.rayhit;s&&s(Vb({body:n?M[n]:null,ray:Vb({uuid:r},a)},o))};bM(_),(0,t.useEffect)((function(){return z.connect(),z.init(),z.on("collide",T),z.on("collideBegin",E),z.on("collideEnd",J),z.on("frame",D),z.on("rayhit",U),function(){z.terminate(),z.removeAllListeners()}}),[]),(0,t.useEffect)((function(){z.axisIndex=a}),[a]),(0,t.useEffect)((function(){z.broadphase=s}),[s]),(0,t.useEffect)((function(){z.gravity=I}),[I]),(0,t.useEffect)((function(){z.iterations=A}),[A]),(0,t.useEffect)((function(){z.tolerance=k}),[k]);var P=(0,t.useMemo)((function(){return{bodies:H,events:F,refs:M,scaleOverrides:K,subscriptions:N,worker:z}}),[H,F,M,N,z]);return(0,Kl.jsx)(sL.Provider,{value:P,children:g})}var wL=function(e){return e===Object(e)&&!Array.isArray(e)&&"function"!==typeof e};function SL(e,n){var i=vM((function(e){return e.gl})),r=GM(iY,wL(e)?Object.values(e):e);if((0,t.useLayoutEffect)((function(){null==n||n(r)}),[n]),(0,t.useEffect)((function(){(Array.isArray(r)?r:[r]).forEach(i.initTexture)}),[i,r]),wL(e)){var a=Object.keys(e),o={};return a.forEach((function(e){return Object.assign(o,Eo({},e,r[a.indexOf(e)]))})),o}return r}SL.preload=function(e){return GM.preload(iY,e)},SL.clear=function(e){return GM.clear(iY,e)};var WL=["args","radius","steps","smoothness","children"],xL=1e-5;var RL=t.forwardRef((function(e,n){var i=e.args,r=Ir(i=void 0===i?[]:i,3),a=r[0],o=void 0===a?1:a,s=r[1],g=void 0===s?1:s,l=r[2],u=void 0===l?1:l,c=e.radius,I=void 0===c?.05:c,C=e.steps,d=void 0===C?1:C,h=e.smoothness,A=void 0===h?4:h,p=e.children,m=kb(e,WL),f=t.useMemo((function(){return function(e,t,n){var i=new Rk,r=n-xL;return i.absarc(xL,xL,xL,-Math.PI/2,-Math.PI,!0),i.absarc(xL,t-2*r,xL,Math.PI,Math.PI/2,!0),i.absarc(e-2*r,t-2*r,xL,Math.PI/2,0,!0),i.absarc(e-2*r,xL,xL,0,-Math.PI/2,!0),i}(o,g,I)}),[o,g,I]),v=t.useMemo((function(){return{depth:u-2*I,bevelEnabled:!0,bevelSegments:2*A,steps:d,bevelSize:I-xL,bevelThickness:I,curveSegments:A}}),[u,I,A]),b=t.useRef();return t.useLayoutEffect((function(){b.current&&b.current.center()}),[f,v]),t.createElement("mesh",oa({ref:n},m),t.createElement("extrudeGeometry",{ref:b,args:[f,v]}),p)})),VL=["children","transparent","opacity","color","args","map"],kL=(0,t.forwardRef)((function(e,t){var n=e.children,i=e.transparent,r=void 0!==i&&i,a=e.opacity,o=void 0===a?1:a,s=e.color,g=void 0===s?"white":s,l=e.args,u=void 0===l?[1,1,1]:l,c=e.map,I=kb(e,VL);return(0,Kl.jsxs)(RL,Vb(Vb({args:u,receiveShadow:!0,castShadow:!0,ref:t},I),{},{children:[(0,Kl.jsx)(jM,{color:g,transparent:r,opacity:o,map:c}),n]}))})),XL=kL;function YL(e){var t=SL({map:"/metal/Metal038_2K_Color.jpg",displacementMap:"/metal/Metal038_2K_Displacement.jpg",normalMap:"/metal/Metal038_2K_NormalGL.jpg",roughnessMap:"/metal/Metal038_2K_Roughness.jpg",metalness:"/metal/Metal038_2K_Metalness.jpg"});return(0,Kl.jsx)(XL,Vb(Vb(Vb({},e),{},{blur:[300,300],resolution:1024,mixBlur:1,mixStrength:40,roughness:1,depthScale:1.2,minDepthThreshold:.4,maxDepthThreshold:1.4,metalness:.5},t),{},{scale:[.3,3.6,.3]}))}function HL(){var e,t,n=SL({map:"/wood/color.jpg",displacementMap:"/wood/displacement.jpg",normalMap:"/wood/normalGL.jpg",roughnessMap:"/wood/roughness.jpg"}),i=Ir(fL("Compound",(function(){return{shapes:[{type:"Box",position:[0,1,0],args:[5,.5,5]},{type:"Box",position:[2,-1,2.5],args:[.5,3.5,.5]},{type:"Box",position:[-2,-1,-2.5],args:[.5,3.5,.5]},{type:"Box",position:[2,-1,-2.5],args:[.5,3.5,.5]},{type:"Box",position:[-2,-1,2.5],args:[.5,3.5,.5]}]}}),(function(e){return e}),e,t),1)[0];return(0,Kl.jsxs)("group",{ref:i,children:[(0,Kl.jsx)(XL,Vb(Vb({},n),{},{displacement:!0,scale:[5,.25,10],position:[0,1.1,0]})),(0,Kl.jsx)(YL,{position:[-2,-.7,4]}),(0,Kl.jsx)(YL,{position:[-2,-.7,-4]}),(0,Kl.jsx)(YL,{position:[2,-.7,-4]}),(0,Kl.jsx)(YL,{position:[2,-.7,4]})]})}var FL,ML=new WeakMap,KL=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,e)).decoderPath="",i.decoderConfig={},i.decoderBinary=null,i.decoderPending=null,i.workerLimit=4,i.workerPool=[],i.workerNextTaskID=1,i.workerSourceURL="",i.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},i.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},i}return Ai(n,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,i){var r=this,a=new jX(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){var n={attributeIDs:r.defaultAttributeIDs,attributeTypes:r.defaultAttributeTypes,useUniqueIDs:!1};r.decodeGeometry(e,n).then(t).catch(i)}),n,i)}},{key:"decodeDracoFile",value:function(e,t,n,i){var r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,r).then(t)}},{key:"decodeGeometry",value:function(e,t){var n=this;for(var i in t.attributeTypes){var r=t.attributeTypes[i];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[i]=r.name)}var a,o=JSON.stringify(t);if(ML.has(e)){var s=ML.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var g=this.workerNextTaskID++,l=e.byteLength,u=this._getWorker(g,l).then((function(n){return a=n,new Promise((function(n,i){a._callbacks[g]={resolve:n,reject:i},a.postMessage({type:"decode",id:g,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return u.catch((function(){return!0})).then((function(){a&&g&&n._releaseTask(a,g)})),ML.set(e,{key:o,promise:u}),u}},{key:"_createGeometry",value:function(e){var t=new bS;e.index&&t.setIndex(new iS(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],r=i.name,a=i.array,o=i.itemSize;t.setAttribute(r,new iS(a,o))}return t}},{key:"_loadLibrary",value:function(e,t){var n=new jX(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,i){n.load(e,t,void 0,i)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var i=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var r=NL.toString(),a=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var i=new Worker(n.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:n.decoderConfig}),i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":i._callbacks[t.id].resolve(t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(i)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var r=n.workerPool[n.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),n}(QX);function NL(){var e,t;function n(e,t,n,i,r,a){var o=a.num_components(),s=n.num_points()*o,g=s*r.BYTES_PER_ELEMENT,l=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),u=e._malloc(g);t.GetAttributeDataArrayForAllPoints(n,a,l,g,u);var c=new r(e.HEAPF32.buffer,u,s).slice();return e._free(u),{name:i,array:c,itemSize:o}}onmessage=function(i){var r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=r.buffer,o=r.taskConfig;t.then((function(e){var t=e.draco,i=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var g=function(e,t,i,r){var a,o,s=r.attributeIDs,g=r.attributeTypes,l=t.GetEncodedGeometryType(i);if(l===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(i,a);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(i,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var u={index:null,attributes:[]};for(var c in s){var I=self[g[c]],C=void 0,d=void 0;if(r.useUniqueIDs)d=s[c],C=t.GetAttributeByUniqueId(a,d);else{if(-1===(d=t.GetAttributeId(a,e[s[c]])))continue;C=t.GetAttribute(a,d)}u.attributes.push(n(e,t,a,c,I,C))}l===e.TRIANGULAR_MESH&&(u.index=function(e,t,n){var i=3*n.num_faces(),r=4*i,a=e._malloc(r);t.GetTrianglesUInt32Array(n,r,a);var o=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:o,itemSize:1}}(e,t,a));return e.destroy(a),u}(t,i,s,o),l=g.attributes.map((function(e){return e.array.buffer}));g.index&&l.push(g.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:g},l)}catch(u){console.error(u),self.postMessage({type:"error",id:r.id,error:u.message})}finally{t.destroy(s),t.destroy(i)}}))}}}var zL=function(){if(FL)return FL;var e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!==typeof WebAssembly)return{supported:!1};var n,i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(e)&&(i="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB");var r=WebAssembly.instantiate(function(e){for(var n=new Uint8Array(e.length),i=0;i<e.length;++i){var r=e.charCodeAt(i);n[i]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}for(var a=0,o=0;o<e.length;++o)n[a++]=n[o]<60?t[n[o]]:64*(n[o]-60)+n[++o];return n.buffer.slice(0,a)}(i),{}).then((function(e){(n=e.instance).exports.__wasm_call_ctors()}));function a(e,t,i,r,a,o){var s=n.exports.sbrk,g=i+3&-4,l=s(g*r),u=s(a.length),c=new Uint8Array(n.exports.memory.buffer);c.set(a,u);var I=e(l,i,r,u,a.length);if(0===I&&o&&o(l,g,r),t.set(c.subarray(l,l+i*r)),s(l-s(0)),0!==I)throw new Error("Malformed buffer data: ".concat(I))}var o={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},s={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return FL={ready:r,supported:!0,decodeVertexBuffer:function(e,t,i,r,s){a(n.exports.meshopt_decodeVertexBuffer,e,t,i,r,n.exports[o[s]])},decodeIndexBuffer:function(e,t,i,r){a(n.exports.meshopt_decodeIndexBuffer,e,t,i,r)},decodeIndexSequence:function(e,t,i,r){a(n.exports.meshopt_decodeIndexSequence,e,t,i,r)},decodeGltfBuffer:function(e,t,i,r,g,l){a(n.exports[s[g]],e,t,i,r,n.exports[o[l]])}}},LL=function(e){Li(n,e);var t=Di(n);function n(e){var i;return di(this,n),(i=t.call(this,e)).dracoLoader=null,i.ktx2Loader=null,i.meshoptDecoder=null,i.pluginCallbacks=[],i.register((function(e){return new DL(e)})),i.register((function(e){return new qL(e)})),i.register((function(e){return new $L(e)})),i.register((function(e){return new UL(e)})),i.register((function(e){return new PL(e)})),i.register((function(e){return new QL(e)})),i.register((function(e){return new OL(e)})),i.register((function(e){return new jL(e)})),i.register((function(e){return new EL(e)})),i.register((function(e){return new e_(e)})),i}return Ai(n,[{key:"load",value:function(e,t,n,i){var r,a=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:BY.extractUrlBase(e),this.manager.itemStart(e);var o=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new jX(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{a.parse(n,r,(function(n){t(n),a.manager.itemEnd(e)}),o)}catch(CL){o(CL)}}),n,o)}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(e){return this.ktx2Loader=e,this}},{key:"setMeshoptDecoder",value:function(e){return this.meshoptDecoder=e,this}},{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,n,i){var r,a={},o={};if("string"===typeof e)r=e;else if(BY.decodeText(new Uint8Array(e,0,4))===t_){try{a[TL.KHR_BINARY_GLTF]=new r_(e)}catch(d){return void(i&&i(d))}r=a[TL.KHR_BINARY_GLTF].content}else r=BY.decodeText(new Uint8Array(e));var s=JSON.parse(r);if(void 0===s.asset||s.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var g=new F_(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});g.fileLoader.setRequestHeader(this.requestHeader);for(var l=0;l<this.pluginCallbacks.length;l++){var u=this.pluginCallbacks[l](g);o[u.name]=u,a[u.name]=!0}if(s.extensionsUsed)for(var c=0;c<s.extensionsUsed.length;++c){var I=s.extensionsUsed[c],C=s.extensionsRequired||[];switch(I){case TL.KHR_MATERIALS_UNLIT:a[I]=new JL;break;case TL.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[I]=new g_;break;case TL.KHR_DRACO_MESH_COMPRESSION:a[I]=new a_(s,this.dracoLoader);break;case TL.KHR_TEXTURE_TRANSFORM:a[I]=new o_;break;case TL.KHR_MESH_QUANTIZATION:a[I]=new l_;break;default:C.indexOf(I)>=0&&void 0===o[I]&&console.warn('THREE.GLTFLoader: Unknown extension "'+I+'".')}}g.setExtensions(a),g.setPlugins(o),g.parse(n,i)}}},{key:"parseAsync",value:function(e,t){var n=this;return new Promise((function(i,r){n.parse(e,t,i,r)}))}}]),n}(QX);function _L(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var TL={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},EL=function(){function e(t){di(this,e),this.parser=t,this.name=TL.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return Ai(e,[{key:"_markDefs",value:function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,i=t.length;n<i;n++){var r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}},{key:"_loadLight",value:function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var r,a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],s=new BZ(16777215);void 0!==o.color&&s.fromArray(o.color);var g=void 0!==o.range?o.range:0;switch(o.type){case"directional":(r=new mY(s)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new AY(s)).distance=g;break;case"spot":(r=new cY(s)).distance=g,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,r.angle=o.spot.outerConeAngle,r.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return r.position.set(0,0,0),r.decay=2,void 0!==o.intensity&&(r.intensity=o.intensity),r.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(r),t.cache.add(n,i),i}},{key:"createNodeAttachment",value:function(e){var t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}]),e}(),JL=function(){function e(){di(this,e),this.name=TL.KHR_MATERIALS_UNLIT}return Ai(e,[{key:"getMaterialType",value:function(){return eS}},{key:"extendParams",value:function(e,t,n){var i=[];e.color=new BZ(1,1,1),e.opacity=1;var r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var a=r.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(i)}}]),e}(),DL=function(){function e(t){di(this,e),this.parser=t,this.name=TL.KHR_MATERIALS_CLEARCOAT}return Ai(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?GX:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new sZ(o,o)}return Promise.all(r)}}]),e}(),UL=function(){function e(t){di(this,e),this.parser=t,this.name=TL.KHR_MATERIALS_SHEEN}return Ai(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?GX:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[];t.sheenColor=new BZ(0,0,0),t.sheenRoughness=0,t.sheen=1;var a=i.extensions[this.name];return void 0!==a.sheenColorFactor&&t.sheenColor.fromArray(a.sheenColorFactor),void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&r.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture)),void 0!==a.sheenRoughnessTexture&&r.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(r)}}]),e}(),PL=function(){function e(t){di(this,e),this.parser=t,this.name=TL.KHR_MATERIALS_TRANSMISSION}return Ai(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?GX:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}]),e}(),QL=function(){function e(t){di(this,e),this.parser=t,this.name=TL.KHR_MATERIALS_VOLUME}return Ai(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?GX:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||0;var o=a.attenuationColor||[1,1,1];return t.attenuationColor=new BZ(o[0],o[1],o[2]),Promise.all(r)}}]),e}(),OL=function(){function e(t){di(this,e),this.parser=t,this.name=TL.KHR_MATERIALS_IOR}return Ai(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?GX:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}]),e}(),jL=function(){function e(t){di(this,e),this.parser=t,this.name=TL.KHR_MATERIALS_SPECULAR}return Ai(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?GX:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));var o=a.specularColorFactor||[1,1,1];return t.specularColor=new BZ(o[0],o[1],o[2]),void 0!==a.specularColorTexture&&r.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture).then((function(e){e.encoding=IB}))),Promise.all(r)}}]),e}(),qL=function(){function e(t){di(this,e),this.parser=t,this.name=TL.KHR_TEXTURE_BASISU}return Ai(e,[{key:"loadTexture",value:function(e){var t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;var r=i.extensions[this.name],a=n.images[r.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)}}]),e}(),$L=function(){function e(t){di(this,e),this.parser=t,this.name=TL.EXT_TEXTURE_WEBP,this.isSupported=null}return Ai(e,[{key:"loadTexture",value:function(e){var t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;var a=r.extensions[t],o=i.images[a.source],s=n.textureLoader;if(o.uri){var g=n.options.manager.getHandler(o.uri);null!==g&&(s=g)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,o,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}]),e}(),e_=function(){function e(t){di(this,e),this.name=TL.EXT_MESHOPT_COMPRESSION,this.parser=t}return Ai(e,[{key:"loadBufferView",value:function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,a.ready]).then((function(e){var t=i.byteOffset||0,n=i.byteLength||0,r=i.count,o=i.byteStride,s=new ArrayBuffer(r*o),g=new Uint8Array(e[0],t,n);return a.decodeGltfBuffer(new Uint8Array(s),r,o,g,i.mode,i.filter),s}))}return null}}]),e}(),t_="glTF",n_=1313821514,i_=5130562,r_=Ai((function e(t){di(this,e),this.name=TL.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,12);if(this.header={magic:BY.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==t_)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=this.header.length-12,r=new DataView(t,12),a=0;a<i;){var o=r.getUint32(a,!0);a+=4;var s=r.getUint32(a,!0);if(a+=4,s===n_){var g=new Uint8Array(t,12+a,o);this.content=BY.decodeText(g)}else if(s===i_){var l=12+a;this.body=t.slice(l,l+o)}a+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")})),a_=function(){function e(t,n){if(di(this,e),!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=TL.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}return Ai(e,[{key:"decodePrimitive",value:function(e,t){var n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},g={};for(var l in a){var u=B_[l]||l.toLowerCase();o[u]=a[l]}for(var c in e.attributes){var I=B_[c]||c.toLowerCase();if(void 0!==a[c]){var C=n.accessors[e.attributes[c]],d=v_[C.componentType];g[I]=d,s[I]=!0===C.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(var n in e.attributes){var i=e.attributes[n],r=s[n];void 0!==r&&(i.normalized=r)}t(e)}),o,g)}))}))}}]),e}(),o_=function(){function e(){di(this,e),this.name=TL.KHR_TEXTURE_TRANSFORM}return Ai(e,[{key:"extendTexture",value:function(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}]),e}(),s_=function(e){Li(n,e);var t=Di(n);function n(e){var i;di(this,n),(i=t.call(this)).isGLTFSpecularGlossinessMaterial=!0;var r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),g=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),l={specular:{value:(new BZ).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return i._extraUniforms=l,i.onBeforeCompile=function(e){for(var t in l)e.uniforms[t]=l[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",g)},Object.defineProperties(Ni(i),{specular:{get:function(){return l.specular.value},set:function(e){l.specular.value=e}},specularMap:{get:function(){return l.specularMap.value},set:function(e){l.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(e){l.glossiness.value=e}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(e){l.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete i.metalness,delete i.roughness,delete i.metalnessMap,delete i.roughnessMap,i.setValues(e),i}return Ai(n,[{key:"copy",value:function(e){return Rr(_i(n.prototype),"copy",this).call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}]),n}(yX),g_=function(){function e(){di(this,e),this.name=TL.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}return Ai(e,[{key:"getMaterialType",value:function(){return s_}},{key:"extendParams",value:function(e,t,n){var i=t.extensions[this.name];e.color=new BZ(1,1,1),e.opacity=1;var r=[];if(Array.isArray(i.diffuseFactor)){var a=i.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new BZ(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new BZ(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var o=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",o)),r.push(n.assignTexture(e,"specularMap",o))}return Promise.all(r)}},{key:"createMaterial",value:function(e){var t=new s_(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=hB,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}]),e}(),l_=Ai((function e(){di(this,e),this.name=TL.KHR_MESH_QUANTIZATION})),u_=function(e){Li(n,e);var t=Di(n);function n(e,i,r,a){return di(this,n),t.call(this,e,i,r,a)}return Ai(n,[{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i,a=0;a!==i;a++)t[a]=n[r+a];return t}}]),n}(VX);u_.prototype.beforeStart_=u_.prototype.copySampleValue_,u_.prototype.afterEnd_=u_.prototype.copySampleValue_,u_.prototype.interpolate_=function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,g=3*o,l=i-t,u=(n-t)/l,c=u*u,I=c*u,C=e*g,d=C-g,h=-2*I+3*c,A=I-c,p=1-h,m=A-c+u,f=0;f!==o;f++){var v=a[d+f+o],b=a[d+f+s]*l,y=a[C+f+o],G=a[C+f]*l;r[f]=p*v+m*b+h*y+A*G}return r};var c_=new MZ,I_=function(e){Li(n,e);var t=Di(n);function n(){return di(this,n),t.apply(this,arguments)}return Ai(n,[{key:"interpolate_",value:function(e,t,i,r){var a=Rr(_i(n.prototype),"interpolate_",this).call(this,e,t,i,r);return c_.fromArray(a).normalize().toArray(a),a}}]),n}(u_),C_=0,d_=1,h_=2,A_=3,p_=4,m_=5,f_=6,v_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},b_={9728:Dy,9729:jy,9984:Uy,9985:qy,9986:Qy,9987:eG},y_={33071:Ey,33648:Jy,10497:Ty},G_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},B_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Z_={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},w_={CUBICSPLINE:void 0,LINEAR:tB,STEP:eB},S_="OPAQUE",W_="MASK",x_="BLEND";function R_(e,t,n){for(var i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function V_(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function k_(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(var a=0,o=r.length;a<o;a++)e.morphTargetDictionary[r[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function X_(e){var t=e.extensions&&e.extensions[TL.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+Y_(t.attributes):e.indices+":"+Y_(e.attributes)+":"+e.mode}function Y_(e){for(var t="",n=Object.keys(e).sort(),i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function H_(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var F_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};di(this,e),this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new _L,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new VY(this.options.manager):this.textureLoader=new iY(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new jX(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return Ai(e,[{key:"setExtensions",value:function(e){this.extensions=e}},{key:"setPlugins",value:function(e){this.plugins=e}},{key:"parse",value:function(e,t){var n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};R_(r,a,i),V_(a,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)}},{key:"_markDefs",value:function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],i=0,r=t.length;i<r;i++)for(var a=t[i].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var g=0,l=e.length;g<l;g++){var u=e[g];void 0!==u.mesh&&(this._addNodeRef(this.meshCache,u.mesh),void 0!==u.skin&&(n[u.mesh].isSkinnedMesh=!0)),void 0!==u.camera&&this._addNodeRef(this.cameraCache,u.camera)}}},{key:"_addNodeRef",value:function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}},{key:"_getNodeRef",value:function(e,t,n){var i=this;if(e.refs[t]<=1)return n;var r=n.clone();return function e(t,n){var r=i.associations.get(t);null!=r&&i.associations.set(n,r);var a,o=Cr(t.children.entries());try{for(o.s();!(a=o.n()).done;){var s=Ir(a.value,2),g=s[0];e(s[1],n.children[g])}}catch(l){o.e(l)}finally{o.f()}}(n,r),r.name+="_instance_"+e.uses[t]++,r}},{key:"_invokeOne",value:function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var i=e(t[n]);if(i)return i}return null}},{key:"_invokeAll",value:function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],i=0;i<t.length;i++){var r=e(t[i]);r&&n.push(r)}return n}},{key:"getDependency",value:function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}},{key:"getDependencies",value:function(e){var t=this.cache.get(e);if(!t){var n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}},{key:"loadBuffer",value:function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[TL.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,r){n.load(BY.resolveURL(t.uri,i.path),e,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}},{key:"loadBufferView",value:function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}},{key:"loadAccessor",value:function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var r=[];return void 0!==i.bufferView?r.push(this.getDependency("bufferView",i.bufferView)):r.push(null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then((function(e){var r,a,o=e[0],s=G_[i.type],g=v_[i.componentType],l=g.BYTES_PER_ELEMENT,u=l*s,c=i.byteOffset||0,I=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,C=!0===i.normalized;if(I&&I!==u){var d=Math.floor(c/I),h="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+d+":"+i.count,A=t.cache.get(h);A||(r=new g(o,d*I,i.count*I/l),A=new ER(r,I/l),t.cache.add(h,A)),a=new DR(A,s,c%I/l,C)}else r=null===o?new g(i.count*s):new g(o,c,i.count*s),a=new iS(r,s,C);if(void 0!==i.sparse){var p=G_.SCALAR,m=v_[i.sparse.indices.componentType],f=i.sparse.indices.byteOffset||0,v=i.sparse.values.byteOffset||0,b=new m(e[1],f,i.sparse.count*p),y=new g(e[2],v,i.sparse.count*s);null!==o&&(a=new iS(a.array.slice(),a.itemSize,a.normalized));for(var G=0,B=b.length;G<B;G++){var Z=b[G];if(a.setX(Z,y[G*s]),s>=2&&a.setY(Z,y[G*s+1]),s>=3&&a.setZ(Z,y[G*s+2]),s>=4&&a.setW(Z,y[G*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a}))}},{key:"loadTexture",value:function(e){var t=this.json,n=this.options,i=t.textures[e],r=t.images[i.source],a=this.textureLoader;if(r.uri){var o=n.manager.getHandler(r.uri);null!==o&&(a=o)}return this.loadTextureImage(e,r,a)}},{key:"loadTextureImage",value:function(e,t,n){var i=this,r=this.json,a=this.options,o=r.textures[e],s=(t.uri||t.bufferView)+":"+o.sampler;if(this.textureCache[s])return this.textureCache[s];var g=self.URL||self.webkitURL,l=t.uri||"",u=!1;if(void 0!==t.bufferView)l=i.getDependency("bufferView",t.bufferView).then((function(e){u=!0;var n=new Blob([e],{type:t.mimeType});return l=g.createObjectURL(n)}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");var c=Promise.resolve(l).then((function(e){return new Promise((function(t,i){var r=t;!0===n.isImageBitmapLoader&&(r=function(e){var n=new xZ(e);n.needsUpdate=!0,t(n)}),n.load(BY.resolveURL(e,a.path),r,void 0,i)}))})).then((function(t){!0===u&&g.revokeObjectURL(l),t.flipY=!1,o.name&&(t.name=o.name);var n=(r.samplers||{})[o.sampler]||{};return t.magFilter=b_[n.magFilter]||jy,t.minFilter=b_[n.minFilter]||eG,t.wrapS=y_[n.wrapS]||Ty,t.wrapT=y_[n.wrapT]||Ty,i.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",l),null}));return this.textureCache[s]=c,c}},{key:"assignTexture",value:function(e,t,n){var i=this;return this.getDependency("texture",n.index).then((function(r){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[TL.KHR_TEXTURE_TRANSFORM]){var a=void 0!==n.extensions?n.extensions[TL.KHR_TEXTURE_TRANSFORM]:void 0;if(a){var o=i.associations.get(r);r=i.extensions[TL.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),i.associations.set(r,o)}}return e[t]=r,r}))}},{key:"assignFinalMaterial",value:function(e){var t=e.geometry,n=e.material,i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){var o="PointsMaterial:"+n.uuid,s=this.cache.get(o);s||(s=new NV,$w.prototype.copy.call(s,n),s.color.copy(n.color),s.map=n.map,s.sizeAttenuation=!1,this.cache.add(o,s)),n=s}else if(e.isLine){var g="LineBasicMaterial:"+n.uuid,l=this.cache.get(g);l||(l=new WV,$w.prototype.copy.call(l,n),l.color.copy(n.color),this.cache.add(g,l)),n=l}if(i||r||a){var u="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),i&&(u+="derivative-tangents:"),r&&(u+="vertex-colors:"),a&&(u+="flat-shading:");var c=this.cache.get(u);c||(c=n.clone(),r&&(c.vertexColors=!0),a&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(u,c),this.associations.set(c,this.associations.get(n))),n=c}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}},{key:"getMaterialType",value:function(){return yX}},{key:"loadMaterial",value:function(e){var t,n=this,i=this.json,r=this.extensions,a=i.materials[e],o={},s=a.extensions||{},g=[];if(s[TL.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=r[TL.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=l.getMaterialType(),g.push(l.extendParams(o,a,n))}else if(s[TL.KHR_MATERIALS_UNLIT]){var u=r[TL.KHR_MATERIALS_UNLIT];t=u.getMaterialType(),g.push(u.extendParams(o,a,n))}else{var c=a.pbrMetallicRoughness||{};if(o.color=new BZ(1,1,1),o.opacity=1,Array.isArray(c.baseColorFactor)){var I=c.baseColorFactor;o.color.fromArray(I),o.opacity=I[3]}void 0!==c.baseColorTexture&&g.push(n.assignTexture(o,"map",c.baseColorTexture)),o.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,o.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture&&(g.push(n.assignTexture(o,"metalnessMap",c.metallicRoughnessTexture)),g.push(n.assignTexture(o,"roughnessMap",c.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),g.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)}))))}!0===a.doubleSided&&(o.side=Qb);var C=a.alphaMode||S_;if(C===x_?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,C===W_&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==eS&&(g.push(n.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new sZ(1,1),void 0!==a.normalTexture.scale)){var d=a.normalTexture.scale;o.normalScale.set(d,d)}return void 0!==a.occlusionTexture&&t!==eS&&(g.push(n.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==eS&&(o.emissive=(new BZ).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&t!==eS&&g.push(n.assignTexture(o,"emissiveMap",a.emissiveTexture)),Promise.all(g).then((function(){var i;return i=t===s_?r[TL.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new t(o),a.name&&(i.name=a.name),i.map&&(i.map.encoding=IB),i.emissiveMap&&(i.emissiveMap.encoding=IB),V_(i,a),n.associations.set(i,{materials:e}),a.extensions&&R_(r,i,a),i}))}},{key:"createUniqueName",value:function(e){for(var t=gH.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}},{key:"loadGeometries",value:function(e){var t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[TL.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return K_(n,e,t)}))}for(var a=[],o=0,s=e.length;o<s;o++){var g=e[o],l=X_(g),u=i[l];if(u)a.push(u.promise);else{var c=void 0;c=g.extensions&&g.extensions[TL.KHR_DRACO_MESH_COMPRESSION]?r(g):K_(new bS,g,t),i[l]={primitive:g,promise:c},a.push(c)}}return Promise.all(a)}},{key:"loadMesh",value:function(e){for(var t,n=this,i=this.json,r=this.extensions,a=i.meshes[e],o=a.primitives,s=[],g=0,l=o.length;g<l;g++){var u=void 0===o[g].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new yX({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ub})),t.DefaultMaterial):this.getDependency("material",o[g].material);s.push(u)}return s.push(n.loadGeometries(o)),Promise.all(s).then((function(t){for(var i=t.slice(0,t.length-1),s=t[t.length-1],g=[],l=0,u=s.length;l<u;l++){var c=s[l],I=o[l],C=void 0,d=i[l];if(I.mode===p_||I.mode===m_||I.mode===f_||void 0===I.mode)!0!==(C=!0===a.isSkinnedMesh?new AV(c,d):new NS(c,d)).isSkinnedMesh||C.geometry.attributes.skinWeight.normalized||C.normalizeSkinWeights(),I.mode===m_?C.geometry=N_(C.geometry,lB):I.mode===f_&&(C.geometry=N_(C.geometry,uB));else if(I.mode===d_)C=new MV(c,d);else if(I.mode===A_)C=new YV(c,d);else if(I.mode===h_)C=new KV(c,d);else{if(I.mode!==C_)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+I.mode);C=new EV(c,d)}Object.keys(C.geometry.morphAttributes).length>0&&k_(C,a),C.name=n.createUniqueName(a.name||"mesh_"+e),V_(C,a),I.extensions&&R_(r,C,I),n.assignFinalMaterial(C),g.push(C)}for(var h=0,A=g.length;h<A;h++)n.associations.set(g[h],{meshes:e,primitives:h});if(1===g.length)return g[0];var p=new VR;n.associations.set(p,{meshes:e});for(var m=0,f=g.length;m<f;m++)p.add(g[m]);return p}))}},{key:"loadCamera",value:function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new US(oZ.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new pW(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),V_(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}},{key:"loadAnimation",value:function(e){for(var t=this.json.animations[e],n=[],i=[],r=[],a=[],o=[],s=0,g=t.channels.length;s<g;s++){var l=t.channels[s],u=t.samplers[l.sampler],c=l.target,I=void 0!==c.node?c.node:c.id,C=void 0!==t.parameters?t.parameters[u.input]:u.input,d=void 0!==t.parameters?t.parameters[u.output]:u.output;n.push(this.getDependency("node",I)),i.push(this.getDependency("accessor",C)),r.push(this.getDependency("accessor",d)),a.push(u),o.push(c)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(a),Promise.all(o)]).then((function(n){for(var i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],g=[],l=function(e,t){var n=i[e],l=r[e],u=a[e],c=o[e],I=s[e];if(void 0===n)return"continue";n.updateMatrix(),n.matrixAutoUpdate=!0;var C=void 0;switch(Z_[I.path]){case Z_.weights:C=KX;break;case Z_.rotation:C=zX;break;default:C=_X}var d=n.name?n.name:n.uuid,h=void 0!==c.interpolation?w_[c.interpolation]:tB,A=[];Z_[I.path]===Z_.weights?n.traverse((function(e){e.morphTargetInfluences&&A.push(e.name?e.name:e.uuid)})):A.push(d);var p=u.array;if(u.normalized){for(var m=H_(p.constructor),f=new Float32Array(p.length),v=0,b=p.length;v<b;v++)f[v]=p[v]*m;p=f}for(var y=0,G=A.length;y<G;y++){var B=new C(A[y]+"."+Z_[I.path],l.array,p,h);"CUBICSPLINE"===c.interpolation&&(B.createInterpolant=function(e){return new(this instanceof zX?I_:u_)(this.times,this.values,this.getValueSize()/3,e)},B.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),g.push(B)}},u=0,c=i.length;u<c;u++)l(u);var I=t.name?t.name:"animation_"+e;return new TX(I,void 0,g)}))}},{key:"createNodeMesh",value:function(e){var t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}},{key:"loadNode",value:function(e){var t=this.json,n=this.extensions,i=this,r=t.nodes[e],a=r.name?i.createUniqueName(r.name):"";return function(){var t=[],n=i._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==r.camera&&t.push(i.getDependency("camera",r.camera).then((function(e){return i._getNodeRef(i.cameraCache,r.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){var o;if((o=!0===r.isBone?new pV:t.length>1?new VR:1===t.length?t[0]:new zw)!==t[0])for(var s=0,g=t.length;s<g;s++)o.add(t[s]);if(r.name&&(o.userData.name=r.name,o.name=a),V_(o,r),r.extensions&&R_(n,o,r),void 0!==r.matrix){var l=new hw;l.fromArray(r.matrix),o.applyMatrix4(l)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);return i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=e,o}))}},{key:"loadScene",value:function(e){var t=this.json,n=this.extensions,i=this.json.scenes[e],r=this,a=new VR;i.name&&(a.name=r.createUniqueName(i.name)),V_(a,i),i.extensions&&R_(n,a,i);for(var o=i.nodes||[],s=[],g=0,l=o.length;g<l;g++)s.push(M_(o[g],a,t,r));return Promise.all(s).then((function(){return r.associations=function(e){var t,n=new Map,i=Cr(r.associations);try{for(i.s();!(t=i.n()).done;){var a=Ir(t.value,2),o=a[0],s=a[1];(o instanceof $w||o instanceof xZ)&&n.set(o,s)}}catch(g){i.e(g)}finally{i.f()}return e.traverse((function(e){var t=r.associations.get(e);null!=t&&n.set(e,t)})),n}(a),a}))}}]),e}();function M_(e,t,n,i){var r=n.nodes[e];return i.getDependency("node",e).then((function(e){return void 0===r.skin?e:i.getDependency("skin",r.skin).then((function(e){for(var n=[],r=0,a=(t=e).joints.length;r<a;r++)n.push(i.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var i=[],r=[],a=0,o=n.length;a<o;a++){var s=n[a];if(s){i.push(s);var g=new hw;void 0!==t.inverseBindMatrices&&g.fromArray(t.inverseBindMatrices.array,16*a),r.push(g)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new bV(i,r),e.matrixWorld)}})),e}));var t})).then((function(e){t.add(e);var a=[];if(r.children)for(var o=r.children,s=0,g=o.length;s<g;s++){var l=o[s];a.push(M_(l,e,n,i))}return Promise.all(a)}))}function K_(e,t,n){var i=t.attributes,r=[];function a(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(var o in i){var s=B_[o]||o.toLowerCase();s in e.attributes||r.push(a(i[o],s))}if(void 0!==t.indices&&!e.index){var g=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(g)}return V_(e,t),function(e,t,n){var i=t.attributes,r=new LZ;if(void 0!==i.POSITION){var a=n.json.accessors[i.POSITION],o=a.min,s=a.max;if(void 0!==o&&void 0!==s){if(r.set(new KZ(o[0],o[1],o[2]),new KZ(s[0],s[1],s[2])),a.normalized){var g=H_(v_[a.componentType]);r.min.multiplyScalar(g),r.max.multiplyScalar(g)}var l=t.targets;if(void 0!==l){for(var u=new KZ,c=new KZ,I=0,C=l.length;I<C;I++){var d=l[I];if(void 0!==d.POSITION){var h=n.json.accessors[d.POSITION],A=h.min,p=h.max;if(void 0!==A&&void 0!==p){if(c.setX(Math.max(Math.abs(A[0]),Math.abs(p[0]))),c.setY(Math.max(Math.abs(A[1]),Math.abs(p[1]))),c.setZ(Math.max(Math.abs(A[2]),Math.abs(p[2]))),h.normalized){var m=H_(v_[h.componentType]);c.multiplyScalar(m)}u.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(u)}e.boundingBox=r;var f=new ow;r.getCenter(f.center),f.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,n){for(var i=!1,r=!1,a=0,o=t.length;a<o;a++){var s=t[a];if(void 0!==s.POSITION&&(i=!0),void 0!==s.NORMAL&&(r=!0),i&&r)break}if(!i&&!r)return Promise.resolve(e);for(var g=[],l=[],u=0,c=t.length;u<c;u++){var I=t[u];if(i){var C=void 0!==I.POSITION?n.getDependency("accessor",I.POSITION):e.attributes.position;g.push(C)}if(r){var d=void 0!==I.NORMAL?n.getDependency("accessor",I.NORMAL):e.attributes.normal;l.push(d)}}return Promise.all([Promise.all(g),Promise.all(l)]).then((function(t){var n=t[0],a=t[1];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function N_(e,t){var n=e.getIndex();if(null===n){var i=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<r.count;a++)i.push(a);e.setIndex(i),n=e.getIndex()}var o=n.count-2,s=[];if(t===uB)for(var g=1;g<=o;g++)s.push(n.getX(0)),s.push(n.getX(g)),s.push(n.getX(g+1));else for(var l=0;l<o;l++)l%2===0?(s.push(n.getX(l)),s.push(n.getX(l+1)),s.push(n.getX(l+2))):(s.push(n.getX(l+2)),s.push(n.getX(l+1)),s.push(n.getX(l)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(s),u}var z_=null;function L_(e,t,n){return function(i){n&&n(i),e&&(z_||(z_=new KL),z_.setDecoderPath("string"===typeof e?e:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),i.setDRACOLoader(z_)),t&&i.setMeshoptDecoder(zL())}}function __(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0,r=GM(LL,e,L_(t,n,i));return r}function T_(e){var t=Object.assign({},e),n=__("/several_folders/scene.gltf"),i=n.nodes,r=n.materials,a=function(){return Array(5).fill(5).map((function(e,n){return 0===n?(0,Kl.jsx)(Kl.Fragment,{children:(0,Kl.jsx)("mesh",Vb(Vb({},t),{},{position:[0,1.8,.3*n+2.5],geometry:i.folder_LP_nolabel_Folder_nolabel_0.geometry,material:r.Folder_nolabel}))}):(0,Kl.jsx)("mesh",Vb(Vb({},t),{},{position:[0,1.8,.3*n+2.5],geometry:i.folder_LP_Work_Folder_Work_0.geometry,material:r.Folder_Work}))}))};return(0,Kl.jsx)(a,{})}function E_(e){var n=Object.assign({},e),i=(0,t.useRef)(),r=__("/office_chair/scene.gltf"),a=r.nodes,o=r.materials;return(0,Kl.jsx)("group",Vb(Vb({ref:i},n),{},{dispose:null,children:(0,Kl.jsx)("group",{children:(0,Kl.jsxs)("group",{children:[(0,Kl.jsxs)("group",{position:[-21.91,2.3,-108.05],rotation:[-Math.PI/2,0,0],children:[(0,Kl.jsx)("mesh",{geometry:a.Cylinder01_Matteplastic_0.geometry,material:o.Matteplastic}),(0,Kl.jsx)("mesh",{geometry:a.Cylinder01_BlackMetal_0.geometry,material:o.BlackMetal})]}),(0,Kl.jsx)("group",{position:[-16.04,30.48,-108.05],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Rectangle11_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-25.15,24.27,-108.05],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Line01_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-14.46,23.8,-108.05],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder03_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("group",{position:[-25.59,24.17,-86.28],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Line02_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-29.26,24.56,-81.48],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Circle01_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("group",{position:[-18.74,27.15,-126.39],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder07_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-12.85,27.39,-126.4],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder08_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-12.9,28.29,-131.49],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder09_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-18.79,28.05,-131.48],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder10_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-18.78,27.84,-84.72],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder11_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-18.73,26.94,-89.81],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder12_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-12.89,28.09,-84.71],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder13_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-12.84,27.18,-89.8],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder14_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-18.11,48.52,-79.05],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Line04_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("group",{position:[-19.86,33.51,-79.26],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder15_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-12.68,33.81,-79.2],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder16_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-18.11,48.52,-136.57],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Line05_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("group",{position:[-12.68,33.81,-136.43],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder17_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[-19.86,33.51,-136.36],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder18_BlackMetal_0.geometry,material:o.BlackMetal})}),(0,Kl.jsx)("group",{position:[7.49,34.37,-108.05],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{geometry:a.Box01_Lether_0.geometry,material:o.Lether})}),(0,Kl.jsxs)("group",{position:[-51.39,55.29,-133.69],rotation:[-Math.PI/2,0,0],children:[(0,Kl.jsx)("mesh",{geometry:a.Box02_Lether_0.geometry,material:o.Lether}),(0,Kl.jsx)("mesh",{geometry:a.Box02_Chairback_0.geometry,material:o.Chairback})]}),(0,Kl.jsxs)("group",{position:[-21.91,-.06,-108.05],rotation:[-Math.PI/2,0,0],children:[(0,Kl.jsxs)("group",{position:[-9.74,28.28,-4.17],children:[(0,Kl.jsx)("group",{position:[-1.58,.25,-4.73],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder02_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("mesh",{geometry:a.Cylinder04_Matteplastic_0.geometry,material:o.Matteplastic})]}),(0,Kl.jsxs)("group",{position:[23.84,17.93,-4.17],children:[(0,Kl.jsx)("group",{position:[-.42,1.54,-4.73],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder19_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("mesh",{geometry:a.Cylinder20_Matteplastic_0.geometry,material:o.Matteplastic})]}),(0,Kl.jsxs)("group",{position:[24.42,-17.13,-4.17],children:[(0,Kl.jsx)("group",{position:[.92,1.31,-4.73],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder22_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("mesh",{geometry:a.Cylinder21_Matteplastic_0.geometry,material:o.Matteplastic})]}),(0,Kl.jsxs)("group",{position:[-8.75,-28.45,-4.17],children:[(0,Kl.jsx)("group",{position:[1.58,-.22,-4.73],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder24_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("mesh",{geometry:a.Cylinder23_Matteplastic_0.geometry,material:o.Matteplastic})]}),(0,Kl.jsxs)("group",{position:[-29.85,-.52,-4.17],children:[(0,Kl.jsx)("group",{position:[-.7,1.43,-4.73],children:(0,Kl.jsx)("mesh",{geometry:a.Cylinder25_Matteplastic_0.geometry,material:o.Matteplastic})}),(0,Kl.jsx)("mesh",{geometry:a.Cylinder26_Matteplastic_0.geometry,material:o.Matteplastic})]}),(0,Kl.jsx)("mesh",{geometry:a.Rectangle02_Chrome_0.geometry,material:o.Chrome})]})]})})}))}function J_(e){var n=Object.assign({},e),i=(0,t.useRef)(),r=__("/ultrawide_screen/scene.gltf"),a=r.nodes,o=r.materials;return(0,Kl.jsx)("group",{ref:i,dispose:null,children:(0,Kl.jsx)("group",{children:(0,Kl.jsx)("group",{children:(0,Kl.jsxs)("group",Vb(Vb({},n),{},{rotation:[-Math.PI/2,0,Math.PI/2],children:[(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Cube001_black_0.geometry,material:o.black}),(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Cube001_screen_0.geometry,material:o.screen})]}))})})})}function D_(e){var n=(0,t.useRef)();return(0,t.useEffect)((function(){console.log(n.current),n.current.angle=Math.PI/3,n.current.decay=2}),[]),(0,Kl.jsx)("spotLight",Vb({ref:n},e))}function U_(e){var n=Object.assign({},e),i=(0,t.useRef)(),r=__("/desk_lamp/scene.gltf"),a=r.nodes,o=r.materials;return(0,Kl.jsxs)("group",{children:[(0,Kl.jsx)(D_,{color:"#fcd483",castShadow:!0,position:[-.7,3,-2.74],distance:50,intensity:.7}),(0,Kl.jsx)("group",Vb(Vb({ref:i},n),{},{dispose:null,children:(0,Kl.jsx)("group",{rotation:[-Math.PI/2,0,0],scale:.06,children:(0,Kl.jsxs)("group",{rotation:[Math.PI/2,0,0],children:[(0,Kl.jsx)("group",{position:[-3.39,0,0],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Cylinder001_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[-7.97,2.98,0],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Cylinder003_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[-4.99,32.56,0],rotation:[Math.PI,0,2.45],children:(0,Kl.jsx)("group",{position:[0,0,-.76],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Box009_01_-_Default_0"].geometry,material:o["01_-_Default"]})})}),(0,Kl.jsx)("group",{position:[1.84,36.85,0],rotation:[-Math.PI/2,Math.PI/2,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Cylinder004_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsxs)("group",{position:[8.67,.16,0],rotation:[-Math.PI/2,0,0],children:[(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Cylinder005_01_-_Default_0"].geometry,material:o["01_-_Default"]}),(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Cylinder005_Material_#13_0"].geometry,material:o.Material_13})]}),(0,Kl.jsx)("group",{position:[-3.39,1,0],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Cylinder006_01_-_Default_0"].geometry,material:o["01_-_Default"]})}),(0,Kl.jsx)("group",{position:[-8.39,6.92,-.68],rotation:[Math.PI,0,-Math.PI],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Sphere001_03_-_Default_0"].geometry,material:o["03_-_Default"]})}),(0,Kl.jsx)("group",{position:[-13.34,26.48,0],rotation:[-Math.PI,0,-1.83],children:(0,Kl.jsx)("group",{position:[.09,1.04,-1],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object003_01_-_Default_0"].geometry,material:o["01_-_Default"]})})}),(0,Kl.jsx)("group",{position:[-14.05,26.07,0],rotation:[-Math.PI,0,-1.83],children:(0,Kl.jsx)("group",{position:[.09,1.04,-1],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object004_01_-_Default_0"].geometry,material:o["01_-_Default"]})})}),(0,Kl.jsx)("group",{position:[-14.05,26.07,0],rotation:[-Math.PI,0,-1.83],children:(0,Kl.jsx)("group",{position:[.09,1.04,-1],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object006_01_-_Default_0"].geometry,material:o["01_-_Default"]})})}),(0,Kl.jsx)("group",{position:[-4.84,9.16,-1.75],rotation:[0,0,1.85],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Spring013_02_-_Default_0"].geometry,material:o["02_-_Default"]})}),(0,Kl.jsx)("group",{position:[-13.49,26.56,0],rotation:[-Math.PI,0,-1.83],children:(0,Kl.jsx)("group",{position:[.09,1.04,-1],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object008_04_-_Default_0"].geometry,material:o["04_-_Default"]})})}),(0,Kl.jsx)("group",{position:[-8.08,2.39,0],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object012_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[-8.12,2.39,0],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object013_03_-_Default_0"].geometry,material:o["03_-_Default"]})}),(0,Kl.jsx)("group",{position:[8.67,.49,0],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object014_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[5.84,36.88,-.67],rotation:[Math.PI/2,-Math.PI/2,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Sphere017_03_-_Default_0"].geometry,material:o["03_-_Default"]})}),(0,Kl.jsx)("group",{position:[2.42,37.55,-4.68],rotation:[Math.PI,0,-2.79],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Cylinder008_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[2.52,35.88,8.43],scale:[-1,1,1],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object015_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[1.88,36.06,1.64],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Box010_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[1.88,36.06,1.64],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object016_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[-13.68,28.67,0],rotation:[Math.PI,0,-Math.PI],scale:[1,1,1.24],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Line002_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[-4.99,32.56,0],rotation:[Math.PI,0,2.45],children:(0,Kl.jsx)("group",{position:[0,0,-.76],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object017_04_-_Default_0"].geometry,material:o["04_-_Default"]})})}),(0,Kl.jsx)("group",{position:[-15.81,26.05,0],rotation:[Math.PI,0,2.45],children:(0,Kl.jsx)("group",{position:[-12.5,-1.83,-.76],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object018_01_-_Default_0"].geometry,material:o["01_-_Default"]})})}),(0,Kl.jsx)("group",{position:[-9.13,7.29,0],rotation:[-Math.PI,0,-.68],children:(0,Kl.jsx)("group",{position:[-12.5,-1.83,-.76],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object019_04_-_Default_0"].geometry,material:o["04_-_Default"]})})}),(0,Kl.jsx)("group",{position:[5.84,36.88,-.67],rotation:[Math.PI/2,-Math.PI/2,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object020_04_-_Default_0"].geometry,material:o["04_-_Default"]})}),(0,Kl.jsx)("group",{position:[-13.49,26.56,0],rotation:[-Math.PI,0,-1.83],children:(0,Kl.jsx)("group",{position:[.09,1.04,-1],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Object021_04_-_Default_0"].geometry,material:o["04_-_Default"]})})}),(0,Kl.jsxs)("group",{position:[8.65,29.4,0],rotation:[-Math.PI/2,0,0],children:[(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Sphere020_05_-_Default_0"].geometry,material:o["05_-_Default"]}),(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Sphere020_Ceramic_0.geometry,material:o.Ceramic})]}),(0,Kl.jsx)("group",{position:[19.8,0,4.4],rotation:[-Math.PI/2,0,0],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["Box011_03_-_Default_0"].geometry,material:o["03_-_Default"]})})]})})}))]})}function P_(e){var n=Object.assign({},e),i=(0,t.useRef)(),r=__("/keyboard/scene.gltf"),a=r.nodes,o=r.materials;return(0,Kl.jsx)("group",Vb(Vb({ref:i},n),{},{dispose:null,children:(0,Kl.jsx)("group",{rotation:[-Math.PI/2,0,0],children:(0,Kl.jsxs)("group",{rotation:[Math.PI/2,0,0],children:[(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Keycaps_Keycaps_0.geometry,material:o.Keycaps})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Stabilizers_Stabilizers_0.geometry,material:o.Stabilizers})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.LED_LED_0.geometry,material:o.material})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Wire_Wire_0.geometry,material:o.Wire})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Stabilizer_slots_Stabilizer_slots_0.geometry,material:o.Stabilizer_slots})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Case_Case_0.geometry,material:o.Case})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["6_Degrees_6_Degrees_0"].geometry,material:o["6_Degrees"]})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a["9_Degrees_9_Degrees_0"].geometry,material:o["9_Degrees"]})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Stem_Stem_0.geometry,material:o.Stem})}),(0,Kl.jsx)("group",{position:[-3.95,1.65,-52.4],children:(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Housing_Housing_0.geometry,material:o.Housing})})]})})}))}function Q_(e){var n=Object.assign({},e),i=(0,t.useRef)(),r=__("/mouse/scene.gltf"),a=r.nodes,o=r.materials;return(0,Kl.jsx)("group",Vb(Vb({ref:i},n),{},{dispose:null,children:(0,Kl.jsxs)("group",{rotation:[-Math.PI/2,0,0],scale:.11,children:[(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Object_2.geometry,material:o.DARK_GREY_MATTE}),(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Object_3.geometry,material:o.DARK_GREY_MATTE}),(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Object_4.geometry,material:o.Metal}),(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Object_5.geometry,material:o.NEON_Green_Light}),(0,Kl.jsx)("mesh",{castShadow:!0,receiveShadow:!0,geometry:a.Object_6.geometry,material:o.Silver})]})}))}function O_(e){var t,n,i=Ir(fL("Plane",(function(){return Vb({rotation:[-Math.PI/2,0,0]},e)}),(function(){return[]}),t,n),1)[0];return(0,Kl.jsxs)("mesh",{ref:i,receiveShadow:!0,children:[(0,Kl.jsx)("planeGeometry",{args:[20,20]}),(0,Kl.jsx)(jM,{blur:[300,300],resolution:1024,mixBlur:1,mixStrength:40,roughness:1,depthScale:1.2,minDepthThreshold:.4,maxDepthThreshold:1.4,color:"#101010",metalness:.5})]})}function j_(e){var n=(0,t.useRef)(),i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.size,i=void 0===n?256:n,r=e.frames,a=void 0===r?1/0:r,o=vM((function(e){return e.viewport.dpr})),s=vM((function(e){return e.size})),g=s.width,l=s.height,u=i||g*o,c=i||l*o,I=t.useMemo((function(){var e=new YR(u,c);return e.format=mG,e.type=aG,{depthTexture:e}}),[u,c]),C=0,d=$M(u,c,I);return bM((function(e){(a===1/0||C<a)&&(e.gl.setRenderTarget(d),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),C++)})),d.depthTexture}({frames:1});return(0,Kl.jsx)(rK,Vb({position:[10,10,5],depthBuffer:i,distance:25,castShadow:!0,color:"#FCF9D9",intensity:.25,angle:3,ref:n},e))}function q_(e){e.titleSectionRef;var n=e.clickedCanvas,i=Ir((0,t.useState)(0),2),r=(i[0],i[1],Ir((0,t.useState)(!1),2)),a=r[0],o=r[1],s=Ir((0,t.useState)(!1),2),g=s[0],l=s[1];return bM((function(e){n&&o(!0),a&&!g?l(!0):a||(e.camera.lookAt(0,0,0),e.camera.position.set(10*Math.sin(.02*e.clock.getElapsedTime()),10,10*Math.cos(.02*e.clock.getElapsedTime())))})),(0,Kl.jsxs)(t.Suspense,{fallback:null,children:[(0,Kl.jsx)(sK,{radius:50,depth:50,count:2e3,factor:10,saturation:0,fade:!0,speed:1}),(0,Kl.jsx)(lK,{makeDefault:!0,position:[15,10,20],zoom:1}),(0,Kl.jsx)(CK,{makeDefault:!0}),(0,Kl.jsx)(j_,{}),(0,Kl.jsxs)(ZL,{gravity:[0,-5,0],children:[(0,Kl.jsx)(E_,{scale:.05,position:[.8,-1.8,1.8],rotation:[0,-Math.PI/3,0]}),(0,Kl.jsx)(Q_,{position:[.5,1.35,-1.8],scale:.28}),(0,Kl.jsx)(P_,{position:[.5,1.2,0],rotation:[0,Math.PI/2,0],scale:.07}),(0,Kl.jsx)(J_,{position:[-1.8,1.45,0],scale:.1}),(0,Kl.jsx)(U_,{receiveShadow:!0,castShadow:!0,position:[-1,1.2,-3],rotation:[0,-Math.PI/5,0]}),(0,Kl.jsx)(T_,{receiveShadow:!0,castShadow:!0,scale:4,rotation:[Math.PI/2,Math.PI,-Math.PI/2]}),(0,Kl.jsx)(HL,{}),(0,Kl.jsx)(O_,{position:[0,-2.5,0]})]})]})}function $_(e){var n=e.canvaContainerRef,i=e.canvasRef,r=e.titleSectionRef,a=Ir((0,t.useState)(!1),2),o=a[0],s=a[1];return(0,Kl.jsx)("div",{id:"canvas-container",ref:n,children:(0,Kl.jsx)(JM,{onMouseDown:function(){return s(!0)},ref:i,shadows:!0,gl:{alpha:!1},children:(0,Kl.jsx)(q_,{titleSectionRef:r,clickedCanvas:o})})})}function eT(e){return su("MuiAppBar",e)}__.preload=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3?arguments[3]:void 0;return GM.preload(LL,e,L_(t,n,i))},__.clear=function(e){return GM.clear(LL,e)},__.preload("/scene.gltf"),__.preload("/scene.gltf"),__.preload("/scene.gltf"),__.preload("/scene.gltf"),__.preload("/scene.gltf"),__.preload("/scene.gltf");gu("MuiAppBar",["root","positionFixed","positionAbsolute","positionSticky","positionStatic","positionRelative","colorDefault","colorPrimary","colorSecondary","colorInherit","colorTransparent"]);var tT=["className","color","enableColorOnDark","position"],nT=function(e,t){return"".concat(null==e?void 0:e.replace(")",""),", ").concat(t,")")},iT=Al(Yc,{name:"MuiAppBar",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,t["position".concat(Ql(n.position))],t["color".concat(Ql(n.color))]]}})((function(e){var t=e.theme,n=e.ownerState,i="light"===t.palette.mode?t.palette.grey[100]:t.palette.grey[900];return oa({display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",flexShrink:0},"fixed"===n.position&&{position:"fixed",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0,"@media print":{position:"absolute"}},"absolute"===n.position&&{position:"absolute",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0},"sticky"===n.position&&{position:"sticky",zIndex:(t.vars||t).zIndex.appBar,top:0,left:"auto",right:0},"static"===n.position&&{position:"static"},"relative"===n.position&&{position:"relative"},!t.vars&&oa({},"default"===n.color&&{backgroundColor:i,color:t.palette.getContrastText(i)},n.color&&"default"!==n.color&&"inherit"!==n.color&&"transparent"!==n.color&&{backgroundColor:t.palette[n.color].main,color:t.palette[n.color].contrastText},"inherit"===n.color&&{color:"inherit"},"dark"===t.palette.mode&&!n.enableColorOnDark&&{backgroundColor:null,color:null},"transparent"===n.color&&oa({backgroundColor:"transparent",color:"inherit"},"dark"===t.palette.mode&&{backgroundImage:"none"})),t.vars&&oa({},"default"===n.color&&{"--AppBar-background":n.enableColorOnDark?t.vars.palette.AppBar.defaultBg:nT(t.vars.palette.AppBar.darkBg,t.vars.palette.AppBar.defaultBg),"--AppBar-color":n.enableColorOnDark?t.vars.palette.text.primary:nT(t.vars.palette.AppBar.darkColor,t.vars.palette.text.primary)},n.color&&!n.color.match(/^(default|inherit|transparent)$/)&&{"--AppBar-background":n.enableColorOnDark?t.vars.palette[n.color].main:nT(t.vars.palette.AppBar.darkBg,t.vars.palette[n.color].main),"--AppBar-color":n.enableColorOnDark?t.vars.palette[n.color].contrastText:nT(t.vars.palette.AppBar.darkColor,t.vars.palette[n.color].contrastText)},{backgroundColor:"var(--AppBar-background)",color:"inherit"===n.color?"inherit":"var(--AppBar-color)"},"transparent"===n.color&&{backgroundImage:"none",backgroundColor:"transparent",color:"inherit"}))})),rT=t.forwardRef((function(e,t){var n=Rl({props:e,name:"MuiAppBar"}),i=n.className,r=n.color,a=void 0===r?"primary":r,o=n.enableColorOnDark,s=void 0!==o&&o,g=n.position,l=void 0===g?"fixed":g,u=sa(n,tT),c=oa({},n,{color:a,position:l,enableColorOnDark:s}),I=function(e){var t=e.color,n=e.position,i=e.classes;return fl({root:["root","color".concat(Ql(t)),"position".concat(Ql(n))]},eT,i)}(c);return(0,Kl.jsx)(iT,oa({square:!0,component:"header",ownerState:c,elevation:4,className:ml(I.root,i,"fixed"===l&&"mui-fixed"),ref:t},u))})),aT=rT,oT=VC((0,Kl.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function sT(e){return su("MuiAvatar",e)}gu("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);var gT=["alt","children","className","component","imgProps","sizes","src","srcSet","variant"],lT=Al("div",{name:"MuiAvatar",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,t[n.variant],n.colorDefault&&t.colorDefault]}})((function(e){var t=e.theme,n=e.ownerState;return oa({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none"},"rounded"===n.variant&&{borderRadius:(t.vars||t).shape.borderRadius},"square"===n.variant&&{borderRadius:0},n.colorDefault&&oa({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:{backgroundColor:"light"===t.palette.mode?t.palette.grey[400]:t.palette.grey[600]}))})),uT=Al("img",{name:"MuiAvatar",slot:"Img",overridesResolver:function(e,t){return t.img}})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),cT=Al(oT,{name:"MuiAvatar",slot:"Fallback",overridesResolver:function(e,t){return t.fallback}})({width:"75%",height:"75%"});var IT=t.forwardRef((function(e,n){var i=Rl({props:e,name:"MuiAvatar"}),r=i.alt,a=i.children,o=i.className,s=i.component,g=void 0===s?"div":s,l=i.imgProps,u=i.sizes,c=i.src,I=i.srcSet,C=i.variant,d=void 0===C?"circular":C,h=sa(i,gT),A=null,p=function(e){var n=e.crossOrigin,i=e.referrerPolicy,r=e.src,a=e.srcSet,o=Ir(t.useState(!1),2),s=o[0],g=o[1];return t.useEffect((function(){if(r||a){g(!1);var e=!0,t=new Image;return t.onload=function(){e&&g("loaded")},t.onerror=function(){e&&g("error")},t.crossOrigin=n,t.referrerPolicy=i,t.src=r,a&&(t.srcset=a),function(){e=!1}}}),[n,i,r,a]),s}(oa({},l,{src:c,srcSet:I})),m=c||I,f=m&&"error"!==p,v=oa({},i,{colorDefault:!f,component:g,variant:d}),b=function(e){var t=e.classes;return fl({root:["root",e.variant,e.colorDefault&&"colorDefault"],img:["img"],fallback:["fallback"]},sT,t)}(v);return A=f?(0,Kl.jsx)(uT,oa({alt:r,src:c,srcSet:I,sizes:u,ownerState:v,className:b.img},l)):null!=a?a:m&&r?r[0]:(0,Kl.jsx)(cT,{className:b.fallback}),(0,Kl.jsx)(lT,oa({as:g,ownerState:v,className:ml(b.root,o),ref:n},h,{children:A}))})),CT=IT,dT=n.p+"static/media/logo.53bc556878f3f1fc1cd7.png";function hT(){return(0,Kl.jsx)(aT,{sx:{zIndex:9999,background:"transparent",boxShadow:"none"},position:"fixed",children:(0,Kl.jsxs)(id,{sx:{ml:4,mt:3,display:"flex",alignItems:"center"},children:[(0,Kl.jsx)(CT,{alt:"Siqi Liu",src:dT,sx:{mr:1,borderRadius:"25%"}}),(0,Kl.jsx)("a",{style:{textDecoration:"none"},href:"http://portfoliu.net",children:(0,Kl.jsx)(ud,{sx:{fontWeight:"bold"},color:"primary",variant:"h5",children:"Siqi Liu"})})]})})}var AT=function(){var e=(0,t.useRef)(),n=(0,t.useRef)(),i=(0,t.useRef)();return(0,t.useEffect)((function(){return wm.registerPlugin(mb),wm.to(e.current,{scrollTrigger:{trigger:n.current,start:"bottom bottom"},zIndex:1}),function(){wm.killTweensOf(n.current),wm.killTweensOf(e.current)}}),[]),(0,Kl.jsxs)(qC,{children:[(0,Kl.jsx)(hT,{}),(0,Kl.jsxs)("div",{className:"App",children:[(0,Kl.jsx)($_,{titleSectionRef:n,canvaContainerRef:e,canvasRef:i}),(0,Kl.jsx)(xb,{titleSectionRef:n}),(0,Kl.jsx)("div",{style:{height:"100vh"}})]})]})},pT=function(e){e&&e instanceof Function&&n.e(787).then(n.bind(n,787)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),i(e),r(e),a(e),o(e)}))};r.createRoot(document.getElementById("root")).render((0,Kl.jsx)(t.StrictMode,{children:(0,Kl.jsx)(AT,{})})),pT()}()}();
//# sourceMappingURL=main.63f7d60a.js.map